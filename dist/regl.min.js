(function(wa){"object"===typeof exports&&"undefined"!==typeof module?module.exports=wa():"function"===typeof define&&define.amd?define([],wa):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).initREGL=wa()})(function(){return function l(p,r,a){function g(n,k){if(!r[n]){if(!p[n]){var I="function"==typeof require&&require;if(!k&&I)return I(n,!0);if(h)return h(n,!0);I=Error("Cannot find module '"+n+"'");throw I.code="MODULE_NOT_FOUND",I;}I=r[n]=
{exports:{}};p[n][0].call(I.exports,function(h){var a=p[n][1][h];return g(a?a:h)},I,I.exports,l,p,r,a)}return r[n].exports}for(var h="function"==typeof require&&require,k=0;k<a.length;k++)g(a[k]);return g}({1:[function(l,p,r){function a(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(g,h,k,n,b){g=k.maxAttributes;h=Array(g);for(k=0;k<g;++k)h[k]=new a;return{Record:a,scope:{},state:h}}},
{}],2:[function(l,p,r){function a(h,a){switch(h){case 5121:return new Uint8Array(a);case 5123:return new Uint16Array(a);case 5125:return new Uint32Array(a);case 5120:return new Int8Array(a);case 5122:return new Int16Array(a);case 5124:return new Int32Array(a);case 5126:return new Float32Array(a);default:return null}}var g=l("./util/is-typed-array"),h=l("./util/is-ndarray"),k=l("./constants/arraytypes.json"),n=l("./constants/dtypes.json"),b=l("./util/values"),I={"static":35044,dynamic:35048,stream:35040};
p.exports=function(l){function p(a){this.id=z++;this.buffer=null;this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function A(a){l.isBuffer(a.buffer)||(a.buffer=l.createBuffer());a.bind();l.bufferData(a.type,a.data||a.byteLength,a.usage)}function u(a){var h=a.buffer;l.isBuffer(h)&&l.deleteBuffer(h);a.buffer=null;delete c[a.id]}function t(b,l,t){function z(c){var b=c||{};if(Array.isArray(b)||g(b)||h(b))b={data:b};else if("number"===typeof b)b={length:b|
0};else if(null===b||void 0===b)b={};x.usage="usage"in b?I[b.usage]:35044;c=0;"type"in b&&(c=n[b.type]);var l=b.dimension|0||1,t=0,v=null;if("data"in b)if(v=b.data,null===v)t=b.length|0;else{if(h(v)){var l=v.shape,t=v.stride,b=v.offset,w=0,G=0,u=0,H=0;1===l.length?(w=l[0],G=1,u=t[0],H=0):2===l.length&&(w=l[0],G=l[1],u=t[0],H=t[1]);c=c||k[Object.prototype.toString.call(v.data)]|0||5126;for(var l=G,t=a(c,w*G),v=v.data,p=0,y=0;y<w;++y)for(var F=0;F<G;++F)t[p++]=v[u*y+H*F+b];v=t}else if(Array.isArray(v))if(0<
v.length&&Array.isArray(v[0])){l=v[0].length;c=c||5126;b=a(c,v.length*l);t=v;v=l;for(w=H=0;w<t.length;++w)for(u=t[w],G=0;G<v;++G)b[H++]=u[G];v=b}else c=c||5126,v=a(c,v);else c=c||k[Object.prototype.toString.call(v)]|0;t=v.byteLength}else"length"in b&&(t=b.length|0);x.data=v;x.dtype=c||5121;x.byteLength=t;x.dimension=l;A(x);return z}var x=new p(l);c[x.id]=x;t||z(b);z._reglType="buffer";z._buffer=x;z.destroy=function(){u(x)};return z}var z=0,c={};p.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)};
return{create:t,createStream:function(a){return t({data:a,usage:"stream"},34962,!1)._buffer},destroyStream:function(a){u(a)},clear:function(){b(c).forEach(u)},refresh:function(){b(c).forEach(A)},getBuffer:function(a){return a&&a._buffer instanceof p?a._buffer:null}}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./util/is-ndarray":20,"./util/is-typed-array":21,"./util/values":27}],3:[function(l,p,r){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,
"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(l,p,r){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],5:[function(l,p,r){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(l,p,r){function a(a){return Array.isArray(a)||
ca(a)||A(a)}function g(a){return a.sort(function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1})}function h(a,c,h,b){this.thisDep=a;this.contextDep=c;this.propDep=h;this.append=b}function k(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function n(a){return new h(!1,!1,!1,a)}function b(a,c){var b=a.type;return 0===b?(b=a.data.length,new h(!0,1<=b,2<=b,c)):new h(3===b,2===b,1===b,c)}var I=l("./util/codegen"),F=l("./util/loop"),ca=l("./util/is-typed-array"),A=l("./util/is-ndarray"),u=l("./constants/primitives.json"),
t=l("./constants/dtypes.json"),z=["x","y","z","w"],c={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},v={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,
"!=":517,"!==":517,gequal:518,">=":518,always:519},H={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},y={cw:2304,ccw:2305},aa=new h(!1,!1,!1,function(){});p.exports=function(l,p,A,r,W,J,w,G,fa,S,Y,ga,N){function Q(d){return d.replace(".","_")}function E(d,m,a){var f=Q(d);ra.push(d);oa[f]=ja[f]=!!a;ka[f]=m}function C(d,m,a){var f=Q(d);ra.push(d);Array.isArray(a)?(ja[f]=a.slice(),oa[f]=a.slice()):ja[f]=oa[f]=a;la[f]=m}function R(){var d=
I(),m=d.link,a=d.global;d.id=Da++;d.batchId="0";var f=m(Aa),c=d.shared={props:"a0"};Object.keys(Aa).forEach(function(e){c[e]=a.def(f,".",e)});var D=d.next={},b=d.current={};Object.keys(la).forEach(function(e){Array.isArray(ja[e])&&(D[e]=a.def(c.next,".",e),b[e]=a.def(c.current,".",e))});var e=d.constants={};Object.keys(sa).forEach(function(d){e[d]=a.def(JSON.stringify(sa[d]))});d.invoke=function(e,U){switch(U.type){case 0:var a=["this",c.context,c.props,d.batchId];return e.def(m(U.data),".call(",
a.slice(0,Math.max(U.data.length+1,4)),")");case 1:return e.def(c.props,U.data);case 2:return e.def(c.context,U.data);case 3:return e.def("this",U.data)}};d.attribCache={};var U={};d.scopeAttrib=function(e){e=p.id(e);if(e in U)return U[e];var d=S.scope[e];d||(d=S.scope[e]=new pa);return U[e]=m(d)};return d}function ba(d){var m=d["static"];d=d.dynamic;if("framebuffer"in m){var a=m.framebuffer;return a?(a=G.getFramebuffer(a),n(function(d,m){var f=d.link(a),e=d.shared;m.set(e.framebuffer,".next",f);
e=e.context;m.set(e,".framebufferWidth",f+".width");m.set(e,".framebufferHeight",f+".height");return f})):n(function(d,m){var a=d.shared;m.set(a.framebuffer,".next","null");a=a.context;m.set(a,".framebufferWidth",a+".drawingBufferWidth");m.set(a,".framebufferHeight",a+".drawingBufferHeight");return null})}if("framebuffer"in d){var f=d.framebuffer;return b(f,function(d,m){var a=d.invoke(m,f),e=d.shared,U=e.framebuffer,a=m.def(U,".getFramebuffer(",a,")");m.set(U,".next",a);e=e.context;m.set(e,".framebufferWidth",
a+"?"+a+".width:"+e+".drawingBufferWidth");m.set(e,".framebufferHeight",a+"?"+a+".height:"+e+".drawingBufferHeight");return a})}return null}function M(d,a){function m(e){if(e in f){var d=f[e];e=!0;var ia=d.x|0,Ba=d.y|0,D,q;"w"in d?D=d.w|0:e=!1;"h"in d?q=d.h|0:e=!1;return new h(e&&a&&a.thisDep,e&&a&&a.contextDep,e&&a&&a.propDep,function(e,a){var m=e.shared.context,f=D;"w"in d||(f=a.def(m,".","framebufferWidth","-",ia));var c=q;"h"in d||(c=a.def(m,".","framebufferHeight","-",Ba));return[ia,Ba,f,c]})}if(e in
c){var na=c[e];e=b(na,function(e,a){var d=e.invoke(a,na),m=e.shared.context,f=a.def(d,".x|0"),U=a.def(d,".y|0"),ia=a.def('"w" in ',d,"?",d,".w|0:","(",m,".","framebufferWidth","-",f,")"),d=a.def('"h" in ',d,"?",d,".h|0:","(",m,".","framebufferHeight","-",U,")");return[f,U,ia,d]});a&&(e.thisDep=e.thisDep||a.thisDep,e.contextDep=e.contextDep||a.contextDep,e.propDep=e.propDep||a.prpoDep);return e}return a?new h(a.thisDep,a.contextDep,a.propDep,function(e,d){var a=e.shared.context;return[0,0,d.def(a,
".","framebufferWidth"),d.def(a,".","framebufferHeight")]}):null}var f=d["static"],c=d.dynamic,D=m("viewport");if(D)var q=D,D=new h(D.thisDep,D.contextDep,D.propDep,function(e,d){var a=q.append(e,d),m=e.shared.context;d.set(m,".viewportWidth",a[2]);d.set(m,".viewportHeight",a[3]);return a});return{viewport:D,scissor_box:m("scissor.box")}}function L(d){function a(e){if(e in m){var d=p.id(m[e]);e=n(function(){return d});e.id=d;return e}if(e in f){var c=f[e];return b(c,function(e,d){var a=e.invoke(d,
c);return d.def(e.shared.strings,".id(",a,")")})}return null}var m=d["static"],f=d.dynamic,c=a("frag"),D=a("vert"),q=null;k(c)&&k(D)?(q=Y.program(D.id,c.id),d=n(function(e,d){return e.link(q)})):d=new h(c&&c.thisDep||D&&D.thisDep,c&&c.contextDep||D&&D.contextDep,c&&c.propDep||D&&D.propDep,function(e,d){var a=e.shared.shader,m;m=c?c.append(e,d):d.def(a,".","frag");var f;f=D?D.append(e,d):d.def(a,".","vert");return d.def(a+".program("+f+","+m+")")});return{frag:c,vert:D,progVar:d,program:q}}function K(d){function m(d,
e){if(d in f){var a=f[d]|0;return n(function(d,m){e&&(d.OFFSET=a);return a})}if(d in c){var ia=c[d];return b(ia,function(d,a){var m=d.invoke(a,ia);e&&(d.OFFSET=m);return m})}return e&&q?n(function(e,d){e.OFFSET="0";return 0}):null}var f=d["static"],c=d.dynamic,q=function(){if("elements"in f){var d=f.elements;a(d)?d=J.getElements(J.create(d)):d&&(d=J.getElements(d));var e=n(function(e,a){if(d){var m=e.link(d);return e.ELEMENTS=m}return e.ELEMENTS=null});e.value=d;return e}if("elements"in c){var m=
c.elements;return b(m,function(e,d){var a=e.shared,f=a.isBufferArgs,a=a.elements,c=e.invoke(d,m),q=d.def("null"),f=d.def(f,"(",c,")"),c=e.cond(f).then(q,"=",a,".createStream(",c,");")["else"](q,"=",a,".getElements(",c,");");d.entry(c);d.exit(e.cond(f).then(a,".destroyStream(",q,");"));return e.ELEMENTS=q})}return null}(),D=m("offset",!0);return{elements:q,primitive:function(){if("primitive"in f){var d=f.primitive;return n(function(e,a){return u[d]})}if("primitive"in c){var e=c.primitive;return b(e,
function(d,a){var m=d.constants.primTypes,f=d.invoke(a,e);return a.def(m,"[",f,"]")})}return q?k(q)?q.value?n(function(e,d){return d.def(e.ELEMENTS,".primType")}):n(function(){return 4}):new h(q.thisDep,q.contextDep,q.propDep,function(e,d){var a=e.ELEMENTS;return d.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in f){var d=f.count|0;return n(function(){return d})}if("count"in c){var e=c.count;return b(e,function(d,a){return d.invoke(a,e)})}return q?k(q)?q?D?new h(D.thisDep,D.contextDep,
D.propDep,function(e,d){return d.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):n(function(e,d){return d.def(e.ELEMENTS,".vertCount")}):n(function(){return-1}):new h(q.thisDep||D.thisDep,q.contextDep||D.contextDep,q.propDep||D.propDep,function(e,d){var a=e.ELEMENTS;return e.OFFSET?d.def(a,"?",a,".vertCount-",e.OFFSET,":-1"):d.def(a,"?",a,".vertCount:-1")}):null}(),instances:m("instances",!1),offset:D}}function V(d){var a=d["static"],m=d.dynamic,f={};ra.forEach(function(d){function q(e,c){if(d in a){var ia=
e(a[d]);f[h]=n(function(){return ia})}else if(d in m){var D=m[d];f[h]=b(D,function(e,d){return c(e,d,e.invoke(d,D))})}}var h=Q(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return q(function(e){return e},function(e,d,a){return a});case "depth.func":return q(function(e){return v[e]},function(e,d,a){return d.def(e.constants.compareFuncs,
"[",a,"]")});case "depth.range":return q(function(e){return e},function(e,d,a){e=d.def("+",a,"[0]");d=d.def("+",a,"[1]");return[e,d]});case "blend.func":return q(function(e){return[c["srcRGB"in e?e.srcRGB:e.src],c["dstRGB"in e?e.dstRGB:e.dst],c["srcAlpha"in e?e.srcAlpha:e.src],c["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,d,a){function m(e,c){var q=d.def('"',e,c,'" in ',a,"?",a,".",e,c,":",a,".",e);return d.def(f,"[",q,"]")}var f=e.constants.blendFuncs;e=m("src","RGB");var c=m("src","Alpha"),q=
m("dst","RGB"),ha=m("dst","Alpha");return[e,q,c,ha]});case "blend.equation":return q(function(e){if("string"===typeof e)return[ma[e],ma[e]];if("object"===typeof e)return[ma[e.rgb],ma[e.alpha]]},function(e,d,a){var m=e.constants.blendEquations,f=d.def(),c=d.def();e=e.cond("typeof ",a,'==="string"');e.then(f,"=",c,"=",m,"[",a,"];");e["else"](f,"=",m,"[",a,".rgb];",c,"=",m,"[",a,".alpha];");d(e);return[f,c]});case "blend.color":return q(function(e){return F(4,function(d){return+e[d]})},function(e,d,
a){return F(4,function(e){return d.def("+",a,"[",e,"]")})});case "stencil.mask":return q(function(e){return e|0},function(e,d,a){return d.def(a,"|0")});case "stencil.func":return q(function(e){return[v[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,d,a){e=d.def('"cmp" in ',a,"?",e.constants.compareFuncs,"[",a,".cmp]",":",7680);var m=d.def(a,".ref|0");d=d.def('"mask" in ',a,"?",a,".mask|0:-1");return[e,m,d]});case "stencil.opFront":case "stencil.opBack":return q(function(e){return["stencil.opBack"===
d?1029:1028,H[e.fail||"keep"],H[e.zfail||"keep"],H[e.pass||"keep"]]},function(e,a,m){function f(e){return a.def('"',e,'" in ',m,"?",c,"[",m,".",e,"]:",7680)}var c=e.constants.stencilOps;return["stencil.opBack"===d?1029:1028,f("fail"),f("zfail"),f("pass")]});case "polygonOffset.offset":return q(function(e){return[e.factor|0,e.units|0]},function(e,d,a){e=d.def(a,".factor|0");d=d.def(a,".units|0");return[e,d]});case "cull.face":return q(function(e){var d=0;"front"===e?d=1028:"back"===e&&(d=1029);return d},
function(e,d,a){return d.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return q(function(d){return d},function(d,a,m){return m});case "frontFace":return q(function(d){return y[d]},function(d,a,m){return a.def(m+'==="cw"?2304:2305')});case "colorMask":return q(function(d){return d.map(function(d){return!!d})},function(d,a,m){return F(4,function(d){return"!!"+m+"["+d+"]"})});case "sample.coverage":return q(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,m){d=a.def('"value" in ',
m,"?+",m,".value:1");a=a.def("!!",m,".invert");return[d,a]})}});return f}function T(d){var a=d["static"],m=d.dynamic,f={};Object.keys(a).forEach(function(d){var m=a[d],c;if("number"===typeof m||"boolean"===typeof m)c=n(function(){return m});else if("function"===typeof m&&"texture"===m._reglType)c=n(function(d){return d.link(m)});else if(Array.isArray(m)||ca(m))c=n(function(d){return d.global.def("[",F(m.length,function(d){return m[d]}),"]")});c.value=m;f[d]=c});Object.keys(m).forEach(function(d){var a=
m[d];f[d]=b(a,function(d,e){return d.invoke(e,a)})});return f}function Z(d){var m=d["static"],f=d.dynamic,c={};Object.keys(m).forEach(function(d){var f=m[d],q=p.id(d),e=new pa;if(a(f))e.state=1,e.buffer=W.getBuffer(W.create(f,34962,!1)),e.type=e.buffer.dtype;else{var b=W.getBuffer(f);if(b)e.state=1,e.buffer=b,e.type=b.dtype;else if(f.constant){var h=f.constant;e.state=2;"number"===typeof h?e.x=h:z.forEach(function(d,a){a<h.length&&(e[d]=h[a])})}else{var b=W.getBuffer(f.buffer),g=f.offset|0,k=f.stride|
0,B=f.size|0,l=!!f.normalized,na=0;"type"in f&&(na=t[f.type]);f=f.divisor|0;e.buffer=b;e.state=1;e.size=B;e.normalized=l;e.type=na||b.dtype;e.offset=g;e.stride=k;e.divisor=f}}c[d]=n(function(d,a){var m=d.attribCache;if(q in m)return m[q];var f={isStream:!1};Object.keys(e).forEach(function(d){f[d]=e[d]});e.buffer&&(f.buffer=d.link(e.buffer));return m[q]=f})});Object.keys(f).forEach(function(d){var a=f[d];c[d]=b(a,function(d,e){function m(d){e(h[d],"=",f,".",d,"|0;")}var f=d.invoke(e,a),c=d.shared,
q=c.isBufferArgs,b=c.buffer,h={isStream:e.def(!1)},ha=new pa;ha.state=1;Object.keys(ha).forEach(function(d){h[d]=e.def(""+ha[d])});var n=h.buffer,g=h.type;e("if(",q,"(",f,")){",h.isStream,"=true;",n,"=",b,".createStream(",f,");",g,"=",n,".dtype;","}else{",n,"=",b,".getBuffer(",f,");","if(",n,"){",g,"=",n,".dtype;","}else if(",f,".constant){",h.state,"=",2,";",z.map(function(d,a){return h[d]+"="+f+".length>="+a+"?"+f+"["+a+"]:0;"}).join(""),"}else{",n,"=",b,".getBuffer(",f,".buffer);",g,'="type" in ',
f,"?",c.glTypes,"[",f,".type]:",n,".dtype;",h.normalized,"=!!",f,".normalized;");m("size");m("offset");m("stride");m("divisor");e("}}");return h})});return c}function O(d){var a=d["static"],m=d.dynamic,f={};Object.keys(a).forEach(function(d){var m=a[d];f[d]=n(function(d,a){return"number"===typeof m||"boolean"===typeof m?""+m:d.link(m)})});Object.keys(m).forEach(function(d){var a=m[d];f[d]=b(a,function(d,e){return d.invoke(e,a)})});return f}function P(d,a,m){var f=d.shared.context,c=d.scope();Object.keys(m).forEach(function(q){a.save(f,
"."+q);c(f,".",q,"=",m[q].append(d,a),";")});a(c)}function m(d,a,m){var f=d.shared,c=f.gl,q=f.framebuffer,h;ta&&(h=a.def(f.extensions,".webgl_draw_buffers"));var e=d.constants,f=e.drawBuffers,e=e.backBuffer;d=m?m.append(d,a):a.def(q,".next");a("if(",q,".dirty||",d,"!==",q,".cur){","if(",d,"){",c,".bindFramebuffer(",36160,",",d,".framebuffer);");ta&&a(h,".drawBuffersWEBGL(",f,"[",d,".colorAttachments.length]);");a("}else{",c,".bindFramebuffer(",36160,",null);");ta&&a(h,".drawBuffersWEBGL(",e,");");
a("}",q,".cur=",d,";",q,".dirty=false;","}")}function q(d,a,m){var f=d.shared,c=f.gl,q=d.current,h=d.next,e=f.current,b=f.next,n=d.cond(e,".dirty");ra.forEach(function(a){a=Q(a);if(!(a in m.state)){var f,ha;if(a in h){f=h[a];ha=q[a];var g=F(ja[a].length,function(d){return n.def(f,"[",d,"]")});n(d.cond(g.map(function(d,a){return d+"==="+ha+"["+a+"]"}).join("&&")).then(c,".",la[a],"(",g,");",g.map(function(d,a){return ha+"["+a+"]="+d}).join(";"),";"))}else f=n.def(b,".",a),g=d.cond(f,"!==",e,".",a),
n(g),a in ka?g(d.cond(f).then(c,".enable(",ka[a],");")["else"](c,".disable(",ka[a],");"),e,".",a,"=",f,";"):g(c,".",la[a],"(",f,");",e,".",a,"=",f,";")}});0===Object.keys(m.state).length&&n(e,".dirty=false;");a(n)}function f(d,a,m,f){var c=d.shared,q=d.current,h=c.current,e=c.gl;g(Object.keys(m)).forEach(function(c){var b=m[c];if(!f||f(b)){var n=b.append(d,a);if(ka[c]){var g=ka[c];k(b)?n?a(e,".enable(",g,");"):a(e,".disable(",g,");"):a(d.cond(n).then(e,".enable(",g,");")["else"](e,".disable(",g,");"));
a(h,".",c,"=",n,";")}else if(Array.isArray(n)){var B=q[c];a(e,".",la[c],"(",n,");",n.map(function(d,a){return B+"["+a+"]="+d}).join(";"),";")}else a(e,".",la[c],"(",n,");",h,".",c,"=",n,";")}})}function B(d,a){qa&&!d.instancing&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function ua(d,a,m,f,c){function q(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(m,
f,c){function q(){a("if(!",k,".pointer){",n,".enableVertexAttribArray(",g,");",k,".pointer=true;}");var e=c.type,m;m=c.size?a.def(c.size,"||",f):f;a("if(",k,".type!==",e,"||",k,".size!==",m,"||",v.map(function(d){return k+"."+d+"!=="+c[d]}).join("||"),"){",n,".bindBuffer(",34962,",",B,".buffer);",n,".vertexAttribPointer(",[g,m,e,c.normalized,c.stride,c.offset],");",k,".type=",e,";",k,".size=",m,";",v.map(function(d){return k+"."+d+"="+c[d]+";"}).join(""),"}");qa&&(e=c.divisor,a("if(",k,".divisor!==",
e,"){",d.instancing,".vertexAttribDivisorANGLE(",[g,e],");",k,".divisor=",e,";}"))}function b(){a("if(",k,".pointer){",n,".disableVertexAttribArray(",g,");",k,".pointer=false;","}if(",z.map(function(d,a){return k+"."+d+"!=="+l[a]}).join("||"),"){",n,".vertexAttrib4f(",g,",",l,");",z.map(function(d,a){return k+"."+d+"="+l[a]+";"}).join(""),"}")}var n=e.gl,g=a.def(m,".location"),k=a.def(e.attributes,"[",g,"]");m=c.state;var B=c.buffer,l=[c.x,c.y,c.z,c.w],v=["buffer","normalized","offset","stride"];
1===m?q():2===m?b():(a("if(",m,"===",1,"){"),q(),a("}else{"),b(),a("}"))}var e=d.shared;f.forEach(function(e){var f=e.name,b=m.attributes[f],n;if(b){if(!c(b))return;n=b.append(d,a)}else{if(!c(aa))return;var g=d.scopeAttrib(f);n={};Object.keys(new pa).forEach(function(d){n[d]=a.def(g,".",d)})}h(d.link(e),q(e.info.type),n)})}function va(d,a,m,f,c){for(var q=d.shared,b=q.gl,e,h=0;h<f.length;++h){var n=f[h],g=n.name,k=n.info.type,B=m.uniforms[g],n=d.link(n)+".location";if(B){if(!c(B))continue;if(B["static"]){g=
B.value;if(35678===k||35680===k)k=d.link(g._texture),a(b,".uniform1i(",n,k+".bind());"),a.exit(k,".unbind()");else if(35674===k||35675===k||35676===k)g=d.global.def("["+g+"]"),B=2,35675===k?B=3:35676===k&&(B=4),a(b,".uniformMatrix",B,"fv(",n,",false,",g,");");else{switch(k){case 5126:e="1f";break;case 35664:e="2f";break;case 35665:e="3f";break;case 35666:e="4f";break;case 35670:e="1i";break;case 5124:e="1i";break;case 35671:e="2i";break;case 35667:e="2i";break;case 35672:e="3i";break;case 35668:e=
"3i";break;case 35673:e="4i";break;case 35669:e="4i"}a(b,".uniform",e,"(",n,",",g,");")}continue}else g=B.append(d,a)}else{if(!c(aa))continue;g=a.def(q.uniforms,"[",p.id(g),"]")}B=",";switch(k){case 35678:case 35680:k=a.def(g,"._texture");a(b,".uniform1i(",n,",",k,".bind());");a.exit(k,".unbind();");continue;case 5124:case 35670:e="1i";break;case 35667:case 35671:e="2iv";break;case 35668:case 35672:e="3iv";break;case 35669:case 35673:e="4iv";break;case 5126:e="1f";break;case 35664:e="2fv";break;case 35665:e=
"3fv";break;case 35666:e="4fv";break;case 35674:e="Matrix2fv";B=",false,";break;case 35675:e="Matrix3fv";B=",false,";break;case 35676:e="Matrix4fv",B=",false,"}a(b,".uniform",e,"(",n,B,g,");")}}function xa(d,a,m,f){function c(e){var f=g[e];return f?f.batchStatic?f.append(d,a):f.append(d,m):a.def(n,".",e)}function q(){function d(){m(u,".drawElementsInstancedANGLE(",[l,t,G,v+"<<(("+G+"-5121)>>1)",w],");")}function a(){m(u,".drawArraysInstancedANGLE(",[l,v,t,w],");")}B?H?d():(m("if(",B,"){"),d(),m("}else{"),
a(),m("}")):a()}function b(){function d(){m(h+".drawElements("+[l,t,G,v+"<<(("+G+"-5121)>>1)"]+");")}function a(){m(h+".drawArrays("+[l,v,t]+");")}B?H?d():(m("if(",B,"){"),d(),m("}else{"),a(),m("}")):a()}var e=d.shared,h=e.gl,n=e.draw,g=f.draw,B=function(){var e=g.elements,f=a;e?(e.batchStatic||(f=m),e=e.append(d,f)):e=f.def(n,".","elements");e&&f("if("+e+")"+h+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),l=c("primitive"),v=c("offset"),t=function(){var e=g.count,f=a;e?(e.batchStatic||(f=
m),e=e.append(d,f)):e=f.def(n,".","count");return e}();if("number"===typeof t){if(0===t)return}else m("if(",t,"){"),m.exit("}");var w,u;qa&&(w=c("instances"),u=d.instancing);var G=B+".type",H=g.elements&&k(g.elements);qa&&("number"!==typeof w||0<=w)?"string"===typeof w?(m("if(",w,">0){"),q(),m("}else if(",w,"<0){"),b(),m("}")):q():b()}function ya(d,a,m,f,c){a=R();c=a.proc("body",c);qa&&(a.instancing=c.def(a.shared.extensions,".angle_instanced_arrays"));d(a,c,m,f);return a.compile().body}function Ca(d,
a,m,f){B(d,a);ua(d,a,m,f.attributes,function(){return!0});va(d,a,m,f.uniforms,function(){return!0});xa(d,a,a,m)}function Ea(d,a){var c=d.proc("draw",1);B(d,c);P(d,c,a.context);m(d,c,a.framebuffer);q(d,c,a);f(d,c,a.state);var b=a.shader.progVar.append(d,c);c(d.shared.gl,".useProgram(",b,".program);");if(a.shader.program)Ca(d,c,a,a.shader.program);else{var h=d.global.def("{}"),n=c.def(b,".id"),g=c.def(h,"[",n,"]");c(d.cond(g).then(g,".call(this,a0);")["else"](g,"=",h,"[",n,"]=",d.link(function(e){return ya(Ca,
d,a,e,1)}),"(",b,");",g,".call(this,a0);"))}0<Object.keys(a.state).length&&c(d.shared.current,".dirty=true;")}function Fa(a,m,f,c){function q(){return!0}a.batchId="a1";B(a,m);ua(a,m,f,c.attributes,q);va(a,m,f,c.uniforms,q);xa(a,m,m,f)}function za(a,c,q,b){function h(a){return a.contextDep&&g||a.propDep}function n(a){return!h(a)}B(a,c);var g=q.contextDynamic,e=c.def(),k=c.def();a.shared.props=k;a.batchId=e;var l=a.scope(),v=a.scope();c(l.entry,"for(",e,"=0;",e,"<","a1",";++",e,"){",k,"=","a0","[",
e,"];",v,"}",l.exit);q.needsContext&&P(a,v,q.context);q.needsFramebuffer&&m(a,v,q.framebuffer);f(a,v,q.state,h);b?(ua(a,l,q,b.attributes,n),ua(a,v,q,b.attributes,h),va(a,l,q,b.uniforms,n),va(a,v,q,b.uniforms,h),xa(a,l,v,q)):(c=a.global.def("{}"),b=q.shader.progVar.append(a,v),k=v.def(b,".id"),l=v.def(c,"[",k,"]"),v(a.shared.gl,".useProgram(",b,".program);","if(!",l,"){",l,"=",c,"[",k,"]=",a.link(function(e){return ya(Fa,a,q,e,2)}),"(",b,");}",l,".call(this,a0[",e,"],",e,");"))}function Ga(a,c){var b=
a.proc("batch",2);a.batchId="0";B(a,b);var h=!1,n=!0;Object.keys(c.context).forEach(function(a){h=h||c.context[a].propDep});h||(P(a,b,c.context),n=!1);var g=c.framebuffer,k=!1;g&&(g.propDep?h=k=!0:g.contextDep&&h&&(k=!0),k||m(a,b,g));c.state.viewport&&c.state.viewport.propDynamic&&(h=!0);q(a,b,c);f(a,b,c.state,function(a){return!(a.contextDep&&h||a.propDep)});c.contextDep=h;c.needsContext=n;c.needsFramebuffer=k;n=c.shader.progVar;if(n.contextDep&&h||n.propDep)za(a,b,c,null);else if(n=n.append(a,b),
b(a.shared.gl,".useProgram(",n,".program);"),c.shader.program)za(a,b,c,c.shader.program);else{var g=a.global.def("{}"),k=b.def(n,".id"),e=b.def(g,"[",k,"]");b(a.cond(e).then(e,".call(this,a0,a1);")["else"](e,"=",g,"[",k,"]=",a.link(function(e){return ya(za,a,c,e,2)}),"(",n,");",e,".call(this,a0,a1);"))}0<Object.keys(c.state).length&&b(a.shared.current,".dirty=true;")}function Ha(a,m){function f(b){var e=m.shader[b];e&&c.set(q.shader,"."+b,e.append(a,c))}var c=a.proc("scope",3);a.batchId="a2";var q=
a.shared,b=q.current;P(a,c,m.context);m.framebuffer&&m.framebuffer.append(a,c);g(Object.keys(m.state)).forEach(function(f){var e=m.state[f].append(a,c);Array.isArray(e)?e.forEach(function(m,e){c.set(a.next[f],"["+e+"]",m)}):c.set(q.next,"."+f,e)});["elements","offset","count","instances","primitive"].forEach(function(f){var e=m.draw[f];e&&c.set(q.draw,"."+f,""+e.append(a,c))});Object.keys(m.uniforms).forEach(function(f){c.set(q.uniforms,"["+p.id(f)+"]",m.uniforms[f].append(a,c))});Object.keys(m.attributes).forEach(function(f){var e=
m.attributes[f].append(a,c),q=a.scopeAttrib(f);Object.keys(new pa).forEach(function(a){c.set(q,"."+a,e[a])})});f("vert");f("frag");0<Object.keys(m.state).length&&(c(b,".dirty=true;"),c.exit(b,".dirty=true;"));c("a1(",a.shared.context,",a0,0);")}var pa=S.Record,ma={add:32774,subtract:32778,"reverse subtract":32779};A.ext_blend_minmax&&(ma.min=32775,ma.max=32776);var qa=A.angle_instanced_arrays,ta=A.webgl_draw_buffers,ja={dirty:!0},oa={},ra=[],ka={},la={};E("dither",3024);E("blend.enable",3042);C("blend.color",
"blendColor",[0,0,0,0]);C("blend.equation","blendEquationSeparate",[32774,32774]);C("blend.func","blendFuncSeparate",[1,0,1,0]);E("depth.enable",2929,!0);C("depth.func","depthFunc",513);C("depth.range","depthRange",[0,1]);C("depth.mask","depthMask",!0);C("colorMask","colorMask",[!0,!0,!0,!0]);E("cull.enable",2884);C("cull.face","cullFace",1029);C("frontFace","frontFace",2305);C("lineWidth","lineWidth",1);E("polygonOffset.enable",32823);C("polygonOffset.offset","polygonOffset",[0,0]);E("sample.alpha",
32926);E("sample.enable",32928);C("sample.coverage","sampleCoverage",[1,!1]);E("stencil.enable",2960);C("stencil.mask","stencilMask",-1);C("stencil.func","stencilFunc",[519,0,-1]);C("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);C("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);E("scissor.enable",3089);C("scissor.box","scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);C("viewport","viewport",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var Aa={gl:l,context:N,
strings:p,next:oa,current:ja,draw:ga,elements:J,buffer:W,shader:Y,attributes:S.state,uniforms:fa,framebuffer:G,extensions:A,isBufferArgs:a},sa={primTypes:u,compareFuncs:v,blendFuncs:c,blendEquations:ma,stencilOps:H,glTypes:t,orientationType:y};ta&&(sa.backBuffer=[1029],sa.drawBuffer=F(r.maxDrawbuffers,function(a){return F(a,function(a){return 36064+a})}));var Da=0;return{next:oa,current:ja,procs:function(){var a=R(),f=a.proc("poll"),c=a.proc("refresh"),q=a.block();f(q);c(q);var b=a.shared,h=b.gl,
n=b.next,e=b.current;q(e,".dirty=false;");m(a,f);c(b.framebuffer,".dirty=true;");m(a,c);Object.keys(ka).forEach(function(m){var b=ka[m],g=q.def(n,".",m),k=a.block();k("if(",g,"){",h,".enable(",b,")}else{",h,".disable(",b,")}",e,".",m,"=",g,";");c(k);f("if(",g,"!==",e,".",m,"){",k,"}")});Object.keys(la).forEach(function(m){var b=la[m],g=ja[m],k,B,l=a.block();l(h,".",b,"(");Array.isArray(g)?(b=g.length,k=a.global.def(n,".",m),B=a.global.def(e,".",m),l(F(b,function(a){return k+"["+a+"]"}),");",F(b,function(a){return B+
"["+a+"]="+k+"["+a+"];"}).join("")),f("if(",F(b,function(a){return k+"["+a+"]!=="+B+"["+a+"]"}).join("||"),"){",l,"}")):(k=q.def(n,".",m),B=q.def(e,".",m),l(k,");",e,".",m,"=",k,";"),f("if(",k,"!==",B,"){",l,"}"));c(l)});return a.compile()}(),compile:function(a,m,f,c){var q=R(),b;b=ba(a);var h=M(a,b),e=K(a),n=V(a);a=L(a);var g=h.viewport;g&&(n.viewport=g);g=Q("scissor.box");(h=h[g])&&(n[g]=h);h=0<Object.keys(n).length;b={framebuffer:b,draw:e,shader:a,state:n,dirty:h};b.uniforms=T(f);b.attributes=
Z(m);b.context=O(c);Ea(q,b);Ha(q,b);Ga(q,b);return q.compile()}}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./util/codegen":18,"./util/is-ndarray":20,"./util/is-typed-array":21,"./util/loop":23}],7:[function(l,p,r){function a(a,b){this.id=k++;this.type=a;this.data=b}function g(a){if(0===a.length)return[];var b=a.charAt(0),h=a.charAt(a.length-1);if(1<a.length&&b===h&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return g(a.substr(0,
b.index)).concat(g(b[1])).concat(g(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(h=0;h<b.length;++h)a=a.concat(g(b[h]));return a}function h(a){return"["+g(a).join("][")+"]"}var k=0;p.exports={define:function(g,b){switch(typeof b){case "boolean":case "number":case "string":return new a(g,h(b+""));case "undefined":return new a(g|128,null)}},isDynamic:function(h){return"function"===typeof h&&!h._reglType||h instanceof
a},unbox:function(g,b){if(g instanceof a){if(g.type&128)return new a(g.type&-129,h(b))}else if("function"===typeof g)return new a(0,g);return g},accessor:h}},{}],8:[function(l,p,r){var a=l("./util/is-typed-array"),g=l("./util/is-ndarray"),h=l("./constants/primitives.json");p.exports=function(k,n,b){function l(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}function p(k){function F(b){var c=n.oes_element_index_uint;if(b)if("number"===typeof b)t(b);else{var k=null,l="static";Array.isArray(b)||
a(b)||g(b)?k=b:("data"in b&&(k=b.data),"usage"in b&&(l=b.usage));Array.isArray(k)||g(k)&&Array.isArray(k.data)||"type"in b?t({type:b.type||(c?"uint32":"uint16"),usage:l,data:k}):t({usage:l,data:k});if(Array.isArray(k)||a(k))t.dimension=3}else t();c=u.buffer.byteLength;k=0;switch(u.buffer.dtype){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;c>>=1;break;case 5125:case 5124:k=5125,c>>=2}var l=4,p=u.buffer.dimension;1===p&&(l=0);2===p&&(l=1);3===p&&(l=4);"object"===typeof b&&("primitive"in
b&&(l=h[b.primitive]),"count"in b&&(c=b.vertCount|0));u.primType=l;u.vertCount=c;u.type=k;return F}var u=new l,t=b.create(null,34963,!0);u.buffer=t._buffer;F(k);F._reglType="elements";F._elements=u;F.destroy=function(){t.destroy();u.buffer=null};return F}l.prototype.bind=function(){this.buffer.bind()};return{create:p,createStream:function(a){return p({usage:"stream",data:a})._elements},destroyStream:function(a){b.destroyStream(a.buffer)},getElements:function(a){return"function"===typeof a&&a._elements instanceof
l?a._elements:null}}}},{"./constants/primitives.json":5,"./util/is-ndarray":20,"./util/is-typed-array":21}],9:[function(l,p,r){p.exports=function(a){function g(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(g){try{h[g]=
a.getExtension(g)}catch(n){}})}var h={};g();return{extensions:h,refresh:g}}},{}],10:[function(l,p,r){var a=l("./util/values"),g=l("./util/extend");p.exports=function(h,k,n,b,l){function p(a,c,b,h){this.target=a;this.level=c;this.texture=b;this.renderbuffer=h}function r(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function A(a,c){var b=c.width,h=c.height;if(a.texture)var g=a.texture._texture,k=Math.max(1,g.params.width>>a.level),n=Math.max(1,
g.params.height>>a.level),b=b||k,h=h||n;else g=a.renderbuffer._renderbuffer,b=b||g.width,h=h||g.height;g.refCount+=1;c.width=b;c.height=h}function u(a,c){c?c.texture?h.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,c.level):h.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):h.framebufferTexture2D(36160,a,3553,null,0)}function t(a){var c=3553,b=0,h=null,g=null;"object"===typeof a&&("level"in a&&(b=a.level|0),"target"in a&&(c=a.target|0));var k=a._reglType;
"texture"===k?h=a:"renderbuffer"===k&&(g=a,c=36161,b=0);return new p(c,b,h,g)}function z(a){return a&&(a.texture||a.renderbuffer)}function c(){this.id=W++;J[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function v(a){h.isFramebuffer(a.framebuffer)||(a.framebuffer=h.createFramebuffer());y.dirty=!0;h.bindFramebuffer(36160,a.framebuffer);for(var c=
a.colorAttachments,b=0;b<c.length;++b)u(36064+b,c[b]);for(b=c.length;b<n.maxColorAttachments;++b)u(36064+b,null);u(36096,a.depthAttachment);u(36128,a.stencilAttachment);u(33306,a.depthStencilAttachment);k.webgl_draw_buffers&&k.webgl_draw_buffers.drawBuffersWEBGL(ea[c.length]);h.checkFramebufferStatus(36160)}function H(a){a=a.framebuffer;h.isFramebuffer(a)&&h.deleteFramebuffer(a)}var y={current:null,next:null,dirty:!1},aa={rgba:6408},x={rgba4:32854,rgb565:36194,"rgb5 a1":32855};k.ext_srgb&&(x.srgba=
35907);k.ext_color_buffer_half_float&&(x.rgba16f=34842,x.rgb16f=34843);k.webgl_color_buffer_float&&(x.rgba32f=34836);var X=[],da=[];k.webgl_depth_texture&&(X.push(6402),da.push(34041));g(g({},aa),x);a(aa);a(x);x=5121;X={uint8:5121};k.oes_texture_half_float&&(x=X["half float"]=36193);k.oes_texture_float&&(x=X["float"]=5126);X.best=x;var ea=function(){for(var a=Array(n.maxDrawbuffers),c=0;c<=n.maxDrawbuffers;++c)for(var b=a[c]=Array(c),h=0;h<c;++h)b[h]=36064+h;return a}(),W=0,J={};return g(y,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof c)?a:null},create:function(a){function g(a){var c,n=a||{},u=a=0;if("shape"in n){var H=n.shape;a=H[0];u=H[1]}else"radius"in n&&(a=u=n.radius),"width"in n&&(a=n.width),"height"in n&&(u=n.height);var y=null,H=!1;if("colorBuffers"in n||"colorBuffer"in n){y=n.colorBuffers||n.colorBuffer;Array.isArray(y)||(y=[y]);k.width=a;k.height=u;y=y.map(t);for(c=0;c<y.length;++c)A(y[c],k);a=k.width;u=k.height}else{var w=!0,x="rgba",J="uint8",M=1,
H=!0;k.width=a=a||h.drawingBufferWidth;k.height=u=u||h.drawingBufferHeight;"format"in n&&(x=n.format,w=x in aa);"type"in n&&(J=n.type);"colorCount"in n&&(M=n.colorCount|0);if(k.ownsColor)for(y=k.colorAttachments;y.length>M;)r(y.pop());else y=[];for(c=0;c<y.length;++c){var L;a:{L=y[c];var K=w,V=x,T=a,X=u;if(L.texture){var O=L.texture;if(K){O({format:V,type:J,width:T,height:X});O._texture.refCount+=1;L=!0;break a}}else if(O=L.renderbuffer,!K){O({format:V,width:T,height:X});O._renderbuffer.refCount+=
1;L=!0;break a}r(L);L=!1}L||(y[c--]=y[y.length-1],y.pop())}for(;y.length<M;)w?y.push(new p(3553,0,b.create({format:x,type:J,width:a,height:u},3553),null)):y.push(new p(36161,0,null,l.create({format:x,width:a,height:u})))}k.width=a;k.height=u;x=w=c=null;J=!1;"depthBuffer"in n&&(c=t(n.depthBuffer));"stencilBuffer"in n&&(w=t(n.stencilBuffer));"depthStencilBuffer"in n&&(x=t(n.depthStencilBuffer));if(c||w||x)A(c||w||x,k);else if(M=!0,K=L=!1,"depth"in n&&(M=!!n.depth),"stencil"in n&&(L=!!n.stencil),"depthTexture"in
n&&(K=!!n.depthTexture),n=k.depthAttachment||k.stencilAttachment||k.depthStencilAttachment,V=null,M||L)J=!0,K?(K=L?"depth stencil":"depth",k.ownsDepthStencil&&n.texture?(n.texture({format:K,width:a,height:u}),n.texture._texture.refCount+=1,V=n):V=new p(3553,0,b.create({format:K,width:a,height:u},3553),null)):(K=M?L?"depth stencil":"depth":"stencil",k.ownsDepthStencil&&n.renderbuffer?(n.renderbuffer({format:K,width:a,height:u}),n.renderbuffer._renderbuffer.refCount+=1,V=n):V=new p(36161,0,null,l.create({format:K,
width:a,height:u}))),M?L?x=V:c=V:w=V;a=k;a.colorAttachments.forEach(r);r(a.depthAttachment);r(a.stencilAttachment);r(a.depthStencilAttachment);k.colorAttachments=y;k.depthAttachment=c;k.stencilAttachment=w;k.depthStencilAttachment=x;k.ownsColor=H;k.ownsDepthStencil=J;g.color=y.map(z);g.depth=z(c);g.stencil=z(w);g.depthStencil=z(x);v(k);g.width=k.width;g.height=k.height;return g}var k=new c;g(a);g._reglType="framebuffer";g._framebuffer=k;g._destroy=function(){H(k)};return g},clear:function(){a(J).forEach(H)},
refresh:function(){a(J).forEach(v)}})}},{"./util/extend":19,"./util/values":27}],11:[function(l,p,r){p.exports=function(a,g){var h=1;g.ext_texture_filter_anisotropic&&(h=a.getParameter(34047));var k=1,n=1;g.webgl_draw_buffers&&(k=a.getParameter(34852),n=a.getParameter(36063));return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(g).filter(function(a){return!!g[a]}),
maxAnisotropic:h,maxDrawbuffers:k,maxColorAttachments:n,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),
maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938)}}},{}],12:[function(l,p,r){var a=l("./util/is-typed-array");p.exports=function(g,h,k){return function(n){var b=n||{};a(n)?b={data:b}:2===arguments.length?b={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof n&&(b={});h();var l=b.x||0,p=b.y||0,r=b.width||k.viewportWidth,A=b.height||k.viewportHeight,b=b.data||new Uint8Array(r*A*4);g.pixelStorei(3333,
4);g.readPixels(l,p,r,A,6408,5121,b);return b}}},{"./util/is-typed-array":21}],13:[function(l,p,r){var a=l("./util/values");p.exports=function(g,h,k){function n(){this.id=r++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function b(a){g.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=g.createRenderbuffer());g.bindRenderbuffer(36161,a.renderbuffer);g.renderbufferStorage(36161,a.format,a.width,a.height)}function l(a){var b=a.renderbuffer;g.bindRenderbuffer(36161,
null);g.isRenderbuffer(b)&&g.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete A[a.id]}var p={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};h.ext_srgb&&(p.srgba=35907);h.ext_color_buffer_half_float&&(p.rgba16f=34842,p.rgb16f=34843);h.webgl_color_buffer_float&&(p.rgba32f=34836);var r=0,A={};n.prototype.decRef=function(){0===--this.refCount&&l(this)};return{create:function(a){function g(a){a=a||{};var k=0,n=0;"shape"in a?(n=a.shape,k=n[0]|0,n=
n[1]|0):("radius"in a&&(k=n=a.radius|0),"width"in a&&(k=a.width|0),"height"in a&&(n=a.height|0));g.width=h.width=Math.max(k,1);g.height=h.height=Math.max(n,1);h.format=32854;"format"in a&&(h.format=p[a.format]);b(h);return g}var h=new n;A[h.id]=h;g(a);g._reglType="renderbuffer";g._renderbuffer=h;g.destroy=function(){h.decRef()};return g},refresh:function(){a(A).forEach(b)},clear:function(){a(A).forEach(l)}}}},{"./util/values":27}],14:[function(l,p,r){var a=l("./util/values");p.exports=function(g,
h){function k(a,b,g,h){this.name=a;this.id=b;this.location=g;this.info=h}function n(a,b){for(var g=0;g<a.length;++g)if(a[g].id===b.id){a[g].location=b.location;return}a.push(b)}function b(a,b,k){k=35632===a?r:A;var n=k[b];if(!n){var l=h.str(b),n=g.createShader(a);g.shaderSource(n,l);g.compileShader(n);k[b]=n}return n}function l(a,b){this.id=z++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function p(a,l){var t,u;t=b(35632,a.fragId);u=b(35633,a.vertId);var r=a.program=
g.createProgram();g.attachShader(r,t);g.attachShader(r,u);g.linkProgram(r);var x=g.getProgramParameter(r,35718),z=a.uniforms;for(t=0;t<x;++t)if(u=g.getActiveUniform(r,t))if(1<u.size)for(var I=0;I<u.size;++I){var F=u.name.replace("[0]","["+I+"]");n(z,new k(F,h.id(F),g.getUniformLocation(r,F),u))}else n(z,new k(u.name,h.id(u.name),g.getUniformLocation(r,u.name),u));x=g.getProgramParameter(r,35721);z=a.attributes;for(t=0;t<x;++t)(u=g.getActiveAttrib(r,t))&&n(z,new k(u.name,h.id(u.name),g.getAttribLocation(r,
u.name),u))}var r={},A={},u={},t=[],z=0;return{clear:function(){var c=g.deleteShader.bind(g);a(r).forEach(c);r={};a(A).forEach(c);A={};t.forEach(function(a){g.deleteProgram(a.program)});t.length=0;u={}},refresh:function(){r={};A={};t.forEach(p)},program:function(a,b,g){var h=u[b];h||(h=u[b]={});var k=h[a];k||(k=new l(b,a),p(k,g),h[a]=k,t.push(k));return k},shader:b,frag:null,vert:null}}},{"./util/values":27}],15:[function(l,p,r){p.exports=function(){var a={"":0},g=[""];return{id:function(h){var k=
a[h];if(k)return k;k=a[h]=g.length;g.push(h);return k},str:function(a){return g[a]}}}},{}],16:[function(l,p,r){function a(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function g(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var g=a[0].length,h=1;h<b;++h)if(!Array.isArray(a[h])||a[h].length!==g)return!1;return!0}function h(a){return Object.prototype.toString.call(a)}function k(a){return"[object HTMLCanvasElement]"===h(a)}function n(a){return"[object CanvasRenderingContext2D]"===
h(a)}var b=l("./util/extend"),I=l("./util/values"),F=l("./util/is-typed-array"),ca=l("./util/is-ndarray"),A=l("./util/load-texture"),u=l("./util/to-half-float"),t=l("./util/parse-dds"),z=[9984,9986,9985,9987];p.exports=function(c,l,p,r,aa){function x(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function X(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function da(a,c){var f,b,g=0,h=0,k=0,n=0,l=0,t=0,p=!1,u=!1,v=!1;for(f=0;f<c.length;++f)b=c[f],n=n||b.width<<b.miplevel,l=l||b.height<<b.miplevel,
g=g||b.type,h=h||b.format,k=k||b.internalformat,t=t||b.channels,p=p||b.needsPoll,u=u||b.needsListeners,b=b.miplevel,v=v||0<b;a.needsPoll=p;a.needsListeners=u;a.width=n;a.height=l;a.format=h;a.internalformat=k;a.type=g;if(3553!==a.target)for(f=0;6>f;++f);f=0<=z.indexOf(a.minFilter);a.genMipmaps=!v&&(a.genMipmaps||f);v=v||a.genMipmaps;a.minFilter||(a.minFilter=v?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(f=0;f<c.length;++f)b=c[f],b.channels||(b.channels=t),b.format||(b.format=h),b.internalformat||
(b.internalformat=k),b.type||(b.type=g)}function ea(a){this.id=V++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new X(a);this.pixels=[]}function W(a,c){function f(a,f){var m=f.mipmap,b;if(Array.isArray(m))for(var g=0;g<m.length;++g)b=new x(a),b.parseFlags(c),b.parseFlags(f),b.parse(m[g],g),h.push(b);else b=new x(a),b.parseFlags(c),b.parse(f,0),h.push(b)}var b;G(a);var g=a.params;X.call(g,a.target);var h=a.pixels;h.length=
0;g.parse(c);if(3553===a.target)f(3553,c);else{var k=c.faces||c;if(Array.isArray(k))for(b=0;6>b;++b)f(34069+b,k[b]);else if("string"!==typeof k)for(b=0;6>b;++b)f(34069+b,{})}da(g,h);g.needsListeners&&w(a);g.needsPoll&&(a.pollId=Z.length,Z.push(a));J(a)}function J(a){c.isTexture(a.texture)||(a.texture=c.createTexture());var b=a.target,f=a.unit;0<=f?(c.activeTexture(33984+f),K=f):c.bindTexture(b,a.texture);for(var b=a.pixels,g=a.params,h=0;h<b.length;++h)b[h].upload(g);g.upload();0>f&&((f=P[K])?c.bindTexture(f.target,
f.texture):(a.unit=K,P[K]=a))}function w(a){function c(a,f,b){var m=t(b);m.pixels.forEach(function(c){var b=new x(m.cube?c.target:a);b.channels=m.channels;b.compressed=m.compressed;b.type=m.type;b.internalformat=m.format;b.format=L[m.format];b.width=c.width;b.height=c.height;b.miplevel=c.miplevel||f;b.data=c.data;g.push(b)})}function f(){for(var f=0;f<g.length;++f){var h=g[f],k=h.image,n=h.video,l=h.xhr;k&&k.complete?(h.width=k.naturalWidth,h.height=k.naturalHeight):n&&2<n.readyState?(h.width=n.width,
h.height=n.height):l&&4===l.readyState&&(g[f]=g[g.length-1],g.pop(),l.removeEventListener("readystatechange",J),c(h.target,h.miplevel,l.response))}da(b,g);J(a)}var b=a.params,g=a.pixels;g.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",f):a.video&&1>a.readyState?a.video.addEventListener("progress",f):a.xhr&&a.xhr.addEventListener("readystatechange",f)});a.cancelPending=function(){g.forEach(function(a){a.image?a.image.removeEventListener("load",f):a.video?a.video.removeEventListener("progress",
f):a.xhr&&(a.xhr.removeEventListener("readystatechange",f),a.xhr.abort())})}}function G(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((Z[b]=Z[Z.length-1]).id=b,Z.pop(),a.pollId=-1)}function fa(a){var b=a.texture,f=a.unit,g=a.target;0<=f&&(c.activeTexture(33984+f),K=f,c.bindTexture(g,null),P[f]=null);G(a);c.isTexture(b)&&c.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete T[a.id]}var S={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Y={repeat:10497,clamp:33071,mirror:33648},ga={nearest:9728,linear:9729},N=b({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ga),Q={none:0,browser:37444},E={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},C={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},R={};l.ext_srgb&&(C.srgb=35904,C.srgba=35906);l.oes_texture_float&&(E["float"]=5126);l.oes_texture_half_float&&
(E["half float"]=36193);l.webgl_depth_texture&&(b(C,{depth:6402,"depth stencil":34041}),b(E,{uint16:5123,uint32:5125,"depth stencil":34042}));l.webgl_compressed_texture_s3tc&&b(R,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&b(R,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&b(R,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(R["rgb etc1"]=36196);var ba=Array.prototype.slice.call(c.getParameter(34467));Object.keys(R).forEach(function(a){var b=R[a];0<=ba.indexOf(b)&&(C[a]=b)});var M=Object.keys(C);p.textureFormats=M;var L=M.reduce(function(a,b){var f=C[b];6409===f||6406===f||6409===f||6410===f||6402===f||34041===f?a[f]=f:32855===f||0<=b.indexOf("rgba")?a[f]=6408:a[f]=6407;return a},{});b(x.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=Q[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=C[b];b in E&&(this.type=E[b]);b in R&&(this.compressed=!0)}"type"in a&&(this.type=E[a.type]);var b=this.width,f=this.height,c=this.channels;"shape"in a?(b=a.shape[0],f=a.shape[1],3===a.shape.length&&(c=a.shape[2])):("radius"in a&&(b=f=a.radius),"width"in a&&(b=a.width),
"height"in a&&(f=a.height),"channels"in a&&(c=a.channels));this.width=b|0;this.height=f|0;this.channels=c|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*c,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(b,c){this.miplevel=c;this.width>>=c;this.height>>=c;var f=b;switch(typeof b){case "object":if(!b)return;
this.parseFlags(b);var l=b.data;if("string"===typeof l||l&&(F(l)||a(l)||ca(l)||k(l)||n(l)||"[object HTMLImageElement]"===h(l)||"[object HTMLVideoElement]"===h(l)||g(l)))f=b.data;break;case "undefined":return}"string"===typeof f&&(f=A(f,this.crossOrigin));var l=null,t=!1;if(null!==f)if(F(f))this.data=f;else if(a(f))l=f,t=!0;else if(ca(f)){Array.isArray(f.data)?(l=f.data,t=!0):this.data=f.data;var p=f.shape;this.width=p[0];this.height=p[1];this.channels=3===p.length?p[2]:1;p=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===p.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(k(f)||n(f))k(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===h(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===h(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===h(f))this.xhr=f,this.needsListeners=!0;else if(g(f)){var t=f[0].length,p=f.length,v=1,r,w,z,x;if(Array.isArray(f[0][0]))for(v=f[0][0].length,l=Array(t*p*v),w=x=0;w<p;++w)for(r=0;r<t;++r)for(z=0;z<v;++z)l[x++]=f[w][r][z];
else for(l=Array(t*p),w=x=0;w<p;++w)for(r=0;r<t;++r)l[x++]=f[w][r];this.width=t;this.height=p;this.channels=v;t=!0}else b.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||aa.viewportWidth)|0,this.height=(this.height||aa.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;p=this.format=L[f];if(!this.channels)switch(p){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}p=this.type;5126!==p&&36193!==p&&(p||(p=6402===f?5125:5121));this.type=p;if(t)switch(p){case 5121:this.data=new Uint8Array(l);break;case 5123:this.data=new Uint16Array(l);break;case 5125:this.data=new Uint32Array(l);break;
case 5126:this.data=new Float32Array(l);break;case 36193:this.data=u(l)}if(this.data&&this.needsTranspose){l=this.data;f=this.width;t=this.height;p=this.channels;v=this.strideX;r=this.strideY;w=this.strideC;z=this.offset;x=new l.constructor(f*t*p);for(var y=0,I=0;I<t;++I)for(var G=0;G<f;++G)for(var H=0;H<p;++H)x[y++]=l[r*I+v*G+w*H+z];this.data=x}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){c.pixelStorei(37440,
this.flipY);c.pixelStorei(37441,this.premultiplyAlpha);c.pixelStorei(37443,this.colorSpace);c.pixelStorei(3317,this.unpackAlignment);var b=this.target,f=this.miplevel,g=this.image,h=this.canvas,k=this.video,n=this.data,l=this.internalformat,p=this.format,t=this.type,u=this.width||Math.max(1,a.width>>f);a=this.height||Math.max(1,a.height>>f);k&&2<k.readyState?c.texImage2D(b,f,p,p,t,k):g&&g.complete?c.texImage2D(b,f,p,p,t,g):h?c.texImage2D(b,f,p,p,t,h):this.compressed?c.compressedTexImage2D(b,f,l,u,
a,0,n):this.copy?(r(),c.copyTexImage2D(b,f,p,this.x,this.y,u,a,0)):n?c.texImage2D(b,f,p,u,a,0,p,t,n):c.texImage2D(b,f,p,u||1,a||1,0,p,t,null)}});b(X.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=N[a.min]);"mag"in a&&(this.magFilter=ga[a.mag]);var b=this.wrapS,f=this.wrapT;if("wrap"in a){var c=a.wrap;"string"===typeof c?b=f=Y[c]:Array.isArray(c)&&(b=Y[c[0]],f=Y[c[1]])}else"wrapS"in a&&(b=Y[a.wrapS]),"wrapT"in a&&(f=Y[a.wrapT]);this.wrapS=b;this.wrapT=f;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=S[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.minFilter);c.texParameteri(a,10240,this.magFilter);c.texParameteri(a,10242,this.wrapS);c.texParameteri(a,10243,this.wrapT);l.ext_texture_filter_anisotropic&&c.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(c.hint(33170,this.mipmapHint),c.generateMipmap(a))}});
var K=0,V=0,T={},Z=[],O=p.maxTextureUnits,P=Array(O).map(function(){return null});b(ea.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<O;++b){var f=P[b];if(f){if(0<f.bindCount)continue;f.unit=-1}P[b]=this;a=b;break}this.unit=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.texture);K=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&fa(this)}});return{create:function(a,b){function c(a,h,k,m,n,l){var p=a||{};34067===b&&
6===arguments.length&&(p=[a,h,k,m,n,l]);W(g,p);c.width=g.params.width;c.height=g.params.height;return c}var g=new ea(b);T[g.id]=g;c(a);c._reglType="texture";c._texture=g;c.destroy=function(){g.decRef()};return c},refresh:function(){I(T).forEach(J);for(var a=0;a<O;++a)P[a]=null;K=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<O;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),P[a]=null;c.activeTexture(33984);K=0;I(T).forEach(fa)},poll:function(){Z.forEach(J)},getTexture:function(a){return null}}}},
{"./util/extend":19,"./util/is-ndarray":20,"./util/is-typed-array":21,"./util/load-texture":22,"./util/parse-dds":24,"./util/to-half-float":26,"./util/values":27}],17:[function(l,p,r){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],18:[function(l,p,r){function a(a){return Array.prototype.slice.call(a)}function g(g){return a(g).join("")}var h=l("./extend");p.exports=function(){function k(){var k=[],n=[];return h(function(){k.push.apply(k,
a(arguments))},{def:function(){var g="v"+b++;n.push(g);0<arguments.length&&(k.push(g,"="),k.push.apply(k,a(arguments)),k.push(";"));return g},toString:function(){return g([0<n.length?"var "+n+";":"",g(k)])}})}function n(){function a(c,h){g(c,h,"=",b.def(c,h),";")}var b=k(),g=k(),c=b.toString,n=g.toString;return h(b,{entry:b,exit:g,save:a,set:function(c,g,h){a(c,g);b(c,g,"=",h,";")},toString:function(){return c()+n()}})}var b=0,l=[],p=[],r=k(),A={};return{global:r,link:function(a){for(var g=0;g<p.length;++g)if(p[g]===
a)return l[g];g="g"+b++;l.push(g);p.push(a);return g},block:k,proc:function(a,b){function k(){var a="a"+c.length;c.push(a);return a}var c=[];b=b||0;for(var l=0;l<b;++l)k();var l=n(),p=l.toString;return A[a]=h(l,{arg:k,toString:function(){return g(["function(",c.join(),"){",p(),"}"])}})},scope:n,cond:function(){var b=g(arguments),k=n(),l=n(),c=k.toString,p=l.toString;return h(k,{then:function(){k.apply(k,a(arguments));return this},"else":function(){l.apply(l,a(arguments));return this},toString:function(){var a=
p();a&&(a="else{"+a+"}");return g(["if(",b,"){",c(),"}",a])}})},compile:function(){var a=['"use strict";',r,"return {"];Object.keys(A).forEach(function(b){a.push('"',b,'":',A[b].toString(),",")});a.push("}");var b=g(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,l.concat(b)).apply(null,p)}}}},{"./extend":19}],19:[function(l,p,r){p.exports=function(a,g){for(var h=Object.keys(g),k=0;k<h.length;++k)a[h[k]]=g[h[k]];return a}},{}],20:[function(l,p,r){var a=l("./is-typed-array");
p.exports=function(g){return!!g&&"object"===typeof g&&Array.isArray(g.shape)&&Array.isArray(g.stride)&&"number"===typeof g.offset&&g.shape.length===g.stride.length&&(Array.isArray(g.data)||a(g.data))}},{"./is-typed-array":21}],21:[function(l,p,r){var a=l("../constants/arraytypes.json");p.exports=function(g){return Object.prototype.toString.call(g)in a}},{"../constants/arraytypes.json":3}],22:[function(l,p,r){p.exports=function(a,g){if("undefined"!==typeof document){var h;h=(h=/\.(\w+)(\?.*)?$/.exec(a))&&
h[1]?h[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(h))return h=document.createElement("video"),h.autoplay=!0,h.loop=!0,g&&(h.crossOrigin=g),h.src=a,h;if(0<=["dds"].indexOf(h))return h=new XMLHttpRequest,h.responseType="arraybuffer",h.open("GET",a,!0),h.send(),h;h=new Image;g&&(h.crossOrigin=g);h.src=a;return h}return null}},{}],23:[function(l,p,r){p.exports=function(a,g){for(var h=Array(a),k=0;k<a;++k)h[k]=g(k);return h}},
{}],24:[function(l,p,r){p.exports=function(l){function p(a){for(var b=S,c=Y,g=0;g<C;++g){var h=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*Q;ba.pixels.push({target:a,miplevel:g,width:b,height:c,data:new Uint8Array(l,R,h)});R+=h;b>>=1;c>>=1}}var r=new Int32Array(l),fa=r[y],S=r[x],Y=r[aa],ga=F,N=0,Q=0,E=4;switch(r[ea]){case t:Q=8;fa&u?(E=3,N=h):N=k;break;case z:Q=16;N=n;break;case c:Q=16;N=b;break;case v:Q=8,N=I}var C=1;r[da]&ca&&(C=Math.max(1,r[X]));var R=r[H]+4,ba={width:S,height:Y,channels:E,format:N,
type:ga,compressed:!0,cube:!1,pixels:[]};if(r[W]&A)for(ba.cube=!0,r=0;6>r;++r)p(g+r);else p(a);return ba};var a=3553,g=34069,h=33776,k=33777,n=33778,b=33779,I=36196,F=5121,ca=131072,A=512,u=64,t=827611204,z=861165636,c=894720068,v=826496069,H=1,y=2,aa=3,x=4,X=7,da=20,ea=21,W=28},{}],25:[function(l,p,r){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(a){return requestAnimationFrame(a)},cancel:function(a){return cancelAnimationFrame(a)}}:
{next:function(a){setTimeout(a,30)},cancel:clearTimeout}},{}],26:[function(l,p,r){p.exports=function(a){for(var g=new Float32Array(a),g=new Uint32Array(g.buffer),h=new Uint16Array(a.length),k=0;k<a.length;++k)if(isNaN(a[k]))h[k]=65535;else if(Infinity===a[k])h[k]=31744;else if(-Infinity===a[k])h[k]=64512;else{var n=g[k],b=n>>>31<<15,l=(n<<1>>>24)-127,n=n>>13&1023;h[k]=-24>l?b:-14>l?b+(n+1024>>-14-l):15<l?b+31744:b+(l+15<<10)+n}return h}},{}],27:[function(l,p,r){p.exports=function(a){return Object.keys(a).map(function(g){return a[g]})}},
{}],28:[function(l,p,r){function a(a,n){function b(){var b=window.innerWidth,g=window.innerHeight;a!==document.body&&(g=a.getBoundingClientRect(),b=g.right-g.left,g=g.top-g.bottom);l.width=r*b;l.height=r*g;h(l.style,{width:b+"px",height:g+"px"})}var l=document.createElement("canvas"),p=g(l,n);h(l.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(l);a===document.body&&(l.style.position="absolute",h(a.style,{margin:0,padding:0}));var r=+p.options.pixelRatio;window.addEventListener("resize",
b,!1);var A=p.options.onDestroy;p.options=h(h({},p.options),{onDestroy:function(){window.removeEventListener("resize",b);a.removeChild(l);A&&A()}});b();return p}function g(a,g){function b(b){try{return a.getContext(b,l)}catch(g){return null}}var l=g.glOptions||{};return{gl:b("webgl")||b("experimental-webgl")||b("webgl-experimental"),options:h({pixelRatio:window.devicePixelRatio},g)}}var h=l("./util/extend");p.exports=function(k){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:k[0],
options:k[1]||{}};var l=document.body,b=k[1]||{};if("string"===typeof k[0])l=document.querySelector(k[0])||document.body;else if("object"===typeof k[0])if(k[0]instanceof HTMLElement)l=k[0];else{if(k[0]instanceof WebGLRenderingContext)return{gl:k[0],options:h({pixelRatio:1},b)};b=k[0]}return l.nodeName&&"CANVAS"===l.nodeName.toUpperCase()?g(l,b):a(l,b)}},{"./util/extend":19}],29:[function(l,p,r){var a=l("./lib/util/extend"),g=l("./lib/dynamic"),h=l("./lib/util/raf"),k=l("./lib/util/clock"),n=l("./lib/strings"),
b=l("./lib/webgl"),I=l("./lib/extension"),F=l("./lib/limits"),ca=l("./lib/buffer"),A=l("./lib/elements"),u=l("./lib/texture"),t=l("./lib/renderbuffer"),z=l("./lib/framebuffer"),c=l("./lib/attribute"),v=l("./lib/shader"),H=l("./lib/read"),y=l("./lib/core");p.exports=function(){function l(){m=h.next(l);E.count+=1;var a=Z.viewport,b=Z.scissor_box;a[0]=a[1]=b[0]=b[1]=0;E.viewportWidth=E.frameBufferWidth=E.drawingBufferWidth=a[2]=b[2]=w.drawingBufferWidth;E.viewportHeight=E.frameBufferWidth=E.drawingBufferHeight=
a[3]=b[3]=w.drawingBufferHeight;a=k();E.deltaTime=(a-ga)/1E3;E.time=(a-Y)/1E3;ga=a;T.procs.refresh();M.poll();for(a=0;a<P.length;++a)(0,P[a])(E,null,0)}function p(){m&&(h.cancel(l),m=0)}function r(a){p();a.preventDefault();if(G.onContextLost)G.onContextLost()}function da(a){w.getError();fa.refresh();T.procs.refresh();C.refresh();M.refresh();L.refresh();K.refresh();ba.refresh();if(G.onContextRestored)G.onContextRestored();l()}function ea(b){function c(a){var b={},f={};Object.keys(a).forEach(function(c){var h=
a[c];g.isDynamic(h)?f[c]=g.unbox(h,c):b[c]=h});return{dynamic:f,"static":b}}function h(a){for(;t.length<a;)t.push(null);return t}var k=c(b.context||{}),l=c(b.uniforms||{}),m=c(b.attributes||{});b=c(function(b){function c(a){if(a in f){var b=f[a];delete f[a];Object.keys(b).forEach(function(c){f[a+"."+c]=b[c]})}}var f=a({},b);delete f.uniforms;delete f.attributes;delete f.context;c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return f}(b));var k=T.compile(b,
m,l,k),n=k.draw,p=k.batch,r=k.scope,t=[];return function(a,b){var c;if("function"===typeof a)return r.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)r.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)r.call(this,a[c],b,c);else return r.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,h(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)}}function W(){T.procs.poll()}
var J=b(Array.prototype.slice.call(arguments)),w=J.gl,G=J.options,J=n(),fa=I(w),S=fa.extensions,Y=k(),ga=Y,N=w.drawingBufferWidth,Q=w.drawingBufferHeight,E={count:0,deltaTime:0,time:0,viewportWidth:N,viewportHeight:Q,framebufferWidth:N,framebufferHeight:Q,drawingBufferWidth:N,drawingBufferHeight:Q,pixelRatio:G.pixelRatio},N=F(w,S),C=ca(w),R=A(w,S,C),Q=c(w,S,N,C,J),ba=v(w,J),M=u(w,S,N,W,E),L=t(w,S,N),K=z(w,S,N,M,L),V=H(w,W,E),T=y(w,J,S,N,C,R,M,K,{},Q,ba,{elements:null,primitive:4,count:-1,offset:0,
instances:-1},E),Z=T.next,O=w.canvas,P=[],m=0;O&&(O.addEventListener("webglcontextlost",r,!1),O.addEventListener("webglcontextrestored",da,!1));T.procs.refresh();return a(ea,{clear:function(a){var b=0;W();var c=a.color;c&&(w.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(w.clearDepth(+a.depth),b|=256);"stencil"in a&&(w.clearStencil(a.stencil|0),b|=1024);w.clear(b)},prop:g.define.bind(null,1),context:g.define.bind(null,2),"this":g.define.bind(null,3),draw:ea({}),elements:function(a){return R.create(a)},
buffer:function(a){return C.create(a,34962)},texture:function(a){return M.create(a,3553)},cube:function(a){return 6===arguments.length?M.create(Array.prototype.slice.call(arguments),34067):M.create(a,34067)},renderbuffer:function(a){return L.create(a)},framebuffer:function(a){return K.create(a)},framebufferCube:function(a){},attributes:w.getContextAttributes(),frame:function(a){P.push(a);!m&&0<P.length&&l();return{cancel:function(){var b=P.find(function(b){return b===a});0>b||(P.splice(b,1),0>=P.length&&
p())}}},limits:N,read:V,destroy:function(){p();O&&(O.removeEventListener("webglcontextlost",r),O.removeEventListener("webglcontextrestored",da));ba.clear();K.clear();L.clear();M.clear();C.clear();if(G.onDestroy)G.onDestroy()},_gl:w,_refresh:function(){T.procs.refresh()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":6,"./lib/dynamic":7,"./lib/elements":8,"./lib/extension":9,"./lib/framebuffer":10,"./lib/limits":11,"./lib/read":12,"./lib/renderbuffer":13,"./lib/shader":14,"./lib/strings":15,
"./lib/texture":16,"./lib/util/clock":17,"./lib/util/extend":19,"./lib/util/raf":25,"./lib/webgl":28}]},{},[29])(29)});
