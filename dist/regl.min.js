(function(ta){if("object"===typeof exports&&"undefined"!==typeof module)module.a=ta();else if("function"===typeof define&&define.Pb)define([],ta);else{var c;"undefined"!==typeof window?c=window:"undefined"!==typeof global?c=global:"undefined"!==typeof self?c=self:c=this;c.Gc=ta()}})(function(){return function c(g,b,q){function a(h,f){if(!b[h]){if(!g[h]){var n="function"==typeof require&&require;if(!f&&n)return n(h,!0);if(d)return d(h,!0);n=Error("Cannot find module '"+h+"'");throw n.code="MODULE_NOT_FOUND",
n;}n=b[h]={a:{}};g[h][0].call(n.a,function(b){var d=g[h][1][b];return a(d?d:b)},n,n.a,c,g,b,q)}return b[h].a}for(var d="function"==typeof require&&require,f=0;f<q.length;f++)a(q[f]);return a}({1:[function(c,g){function b(){this.v=!1;this.O=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.I=!1;this.type=5126;this.H=this.m=this.offset=0}var q=c("./constants/dtypes.json");Object.assign(b.prototype,{jb:function(a,b){return this.v?a.v&&this.buffer===a.buffer&&this.size===b&&this.I===a.I&&this.type===
a.type&&this.offset===a.offset&&this.m===a.m&&this.H===a.H:!a.v&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.O===a.O},set:function(a,b){(this.v=a.v)?(this.buffer=a.buffer,this.size=b,this.I=a.I,this.type=a.type,this.offset=a.offset,this.m=a.m,this.H=a.H):(this.x=a.x,this.y=a.y,this.z=a.z,this.O=a.O)}});g.a=function(a,d,f,h){function c(){for(var a=Array(16),d=0;16>d;++d)a[d]=new b;this.Gb=a;this.top=0}function n(a){for(var d=a.Gb,h=a.top;d.length-1<=h;)d.push(new b);return d[++a.top]}var I={};f=
f.vb;for(var g=Array(f),C=0;C<f;++C)g[C]=new b;Object.assign(c.prototype,{Ya:function(a,b,d,h){var f=n(this);f.v=!1;f.x=a;f.y=b;f.z=d;f.O=h},Fb:function(a,b,d,h,f,q,c){var l=n(this);l.v=!0;l.buffer=a;l.size=b;l.offset=d;l.m=h;l.H=f;l.I=q;l.type=c},Ec:function(a){if("number"===typeof a)this.Ya(a,0,0,0);else if(Array.isArray(a))this.Ya(a[0],a[1],a[2],a[3]);else{var b=h.na(a),d=0,f=0,c=0,n=0,l=!1,I=5126;b?I=b.K:(b=h.na(a.buffer),d=a.size||0,f=a.m||0,c=a.offset||0,n=a.H||0,l=a.I||!1,I=b.K,"type"in a&&
(I=q[a.type]));this.Fb(b,d,c,f,n,l,I)}},pop:function(){--this.top}});return{Ca:g,attributes:I,bind:function(b,h,f,u){u=f.size||u;if(!h.jb(f,u)){if(f.v){h.v||a.enableVertexAttribArray(b);h.buffer!==f.buffer&&f.buffer.bind();a.vertexAttribPointer(b,u,f.type,f.I,f.m,f.offset);var c=d.Na;c&&c.vertexAttribDivisorANGLE(b,f.H)}else h.v&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,f.x,f.y,f.z,f.O);h.set(f,u)}},g:function(a){a in I||(I[a]=new c)}}}},{"./constants/dtypes.json":8}],2:[function(c,g){function b(a,
b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var q=c("./check"),a=c("./is-typed-array"),d=c("./is-ndarray"),f=c("./constants/arraytypes.json"),h=c("./constants/dtypes.json"),l=c("./values"),n={"static":35044,dynamic:35048,stream:35040};g.a=function(c){function g(a,
b){this.id=r++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.la=1;this.data=null;this.K=5121}function C(a){c.isBuffer(a.buffer)||(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function A(a){var b=a.buffer;q(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete k[a.id]}var r=0,k={};g.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(r,l,E){function ba(k){var c=k||
{};if(Array.isArray(c)||a(c)||d(c))c={data:c};else if("number"===typeof c)c={length:c|0};else if(null===c||void 0===c)c={};q.type(c,"object","buffer arguments must be an object, a number or an array");"usage"in c?(q.b(c.usage,n,"invalid buffer usage"),U.usage=n[c.usage]):U.usage=35044;k=0;"type"in c&&(q.b(c.type,h,"invalid buffer type"),k=h[c.type]);var A=c.la|0||1,r=0,l=null;if("data"in c)if(l=c.data,null===l)r=c.length|0;else{if(d(l)){var A=l.shape,r=l.m,c=l.offset,u=0,E=0,D=0,g=0;1===A.length?
(u=A[0],E=1,D=r[0],g=0):2===A.length?(u=A[0],E=A[1],D=r[0],g=r[1]):q.h("invalid shape");k=k||f[Object.prototype.toString.call(l)]|0||5126;for(var A=E,r=b(k,u*E),l=l.data,I=0,fa=0;fa<u;++fa)for(var Z=0;Z<E;++Z)r[I++]=l[D*fa+g*Z+c];l=r}else if(Array.isArray(l))if(0<l.length&&Array.isArray(l[0])){A=l[0].length;k=k||5126;c=b(k,l.length*A);r=l;l=A;for(u=g=0;u<r.length;++u)for(D=r[u],E=0;E<l;++E)c[g++]=D[E];l=c}else k=k||5126,l=b(k,l);else q.Sa(l,"invalid data type buffer data"),k=k||f[Object.prototype.toString.call(l)]|
0;r=l.byteLength}else"length"in c&&(r=c.length|0,q.ba(r,"buffer length must be a nonnegative integer"));U.data=l;U.K=k||5121;U.byteLength=r;U.la=A;C(U);return ba}var O=c.createBuffer(),U=new g(O,l);k[U.id]=U;E||ba(r);ba.C="buffer";ba.Aa=U;ba.G=function(){A(U)};return ba},clear:function(){l(k).forEach(A)},refresh:function(){l(k).forEach(C)},na:function(a){return a&&a.Aa instanceof g?a.Aa:null}}}},{"./check":3,"./constants/arraytypes.json":7,"./constants/dtypes.json":8,"./is-ndarray":16,"./is-typed-array":17,
"./values":30}],3:[function(c,g){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}var q=c("./is-typed-array");g.a=Object.assign(function(a,d){a||b(d)},{h:b,b:function(a,d,f){a in d||b("unknown parameter ("+a+")"+(f?": "+f:"")+". possible values: "+Object.keys(d).join())},type:function(a,d,f){typeof a!==d&&b("invalid parameter type"+(f?": "+f:"")+". expected "+d+", got "+typeof a)},Sa:function(a,d){q(a)||b("invalid parameter type"+(d?": "+d:"")+". must be a typed array")},ba:function(a,
d){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(d?": "+d:"")+". must be a nonnegative integer")},qa:function(a,d,f){0>d.indexOf(a)&&b("invalid value"+(f?": "+f:"")+". must be one of: "+d)}})},{"./is-typed-array":17}],4:[function(c,g){g.a="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],5:[function(c,g){g.a=function(){function b(){var a=[],b=[];return Object.assign(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},
{g:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return d},toString:function(){return[0<b.length?"var "+b+";":"",a.join("")].join("")}})}var c=0,a=[],d=[],f={};return{link:function(b){var f="g"+c++;a.push(f);d.push(b);return f},block:b,ca:function(a){var d=[],n=b(),g=n.toString;return f[a]=Object.assign(n,{T:function(){var a="a"+c++;d.push(a);return a},toString:function(){return["function(",d.join(),"){",g(),
"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(f).forEach(function(a){b.push('"',a,'":',f[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,d)}}}},{}],6:[function(c,g){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function q(a,b,d,h){var c,l=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;
case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";l=",false,";break;case 35675:c="Matrix3fv";l=",false,";break;case 35676:c="Matrix4fv";l=",false,";break;default:f.h("unsupported uniform type")}return a+".uniform"+c+"("+d+l+h+");"}function a(a){return a+"["+a+".length-1]"}function d(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var f=
c("./check"),h=c("./codegen"),l=c("./constants/primitives.json"),n=c("./constants/dtypes.json"),I={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},N={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,
"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},C={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};g.a=function(c,r,k,u,g,E,ba,O,U,ea,Q,ca,ka,ma){function X(k,u,n,E,O){function S(a){var e=ra[a];return e?e:e=ra[a]=y(J[a])}function T(a){var e=a.id,z=W[e];if(z)return z;z=a.Ra?m.g(y(a.data),"(",Q,",",G,",",M,")"):m.g(Q,".",a.data);return W[e]=z}function w(a,e){return a.find(function(a){return a.name===
e})}function H(a){return oa&&!(a in u||a in O)}var K=h(),y=K.link,m=K.ca("batch"),B=K.block(),t=m.g,aa=m.T,e=y(c),F=y(k.va),p=y(ea.bind),M=y(ka),ja=y(ba),v=y(ca.count),P=y(ca.offset),ha=y(ca.W),Y=y(ca.o),ra={},ga=y(g.elements),v=t(a(v)),P=t(a(P)),Y=t(a(Y)),ga=t(a(ga)),x,L,pa=r.Na;pa&&(x=t(a(ha)),L=y(pa));var oa="elements"in u,ha=aa(),aa=aa(),Q=t(),G=t(),W={};m(e,".useProgram(",F,");");k.s.forEach(function(a){if(!(a.name in n)){var na=y(a.location),z=y(U.s[a.name]),z=z+"["+z+".length-1]";35678===a.info.type||
35680===a.info.type?(a=t(z+"._texture"),m(q(e,5124,na,a+".bind()")),B(a,".unbind();")):m(q(e,a.info.type,na,z))}});k.attributes.forEach(function(a){if(!(E.name in E)){var e=y(ea.attributes[a.name]);m(p,"(",a.location,",",y(ea.Ca[a.location]),",",e,".records[",e,".top]",",",b(a.info.type),");")}});oa||m("if(",ga,"){",e,".bindBuffer(",34963,",",ga,".buffer.buffer);","}else{",e,".bindBuffer(",34963,",null);","}");m("for(",G,"=0;",G,"<",ha,";++",G,"){",Q,"=",aa,"[",G,"];");Object.keys(u).sort(d).forEach(function(a){function na(a){m("if(",
z,"){",e,".enable(",a,");}else{",e,".disable(",a,");}")}var z=T(u[a]);switch(a){case "framebuffer":a=S("viewport");var b=S("scissor.box");m("if(",ja,".push(",z,"&&",z,"._framebuffer)){",ja,".poll();",a,".setDirty();",b,".setDirty();","}");break;case "cull.enable":na(2884);break;case "blend.enable":na(3042);break;case "dither":na(3024);break;case "stencil.enable":na(2960);break;case "depth.enable":na(2929);break;case "scissor.enable":na(3089);break;case "polygonOffset.enable":na(32823);break;case "sample.alpha":na(32926);
break;case "sample.enable":na(32928);break;case "depth.mask":m(e,".depthMask(",z,");");break;case "depth.func":a=y(N);m(e,".depthFunc(",a,"[",z,"]);");break;case "depth.range":m(e,".depthRange(",z,"[0],",z,"[1]);");break;case "blend.color":m(e,".blendColor(",z,"[0],",z,"[1],",z,"[2],",z,"[3]);");break;case "blend.equation":a=y(V);m("if(typeof ",z,'==="string"){',e,".blendEquation(",a,"[",z,"]);","}else{",e,".blendEquationSeparate(",a,"[",z,".rgb],",a,"[",z,".alpha]);","}");break;case "blend.func":a=
y(I);m(e,".blendFuncSeparate(",a,'["srcRGB" in ',z,"?",z,".srcRGB:",z,".src],",a,'["dstRGB" in ',z,"?",z,".dstRGB:",z,".dst],",a,'["srcAlpha" in ',z,"?",z,".srcAlpha:",z,".src],",a,'["dstAlpha" in ',z,"?",z,".dstAlpha:",z,".dst]);");break;case "stencil.mask":m(e,".stencilMask(",z,");");break;case "stencil.func":a=y(N);m(e,".stencilFunc(",a,"[",z,'.cmp||"always"],',z,".ref|0,",'"mask" in ',z,"?",z,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=y(C);m(e,".stencilOpSeparate(","stencil.opFront"===
a?1028:1029,",",b,"[",z,'.fail||"keep"],',b,"[",z,'.zfail||"keep"],',b,"[",z,'.pass||"keep"]);');break;case "polygonOffset.offset":m(e,".polygonOffset(",z,".factor||0,",z,".units||0);");break;case "cull.face":m(e,".cullFace(",z,'==="front"?',1028,":",1029,");");break;case "lineWidth":m(e,".lineWidth(",z,");");break;case "frontFace":m(e,".frontFace(",z,'==="cw"?',2304,":",2305,");");break;case "colorMask":m(e,".colorMask(",z,"[0],",z,"[1],",z,"[2],",z,"[3]);");break;case "sample.coverage":m(e,".sampleCoverage(",
z,".value,",z,".invert);");break;case "scissor.box":case "viewport":a=S(a);m(a,".push(",z,".x||0,",z,".y||0,",z,".w||-1,",z,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:f.h("unsupported option for batch",a)}});("viewport"in u||"framebuffer"in u)&&m(S("viewport"),".poll();");("scissor.box"in u||"framebuffer"in u)&&m(S("scissor.box"),".poll();");"framebuffer"in u&&m(ja,".pop();");var X=k.s,da=[];Object.keys(n).forEach(function(a){var b=w(X,a);if(b){var z=
b.info.type,p=y(b.location);a=T(n[a]);35678===b.info.type||35680===b.info.type?(b=t(a+"._texture"),da.push(b),m(q(e,5124,p,b+".bind()"))):m(q(e,z,p,a))}});da.forEach(function(a){m(a,".unbind();")});var ma=k.attributes;Object.keys(E).forEach(function(a){var e=w(ma,a);e&&m(p,"(",e.location,",",y(a.Ca[e.location]),",",T(E[a]),",",b(e.info.type),");")});u.count?m(v,"=",T(u.count),";"):H("count")||m("if(",v,"){");u.offset&&m(P,"=",T(u.offset),";");u.o&&(k=y(l),m(Y,"=",k,"[",T(u.o),"];"));oa&&(k=T(u.elements),
m(ga,"=",k,"?",k,"._elements:null;"));H("offset")&&m(P,"=0;");m("if(",ga,"){");H("count")&&m(v,"=",ga,".vertCount;","if(",v,">0){");H("primitive")&&m(Y,"=",ga,".primType;");oa&&m(e,".bindBuffer(",34963,",",ga,".buffer.buffer);");pa&&(u.W&&m(x,"=",T(u.W),";"),m("if(",x,">0){",L,".drawElementsInstancedANGLE(",Y,",",v,",",ga,".type,",P,",",x,");}else{"));m(e,".drawElements(",Y,",",v,",",ga,".type,",P,");");pa&&m("}");H("count")&&m("}");m("}else{");H("count")||(H("primitive")&&m(Y,"=",4,";"),pa&&m("if(",
x,">0){",L,".drawArraysInstancedANGLE(",Y,",",P,",",v,",",x,");}else{"),m(e,".drawArrays(",Y,",",P,",",v,");}"),pa&&m("}"));m("}}",B);return K.compile().eb}var J=O.gb,V={add:32774,subtract:32778,"reverse subtract":32779};r.cc&&(V.min=32775,V.max=32776);var da=0;return{U:function(d){var f=h(),k=f.link,u=f.ca("draw"),l=u.g,n=k(c),E=k(d.va),I=k(ea.bind),H=k(ca.count),K=k(ca.offset),y=k(ca.W),m=k(ca.o),B=k(g.elements),t=[];u(n,".useProgram(",E,");");d.attributes.forEach(function(a){var e=k(ea.attributes[a.name]);
u(I,"(",a.location,",",k(ea.Ca[a.location]),",",e,".records[",e,".top]",",",b(a.info.type),");")});d.s.forEach(function(a){var e=k(a.location),b=k(U.s[a.name]),b=b+"["+b+".length-1]";35678===a.info.type||35680===a.info.type?(a=l(b+"._texture"),t.push(a),u(q(n,5124,e,a+".bind()"))):u(q(n,a.info.type,e,b))});t.forEach(function(a){u(a,".unbind();")});d=l(a(m));H=l(a(H));K=l(a(K));B=l(a(B));u("if(",H,"){");(E=r.Na)?(y=l(a(y)),E=k(E),u("if(",B,"){",B,".bind();","if(",y,">0){",E,".drawElementsInstancedANGLE(",
d,",",H,",",B,".type,",K,",",y,");}else{",n,".drawElements(",d,",",H,",",B,".type,",K,");}","}else if(",y,">0){",E,".drawArraysInstancedANGLE(",d,",",K,",",H,",",y,");}else{",n,".drawArrays(",d,",",K,",",H,");}}")):u("if(",B,"){",n,".drawElements(",d,",",H,",",B,".type,",K,");}","}else{",n,".drawArrays(",d,",",K,",",H,");}");return f.compile().U},fb:function(b,c,A,r,E,q,O){function w(a){var b=ga[a];return b?b:b=ga[a]=m(J[a])}function H(a,b){var e=w(a);x(e,".push(",b,");");L(e,".pop();")}function K(a){var b=
a.id,e=wa[b];if(e)return e;e=a.Ra?G.g(m(a.data),"(",sa,",0,",va,")"):G.g(sa,".",a.data);return wa[b]=e}var y=h(),m=y.link,B=y.block,t=y.ca,aa=da++,e=m(ma),F=m(Q.ob),p=m(Q.Lb),M=m(Q.Eb),ja=m(ba),v={count:m(ca.count),offset:m(ca.offset),W:m(ca.W),o:m(ca.o)},P=m(g.elements),ha=m(l),Y=m(N),ra=m(C),ga={},x=B(),L=B(),pa=!1;Object.keys(b).sort(d).forEach(function(a){var e=b[a];switch(a){case "frag":pa=!0;x(F,".push(",m(e),");");L(F,".pop();");break;case "vert":pa=!0;x(p,".push(",m(e),");");L(p,".pop();");
break;case "framebuffer":a=ba.rb(e);f(null===e||a,"invalid framebuffer object");a=w("viewport");var d=w("scissor.box");x("if(",ja,".push(",m(e&&e.Ma),")){",a,".setDirty();",d,".setDirty();","}");L("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "count":case "offset":case "instances":f.ba(e,a);x(v[a],".push(",e,");");L(v[a],".pop();");break;case "primitive":f.b(e,l,"not a valid drawing primitive");x(v.o,".push(",l[e],");");L(v.o,".pop();");break;case "elements":d=g.qb(e);e=!("primitive"in
b);a=!("count"in b);d?(d=m(d),x(P,".push(",d,");"),e&&x(v.o,".push(",d,".primType);"),a&&x(v.count,".push(",d,".vertCount);")):(x(P,".push(null);"),e&&x(v.o,".push(",4,");"),a&&x(v.count,".push(0);"));e&&L(v.o,".pop();");a&&L(v.count,".pop();");"offset"in b||(x(v.offset,".push(0);"),L(v.offset,".pop();"));L(P,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":f.type(e,
"boolean",a);H(a,e);break;case "depth.func":f.b(e,N,a);H(a,N[e]);break;case "depth.range":f(Array.isArray(e)&&2===e.length&&e[0]<=e[1],"depth range is 2d array");a=w(a);x(a,".push(",e[0],",",e[1],");");L(a,".pop();");break;case "blend.func":a=w(a);f.type(e,"object","blend func must be an object");var d="srcRGB"in e?e.Jc:e.src,c="srcAlpha"in e?e.Ic:e.src,M="dstRGB"in e?e.bc:e.ib,e="dstAlpha"in e?e.ac:e.ib;f.b(d,I);f.b(c,I);f.b(M,I);f.b(e,I);x(a,".push(",I[d],",",I[M],",",I[c],",",I[e],");");L(a,".pop();");
break;case "blend.equation":a=w(a);"string"===typeof e?(f.b(e,V,"invalid blend equation"),x(a,".push(",V[e],",",V[e],");")):"object"===typeof e?(f.b(e.Ib,V,"invalid blend equation rgb"),f.b(e.alpha,V,"invalid blend equation alpha"),x(a,".push(",V[e.Ib],",",V[e.alpha],");")):f.h("invalid blend equation");L(a,".pop();");break;case "blend.color":f(Array.isArray(e)&&4===e.length,"blend color is a 4d array");a=w(a);x(a,".push(",e[0],",",e[1],",",e[2],",",e[3],");");L(a,".pop();");break;case "stencil.mask":f.type(e,
"number","stencil mask must be an integer");a=w(a);x(a,".push(",e,");");L(a,".pop();");break;case "stencil.func":f.type(e,"object","stencil func must be an object");d=e.Rb||"keep";c=e.Fc||0;e="mask"in e?e.pc:-1;f.b(d,N,"invalid stencil func cmp");f.type(c,"number","stencil func ref");f.type(e,"number","stencil func mask");a=w(a);x(a,".push(",N[d],",",c,",",e,");");L(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":f.type(e,"object",a);d=e.fc||"keep";c=e.Xc||"keep";e=e.Bc||"keep";f.b(d,
C,a);f.b(c,C,a);f.b(e,C,a);a=w(a);x(a,".push(",C[d],",",C[c],",",C[e],");");L(a,".pop();");break;case "polygonOffset.offset":f.type(e,"object",a);d=e.ec||0;e=e.units||0;f.type(d,"number","offset.factor");f.type(e,"number","offset.units");a=w(a);x(a,".push(",d,",",e,");");L(a,".pop();");break;case "cull.face":d=0;"front"===e?d=1028:"back"===e&&(d=1029);f(!!d,"cull.face");e=w(a);x(e,".push(",d,");");L(e,".pop();");break;case "lineWidth":d=k.tb;f("number"===typeof e&&e>=d[0]&&e<=d[1],"invalid line width, must positive number between "+
d[0]+" and "+d[1]);H(a,e);break;case "frontFace":d=0;"cw"===e?d=2304:"ccw"===e&&(d=2305);f(!!d,"frontFace");e=w(a);x(e,".push(",d,");");L(e,".pop();");break;case "colorMask":f(Array.isArray(e)&&4===e.length,"color mask must be length 4 array");a=w(a);x(a,".push(",e.map(function(a){return!!a}).join(),");");L(a,".pop();");break;case "sample.coverage":f.type(e,"object",a);d="value"in e?e.value:1;e=!!e.mc;f("number"===typeof d&&0<=d&&1>=d,"sample value");a=w(a);x(a,".push(",d,",",e,");");L(a,".pop();");
break;case "viewport":case "scissor.box":f("object"===typeof e&&e,a+" is an object");var d=e.x||0,c=e.y||0,h=M=-1;f("number"===typeof d&&0<=d,a+".x must be a positive int");f("number"===typeof c&&0<=c,a+".y must be a positive int");"w"in e&&(M=e.O,f("number"===typeof M&&0<=M,a+".w must be a positive int"));"h"in e&&(h=e.lc,f("number"===typeof h&&0<=h,a+".h must be a positive int"));e=w(a);x(e,".push(",d,",",c,",",M,",",h,");");L(e,".pop();");break;default:f.h("unsupported parameter "+a)}});if(pa){if(b.nb&&
b.Kb)x(M,".push(",m(Q.create(b.Kb,b.nb)),");");else{var B=x.g(F,"[",F,".length-1]"),oa=x.g(p,"[",p,".length-1]"),ua=m(Q.create);x(M,".push(",ua,"(",oa,",",B,"));")}L(M,".pop();")}Object.keys(c).forEach(function(a){U.g(a);var e=m(U.s[a]),b;a=c[a];"function"===typeof a&&a.C?b=m(a):Array.isArray(a)?b=m(a.slice()):b=+a;x(e,".push(",b,");");L(e,".pop();")});Object.keys(A).forEach(function(a){ea.g(a);var e=m(ea.attributes[a]),b=A[a];if("number"===typeof b)x(e,".pushVec(",+b,",0,0,0);");else if(f(!!b,"invalid attribute: "+
a),Array.isArray(b))x(e,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var d=u.na(b),p=0,c=0,M=0,k=0,h=!1,F=5126;d?F=d.K:(f.type(b,"object",'invalid attribute "'+a+'"'),d=u.na(b.buffer),p=b.size||0,c=b.m||0,M=b.offset||0,k=b.H||0,h=b.I||!1,f(!!d,"invalid attribute "+a+".buffer"),F=d.K,"type"in b&&(f.b(b.type,n,"attribute type"),F=n[b.type]));f(!!d,"invalid attribute "+a+".buffer");f.ba(c,a+".stride");f.ba(M,a+".offset");f.ba(k,a+".divisor");f.type(h,"boolean",a+".normalized");f.qa(p,[0,
1,2,3,4],a+".size");x(e,".pushPtr(",[m(d),p,M,c,k,h,F].join(),");")}L(e,".pop();")});var G=y.block(),W=y.block(),va,sa;O&&(va=m(ka),sa=x.g());var wa={};Object.keys(r).sort(d).forEach(function(a){var e=K(r[a]);switch(a){case "framebuffer":a=w("viewport");var d=w("scissor.box");G("if(",ja,".push(",e,"&&",e,"._framebuffer)){",a,".setDirty();",d,".setDirty();","}");W("if(",ja,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
w(a);G(a,".push(",e,");");W(a,".pop();");break;case "count":case "offset":case "instances":a=v[a];G(a,".push(",e,");");W(a,".pop();");break;case "primitive":a=v.o;G(a,".push(",ha,"[",e,"]);");W(a,".pop();");break;case "depth.func":a=w(a);G(a,".push(",Y,"[",e,"]);");W(a,".pop();");break;case "blend.func":a=w(a);d=m(I);G(a,".push(",d,'["srcRGB" in ',e,"?",e,".srcRGB:",e,".src],",d,'["dstRGB" in ',e,"?",e,".dstRGB:",e,".dst],",d,'["srcAlpha" in ',e,"?",e,".srcAlpha:",e,".src],",d,'["dstAlpha" in ',e,
"?",e,".dstAlpha:",e,".dst]);");W(a,".pop();");break;case "blend.equation":a=w(a);d=m(V);G("if(typeof ",e,'==="string"){',a,".push(",d,"[",e,"],",d,"[",e,"]);","}else{",a,".push(",d,"[",e,".rgb],",d,"[",e,".alpha]);","}");W(a,".pop();");break;case "blend.color":a=w(a);G(a,".push(",e,"[0],",e,"[1],",e,"[2],",e,"[3]);");W(a,".pop();");break;case "stencil.mask":a=w(a);G(a,".push(",e,");");W(a,".pop();");break;case "stencil.func":a=w(a);G(a,".push(",Y,"[",e,".cmp],",e,".ref|0,",'"mask" in ',e,"?",e,".mask:-1);");
W(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=w(a);G(a,".push(",ra,"[",e,'.fail||"keep"],',ra,"[",e,'.zfail||"keep"],',ra,"[",e,'.pass||"keep"]);');W(a,".pop();");break;case "polygonOffset.offset":a=w(a);G(a,".push(",e,".factor||0,",e,".units||0);");W(a,".pop();");break;case "cull.face":a=w(a);G(a,".push(",e,'==="front"?',1028,":",1029,");");W(a,".pop();");break;case "frontFace":a=w(a);G(a,".push(",e,'==="cw"?',2304,":",2305,");");W(a,".pop();");break;case "colorMask":a=w(a);
G(a,".push(",e,"[0],",e,"[1],",e,"[2],",e,"[3]);");W(a,".pop();");break;case "sample.coverage":a=w(a);G(a,".push(",e,".value,",e,".invert);");W(a,".pop();");break;case "scissor.box":case "viewport":a=w(a);G(a,".push(",e,".x||0,",e,".y||0,",'"w" in ',e,"?",e,".w:-1,",'"h" in ',e,"?",e,".h:-1);");W(a,".pop();");break;case "elements":a=!("primitive"in r)&&!("primitive"in b);var d=!("count"in r)&&!("count"in b),p=!("offset"in r)&&!("offset"in b),c=G.g();G("if(",e,"){",c,"=",e,"._elements;",P,".push(",
c,");",a?v.o+".push("+c+".primType);":"",d?v.count+".push("+c+".vertCount);":"",p?v.offset+".push("+c+".offset);":"","}else{",P,".push(null);","}");W(P,".pop();","if(",e,"){",a?v.o+".pop();":"",d?v.count+".pop();":"",p?v.offset+".pop();":"","}");break;default:f.h("unsupported dynamic option: "+a)}});Object.keys(E).forEach(function(a){U.g(a);var e=m(U.s[a]);a=K(E[a]);G(e,".push(",a,");");W(e,".pop();")});Object.keys(q).forEach(function(a){ea.g(a);var e=m(ea.attributes[a]);a=K(q[a]);G(e,".pushDyn(",
a,");");W(e,".pop();")});B=t("scope");oa=B.T();ua=B.T();B(x);O&&B(sa,"=",oa,";",G);B(ua,"();",O?W:"",L);B=t("draw");B(x);O&&B(sa,"=",B.T(),";",G);oa=a(M);B(e,"();","if(",oa,")",oa,".draw(",O?sa:"",");",O?W:"",L);var qa=t("batch");qa(x);O=qa.g(a(M));t=m(function(a,e,d){var p=a.Ba[aa];p||(p=a.Ba[aa]=X(a,r,E,q,b));return p(e,d)});qa("if(",O,"){",e,"();",t,"(",O,",",qa.T(),",",qa.T(),");");Object.keys(r).forEach(function(a){(a=ga[a])&&qa(a,".setDirty();")});qa("}",L);return y.compile()}}}},{"./check":3,
"./codegen":5,"./constants/dtypes.json":8,"./constants/primitives.json":9}],7:[function(c,g){g.a={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],8:[function(c,g){g.a={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],9:[function(c,
g){g.a={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],10:[function(c,g){function b(a,b){function c(){var b=window.innerWidth,f=window.innerHeight;a!==document.body&&(f=a.getBoundingClientRect(),b=f.right-f.left,f=f.top-f.bottom);l.width=g*b;l.height=g*f;Object.assign(l.style,{width:b+"px",height:f+"px"})}var l=document.createElement("canvas"),n=q(l,b);Object.assign(l.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(l);a===document.body&&
(l.style.position="absolute",Object.assign(a.style,{margin:0,padding:0}));var g=+n.options.sa;window.addEventListener("resize",c,!1);var N=n.options.Ha;n.options=Object.assign({},n.options,{Ha:function(){window.removeEventListener("resize",c);a.removeChild(l);N&&N()}});c();return n}function q(b,c){function h(a){try{return b.getContext(a,l)}catch(c){return null}}var l=c.jc||{},n=h("webgl")||h("experimental-webgl")||h("webgl-experimental");a(n,"webgl not supported");return{Fa:n,options:Object.assign({sa:window.devicePixelRatio},
c)}}var a=c("./check");g.a=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{Fa:a[0],options:a[1]||{}};var c=document.body,h=a[1]||{};if("string"===typeof a[0])c=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)c=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{Fa:a[0],options:Object.assign({sa:1},h)};h=a[0]}return c.nodeName&&"CANVAS"===c.nodeName.toUpperCase()?q(c,h):b(c,h)}},{"./check":3}],11:[function(c,
g){g.a=function(){return{o:[4],count:[0],offset:[0],W:[0]}}},{}],12:[function(c,g){function b(b,c){this.id=a++;this.Ra=b;this.data=c}function q(a){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return q}}var a=0;g.a={hb:q,sb:function(a){return"function"===typeof a&&!a.C||a instanceof b},Jb:function(a,c){return a instanceof b?a:"function"===typeof a&&a!==q?new b(!0,a):new b(!1,c)}}},{}],13:[function(c,g){var b=c("./check"),
q=c("./is-typed-array"),a=c("./is-ndarray"),d=c("./constants/primitives.json");g.a=function(c,h,l){function n(){this.buffer=null;this.Db=4;this.type=this.bb=0}n.prototype.bind=function(){this.buffer.bind()};return{create:function(c){function f(c){var k=h.yc;if(c)if("number"===typeof c)A(c);else{var u=null,l="static",n=0;Array.isArray(c)||q(c)||a(c)?u=c:(b.type(c,"object","invalid arguments for elements"),"data"in c&&(u=c.data),"usage"in c&&(l=c.usage),"length"in c&&(n=c.length));Array.isArray(u)||
a(u)&&"array"===u.K||"type"in c?A({type:c.type||(k?"uint32":"uint16"),usage:l,data:u,length:n}):A({usage:l,data:u,length:n});if(Array.isArray(u)||q(u))A.la=3}else A();u=g.buffer.byteLength;l=0;switch(g.buffer.K){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;u>>=1;break;case 5125:case 5124:b(k,"32 bit element buffers not supported");l=5125;u>>=2;break;default:b.h("invalid element buffer type")}k=4;n=g.buffer.la;1===n&&(k=0);2===n&&(k=1);3===n&&(k=4);"object"===typeof c&&("primitive"in
c&&(k=c.o,b.b(k,d),k=d[k]),"count"in c&&(u=c.bb|0));g.Db=k;g.bb=u;g.type=l;return f}var g=new n,A=l.create(null,34963,!0);g.buffer=A.Aa;f(c);Object.assign(f,{C:"elements",La:g,G:function(){b(null!==g.buffer,"must not double destroy elements");A.G();g.buffer=null}});return f},elements:[null],qb:function(a){return a&&a.La instanceof n?a.La:null}}}},{"./check":3,"./constants/primitives.json":9,"./is-ndarray":16,"./is-typed-array":17}],14:[function(c,g){g.a=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(c){try{a[c]=
b.getExtension(c)}catch(f){}})}var a={};c();return{Qa:a,refresh:c}}},{}],15:[function(c,g){var b=c("./check"),q=c("./values"),a=[1029];g.a=function(c,f,h,l,n){function g(a,b,c,d){this.target=a;this.level=b;this.c=c;this.i=d}function N(a){a&&(a.c&&a.c.w.aa(),a.i&&a.i.D.aa())}function C(a,c,d){a.c?b.qa(a.c.w.B.l,c,"unsupported texture format for attachment"):b.qa(a.i.D.format,d,"unsupported renderbuffer format for attachment")}function A(a,c){var d=c.width,f=c.height;if(a.c){var k=a.c.w,h=Math.max(1,
k.B.width>>a.level),l=Math.max(1,k.B.height>>a.level),d=d||h,f=f||l;b(h===d&&l===f,"inconsistent width/height for supplied texture");b(0>k.ta,"polling fbo textures not supported");k.j+=1}else k=a.i.D,d=d||k.width,f=f||k.height,b(k.width===d&&k.height===f,"inconsistent width/height for renderbuffer"),b(0<=fa.indexOf(k.format),"renderbuffer format not compatible with color channels"),k.j+=1;c.width=d;c.height=f}function r(a,b){b?b.c?c.framebufferTexture2D(36160,a,b.target,b.c.w.c,b.level):c.framebufferRenderbuffer(36160,
a,36161,b.i.D.i):c.framebufferTexture2D(36160,a,3553,null,0)}function k(a){var c=3553,d=0,f=null,k=null,h=a;"object"===typeof a&&(h=a.data,"level"in a&&(d=a.level|0),"target"in a&&(c=a.target|0));b.type(h,"function","invalid attachment data");h=a.C;"texture"===h?(f=a,34067===f.w.target?b(34069<=c&&34075>c,"invalid cube map target"):b(3553===c)):"renderbuffer"===h?(k=a,c=36161,d=0):b.h("invalid regl object for attachment");return new g(c,d,f,k)}function u(a){return a&&(a.c||a.i)}function D(){this.id=
la++;S[this.id]=this;this.V=null;this.height=this.width=0;this.$=[];this.ka=this.xa=this.ja=null;this.Ia=this.Xa=!1}function E(a){c.isFramebuffer(a.V)||(a.V=c.createFramebuffer());w=!0;c.bindFramebuffer(36160,a.V);for(var k=a.$,l=0;l<k.length;++l)r(36064+l,k[l]);for(l=k.length;l<h.wb;++l)r(36064+l,null);r(36096,a.ja);r(36128,a.xa);r(33306,a.ka);f.za&&f.za.drawBuffersWEBGL(ia[k.length]);a=c.checkFramebufferStatus(36160);36053!==a&&b.h("framebuffer configuration not supported, status = "+U[a])}function ba(a){a=
a.V;b(a,"must not double destroy framebuffer");c.isFramebuffer(a)&&c.deleteFramebuffer(a)}function O(){return T[T.length-1]}var U={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ea={rgba:6408},Q={rgba4:32854,rgb565:36194,"rgb5 a1":32855};f.Pa&&(Q.srgba=35907);f.kb&&(Q.rgba16f=34842,Q.rgb16f=34843);f.Nb&&(Q.rgba32f=34836);var ca=[33189],ka=[36168],ma=[34041],X=[],J=[],V=[];f.Ka&&(X.push(6402),V.push(34041));var da=
Object.assign({},ea,Q),R=q(ea),fa=q(Q),Q=5121,Z={uint8:5121};f.Wa&&(Q=Z["half float"]=36193);f.Va&&(Q=Z.mb=5126);Z.Qb=Q;var ia=function(){for(var a=Array(h.Ta),b=0;b<=h.Ta;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),la=0,S={},T=[null],w=!0;return{top:O,$b:function(){return w},push:function(a){a=a||null;w=w||a!==O();T.push(a);return w},pop:function(){var a=O();T.pop();return w=w||a!==O()},rb:function(a){return"function"===typeof a&&"framebuffer"===a.C&&(a=a.Ma,a instanceof D)?
a:null},M:function(){if(w){var b=T[T.length-1],k=f.za;b?(c.bindFramebuffer(36160,b.V),k&&k.drawBuffersWEBGL(ia[b.$.length])):(c.bindFramebuffer(36160,null),k&&k.drawBuffersWEBGL(a));w=!1}},create:function(a){function h(a){var r,t=a||{};r=f.za;var D=0,e=0;"shape"in t?(a=t.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),D=a[0],e=a[1]):("radius"in t&&(D=e=t.Za),"width"in t&&(D=t.width),"height"in t&&(e=t.height));var F=null;a=!1;if("colorBuffers"in t||"colorBuffer"in t){F=t.Ub||
t.Tb;Array.isArray(F)||(F=[F]);q.width=D;q.height=e;1<F.length&&b(r,"multiple render targets not supported");b(0<=F.length,"must specify at least one color attachment");F=F.map(k);for(r=0;r<F.length;++r)D=F[r],C(D,R,fa),A(D,q);D=q.width;e=q.height}else{var p=!0,M="rgba",ja="uint8",v=1;a=!0;q.width=D||c.drawingBufferWidth;q.height=e||c.drawingBufferHeight;"format"in t&&(M=t.format,b.b(M,da,"invalid color format"),p=M in ea);"type"in t&&(b(p,"colorType can not be set for renderbuffer targets"),ja=t.type,
b.b(ja,Z,"invalid color type"));"colorCount"in t&&(v=t.Vb|0,b(0<=v,"color count must be positive"));if(q.Xa)for(F=q.$;F.length>v;)N(F.pop());else F=[];for(r=0;r<F.length;++r){var P;a:{P=F[r];var ha=p,Y=M,w=D,ga=e;if(P.c){var x=P.c;if(ha){x({format:Y,type:ja,width:w,height:ga});x.w.j+=1;P=!0;break a}}else if(x=P.i,!ha){x({format:Y,width:w,height:ga});x.D.j+=1;P=!0;break a}N(P);P=!1}P||(F[r--]=F[F.length-1],F.pop())}for(;F.length<v;)p?F.push(new g(3553,0,l.create({format:M,type:ja,width:D,height:e},
3553),null)):F.push(new g(36161,0,null,n.create({format:M,width:D,height:e})))}b(0<F.length,"must specify at least one color buffer");q.width=D;q.height=e;M=p=r=null;ja=!1;v=0;"depthBuffer"in t&&(r=k(t.Xb),C(r,X,ca),v+=1);"stencilBuffer"in t&&(p=k(t.Oc),C(p,J,ka),v+=1);"depthStencilBuffer"in t&&(M=k(t.Yb),C(M,V,ma),v+=1);if(r||p||M)b(1===v,"can specify only one of depth, stencil or depthStencil attachment"),A(r||p||M,q);else if(v=!0,ha=P=!1,"depth"in t&&(v=!!t.depth),"stencil"in t&&(P=!!t.stencil),
"depthTexture"in t&&(ha=!!t.Zb),t=q.ja||q.xa||q.ka,Y=null,v||P)ja=!0,ha?(b(f.Ka,"depth texture extension not supported"),b(v,"stencil only textures not supported"),ha=P?"depth stencil":"depth",q.Ia&&t.c?(t.c({format:ha,width:D,height:e}),t.c.w.j+=1,Y=t):Y=new g(3553,0,l.create({format:ha,width:D,height:e},3553),null)):(ha=v?P?"depth stencil":"depth":"stencil",q.Ia&&t.i?(t.i({format:ha,width:D,height:e}),t.i.D.j+=1,Y=t):Y=new g(36161,0,null,n.create({format:ha,width:D,height:e}))),v?P?M=Y:r=Y:p=Y;
D=q;D.$.forEach(N);N(D.ja);N(D.xa);N(D.ka);q.$=F;q.ja=r;q.xa=p;q.ka=M;q.Xa=a;q.Ia=ja;h.color=F.map(u);h.depth=u(r);h.stencil=u(p);h.Ob=u(M);E(q);h.width=q.width;h.height=q.height;return h}var q=new D;h(a);Object.assign(h,{C:"framebuffer",Ma:q,G:function(){ba(q)}});return h},clear:function(){q(S).forEach(ba)},refresh:function(){q(S).forEach(E)}}}},{"./check":3,"./values":30}],16:[function(c,g){var b=c("./is-typed-array");g.a=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.m)&&
"number"===typeof c.offset&&c.shape.length===c.m.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":17}],17:[function(c,g){var b=c("./constants/arraytypes.json");g.a=function(c){return Object.prototype.toString.call(c)in b}},{"./constants/arraytypes.json":7}],18:[function(c,g){g.a=function(b,c){var a=1;c.lb&&(a=b.getParameter(34047));var d=1,f=1;c.za&&(d=b.getParameter(34852),f=b.getParameter(36063));return{Sb:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],
Wb:b.getParameter(3414),Nc:b.getParameter(3415),Pc:b.getParameter(3408),Qa:Object.keys(c).filter(function(a){return!!c[a]}),ub:a,Ta:d,wb:f,Cc:b.getParameter(33901),tb:b.getParameter(33902),xc:b.getParameter(3386),qc:b.getParameter(35661),rc:b.getParameter(34076),xb:b.getParameter(34024),yb:b.getParameter(34930),tc:b.getParameter(3379),vb:b.getParameter(34921),wc:b.getParameter(36347),vc:b.getParameter(35660),uc:b.getParameter(36348),sc:b.getParameter(36349),kc:b.getParameter(35724),Hc:b.getParameter(7937),
vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],19:[function(c,g){g.a=function(b,c){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(b))&&a[1]?a[1].toLowerCase():void 0;0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a)?(a=document.createElement("video"),a.autoplay=!0,a.loop=!0,c&&(a.crossOrigin=c),a.src=b):0<=["dds"].indexOf(a)?(a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",b,!0),a.send()):(a=new Image,
c&&(a.crossOrigin=c),a.src=b);return a}return null}},{}],20:[function(c,g){var b=c("./check");g.a=function(c){function g(a){for(var b=Z,d=ia,k=0;k<H;++k){var e=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*T;y.J.push({target:a,u:k,width:b,height:d,data:new Uint8Array(c,K,e)});K+=e;b>>=1;d>>=1}}var R=new Int32Array(c);b(R[0]===q,"invalid magic number for dds header");var fa=R[ea];b(fa&k,"unsupported dds format");var Z=R[ca],ia=R[Q],la=N,S=0,T=0,w=4;switch(R[X]){case D:T=8;fa&u?(w=3,S=f):S=h;break;case E:T=
16;S=l;break;case ba:T=16;S=n;break;case O:T=8;S=I;break;default:b.h("unsupported dds texture format")}var H=1;R[ma]&C&&(H=Math.max(1,R[ka]));var K=R[U]+4,y={width:Z,height:ia,f:w,format:S,type:la,F:!0,ia:!1,J:[]},R=R[J];if(R&A)for(b((R&r)===r,"missing cubemap faces"),y.ia=!0,R=0;6>R;++R)g(d+R);else g(a);return y};var q=542327876,a=3553,d=34069,f=33776,h=33777,l=33778,n=33779,I=36196,N=5121,C=131072,A=512,r=64512,k=4,u=64,D=827611204,E=861165636,ba=894720068,O=826496069,U=1,ea=2,Q=3,ca=4,ka=7,ma=
20,X=21,J=28},{"./check":3}],21:[function(c,g){"function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?g.a={next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:g.a={next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],22:[function(c,g){var b=c("./check"),q=c("./is-typed-array");g.a=function(a,c,f){return function(h){var l=h||{};q(h)?l={data:l}:2===arguments.length?l={width:arguments[0]|0,height:arguments[1]|0}:"object"!==
typeof h&&(l={});c();var n=l.x||0,g=l.y||0,N=l.width||f.width,C=l.height||f.height,A=N*C*4,l=l.data||new Uint8Array(A);b.Sa(l);b(l.byteLength>=A,"data buffer too small");a.pixelStorei(3333,4);a.readPixels(n,g,N,C,6408,5121,l);return l}}},{"./check":3,"./is-typed-array":17}],23:[function(c,g){var b=c("./check"),q=c("./values");g.a=function(a,c,f){function h(){this.id=N++;this.j=1;this.i=null;this.format=32854;this.height=this.width=0}function l(b){a.isRenderbuffer(b.i)||(b.i=a.createRenderbuffer());
a.bindRenderbuffer(36161,b.i);a.renderbufferStorage(36161,b.format,b.width,b.height)}function n(c){var d=c.i;b(d,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.isRenderbuffer(d)&&a.deleteRenderbuffer(d);c.i=null;c.j=0;delete C[c.id]}var g={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.Pa&&(g.srgba=35907);c.kb&&(g.rgba16f=34842,g.rgb16f=34843);c.Nb&&(g.rgba32f=34836);var N=0,C={};h.prototype.aa=function(){0===--this.j&&n(this)};
return{create:function(a){function c(a){a=a||{};var h=0,n=0;"shape"in a?(n=a.shape,b(Array.isArray(n)&&2<=n.length,"invalid renderbuffer shape"),h=n[0]|0,n=n[1]|0):("radius"in a&&(h=n=a.Za|0),"width"in a&&(h=a.width|0),"height"in a&&(n=a.height|0));var q=f.xb;b(0<=h&&0<=n&&h<=q&&n<=q,"invalid renderbuffer size");c.width=d.width=Math.max(h,1);c.height=d.height=Math.max(n,1);d.format=32854;"format"in a&&(a=a.format,b.b(a,g,"invalid render buffer format"),d.format=g[a]);l(d);return c}var d=new h;C[d.id]=
d;c(a);Object.assign(c,{C:"renderbuffer",D:d,G:function(){d.aa()}});return c},refresh:function(){q(C).forEach(l)},clear:function(){q(C).forEach(n)}}}},{"./check":3,"./values":30}],24:[function(c,g){function b(a,b,c){this.name=a;this.location=b;this.info=c}var q=c("./check");g.a=function(a,c,f,h){function l(b,c){var d=r[b],k=d[c];k||(k=a.createShader(b),a.shaderSource(k,c),a.compileShader(k),a.getShaderParameter(k,a.COMPILE_STATUS)||q.h("Error compiling shader:\n"+a.getShaderInfoLog(k)),d[c]=k);return k}
function n(){Object.keys(r).forEach(function(b){Object.keys(r[b]).forEach(function(c){a.deleteShader(r[b][c])})});r[35632]={};r[35633]={}}function g(a,b){this.pb=a;this.Mb=b;this.va=null;this.s=[];this.attributes=[];this.U=function(){};this.Ba={}}function N(){u.forEach(function(a){a.G()});u.length=0;k={}}function C(){u.forEach(function(a){a.link()})}function A(){n();N()}var r={},k={},u=[];Object.assign(g.prototype,{link:function(){var k,n;k=l(a.FRAGMENT_SHADER,this.pb);n=l(a.VERTEX_SHADER,this.Mb);
var g=this.va=a.createProgram();a.attachShader(g,k);a.attachShader(g,n);a.linkProgram(g);a.getProgramParameter(g,a.LINK_STATUS)||q.h("Error linking program:\n"+a.getProgramInfoLog(g));var u=a.getProgramParameter(g,a.ACTIVE_UNIFORMS),r=this.s=[];for(k=0;k<u;++k)if(n=a.getActiveUniform(g,k))if(1<n.size)for(var A=0;A<n.size;++A){var I=n.name.replace("[0]","["+A+"]");r.push(new b(I,a.getUniformLocation(g,I),n));f.g(I)}else r.push(new b(n.name,a.getUniformLocation(g,n.name),n)),f.g(n.name);u=a.getProgramParameter(g,
a.ACTIVE_ATTRIBUTES);r=this.attributes=[];for(k=0;k<u;++k)if(n=a.getActiveAttrib(g,k))r.push(new b(n.name,a.getAttribLocation(g,n.name),n)),c.g(n.name);this.U=h(this);this.Ba={}},G:function(){a.deleteProgram(this.va)}});A();return{create:function(a,b){var c=k[b];c||(c=k[b]={});var d=c[a];d||(d=new g(b,a),d.link(),c[a]=d,u.push(d));return d},clear:A,refresh:function(){r[35632]={};r[35633]={};C()},Eb:[null],ob:["void main(){gl_FragColor=vec4(0,0,0,0);}"],Lb:["void main(){gl_Position=vec4(0,0,0,0);}"]}}},
{"./check":3}],25:[function(c,g){g.a=function(b,c){var a=b.length,d=b.slice(),f=b.slice(),h=!1,l=!0;return{push:function(){h=!1;for(var b=0;b<a;++b){var c=arguments[b];h=h||c!==f[b];d.push(c)}},pop:function(){h=!1;d.length-=a;for(var b=0;b<a;++b)h=h||d[d.length-a+b]!==f[b]},M:function(){var b=d.length-a;if(h||l){switch(a){case 1:c(d[b]);break;case 2:c(d[b],d[b+1]);break;case 3:c(d[b],d[b+1],d[b+2]);break;case 4:c(d[b],d[b+1],d[b+2],d[b+3]);break;case 5:c(d[b],d[b+1],d[b+2],d[b+3],d[b+4]);break;case 6:c(d[b],
d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]);break;default:c.apply(null,d.slice(b,d.length))}for(var g=0;g<a;++g)f[g]=d[b+g];l=h=!1}},$a:function(){l=!0}}}},{}],26:[function(c,g){var b=c("./stack"),q=c("./codegen");g.a=function(a,c,f){function h(c,d){var k=b([!!d],function(b){b?a.enable(c):a.disable(c)});k.gc=c;return k}var l={dither:h(3024),"blend.enable":h(3042),"blend.color":b([0,0,0,0],function(b,c,d,f){a.blendColor(b,c,d,f)}),"blend.equation":b([32774,32774],function(b,c){a.blendEquationSeparate(b,c)}),
"blend.func":b([1,0,1,0],function(b,c,d,f){a.blendFuncSeparate(b,c,d,f)}),"depth.enable":h(2929,!0),"depth.func":b([513],function(b){a.depthFunc(b)}),"depth.range":b([0,1],function(b,c){a.depthRange(b,c)}),"depth.mask":b([!0],function(b){a.depthMask(b)}),"cull.enable":h(2884),"cull.face":b([1029],function(b){a.cullFace(b)}),frontFace:b([2305],function(b){a.frontFace(b)}),colorMask:b([!0,!0,!0,!0],function(b,c,d,f){a.colorMask(b,c,d,f)}),lineWidth:b([1],function(b){a.lineWidth(b)}),"polygonOffset.enable":h(32823),
"polygonOffset.offset":b([0,0],function(b,c){a.polygonOffset(b,c)}),"sample.alpha":h(32926),"sample.enable":h(32928),"sample.coverage":b([1,!1],function(b,c){a.sampleCoverage(b,c)}),"stencil.enable":h(2960),"stencil.mask":b([-1],function(b){a.stencilMask(b)}),"stencil.func":b([519,0,-1],function(b,c,d){a.stencilFunc(b,c,d)}),"stencil.opFront":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1028,b,c,d)}),"stencil.opBack":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1029,b,c,d)}),"scissor.enable":h(3089),
"scissor.box":b([0,0,-1,-1],function(b,f,k,h){var g=k,l=c.top();0>k&&(g=l?l.width-b:a.drawingBufferWidth-b);k=h;0>h&&(k=l?l.height-f:a.drawingBufferHeight-f);a.scissor(b,f,g,k)}),viewport:b([0,0,-1,-1],function(b,h,k,g){var l=k,n=c.top();0>k&&(l=n?n.width-b:a.drawingBufferWidth-b);k=g;0>g&&(k=n?n.height-h:a.drawingBufferHeight-h);a.viewport(b,h,l,k);f.width=l;f.height=k})},g=q(),I=g.ca("poll"),N=g.ca("refresh");Object.keys(l).forEach(function(a){a=g.link(l[a]);I(a,".poll();");N(a,".setDirty();")});
var C=g.compile();return{gb:l,viewport:f,M:C.M,refresh:C.refresh,Ab:function(){l.viewport.$a();l["scissor.box"].$a()}}}},{"./codegen":5,"./stack":25}],27:[function(c,g){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function q(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function d(b){return"[object HTMLCanvasElement]"===
a(b)}function f(b){return"[object CanvasRenderingContext2D]"===a(b)}var h=c("./check"),l=c("./values"),n=c("./is-typed-array"),I=c("./is-ndarray"),N=c("./load-texture"),C=c("./to-half-float"),A=c("./parse-dds"),r=[9984,9986,9985,9987];g.a=function(c,g,D,E,ba){function O(a){this.target=a;this.ua=this.ma=!1;this.ab=1;this.type=this.l=this.format=this.f=this.height=this.width=this.ga=0;this.F=!1;this.y=this.x=this.offset=this.N=this.ya=this.da=this.u=0;this.ha=!1;this.crossOrigin=this.S=this.canvas=
this.video=this.A=this.data=null;this.Y=this.oa=!1}function U(a){this.target=a;this.type=this.l=this.format=this.height=this.width=0;this.R=this.P=33071;this.X=0;this.Ga=9728;this.ea=1;this.L=!1;this.Ua=4352}function ea(a,b){var c,d,f=0,l=0,k=0,m=0,n=0,q=0,t=!1,x=!1,w=!1,y=0,A=[0,0,0,0,0,0],B=0,G=!1;for(c=0;c<b.length;++c){d=b[c];var m=m||d.width<<d.u,n=n||d.height<<d.u,f=f||d.type,l=l||d.format,k=k||d.l,q=q||d.f,x=x||d.oa,w=w||d.Y,t=t||d.F,C=d.u;d=d.target;G=G||0<C;3553===d?y|=1<<C:(d=d-34069,A[d]|=
1<<C,B|=1<<d)}a.oa=x;a.Y=w;a.width=m;a.height=n;a.format=l;a.l=k;a.type=f;x=G?(m<<1)-1:1;if(3553===a.target)h(0===B,"pixmap type must not contain cubemap faces"),h(y===x,"missing mip map data");else for(h(63===B,"missing cubemap faces"),c=0;6>c;++c)h(A[c]===x,"missing mip map data");c=0<=r.indexOf(a.X);a.L=!G&&(a.L||c);G=G||a.L;a.X?h(G===c,"min filter inconsistent with mipmap data"):a.X=G?9987:9728;G&&h(m===n&&!(m&m-1)&&!!m,"must be a square power of 2 to support mipmaps");a.L&&h(!t,"mipmap generation not supported for compressed textures");
a.P=a.P||33071;a.R=a.R||33071;33071===a.P&&33071===a.R||h(!(m&m-1)&&!!m&&!(n&n-1)&&!!n&&!B,"incompatible size for wrap mode, image must be a power of 2");(5126===f&&!g.zc||36193===f&&!g.Ac)&&h(9728===this.Ga&&9728===this.X,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=b[c],t=d.u,d.width&&h(d.width<<t===m,"inconsistent width"),d.height&&h(d.height<<t===n,"inconsistent width"),d.f?h(d.f===q,"inconsistent channels"):d.f=q,d.format?h(d.format===l,"inconsistent format"):d.format=
l,d.l?h(d.l===k,"inconsistent internalformat"):d.l=k,d.type?h(d.type===f,"inconsistent type"):d.type=f,d.ha&&h(5121===d.type&&6408===d.l,"incompatible format/type for copyTexImage2D")}function Q(a){this.id=y++;this.j=1;this.target=a;this.c=null;this.Z=this.ta=-1;this.fa=0;this.Da=null;this.B=new U(a);this.J=[]}function ca(a,b){function c(a,e){var d=e.zb,f;if(Array.isArray(d))for(var p=0;p<d.length;++p)f=new O(a),f.ra(b),f.ra(e),f.parse(d[p],p),g.push(f);else f=new O(a),f.ra(b),f.parse(e,0),g.push(f)}
var d;X(a);var f=a.B;U.call(f,a.target);var g=a.J;g.length=0;f.parse(b);if(3553===a.target)c(3553,b);else{var l=b.dc||b;if(Array.isArray(l))for(h(6===l.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,l[d]);else if("string"!==typeof l)for(d=0;6>d;++d)c(34069+d,{})}ea(f,g);f.Y&&ma(a);f.oa&&(a.ta=B.length,B.push(a));ka(a)}function ka(a){c.isTexture(a.c)||(a.c=c.createTexture());var b=a.target,d=a.Z;0<=d?(c.activeTexture(33984+d),K=d):c.bindTexture(b,a.c);for(var b=a.J,f=a.B,h=0;h<
b.length;++h)b[h].upload(f);f.upload();0>d&&((d=aa[K])?c.bindTexture(d.target,d.c):(a.Z=K,aa[K]=a))}function ma(a){function b(c,d,p){var g=A(p);h(g.format in H,"unsupported dds texture format");g.ia?(h(34067===a.target),h.h("cube map DDS not yet implemented")):h(3553===a.target);d&&h(1===g.J.length,"number of mip levels inconsistent");g.J.forEach(function(a){var b=new O(g.ia?a.target:c);b.f=g.f;b.F=g.F;b.type=g.type;b.l=g.format;b.format=H[g.format];b.width=a.width;b.height=a.height;b.u=a.u||d;b.data=
a.data;f.push(b)})}function c(){for(var h=0;h<f.length;++h){var p=f[h],g=p.A,l=p.video,k=p.S;g&&g.complete?(p.width=g.naturalWidth,p.height=g.naturalHeight):l&&2<l.readyState?(p.width=l.width,p.height=l.height):k&&4===k.readyState&&(f[h]=f[f.length-1],f.pop(),k.removeEventListener("readystatechange",ka),b(p.target,p.u,k.response))}ea(d,f);ka(a)}var d=a.B,f=a.J;f.forEach(function(a){a.A&&!a.A.complete?a.A.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.S&&
a.S.addEventListener("readystatechange",c)});a.Da=function(){f.forEach(function(a){a.A?a.A.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.S&&(a.S.removeEventListener("readystatechange",c),a.S.abort())})}}function X(a){var b=a.Da;b&&(b(),a.Da=null);b=a.ta;0<=b&&((B[b]=B[B.length-1]).id=b,B.pop(),a.ta=-1)}function J(a){var b=a.c;h(b,"must not double destroy texture");var d=a.Z,f=a.target;0<=d&&(c.activeTexture(33984+d),K=d,c.bindTexture(f,null),aa[d]=null);X(a);c.isTexture(b)&&
c.deleteTexture(b);a.c=null;a.B=null;a.J=null;a.j=0;delete m[a.id]}var V={"don't care":4352,"dont care":4352,nice:4354,fast:4353},da={repeat:10497,clamp:33071,mirror:33648},R={nearest:9728,linear:9729},fa=Object.assign({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},R),Z={none:0,browser:37444},ia={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},la={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,
rgba4:32854,"rgb5 a1":32855,rgb565:36194},S={};g.Pa&&(la.Kc=35904,la.Lc=35906);g.Va&&(ia.mb=5126);g.Wa&&(ia["half float"]=36193);g.Ka&&(Object.assign(la,{depth:6402,"depth stencil":34041}),Object.assign(ia,{uint16:5123,uint32:5125,"depth stencil":34042}));g.Vc&&Object.assign(S,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.Sc&&Object.assign(S,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.Uc&&Object.assign(S,
{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.Tc&&(S["rgb etc1"]=36196);var T=Array.prototype.slice.call(c.getParameter(34467));Object.keys(S).forEach(function(a){var b=S[a];0<=T.indexOf(b)&&(la[a]=b)});var w=Object.keys(la);D.Qc=w;var H=w.reduce(function(a,b){var c=la[b];a[c]=6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?c:32855===c||0<=b.indexOf("rgba")?6408:6407;return a},{});Object.assign(O.prototype,{ra:function(a){if("object"===
typeof a&&a){"premultiplyAlpha"in a&&(h.type(a.ua,"boolean","invalid premultiplyAlpha"),this.ua=a.ua);"flipY"in a&&(h.type(a.ma,"boolean","invalid texture flip"),this.ma=a.ma);"alignment"in a&&(h.qa(a.cb,[1,2,4,8],"invalid texture unpack alignment"),this.ab=a.cb);"colorSpace"in a&&(h.b(a.ga,Z,"invalid colorSpace"),this.ga=Z[a.ga]);if("format"in a){var b=a.format;h.b(b,la,"invalid texture format");this.l=la[b];b in ia&&(this.type=ia[b]);b in S&&(this.F=!0)}"type"in a&&(b=a.type,h.b(b,ia,"invalid texture type"),
this.type=ia[b]);var b=this.width,c=this.height,d=this.f;"shape"in a?(h(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.Za),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.f));this.width=b|0;this.height=c|0;this.f=d|0;"stride"in a?(b=a.m,h(Array.isArray(b)&&2<=b.length,"invalid stride vector"),this.da=b[0],this.ya=b[1],3===b.length?this.N=b[2]:this.N=1,this.pa=!0):(this.N=
1,this.da=this.N*d,this.ya=this.da*b);"offset"in a&&(this.offset=a.offset|0,this.pa=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,l){this.u=l;this.width=this.width>>l;this.height=this.height>>l;var p=c;switch(typeof c){case "string":break;case "object":if(!c)return;this.ra(c);var k=c.data;if("string"===typeof k||k&&(n(k)||b(k)||I(k)||d(k)||f(k)||"[object HTMLImageElement]"===a(k)||"[object HTMLVideoElement]"===a(k)||q(k)))p=c.data;break;case "undefined":return;default:h.h("invalid pixel data type")}"string"===
typeof p&&(p=N(p,this.crossOrigin));var k=null,m=!1;this.F&&h(p instanceof Uint8Array||"[object XMLHttpRequest]"===a(p),"compressed texture data must be stored in a uint8array");if(null!==p)if(n(p))this.data=p;else if(b(p))k=p,m=!0;else if(I(p)){Array.isArray(p.data)?(k=p.data,m=!0):this.data=p.data;var v=p.shape;this.width=v[0];this.height=v[1];3===v.length?this.f=v[2]:this.f=1;v=p.m;this.da=p.m[0];this.ya=p.m[1];3===v.length?this.N=p.m[2]:this.N=1;this.offset=p.offset;this.pa=!0}else if(d(p)||f(p))d(p)?
this.canvas=p:this.canvas=p.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.wa();else if("[object HTMLImageElement]"===a(p))this.A=p,p.complete?(this.width=p.naturalWidth,this.height=p.naturalHeight):(this.width=this.width||p.naturalWidth,this.height=this.height||p.naturalHeight,this.Y=!0),this.wa();else if("[object HTMLVideoElement]"===a(p))this.video=p,1<p.readyState?(this.width=p.width,this.height=p.height):(this.width=this.width||p.width,this.height=this.height||p.height,
this.Y=!0),this.oa=!0,this.wa();else if("[object XMLHttpRequest]"===a(p))this.S=p,this.Y=!0;else if(q(p)){var m=p.length,v=p[0].length,r=1,t,w,y,A;if(Array.isArray(p[0][0]))for(r=p[0][0].length,h(0<=r&&4>=r,"invalid number of channels for image data"),k=Array(m*v*r),w=A=0;w<v;++w)for(t=0;t<m;++t)for(y=0;y<r;++y)k[A++]=p[t][w][y];else for(k=Array(m*v),w=A=0;w<v;++w)for(t=0;t<m;++t)k[A++]=p[t][w];this.width=m;this.height=v;this.f=r;m=!0}else c.ha&&(this.ha=!0,this.x=this.x|0,this.y=this.y|0,this.width=
(this.width||ba.width)|0,this.height=(this.height||ba.height)|0,this.wa());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.l||(this.l=[6409,6410,6407,6408][(this.f=this.f||4)-1],h(this.l,"invalid number of channels"));v=this.l;if(6402===v||34041===v)h(g.Ka,"depth/stencil texture not supported"),6402===v&&h(5123===this.type||5125,"depth texture type must be uint16 or uint32"),
34041===v&&h(34042===this.type,"depth stencil texture format must match type"),h(!this.data&&!k&&!this.A&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");p=this.format=H[v];if(!this.f)switch(p){case 6409:case 6406:case 6402:this.f=1;break;case 34041:case 6410:this.f=2;break;case 6407:this.f=3;break;default:this.f=4}p=this.type;5126===p?h(g.Va,"float texture not supported"):36193===p?h(g.Wa,"half float texture not supported"):p||(p=6402===v?5125:5121);this.type=p;if(m)switch(p){case 5121:this.data=
new Uint8Array(k);break;case 5123:this.data=new Uint16Array(k);break;case 5125:this.data=new Uint32Array(k);break;case 5126:this.data=new Float32Array(k);break;case 36193:this.data=C(k);break;case 33635:case 32820:case 32819:case 34042:h.h("unsupported format for automatic conversion");break;default:h.h("unsupported type conversion")}if(this.data){if(this.pa){k=this.data;m=this.width;v=this.height;r=this.f;t=this.da;w=this.ya;y=this.N;A=this.offset;for(var x=new k.constructor(m*v*r),L=0,B=0;B<v;++B)for(var D=
0;D<m;++D)for(var E=0;E<r;++E)x[L++]=k[w*B+t*D+y*E+A];this.data=x}switch(p){case 5121:h(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:h(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:h(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:h(this.data instanceof Float32Array,"incompatible pixel type");break;default:h.h("bad or missing pixel type")}}this.pa=
!1},wa:function(){this.format=this.l=6408;this.type=5121;this.f=4;this.F=!1},upload:function(a){c.pixelStorei(37440,this.ma);c.pixelStorei(37441,this.ua);c.pixelStorei(37443,this.ga);c.pixelStorei(3317,this.ab);var b=this.target,d=this.u,f=this.A,h=this.canvas,g=this.video,l=this.data,m=this.l,n=this.format,q=this.type,r=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);g&&2<g.readyState?c.texImage2D(b,d,n,n,q,g):f&&f.complete?c.texImage2D(b,d,n,n,q,f):h?c.texImage2D(b,d,n,
n,q,h):this.F?c.compressedTexImage2D(b,d,m,r,a,0,l):this.ha?(E(),c.copyTexImage2D(b,d,n,this.x,this.y,r,a,0)):l?c.texImage2D(b,d,n,r,a,0,n,q,l):c.texImage2D(b,d,n,r||1,a||1,0,n,q,null)}});Object.assign(U.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;h.b(b,fa);this.X=fa[b]}"mag"in a&&(b=a.oc,h.b(b,R),this.Ga=R[b]);var b=this.P,c=this.R;if("wrap"in a){var d=a.Wc;"string"===typeof d?(h.b(d,da),b=c=da[d]):Array.isArray(d)&&(h.b(d[0],da),h.b(d[1],da),b=da[d[0]],c=da[d[1]])}else"wrapS"in
a&&(b=a.P,h.b(b,da),b=da[b]),"wrapT"in a&&(c=a.R,h.b(c,da),c=da[c]);this.P=b;this.R=c;"anisotropic"in a&&(b=a.ea,h("number"===typeof b&&1<=b&&b<=D.ub,"aniso samples must be between 1 and "),this.ea=a.ea);if("mipmap"in a)switch(a=a.zb,typeof a){case "string":h.b(a,V,"invalid mipmap hint");this.Ua=V[a];this.L=!0;break;case "boolean":this.L=!!a;break;case "object":break;default:h.h("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.X);c.texParameteri(a,10240,this.Ga);
c.texParameteri(a,10242,this.P);c.texParameteri(a,10243,this.R);g.lb&&c.texParameteri(a,34046,this.ea);this.L&&(c.hint(33170,this.Ua),c.generateMipmap(a))}});var K=0,y=0,m={},B=[],t=D.yb,aa=Array(t).map(function(){return null});Object.assign(Q.prototype,{bind:function(){this.fa+=1;var a=this.Z;if(0>a){for(var b=0;b<t;++b){var d=aa[b];if(d){if(0<d.fa)continue;d.Z=-1}aa[b]=this;a=b;break}a>=t&&h.h("insufficient number of texture units");this.Z=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.c);
K=a}return a},Rc:function(){--this.fa},aa:function(){0===--this.j&&J(this)}});return{create:function(a,b){function c(a,e,f,h,g,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,f,h,g,k]);ca(d,l);c.width=d.B.width;c.height=d.B.height;return c}var d=new Q(b);m[d.id]=d;c(a);Object.assign(c,{C:"texture",w:d,G:function(){d.aa()}});return c},refresh:function(){l(m).forEach(ka);for(var a=0;a<t;++a)aa[a]=null;K=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<t;++a)c.activeTexture(33984+a),
c.bindTexture(3553,null),aa[a]=null;c.activeTexture(33984);K=0;l(m).forEach(J)},M:function(){B.forEach(ka)},ic:function(){return null}}}},{"./check":3,"./is-ndarray":16,"./is-typed-array":17,"./load-texture":19,"./parse-dds":20,"./to-half-float":28,"./values":30}],28:[function(c,g){g.a=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),a=new Uint16Array(b.length),d=0;d<b.length;++d)if(isNaN(b[d]))a[d]=65535;else if(Infinity===b[d])a[d]=31744;else if(-Infinity===b[d])a[d]=64512;
else{var f=c[d],h=f>>>31<<15,g=(f<<1>>>24)-127,f=f>>13&1023;a[d]=-24>g?h:-14>g?h+(f+1024>>-14-g):15<g?h+31744:h+(g+15<<10)+f}return a}},{}],29:[function(c,g){g.a=function(){var b={};return{s:b,g:function(c){c in b||(b[c]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])}}}},{}],30:[function(c,g){g.a=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],31:[function(c,g){var b=c("./lib/check"),q=c("./lib/context"),a=c("./lib/extension"),d=c("./lib/limits"),f=c("./lib/buffer"),h=c("./lib/elements"),
l=c("./lib/texture"),n=c("./lib/renderbuffer"),I=c("./lib/framebuffer"),N=c("./lib/uniform"),C=c("./lib/attribute"),A=c("./lib/shader"),r=c("./lib/draw"),k=c("./lib/state"),u=c("./lib/compile"),D=c("./lib/read"),E=c("./lib/dynamic"),ba=c("./lib/raf"),O=c("./lib/clock");g.a=function(){function c(){F=ba.next(c);m.count+=1;if(m.width!==J.drawingBufferWidth||m.height!==J.drawingBufferHeight)m.width=J.drawingBufferWidth,m.height=J.drawingBufferHeight,B.Ab();var a=O();m.Oa=a-m.t;m.t=a;H.M();for(var b=0;b<
e.length;++b)(0,e[b])(m.count,m.t,m.Oa);m.Hb=O()-a}function g(){F&&(ba.cancel(c),F=0)}function Q(a){g();a.preventDefault();V.Bb&&V.Bb()}function ca(){da.refresh();Z.refresh();H.refresh();K.refresh();y.refresh();T.refresh();B.refresh();V.Cb&&V.Cb();c()}function ka(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];E.sb(f)?(d=!0,e[c]=E.Jb(f,c)):b[c]=f});return{Ea:e,Ja:b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.s||
{}),f=c(a.attributes||{});a=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Object.assign({},a);delete c.s;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=t.fb(a.Ja,e.Ja,f.Ja,a.Ea,e.Ea,f.Ea,d),g=e.U,h=e.eb,k=e.scope,l=[];return function(a,b){var c;if("number"===typeof a){for(c=a|0;l.length<c;)l.push(null);c=h(a|0,l)}else c=Array.isArray(a)?h(a.length,
a):"function"===typeof a?k(null,a):"function"===typeof b?k(a,b):g(a);return c}}function ma(){y.M();B.M()}var X=q(Array.prototype.slice.call(arguments)),J=X.Fa,V=X.options,da=a(J),X=da.Qa,R={width:J.drawingBufferWidth,height:J.drawingBufferHeight},fa=d(J,X),Z=f(J),ia=h(J,X,Z),la=N(),S=C(J,X,fa,Z),T=A(J,S,la,function(a){return t.U(a)}),w=r(J,X,Z),H=l(J,X,fa,ma,R),K=n(J,X,fa),y=I(J,X,fa,H,K),m={count:0,start:O(),Oa:0,t:O(),Hb:0,width:J.drawingBufferWidth,height:J.drawingBufferHeight,sa:V.sa},B=k(J,y,
R),R=D(J,ma,R),t=u(J,X,fa,Z,ia,H,y,B,la,S,T,w,m,ma),aa=J.canvas,e=[],F=0;aa&&(aa.addEventListener("webglcontextlost",Q,!1),aa.addEventListener("webglcontextrestored",ca,!1));return Object.assign(ka,{clear:function(a){var c=0;ma();var d=a.color;d&&(J.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(J.clearDepth(+a.depth),c|=256);"stencil"in a&&(J.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");J.clear(c)},Dc:E.hb,U:ka({}),elements:function(a){return ia.create(a)},
buffer:function(a){return Z.create(a,34962)},c:function(a){return H.create(a,3553)},ia:function(a){return 6===arguments.length?H.create(Array.prototype.slice.call(arguments),34067):H.create(a,34067)},i:function(a){return K.create(a)},V:function(a){return y.create(a)},hc:function(){b.h("framebuffer cube not yet implemented")},frame:function(a){e.push(a);!F&&0<e.length&&c();return{cancel:function(){var b=e.find(function(b){return b===a});0>b||(e.splice(b,1),0>=e.length&&g())}}},Mc:m,nc:fa,read:R,G:function(){g();
aa&&(aa.removeEventListener("webglcontextlost",Q),aa.removeEventListener("webglcontextrestored",ca));T.clear();y.clear();K.clear();H.clear();Z.clear();V.Ha&&V.Ha()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/check":3,"./lib/clock":4,"./lib/compile":6,"./lib/context":10,"./lib/draw":11,"./lib/dynamic":12,"./lib/elements":13,"./lib/extension":14,"./lib/framebuffer":15,"./lib/limits":18,"./lib/raf":21,"./lib/read":22,"./lib/renderbuffer":23,"./lib/shader":24,"./lib/state":26,"./lib/texture":27,
"./lib/uniform":29}]},{},[31])(31)});
