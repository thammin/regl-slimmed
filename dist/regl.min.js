(function(ua){"object"===typeof exports&&"undefined"!==typeof module?module.exports=ua():"function"===typeof define&&define.amd?define([],ua):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).initREGL=ua()})(function(){return function g(n,r,e){function h(a,c){if(!r[a]){if(!n[a]){var b="function"==typeof require&&require;if(!c&&b)return b(a,!0);if(l)return l(a,!0);b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b;}b=r[a]=
{exports:{}};n[a][0].call(b.exports,function(c){var l=n[a][1][c];return h(l?l:c)},b,b.exports,g,n,r,e)}return r[a].exports}for(var l="function"==typeof require&&require,b=0;b<e.length;b++)h(e[b]);return h}({1:[function(g,n,r){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}n.exports=function(h,l,b,a,c){h=b.maxAttributes;l=Array(h);for(b=0;b<h;++b)l[b]=new e;return{Record:e,scope:{},state:l}}},
{}],2:[function(g,n,r){function e(a,c){for(var l=0;l<c.length;++l)a[l]=c[l]}var h=g("./util/is-typed-array"),l=g("./util/is-ndarray"),b=g("./util/values"),a=g("./util/flatten"),c=g("./util/transpose"),z=g("./util/pool"),F=g("./constants/arraytypes.json"),G=g("./constants/dtypes.json"),y=g("./constants/usage.json");n.exports=function(g){function q(a){this.id=m++;this.buffer=g.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121}function v(a,c,l){a.byteLength=
c.byteLength;g.bufferData(a.type,c,l)}function f(b,f,m,g,q){b.usage=m;if(Array.isArray(f))b.dtype=g||5126,0<f.length&&Array.isArray(f[0])?(b.dimension=f[0].length,g=z.allocType(b.dtype,f.length*b.dimension),a(g,f,b.dimension)):(b.dimension=q,g=z.allocType(b.dtype,f.length),e(g,f)),v(b,g,m),z.freeType(g);else if(h(f))b.dtype=g||F[Object.prototype.toString.call(f)]|0,b.dimension=q,v(b,f,m);else if(l(f)){var u=f.shape,w=f.stride;q=f.offset;var R=0,W=0,n=0,A=0;1===u.length?(R=u[0],W=1,n=w[0],A=0):2===
u.length&&(R=u[0],W=u[1],n=w[0],A=w[1]);b.dtype=g||F[Object.prototype.toString.call(f.data)]|0||5126;b.dimension=W;g=z.allocType(b.dtype,R*W);c(g,f.data,R,W,n,A,q);v(b,g,m);z.freeType(g)}}function w(a){var c=a.buffer;g.isBuffer(c)&&g.deleteBuffer(c);a.buffer=null;delete A[a.id]}var m=0,A={};q.prototype.bind=function(){g.bindBuffer(this.type,this.buffer)};var n=[];return{create:function(b,m,n){function v(a){var c=35044,b=null,e=0,m=0,q=1;Array.isArray(a)||h(a)||l(a)?b=a:"number"===typeof a?e=a|0:a&&
("data"in a&&(b=a.data),"usage"in a&&(c=y[a.usage]),"type"in a&&(m=G[a.type]),"dimension"in a&&(q=a.dimension|0),"length"in a&&(e=a.length|0));E.bind();b?f(E,b,c,m,q):(g.bufferData(E.type,e,c),E.dtype=m||5121,E.usage=c,E.dimension=q,E.byteLength=e);return v}var E=new q(m);A[E.id]=E;n||v(b);v._reglType="buffer";v._buffer=E;v.subdata=function(b,f){var m=(f||0)|0;E.bind();if(Array.isArray(b))if(0<b.length&&Array.isArray(b[0])){var q=b[0].length,w=z.allocType(E.dtype,b.length*q);a(w,b,q);g.bufferSubData(E.type,
m,w);z.freeType(w)}else q=z.allocType(E.dtype,b.length),e(q,b),g.bufferSubData(E.type,m,q),z.freeType(q);else if(h(b))g.bufferSubData(E.type,m,b);else if(l(b)){var n=b.shape,A=b.stride,fa=w=q=0,Y=0;1===n.length?(q=n[0],w=1,fa=A[0],Y=0):2===n.length&&(q=n[0],w=n[1],fa=A[0],Y=A[1]);n=Array.isArray(b.data)?E.dtype:F[Object.prototype.toString.call(b.data)]|0;n=z.allocType(n,q*w);c(n,b.data,q,w,fa,Y,b.offset);g.bufferSubData(E.type,m,n);z.freeType(n)}return v};v.destroy=function(){w(E)};return v},createStream:function(a,
b){var c=n.pop();c||(c=new q(a),c.buffer=g.createBuffer());c.bind();f(c,b,35040,0,1);return c},destroyStream:function(a){n.push(a)},clear:function(){b(A).forEach(w)},getBuffer:function(a){return a&&a._buffer instanceof q?a._buffer:null},_initBuffer:f}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./constants/usage.json":6,"./util/flatten":21,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/pool":27,"./util/transpose":30,"./util/values":31}],3:[function(g,n,r){n.exports=
{"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(g,n,r){n.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],5:[function(g,n,r){n.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,
triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(g,n,r){n.exports={"static":35044,dynamic:35048,stream:35040}},{}],7:[function(g,n,r){function e(a){return Array.isArray(a)||G(a)||y(a)}function h(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function l(a,b,c,l){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=l}function b(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function a(a){return new l(!1,!1,!1,a)}function c(a,b){var c=a.type;
return 0===c?(c=a.data.length,new l(!0,1<=c,2<=c,b)):new l(3===c,2===c,1===c,b)}var z=g("./util/codegen"),F=g("./util/loop"),G=g("./util/is-typed-array"),y=g("./util/is-ndarray"),t=g("./constants/primitives.json"),q=g("./constants/dtypes.json"),v=["x","y","z","w"],f={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,
"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},w={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},m={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},A={cw:2304,ccw:2305},E=new l(!1,!1,!1,function(){});n.exports=function(g,n,y,r,Q,u,la,R,W,Z,J,aa,H){function O(a){return a.replace(".",
"_")}function K(a,d,b){var c=O(a);pa.push(a);ma[c]=ha[c]=!!b;ia[c]=d}function B(a,d,b){var c=O(a);pa.push(a);Array.isArray(b)?(ha[c]=b.slice(),ma[c]=b.slice()):ha[c]=ma[c]=b;ja[c]=d}function I(){var a=z(),d=a.link,b=a.global;a.id=Ca++;a.batchId="0";var c=d(ya),p=a.shared={props:"a0"};Object.keys(ya).forEach(function(k){p[k]=b.def(c,".",k)});var C=a.next={},l=a.current={};Object.keys(ja).forEach(function(k){Array.isArray(ha[k])&&(C[k]=b.def(p.next,".",k),l[k]=b.def(p.current,".",k))});var k=a.constants=
{};Object.keys(qa).forEach(function(a){k[a]=b.def(JSON.stringify(qa[a]))});a.invoke=function(k,b){switch(b.type){case 0:var ca=["this",p.context,p.props,a.batchId];return k.def(d(b.data),".call(",ca.slice(0,Math.max(b.data.length+1,4)),")");case 1:return k.def(p.props,b.data);case 2:return k.def(p.context,b.data);case 3:return k.def("this",b.data)}};a.attribCache={};var ca={};a.scopeAttrib=function(k){k=n.id(k);if(k in ca)return ca[k];var a=Z.scope[k];a||(a=Z.scope[k]=new na);return ca[k]=d(a)};return a}
function da(d){var b=d["static"];d=d.dynamic;if("framebuffer"in b){var p=b.framebuffer;return p?(p=R.getFramebuffer(p),a(function(a,d){var b=a.link(p),k=a.shared;d.set(k.framebuffer,".next",b);k=k.context;d.set(k,".framebufferWidth",b+".width");d.set(k,".framebufferHeight",b+".height");return b})):a(function(a,d){var b=a.shared;d.set(b.framebuffer,".next","null");b=b.context;d.set(b,".framebufferWidth",b+".drawingBufferWidth");d.set(b,".framebufferHeight",b+".drawingBufferHeight");return null})}if("framebuffer"in
d){var l=d.framebuffer;return c(l,function(a,d){var b=a.invoke(d,l),k=a.shared,ca=k.framebuffer,b=d.def(ca,".getFramebuffer(",b,")");d.set(ca,".next",b);k=k.context;d.set(k,".framebufferWidth",b+"?"+b+".width:"+k+".drawingBufferWidth");d.set(k,".framebufferHeight",b+"?"+b+".height:"+k+".drawingBufferHeight");return b})}return null}function S(a,d){function b(k){if(k in p){var a=p[k];k=!0;var x=a.x|0,za=a.y|0,C,h;"w"in a?C=a.w|0:k=!1;"h"in a?h=a.h|0:k=!1;return new l(k&&d&&d.thisDep,k&&d&&d.contextDep,
k&&d&&d.propDep,function(k,d){var b=k.shared.context,c=C;"w"in a||(c=d.def(b,".","framebufferWidth","-",x));var p=h;"h"in a||(p=d.def(b,".","framebufferHeight","-",za));return[x,za,c,p]})}if(k in f){var e=f[k];k=c(e,function(k,a){var d=k.invoke(a,e),b=k.shared.context,c=a.def(d,".x|0"),ca=a.def(d,".y|0"),x=a.def('"w" in ',d,"?",d,".w|0:","(",b,".","framebufferWidth","-",c,")"),d=a.def('"h" in ',d,"?",d,".h|0:","(",b,".","framebufferHeight","-",ca,")");return[c,ca,x,d]});d&&(k.thisDep=k.thisDep||d.thisDep,
k.contextDep=k.contextDep||d.contextDep,k.propDep=k.propDep||d.prpoDep);return k}return d?new l(d.thisDep,d.contextDep,d.propDep,function(k,a){var d=k.shared.context;return[0,0,a.def(d,".","framebufferWidth"),a.def(d,".","framebufferHeight")]}):null}var p=a["static"],f=a.dynamic,C=b("viewport");if(C)var h=C,C=new l(C.thisDep,C.contextDep,C.propDep,function(k,a){var d=h.append(k,a),b=k.shared.context;a.set(b,".viewportWidth",d[2]);a.set(b,".viewportHeight",d[3]);return d});return{viewport:C,scissor_box:b("scissor.box")}}
function L(d){function p(k){if(k in f){var d=n.id(f[k]);k=a(function(){return d});k.id=d;return k}if(k in h){var b=h[k];return c(b,function(k,a){var d=k.invoke(a,b);return a.def(k.shared.strings,".id(",d,")")})}return null}var f=d["static"],h=d.dynamic,e=p("frag"),C=p("vert"),m=null;b(e)&&b(C)?(m=J.program(C.id,e.id),d=a(function(k,a){return k.link(m)})):d=new l(e&&e.thisDep||C&&C.thisDep,e&&e.contextDep||C&&C.contextDep,e&&e.propDep||C&&C.propDep,function(k,a){var d=k.shared.shader,b;b=e?e.append(k,
a):a.def(d,".","frag");var c;c=C?C.append(k,a):a.def(d,".","vert");return a.def(d+".program("+c+","+b+")")});return{frag:e,vert:C,progVar:d,program:m}}function D(d){function p(d,k){if(d in f){var b=f[d]|0;return a(function(d,a){k&&(d.OFFSET=b);return b})}if(d in h){var x=h[d];return c(x,function(d,a){var b=d.invoke(a,x);k&&(d.OFFSET=b);return b})}return k&&m?a(function(k,d){k.OFFSET="0";return 0}):null}var f=d["static"],h=d.dynamic,m=function(){if("elements"in f){var d=f.elements;e(d)?d=u.getElements(u.create(d)):
d&&(d=u.getElements(d));var k=a(function(k,a){if(d){var b=k.link(d);return k.ELEMENTS=b}return k.ELEMENTS=null});k.value=d;return k}if("elements"in h){var b=h.elements;return c(b,function(k,d){var a=k.shared,c=a.isBufferArgs,a=a.elements,p=k.invoke(d,b),x=d.def("null"),c=d.def(c,"(",p,")"),p=k.cond(c).then(x,"=",a,".createStream(",p,");")["else"](x,"=",a,".getElements(",p,");");d.entry(p);d.exit(k.cond(c).then(a,".destroyStream(",x,");"));return k.ELEMENTS=x})}return null}(),C=p("offset",!0);return{elements:m,
primitive:function(){if("primitive"in f){var d=f.primitive;return a(function(k,a){return t[d]})}if("primitive"in h){var k=h.primitive;return c(k,function(d,a){var b=d.constants.primTypes,c=d.invoke(a,k);return a.def(b,"[",c,"]")})}return m?b(m)?m.value?a(function(k,d){return d.def(k.ELEMENTS,".primType")}):a(function(){return 4}):new l(m.thisDep,m.contextDep,m.propDep,function(k,d){var a=k.ELEMENTS;return d.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in f){var d=f.count|0;return a(function(){return d})}if("count"in
h){var k=h.count;return c(k,function(d,a){return d.invoke(a,k)})}return m?b(m)?m?C?new l(C.thisDep,C.contextDep,C.propDep,function(k,d){return d.def(k.ELEMENTS,".vertCount-",k.OFFSET)}):a(function(k,d){return d.def(k.ELEMENTS,".vertCount")}):a(function(){return-1}):new l(m.thisDep||C.thisDep,m.contextDep||C.contextDep,m.propDep||C.propDep,function(k,d){var a=k.ELEMENTS;return k.OFFSET?d.def(a,"?",a,".vertCount-",k.OFFSET,":-1"):d.def(a,"?",a,".vertCount:-1")}):null}(),instances:p("instances",!1),
offset:C}}function T(d){var b=d["static"],p=d.dynamic,l={};pa.forEach(function(d){function x(k,f){if(d in b){var e=k(b[d]);l[h]=a(function(){return e})}else if(d in p){var m=p[d];l[h]=c(m,function(k,d){return f(k,d,k.invoke(d,m))})}}var h=O(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(k){return k},function(k,d,
a){return a});case "depth.func":return x(function(k){return w[k]},function(k,d,a){return d.def(k.constants.compareFuncs,"[",a,"]")});case "depth.range":return x(function(d){return d},function(d,a,b){d=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[d,a]});case "blend.func":return x(function(d){return[f["srcRGB"in d?d.srcRGB:d.src],f["dstRGB"in d?d.dstRGB:d.dst],f["srcAlpha"in d?d.srcAlpha:d.src],f["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,a,b){function c(d,k){var p=a.def('"',d,k,'" in ',b,"?",
b,".",d,k,":",b,".",d);return a.def(x,"[",p,"]")}var x=d.constants.blendFuncs;d=c("src","RGB");var p=c("src","Alpha"),f=c("dst","RGB"),l=c("dst","Alpha");return[d,f,p,l]});case "blend.equation":return x(function(d){if("string"===typeof d)return[ka[d],ka[d]];if("object"===typeof d)return[ka[d.rgb],ka[d.alpha]]},function(d,a,b){var c=d.constants.blendEquations,x=a.def(),p=a.def();d=d.cond("typeof ",b,'==="string"');d.then(x,"=",p,"=",c,"[",b,"];");d["else"](x,"=",c,"[",b,".rgb];",p,"=",c,"[",b,".alpha];");
a(d);return[x,p]});case "blend.color":return x(function(d){return F(4,function(a){return+d[a]})},function(d,a,b){return F(4,function(d){return a.def("+",b,"[",d,"]")})});case "stencil.mask":return x(function(d){return d|0},function(d,a,b){return a.def(b,"|0")});case "stencil.func":return x(function(d){return[w[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,a,b){d=a.def('"cmp" in ',b,"?",d.constants.compareFuncs,"[",b,".cmp]",":",7680);var c=a.def(b,".ref|0");a=a.def('"mask" in ',b,"?",
b,".mask|0:-1");return[d,c,a]});case "stencil.opFront":case "stencil.opBack":return x(function(a){return["stencil.opBack"===d?1029:1028,m[a.fail||"keep"],m[a.zfail||"keep"],m[a.pass||"keep"]]},function(a,b,c){function x(d){return b.def('"',d,'" in ',c,"?",p,"[",c,".",d,"]:",7680)}var p=a.constants.stencilOps;return["stencil.opBack"===d?1029:1028,x("fail"),x("zfail"),x("pass")]});case "polygonOffset.offset":return x(function(d){return[d.factor|0,d.units|0]},function(d,a,b){d=a.def(b,".factor|0");a=
a.def(b,".units|0");return[d,a]});case "cull.face":return x(function(d){var a=0;"front"===d?a=1028:"back"===d&&(a=1029);return a},function(d,a,b){return a.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(d){return d},function(d,a,b){return b});case "frontFace":return x(function(d){return A[d]},function(d,a,b){return a.def(b+'==="cw"?2304:2305')});case "colorMask":return x(function(d){return d.map(function(d){return!!d})},function(d,a,b){return F(4,function(d){return"!!"+b+"["+
d+"]"})});case "sample.coverage":return x(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,b){d=a.def('"value" in ',b,"?+",b,".value:1");a=a.def("!!",b,".invert");return[d,a]})}});return l}function V(d){var b=d["static"],p=d.dynamic,f={};Object.keys(b).forEach(function(d){var c=b[d],x;if("number"===typeof c||"boolean"===typeof c)x=a(function(){return c});else if("function"===typeof c&&"texture"===c._reglType)x=a(function(d){return d.link(c)});else if(Array.isArray(c)||G(c))x=a(function(d){return d.global.def("[",
F(c.length,function(d){return c[d]}),"]")});x.value=c;f[d]=x});Object.keys(p).forEach(function(d){var a=p[d];f[d]=c(a,function(d,b){return d.invoke(b,a)})});return f}function N(d){var b=d["static"],p=d.dynamic,f={};Object.keys(b).forEach(function(d){var c=b[d],x=n.id(d),k=new na;if(e(c))k.state=1,k.buffer=Q.getBuffer(Q.create(c,34962,!1)),k.type=k.buffer.dtype;else{var p=Q.getBuffer(c);if(p)k.state=1,k.buffer=p,k.type=p.dtype;else if(c.constant){var l=c.constant;k.state=2;"number"===typeof l?k.x=
l:v.forEach(function(d,a){a<l.length&&(k[d]=l[a])})}else{var p=Q.getBuffer(c.buffer),h=c.offset|0,m=c.stride|0,g=c.size|0,Ba=!!c.normalized,U=0;"type"in c&&(U=q[c.type]);c=c.divisor|0;k.buffer=p;k.state=1;k.size=g;k.normalized=Ba;k.type=U||p.dtype;k.offset=h;k.stride=m;k.divisor=c}}f[d]=a(function(d,a){var b=d.attribCache;if(x in b)return b[x];var c={isStream:!1};Object.keys(k).forEach(function(d){c[d]=k[d]});k.buffer&&(c.buffer=d.link(k.buffer));return b[x]=c})});Object.keys(p).forEach(function(d){var a=
p[d];f[d]=c(a,function(d,b){function c(d){b(h[d],"=",p,".",d,"|0;")}var p=d.invoke(b,a),x=d.shared,f=x.isBufferArgs,l=x.buffer,h={isStream:b.def(!1)},m=new na;m.state=1;Object.keys(m).forEach(function(d){h[d]=b.def(""+m[d])});var e=h.buffer,ba=h.type;b("if(",f,"(",p,")){",h.isStream,"=true;",e,"=",l,".createStream(",34962,",",p,");",ba,"=",e,".dtype;","}else{",e,"=",l,".getBuffer(",p,");","if(",e,"){",ba,"=",e,".dtype;","}else if(",p,".constant){",h.state,"=",2,";",v.map(function(d,a){return h[d]+
"="+p+".length>="+a+"?"+p+"["+a+"]:0;"}).join(""),"}else{",e,"=",l,".getBuffer(",p,".buffer);",ba,'="type" in ',p,"?",x.glTypes,"[",p,".type]:",e,".dtype;",h.normalized,"=!!",p,".normalized;");c("size");c("offset");c("stride");c("divisor");b("}}");return h})});return f}function M(d){var b=d["static"],p=d.dynamic,f={};Object.keys(b).forEach(function(d){var c=b[d];f[d]=a(function(d,a){return"number"===typeof c||"boolean"===typeof c?""+c:d.link(c)})});Object.keys(p).forEach(function(d){var a=p[d];f[d]=
c(a,function(d,b){return d.invoke(b,a)})});return f}function X(d,a,b){var c=d.shared.context,p=d.scope();Object.keys(b).forEach(function(f){a.save(c,"."+f);p(c,".",f,"=",b[f].append(d,a),";")});a(p)}function d(d,a,b){var c=d.shared,p=c.gl,f=c.framebuffer,l;ra&&(l=a.def(c.extensions,".webgl_draw_buffers"));var k=d.constants,c=k.drawBuffers,k=k.backBuffer;d=b?b.append(d,a):a.def(f,".next");a("if(",f,".dirty||",d,"!==",f,".cur){","if(",d,"){",p,".bindFramebuffer(",36160,",",d,".framebuffer);");ra&&a(l,
".drawBuffersWEBGL(",c,"[",d,".colorAttachments.length]);");a("}else{",p,".bindFramebuffer(",36160,",null);");ra&&a(l,".drawBuffersWEBGL(",k,");");a("}",f,".cur=",d,";",f,".dirty=false;","}")}function ea(d,a,b){var c=d.shared,p=c.gl,f=d.current,l=d.next,k=c.current,h=c.next,e=d.cond(k,".dirty");pa.forEach(function(a){a=O(a);if(!(a in b.state)){var c,m;if(a in l){c=l[a];m=f[a];var ba=F(ha[a].length,function(d){return e.def(c,"[",d,"]")});e(d.cond(ba.map(function(d,a){return d+"==="+m+"["+a+"]"}).join("&&")).then(p,
".",ja[a],"(",ba,");",ba.map(function(d,a){return m+"["+a+"]="+d}).join(";"),";"))}else c=e.def(h,".",a),ba=d.cond(c,"!==",k,".",a),e(ba),a in ia?ba(d.cond(c).then(p,".enable(",ia[a],");")["else"](p,".disable(",ia[a],");"),k,".",a,"=",c,";"):ba(p,".",ja[a],"(",c,");",k,".",a,"=",c,";")}});0===Object.keys(b.state).length&&e(k,".dirty=false;");a(e)}function p(d,a,c,p){var f=d.shared,l=d.current,e=f.current,k=f.gl;h(Object.keys(c)).forEach(function(f){var h=c[f];if(!p||p(h)){var m=h.append(d,a);if(ia[f]){var g=
ia[f];b(h)?m?a(k,".enable(",g,");"):a(k,".disable(",g,");"):a(d.cond(m).then(k,".enable(",g,");")["else"](k,".disable(",g,");"));a(e,".",f,"=",m,";")}else if(Array.isArray(m)){var q=l[f];a(k,".",ja[f],"(",m,");",m.map(function(d,a){return q+"["+a+"]="+d}).join(";"),";")}else a(k,".",ja[f],"(",m,");",e,".",f,"=",m,";")}})}function U(d,a){oa&&!d.instancing&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function sa(d,a,b,c,p){function f(d){switch(d){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function l(b,c,p){function f(){a("if(!",g,".pointer){",e,".enableVertexAttribArray(",m,");",g,".pointer=true;}");var b=p.type,k;k=p.size?a.def(p.size,"||",c):c;a("if(",g,".type!==",b,"||",g,".size!==",k,"||",n.map(function(d){return g+"."+d+"!=="+p[d]}).join("||"),"){",e,".bindBuffer(",34962,",",q,".buffer);",e,".vertexAttribPointer(",[m,k,b,p.normalized,p.stride,p.offset],");",g,".type=",b,";",g,
".size=",k,";",n.map(function(d){return g+"."+d+"="+p[d]+";"}).join(""),"}");oa&&(b=p.divisor,a("if(",g,".divisor!==",b,"){",d.instancing,".vertexAttribDivisorANGLE(",[m,b],");",g,".divisor=",b,";}"))}function h(){a("if(",g,".pointer){",e,".disableVertexAttribArray(",m,");",g,".pointer=false;","}if(",v.map(function(d,a){return g+"."+d+"!=="+U[a]}).join("||"),"){",e,".vertexAttrib4f(",m,",",U,");",v.map(function(d,a){return g+"."+d+"="+U[a]+";"}).join(""),"}")}var e=k.gl,m=a.def(b,".location"),g=a.def(k.attributes,
"[",m,"]");b=p.state;var q=p.buffer,U=[p.x,p.y,p.z,p.w],n=["buffer","normalized","offset","stride"];1===b?f():2===b?h():(a("if(",b,"===",1,"){"),f(),a("}else{"),h(),a("}"))}var k=d.shared;c.forEach(function(c){var k=c.name,h=b.attributes[k],m;if(h){if(!p(h))return;m=h.append(d,a)}else{if(!p(E))return;var e=d.scopeAttrib(k);m={};Object.keys(new na).forEach(function(d){m[d]=a.def(e,".",d)})}l(d.link(c),f(c.info.type),m)})}function ta(d,a,b,c,p){for(var f=d.shared,h=f.gl,k,m=0;m<c.length;++m){var l=
c[m],e=l.name,g=l.info.type,q=b.uniforms[e],l=d.link(l)+".location";if(q){if(!p(q))continue;if(q["static"]){e=q.value;if(35678===g||35680===g)g=d.link(e._texture),a(h,".uniform1i(",l,g+".bind());"),a.exit(g,".unbind()");else if(35674===g||35675===g||35676===g)e=d.global.def("["+e+"]"),q=2,35675===g?q=3:35676===g&&(q=4),a(h,".uniformMatrix",q,"fv(",l,",false,",e,");");else{switch(g){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;
case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}a(h,".uniform",k,"(",l,",",e,");")}continue}else e=q.append(d,a)}else{if(!p(E))continue;e=a.def(f.uniforms,"[",n.id(e),"]")}q=",";switch(g){case 35678:case 35680:g=a.def(e,"._texture");a(h,".uniform1i(",l,",",g,".bind());");a.exit(g,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2iv";break;case 35668:case 35672:k=
"3iv";break;case 35669:case 35673:k="4iv";break;case 5126:k="1f";break;case 35664:k="2fv";break;case 35665:k="3fv";break;case 35666:k="4fv";break;case 35674:k="Matrix2fv";q=",false,";break;case 35675:k="Matrix3fv";q=",false,";break;case 35676:k="Matrix4fv",q=",false,"}a(h,".uniform",k,"(",l,q,e,");")}}function va(d,a,c,p){function f(b){var p=g[b];return p?p.batchStatic?p.append(d,a):p.append(d,c):a.def(m,".",b)}function e(){function d(){c(v,".drawElementsInstancedANGLE(",[U,w,A,n+"<<(("+A+"-5121)>>1)",
ea],");")}function a(){c(v,".drawArraysInstancedANGLE(",[U,n,w,ea],");")}q?z?d():(c("if(",q,"){"),d(),c("}else{"),a(),c("}")):a()}function l(){function d(){c(h+".drawElements("+[U,w,A,n+"<<(("+A+"-5121)>>1)"]+");")}function a(){c(h+".drawArrays("+[U,n,w]+");")}q?z?d():(c("if(",q,"){"),d(),c("}else{"),a(),c("}")):a()}var k=d.shared,h=k.gl,m=k.draw,g=p.draw,q=function(){var b=g.elements,p=a;b?(b.batchStatic||(p=c),b=b.append(d,p)):b=p.def(m,".","elements");b&&p("if("+b+")"+h+".bindBuffer(34963,"+b+
".buffer.buffer);");return b}(),U=f("primitive"),n=f("offset"),w=function(){var b=g.count,p=a;b?(b.batchStatic||(p=c),b=b.append(d,p)):b=p.def(m,".","count");return b}();if("number"===typeof w){if(0===w)return}else c("if(",w,"){"),c.exit("}");var ea,v;oa&&(ea=f("instances"),v=d.instancing);var A=q+".type",z=g.elements&&b(g.elements);oa&&("number"!==typeof ea||0<=ea)?"string"===typeof ea?(c("if(",ea,">0){"),e(),c("}else if(",ea,"<0){"),l(),c("}")):e():l()}function wa(d,a,b,c,p){a=I();p=a.proc("body",
p);oa&&(a.instancing=p.def(a.shared.extensions,".angle_instanced_arrays"));d(a,p,b,c);return a.compile().body}function Aa(d,a,b,c){U(d,a);sa(d,a,b,c.attributes,function(){return!0});ta(d,a,b,c.uniforms,function(){return!0});va(d,a,a,b)}function Da(a,b){var c=a.proc("draw",1);U(a,c);X(a,c,b.context);d(a,c,b.framebuffer);ea(a,c,b);p(a,c,b.state);var f=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",f,".program);");if(b.shader.program)Aa(a,c,b,b.shader.program);else{var e=a.global.def("{}"),
l=c.def(f,".id"),h=c.def(e,"[",l,"]");c(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",e,"[",l,"]=",a.link(function(d){return wa(Aa,a,b,d,1)}),"(",f,");",h,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ea(d,a,b,c){function p(){return!0}d.batchId="a1";U(d,a);sa(d,a,b,c.attributes,p);ta(d,a,b,c.uniforms,p);va(d,a,a,b)}function xa(a,b,c,f){function e(d){return d.contextDep&&l||d.propDep}function h(d){return!e(d)}U(a,b);var l=c.contextDynamic,k=b.def(),
m=b.def();a.shared.props=m;a.batchId=k;var g=a.scope(),q=a.scope();b(g.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",m,"=","a0","[",k,"];",q,"}",g.exit);c.needsContext&&X(a,q,c.context);c.needsFramebuffer&&d(a,q,c.framebuffer);p(a,q,c.state,e);f?(sa(a,g,c,f.attributes,h),sa(a,q,c,f.attributes,e),ta(a,g,c,f.uniforms,h),ta(a,q,c,f.uniforms,e),va(a,g,q,c)):(b=a.global.def("{}"),f=c.shader.progVar.append(a,q),m=q.def(f,".id"),g=q.def(b,"[",m,"]"),q(a.shared.gl,".useProgram(",f,".program);","if(!",g,"){",
g,"=",b,"[",m,"]=",a.link(function(d){return wa(Ea,a,c,d,2)}),"(",f,");}",g,".call(this,a0[",k,"],",k,");"))}function Fa(a,b){var c=a.proc("batch",2);a.batchId="0";U(a,c);var f=!1,e=!0;Object.keys(b.context).forEach(function(d){f=f||b.context[d].propDep});f||(X(a,c,b.context),e=!1);var h=b.framebuffer,l=!1;h&&(h.propDep?f=l=!0:h.contextDep&&f&&(l=!0),l||d(a,c,h));b.state.viewport&&b.state.viewport.propDynamic&&(f=!0);ea(a,c,b);p(a,c,b.state,function(d){return!(d.contextDep&&f||d.propDep)});b.contextDep=
f;b.needsContext=e;b.needsFramebuffer=l;e=b.shader.progVar;if(e.contextDep&&f||e.propDep)xa(a,c,b,null);else if(e=e.append(a,c),c(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)xa(a,c,b,b.shader.program);else{var h=a.global.def("{}"),l=c.def(e,".id"),k=c.def(h,"[",l,"]");c(a.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",h,"[",l,"]=",a.link(function(d){return wa(xa,a,b,d,2)}),"(",e,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ga(d,
a){function b(f){var k=a.shader[f];k&&c.set(p.shader,"."+f,k.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var p=d.shared,f=p.current;X(d,c,a.context);a.framebuffer&&a.framebuffer.append(d,c);h(Object.keys(a.state)).forEach(function(b){var k=a.state[b].append(d,c);Array.isArray(k)?k.forEach(function(a,p){c.set(d.next[b],"["+p+"]",a)}):c.set(p.next,"."+b,k)});["elements","offset","count","instances","primitive"].forEach(function(b){var k=a.draw[b];k&&c.set(p.draw,"."+b,""+k.append(d,c))});Object.keys(a.uniforms).forEach(function(b){c.set(p.uniforms,
"["+n.id(b)+"]",a.uniforms[b].append(d,c))});Object.keys(a.attributes).forEach(function(b){var p=a.attributes[b].append(d,c),f=d.scopeAttrib(b);Object.keys(new na).forEach(function(d){c.set(f,"."+d,p[d])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(f,".dirty=true;"),c.exit(f,".dirty=true;"));c("a1(",d.shared.context,",a0,0);")}var na=Z.Record,ka={add:32774,subtract:32778,"reverse subtract":32779};y.ext_blend_minmax&&(ka.min=32775,ka.max=32776);var oa=y.angle_instanced_arrays,ra=y.webgl_draw_buffers,
ha={dirty:!0},ma={},pa=[],ia={},ja={};K("dither",3024);K("blend.enable",3042);B("blend.color","blendColor",[0,0,0,0]);B("blend.equation","blendEquationSeparate",[32774,32774]);B("blend.func","blendFuncSeparate",[1,0,1,0]);K("depth.enable",2929,!0);B("depth.func","depthFunc",513);B("depth.range","depthRange",[0,1]);B("depth.mask","depthMask",!0);B("colorMask","colorMask",[!0,!0,!0,!0]);K("cull.enable",2884);B("cull.face","cullFace",1029);B("frontFace","frontFace",2305);B("lineWidth","lineWidth",1);
K("polygonOffset.enable",32823);B("polygonOffset.offset","polygonOffset",[0,0]);K("sample.alpha",32926);K("sample.enable",32928);B("sample.coverage","sampleCoverage",[1,!1]);K("stencil.enable",2960);B("stencil.mask","stencilMask",-1);B("stencil.func","stencilFunc",[519,0,-1]);B("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);B("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);K("scissor.enable",3089);B("scissor.box","scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);
B("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var ya={gl:g,context:H,strings:n,next:ma,current:ha,draw:aa,elements:u,buffer:Q,shader:J,attributes:Z.state,uniforms:W,framebuffer:R,extensions:y,isBufferArgs:e},qa={primTypes:t,compareFuncs:w,blendFuncs:f,blendEquations:ka,stencilOps:m,glTypes:q,orientationType:A};ra&&(qa.backBuffer=[1029],qa.drawBuffer=F(r.maxDrawbuffers,function(d){return F(d,function(d){return 36064+d})}));var Ca=0;return{next:ma,current:ha,procs:function(){var a=
I(),b=a.proc("poll"),c=a.proc("refresh"),p=a.block();b(p);c(p);var f=a.shared,e=f.gl,h=f.next,k=f.current;p(k,".dirty=false;");d(a,b);c(f.framebuffer,".dirty=true;");d(a,c);Object.keys(ia).forEach(function(d){var f=ia[d],l=p.def(h,".",d),m=a.block();m("if(",l,"){",e,".enable(",f,")}else{",e,".disable(",f,")}",k,".",d,"=",l,";");c(m);b("if(",l,"!==",k,".",d,"){",m,"}")});Object.keys(ja).forEach(function(d){var f=ja[d],l=ha[d],m,g,q=a.block();q(e,".",f,"(");Array.isArray(l)?(f=l.length,m=a.global.def(h,
".",d),g=a.global.def(k,".",d),q(F(f,function(d){return m+"["+d+"]"}),");",F(f,function(d){return g+"["+d+"]="+m+"["+d+"];"}).join("")),b("if(",F(f,function(d){return m+"["+d+"]!=="+g+"["+d+"]"}).join("||"),"){",q,"}")):(m=p.def(h,".",d),g=p.def(k,".",d),q(m,");",k,".",d,"=",m,";"),b("if(",m,"!==",g,"){",q,"}"));c(q)});return a.compile()}(),compile:function(d,a,b,c){var p=I(),f;f=da(d);var e=S(d,f),k=D(d),l=T(d);d=L(d);var h=e.viewport;h&&(l.viewport=h);h=O("scissor.box");(e=e[h])&&(l[h]=e);e=0<Object.keys(l).length;
f={framebuffer:f,draw:k,shader:d,state:l,dirty:e};f.uniforms=V(b);f.attributes=N(a);f.context=M(c);Da(p,f);Ga(p,f);Fa(p,f);return p.compile()}}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./util/codegen":19,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/loop":25}],8:[function(g,n,r){function e(a,c){this.id=b++;this.type=a;this.data=c}function h(a){if(0===a.length)return[];var b=a.charAt(0),e=a.charAt(a.length-1);if(1<a.length&&b===e&&('"'===b||"'"===b))return['"'+a.substr(1,
a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return h(a.substr(0,b.index)).concat(h(b[1])).concat(h(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(e=0;e<b.length;++e)a=a.concat(h(b[e]));return a}function l(a){return"["+h(a).join("][")+"]"}var b=0;n.exports={define:function(a,b){switch(typeof b){case "boolean":case "number":case "string":return new e(a,
l(b+""));case "undefined":return new e(a|128,null)}},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof e},unbox:function(a,b){if(a instanceof e){if(a.type&128)return new e(a.type&-129,l(b))}else if("function"===typeof a)return new e(0,a);return a},accessor:l}},{}],9:[function(g,n,r){var e=g("./util/is-typed-array"),h=g("./util/is-ndarray"),l=g("./constants/primitives.json"),b=g("./constants/usage.json");n.exports=function(a,c,g){function n(a){this.buffer=a;this.primType=
4;this.type=this.vertCount=0}function G(a,b,f,l,m,n,E){(n=E)||e(b)&&(!h(b)||e(b.data))||(n=c.oes_element_index_uint?5125:5123);a.buffer.bind();g._initBuffer(a.buffer,b,f,n,3);b=E;if(!E){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>m&&(m=a.buffer.byteLength,5123===b?m>>=1:5125===b&&(m>>=2));a.vertCount=m;m=l;0>l&&(m=4,l=a.buffer.dimension,1===l&&(m=0),2===l&&(m=1),3===l&&(m=4));a.primType=m}var y={uint8:5121,
uint16:5123};c.oes_element_index_uint&&(y.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var t=[];return{create:function(c){function v(c){if(c)if("number"===typeof c)f(c),w.primType=4,w.vertCount=c|0,w.type=5121;else{var g=null,q=35044,n=-1,z=-1,t=0,F=0;Array.isArray(c)||e(c)||h(c)?g=c:("data"in c&&(g=c.data),"usage"in c&&(q=b[c.usage]),"primitive"in c&&(n=l[c.primitive]),"count"in c&&(z=c.count|0),"length"in c&&(t=c.length|0),"type"in c&&(F=y[c.type]));g?G(w,g,q,n,z,t,F):(c=w.buffer,
c.bind(),a.bufferData(34963,t,q),c.dtype=F||5121,c.usage=q,c.dimension=3,c.byteLength=t,w.primType=0>n?4:n,w.vertCount=0>z?0:z,w.type=c.dtype)}else f(),w.primType=4,w.vertCount=0,w.type=5121;return v}var f=g.create(null,34963,!0),w=new n(f._buffer);v(c);v._reglType="elements";v._elements=w;v.subdata=function(a,b){f.subdata(a,b);return v};v.destroy=function(){f.destroy();w.buffer=null};return v},createStream:function(a){var b=t.pop();b||(b=new n(g.create(null,34963,!0)._buffer));G(b,a,35040,-1,-1,
0,0);return b},destroyStream:function(a){t.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof n?a._elements:null}}}},{"./constants/primitives.json":5,"./constants/usage.json":6,"./util/is-ndarray":22,"./util/is-typed-array":23}],10:[function(g,n,r){n.exports=function(e){function h(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{l[b]=
e.getExtension(b)}catch(a){}})}var l={};h();return{extensions:l,refresh:h}}},{}],11:[function(g,n,r){var e=g("./util/values"),h=g("./util/extend");n.exports=function(l,b,a,c,g){function n(a,b,c,f){this.target=a;this.level=b;this.texture=c;this.renderbuffer=f}function G(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function y(a,b){var c=b.width,f=b.height;if(a.texture)var e=a.texture._texture,l=Math.max(1,e.params.width>>a.level),h=Math.max(1,
e.params.height>>a.level),c=c||l,f=f||h;else e=a.renderbuffer._renderbuffer,c=c||e.width,f=f||e.height;e.refCount+=1;b.width=c;b.height=f}function t(a,b){b?b.texture?l.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,b.level):l.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):l.framebufferTexture2D(36160,a,3553,null,0)}function q(a){var b=3553,c=0,f=null,e=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var l=a._reglType;
"texture"===l?f=a:"renderbuffer"===l&&(e=a,b=36161,c=0);return new n(b,c,f,e)}function v(a){return a&&(a.texture||a.renderbuffer)}function f(){this.id=Q++;u[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function w(c){l.isFramebuffer(c.framebuffer)||(c.framebuffer=l.createFramebuffer());A.dirty=!0;l.bindFramebuffer(36160,c.framebuffer);for(var f=
c.colorAttachments,e=0;e<f.length;++e)t(36064+e,f[e]);for(e=f.length;e<a.maxColorAttachments;++e)t(36064+e,null);t(36096,c.depthAttachment);t(36128,c.stencilAttachment);t(33306,c.depthStencilAttachment);b.webgl_draw_buffers&&b.webgl_draw_buffers.drawBuffersWEBGL(ga[f.length]);l.checkFramebufferStatus(36160)}function m(a){a=a.framebuffer;l.isFramebuffer(a)&&l.deleteFramebuffer(a)}var A={current:null,next:null,dirty:!1},E={rgba:6408},r={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.ext_srgb&&(r.srgba=
35907);b.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843);b.webgl_color_buffer_float&&(r.rgba32f=34836);var P=[],Y=[];b.webgl_depth_texture&&(P.push(6402),Y.push(34041));h(h({},E),r);e(E);e(r);r=5121;P={uint8:5121};b.oes_texture_half_float&&(r=P["half float"]=36193);b.oes_texture_float&&(r=P["float"]=5126);P.best=r;var ga=function(){for(var b=Array(a.maxDrawbuffers),c=0;c<=a.maxDrawbuffers;++c)for(var f=b[c]=Array(c),e=0;e<c;++e)f[e]=36064+e;return b}(),Q=0,u={};return h(A,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof f)?a:null},create:function(a){function b(a){var f,h=a||{},m=a=0;if("shape"in h){var A=h.shape;a=A[0];m=A[1]}else"radius"in h&&(a=m=h.radius),"width"in h&&(a=h.width),"height"in h&&(m=h.height);var t=null,A=!1;if("colorBuffers"in h||"colorBuffer"in h){t=h.colorBuffers||h.colorBuffer;Array.isArray(t)||(t=[t]);e.width=a;e.height=m;t=t.map(q);for(f=0;f<t.length;++f)y(t[f],e);a=e.width;m=e.height}else{var r=!0,u="rgba",P="uint8",S=1,
A=!0;e.width=a=a||l.drawingBufferWidth;e.height=m=m||l.drawingBufferHeight;"format"in h&&(u=h.format,r=u in E);"type"in h&&(P=h.type);"colorCount"in h&&(S=h.colorCount|0);if(e.ownsColor)for(t=e.colorAttachments;t.length>S;)G(t.pop());else t=[];for(f=0;f<t.length;++f){var L;a:{L=t[f];var D=r,T=u,V=a,N=m;if(L.texture){var M=L.texture;if(D){M({format:T,type:P,width:V,height:N});M._texture.refCount+=1;L=!0;break a}}else if(M=L.renderbuffer,!D){M({format:T,width:V,height:N});M._renderbuffer.refCount+=
1;L=!0;break a}G(L);L=!1}L||(t[f--]=t[t.length-1],t.pop())}for(;t.length<S;)r?t.push(new n(3553,0,c.create({format:u,type:P,width:a,height:m},3553),null)):t.push(new n(36161,0,null,g.create({format:u,width:a,height:m})))}e.width=a;e.height=m;u=r=f=null;P=!1;"depthBuffer"in h&&(f=q(h.depthBuffer));"stencilBuffer"in h&&(r=q(h.stencilBuffer));"depthStencilBuffer"in h&&(u=q(h.depthStencilBuffer));if(f||r||u)y(f||r||u,e);else if(S=!0,D=L=!1,"depth"in h&&(S=!!h.depth),"stencil"in h&&(L=!!h.stencil),"depthTexture"in
h&&(D=!!h.depthTexture),h=e.depthAttachment||e.stencilAttachment||e.depthStencilAttachment,T=null,S||L)P=!0,D?(D=L?"depth stencil":"depth",e.ownsDepthStencil&&h.texture?(h.texture({format:D,width:a,height:m}),h.texture._texture.refCount+=1,T=h):T=new n(3553,0,c.create({format:D,width:a,height:m},3553),null)):(D=S?L?"depth stencil":"depth":"stencil",e.ownsDepthStencil&&h.renderbuffer?(h.renderbuffer({format:D,width:a,height:m}),h.renderbuffer._renderbuffer.refCount+=1,T=h):T=new n(36161,0,null,g.create({format:D,
width:a,height:m}))),S?L?u=T:f=T:r=T;a=e;a.colorAttachments.forEach(G);G(a.depthAttachment);G(a.stencilAttachment);G(a.depthStencilAttachment);e.colorAttachments=t;e.depthAttachment=f;e.stencilAttachment=r;e.depthStencilAttachment=u;e.ownsColor=A;e.ownsDepthStencil=P;b.color=t.map(v);b.depth=v(f);b.stencil=v(r);b.depthStencil=v(u);w(e);b.width=e.width;b.height=e.height;return b}var e=new f;b(a);b._reglType="framebuffer";b._framebuffer=e;b._destroy=function(){m(e)};return b},clear:function(){e(u).forEach(m)},
refresh:function(){e(u).forEach(w)}})}},{"./util/extend":20,"./util/values":31}],12:[function(g,n,r){n.exports=function(e,h){var l=1;h.ext_texture_filter_anisotropic&&(l=e.getParameter(34047));var b=1,a=1;h.webgl_draw_buffers&&(b=e.getParameter(34852),a=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(h).filter(function(a){return!!h[a]}),
maxAnisotropic:l,maxDrawbuffers:b,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),
maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],13:[function(g,n,r){var e=g("./util/is-typed-array");n.exports=function(h,l,b){return function(a){var c=a||{};e(a)?c={data:c}:2===arguments.length?c={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof a&&(c={});l();var g=c.x||0,n=c.y||0,r=c.width||b.viewportWidth,y=c.height||b.viewportHeight,c=c.data||new Uint8Array(r*y*4);h.pixelStorei(3333,
4);h.readPixels(g,n,r,y,6408,5121,c);return c}}},{"./util/is-typed-array":23}],14:[function(g,n,r){var e=g("./util/values");n.exports=function(h,l,b){function a(){this.id=r++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function c(a){h.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=h.createRenderbuffer());h.bindRenderbuffer(36161,a.renderbuffer);h.renderbufferStorage(36161,a.format,a.width,a.height)}function g(a){var b=a.renderbuffer;h.bindRenderbuffer(36161,
null);h.isRenderbuffer(b)&&h.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete y[a.id]}var n={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};l.ext_srgb&&(n.srgba=35907);l.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);l.webgl_color_buffer_float&&(n.rgba32f=34836);var r=0,y={};a.prototype.decRef=function(){0===--this.refCount&&g(this)};return{create:function(b){function e(a){a=a||{};var b=0,l=0;"shape"in a?(l=a.shape,b=l[0]|0,l=
l[1]|0):("radius"in a&&(b=l=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(l=a.height|0));e.width=h.width=Math.max(b,1);e.height=h.height=Math.max(l,1);h.format=32854;"format"in a&&(h.format=n[a.format]);c(h);return e}var h=new a;y[h.id]=h;e(b);e._reglType="renderbuffer";e._renderbuffer=h;e.destroy=function(){h.decRef()};return e},refresh:function(){e(y).forEach(c)},clear:function(){e(y).forEach(g)}}}},{"./util/values":31}],15:[function(g,n,r){var e=g("./util/values");n.exports=function(h,
l){function b(a,b,c,e){this.name=a;this.id=b;this.location=c;this.info=e}function a(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function c(a,b,c){c=35632===a?r:y;var e=c[b];if(!e){var g=l.str(b),e=h.createShader(a);h.shaderSource(e,g);h.compileShader(e);c[b]=e}return e}function g(a,b){this.id=v++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[]}function n(e,g){var m,q;m=c(35632,e.fragId);q=c(35633,e.vertId);var t=e.program=
h.createProgram();h.attachShader(t,m);h.attachShader(t,q);h.linkProgram(t);var r=h.getProgramParameter(t,35718),z=e.uniforms;for(m=0;m<r;++m)if(q=h.getActiveUniform(t,m))if(1<q.size)for(var v=0;v<q.size;++v){var y=q.name.replace("[0]","["+v+"]");a(z,new b(y,l.id(y),h.getUniformLocation(t,y),q))}else a(z,new b(q.name,l.id(q.name),h.getUniformLocation(t,q.name),q));r=h.getProgramParameter(t,35721);z=e.attributes;for(m=0;m<r;++m)(q=h.getActiveAttrib(t,m))&&a(z,new b(q.name,l.id(q.name),h.getAttribLocation(t,
q.name),q))}var r={},y={},t={},q=[],v=0;return{clear:function(){var a=h.deleteShader.bind(h);e(r).forEach(a);r={};e(y).forEach(a);y={};q.forEach(function(a){h.deleteProgram(a.program)});q.length=0;t={}},refresh:function(){r={};y={};q.forEach(n)},program:function(a,b,c){var e=t[b];e||(e=t[b]={});var h=e[a];h||(h=new g(b,a),n(h,c),e[a]=h,q.push(h));return h},shader:c,frag:null,vert:null}}},{"./util/values":31}],16:[function(g,n,r){n.exports=function(){var e={"":0},h=[""];return{id:function(l){var b=
e[l];if(b)return b;b=e[l]=h.length;h.push(l);return b},str:function(e){return h[e]}}}},{}],17:[function(g,n,r){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function h(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function l(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===l(a)}function a(a){return"[object CanvasRenderingContext2D]"===
l(a)}var c=g("./util/extend"),z=g("./util/values"),F=g("./util/is-typed-array"),G=g("./util/is-ndarray"),y=g("./util/load-texture"),t=g("./util/to-half-float"),q=g("./util/parse-dds"),v=[9984,9986,9985,9987];n.exports=function(f,g,m,n,r){function fa(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=
this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function P(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function Y(a,b){var c,e,h=0,f=0,l=0,g=0,m=0,q=0,n=!1,t=!1,r=!1;for(c=0;c<b.length;++c)e=b[c],g=g||e.width<<e.miplevel,m=m||e.height<<e.miplevel,
h=h||e.type,f=f||e.format,l=l||e.internalformat,q=q||e.channels,n=n||e.needsPoll,t=t||e.needsListeners,e=e.miplevel,r=r||0<e;a.needsPoll=n;a.needsListeners=t;a.width=g;a.height=m;a.format=f;a.internalformat=l;a.type=h;if(3553!==a.target)for(c=0;6>c;++c);c=0<=v.indexOf(a.minFilter);a.genMipmaps=!r&&(a.genMipmaps||c);r=r||a.genMipmaps;a.minFilter||(a.minFilter=r?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)e=b[c],e.channels||(e.channels=q),e.format||(e.format=f),e.internalformat||
(e.internalformat=l),e.type||(e.type=h)}function ga(a){this.id=T++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new P(a);this.pixels=[]}function Q(a,b){function c(a,d){var e=d.mipmap,h;if(Array.isArray(e))for(var p=0;p<e.length;++p)h=new fa(a),h.parseFlags(b),h.parseFlags(d),h.parse(e[p],p),f.push(h);else h=new fa(a),h.parseFlags(b),h.parse(d,0),f.push(h)}var e;R(a);var h=a.params;P.call(h,a.target);var f=a.pixels;f.length=
0;h.parse(b);if(3553===a.target)c(3553,b);else{var l=b.faces||b;if(Array.isArray(l))for(e=0;6>e;++e)c(34069+e,l[e]);else if("string"!==typeof l)for(e=0;6>e;++e)c(34069+e,{})}Y(h,f);h.needsListeners&&la(a);h.needsPoll&&(a.pollId=N.length,N.push(a));u(a)}function u(a){f.isTexture(a.texture)||(a.texture=f.createTexture());var b=a.target,c=a.unit;0<=c?(f.activeTexture(33984+c),D=c):f.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,h=0;h<b.length;++h)b[h].upload(e);e.upload();0>c&&((c=X[D])?f.bindTexture(c.target,
c.texture):(a.unit=D,X[D]=a))}function la(a){function b(a,d,c){var e=q(c);e.pixels.forEach(function(b){var c=new fa(e.cube?b.target:a);c.channels=e.channels;c.compressed=e.compressed;c.type=e.type;c.internalformat=e.format;c.format=L[e.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||d;c.data=b.data;h.push(c)})}function c(){for(var p=0;p<h.length;++p){var f=h[p],l=f.image,g=f.video,m=f.xhr;l&&l.complete?(f.width=l.naturalWidth,f.height=l.naturalHeight):g&&2<g.readyState?(f.width=g.width,
f.height=g.height):m&&4===m.readyState&&(h[p]=h[h.length-1],h.pop(),m.removeEventListener("readystatechange",u),b(f.target,f.miplevel,m.response))}Y(e,h);u(a)}var e=a.params,h=a.pixels;h.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){h.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function R(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((N[b]=N[N.length-1]).id=b,N.pop(),a.pollId=-1)}function W(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(f.activeTexture(33984+c),D=c,f.bindTexture(e,null),X[c]=null);R(a);f.isTexture(b)&&f.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete V[a.id]}var Z={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
J={repeat:10497,clamp:33071,mirror:33648},aa={nearest:9728,linear:9729},H=c({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},aa),O={none:0,browser:37444},K={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},B={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},I={};g.ext_srgb&&(B.srgb=35904,B.srgba=35906);g.oes_texture_float&&(K["float"]=5126);g.oes_texture_half_float&&
(K["half float"]=36193);g.webgl_depth_texture&&(c(B,{depth:6402,"depth stencil":34041}),c(K,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&c(I,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&c(I,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&c(I,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(I["rgb etc1"]=36196);var da=Array.prototype.slice.call(f.getParameter(34467));Object.keys(I).forEach(function(a){var b=I[a];0<=da.indexOf(b)&&(B[a]=b)});var S=Object.keys(B);m.textureFormats=S;var L=S.reduce(function(a,b){var c=B[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});c(fa.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=O[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=B[b];b in K&&(this.type=K[b]);b in I&&(this.compressed=!0)}"type"in a&&(this.type=K[a.type]);var b=this.width,c=this.height,e=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(e=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(e=a.channels));this.width=b|0;this.height=c|0;this.channels=e|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*e,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,c){this.miplevel=c;this.width>>=c;this.height>>=c;var f=d;switch(typeof d){case "object":if(!d)return;
this.parseFlags(d);var g=d.data;if("string"===typeof g||g&&(F(g)||e(g)||G(g)||b(g)||a(g)||"[object HTMLImageElement]"===l(g)||"[object HTMLVideoElement]"===l(g)||h(g)))f=d.data;break;case "undefined":return}"string"===typeof f&&(f=y(f,this.crossOrigin));var g=null,m=!1;if(null!==f)if(F(f))this.data=f;else if(e(f))g=f,m=!0;else if(G(f)){Array.isArray(f.data)?(g=f.data,m=!0):this.data=f.data;var q=f.shape;this.width=q[0];this.height=q[1];this.channels=3===q.length?q[2]:1;q=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===q.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(b(f)||a(f))b(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===l(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===l(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===l(f))this.xhr=f,this.needsListeners=!0;else if(h(f)){var m=f[0].length,q=f.length,n=1,z,v,u,w;if(Array.isArray(f[0][0]))for(n=f[0][0].length,g=Array(m*q*n),v=w=0;v<q;++v)for(z=0;z<m;++z)for(u=0;u<n;++u)g[w++]=f[v][z][u];
else for(g=Array(m*q),v=w=0;v<q;++v)for(z=0;z<m;++z)g[w++]=f[v][z];this.width=m;this.height=q;this.channels=n;m=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||r.viewportWidth)|0,this.height=(this.height||r.viewportHeight)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=
[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;q=this.format=L[f];if(!this.channels)switch(q){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}q=this.type;5126!==q&&36193!==q&&(q||(q=6402===f?5125:5121));this.type=q;if(m)switch(q){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;
case 5126:this.data=new Float32Array(g);break;case 36193:this.data=t(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;m=this.height;q=this.channels;n=this.strideX;z=this.strideY;v=this.strideC;u=this.offset;w=new g.constructor(f*m*q);for(var X=0,A=0;A<m;++A)for(var D=0;D<f;++D)for(var B=0;B<q;++B)w[X++]=g[z*A+n*D+v*B+u];this.data=w}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){f.pixelStorei(37440,
this.flipY);f.pixelStorei(37441,this.premultiplyAlpha);f.pixelStorei(37443,this.colorSpace);f.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,h=this.canvas,g=this.video,l=this.data,m=this.internalformat,q=this.format,t=this.type,r=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);g&&2<g.readyState?f.texImage2D(b,c,q,q,t,g):e&&e.complete?f.texImage2D(b,c,q,q,t,e):h?f.texImage2D(b,c,q,q,t,h):this.compressed?f.compressedTexImage2D(b,c,m,r,
a,0,l):this.copy?(n(),f.copyTexImage2D(b,c,q,this.x,this.y,r,a,0)):l?f.texImage2D(b,c,q,r,a,0,q,t,l):f.texImage2D(b,c,q,r||1,a||1,0,q,t,null)}});c(P.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=H[a.min]);"mag"in a&&(this.magFilter=aa[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var e=a.wrap;"string"===typeof e?b=c=J[e]:Array.isArray(e)&&(b=J[e[0]],c=J[e[1]])}else"wrapS"in a&&(b=J[a.wrapS]),"wrapT"in a&&(c=J[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=Z[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;f.texParameteri(a,10241,this.minFilter);f.texParameteri(a,10240,this.magFilter);f.texParameteri(a,10242,this.wrapS);f.texParameteri(a,10243,this.wrapT);g.ext_texture_filter_anisotropic&&f.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(f.hint(33170,this.mipmapHint),f.generateMipmap(a))}});
var D=0,T=0,V={},N=[],M=m.maxTextureUnits,X=Array(M).map(function(){return null});c(ga.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<M;++b){var c=X[b];if(c){if(0<c.bindCount)continue;c.unit=-1}X[b]=this;a=b;break}this.unit=a;f.activeTexture(33984+a);f.bindTexture(this.target,this.texture);D=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&W(this)}});return{create:function(a,b){function c(a,d,f,h,g,l){var m=a||{};34067===b&&
6===arguments.length&&(m=[a,d,f,h,g,l]);Q(e,m);c.width=e.params.width;c.height=e.params.height;return c}var e=new ga(b);V[e.id]=e;c(a);c._reglType="texture";c._texture=e;c.destroy=function(){e.decRef()};return c},refresh:function(){z(V).forEach(u);for(var a=0;a<M;++a)X[a]=null;D=0;f.activeTexture(33984)},clear:function(){for(var a=0;a<M;++a)f.activeTexture(33984+a),f.bindTexture(3553,null),X[a]=null;f.activeTexture(33984);D=0;z(V).forEach(W)},poll:function(){N.forEach(u)},getTexture:function(a){return null}}}},
{"./util/extend":20,"./util/is-ndarray":22,"./util/is-typed-array":23,"./util/load-texture":24,"./util/parse-dds":26,"./util/to-half-float":29,"./util/values":31}],18:[function(g,n,r){n.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],19:[function(g,n,r){function e(b){return Array.prototype.slice.call(b)}function h(b){return e(b).join("")}var l=g("./extend");n.exports=function(){function b(){var a=[],b=[];return l(function(){a.push.apply(a,
e(arguments))},{def:function(){var h="v"+c++;b.push(h);0<arguments.length&&(a.push(h,"="),a.push.apply(a,e(arguments)),a.push(";"));return h},toString:function(){return h([0<b.length?"var "+b+";":"",h(a)])}})}function a(){function a(b,f){e(b,f,"=",c.def(b,f),";")}var c=b(),e=b(),f=c.toString,h=e.toString;return l(c,{entry:c,exit:e,save:a,set:function(b,e,f){a(b,e);c(b,e,"=",f,";")},toString:function(){return f()+h()}})}var c=0,g=[],n=[],r=b(),y={};return{global:r,link:function(a){for(var b=0;b<n.length;++b)if(n[b]===
a)return g[b];b="g"+c++;g.push(b);n.push(a);return b},block:b,proc:function(b,c){function e(){var a="a"+f.length;f.push(a);return a}var f=[];c=c||0;for(var g=0;g<c;++g)e();var g=a(),m=g.toString;return y[b]=l(g,{arg:e,toString:function(){return h(["function(",f.join(),"){",m(),"}"])}})},scope:a,cond:function(){var b=h(arguments),c=a(),g=a(),f=c.toString,n=g.toString;return l(c,{then:function(){c.apply(c,e(arguments));return this},"else":function(){g.apply(g,e(arguments));return this},toString:function(){var a=
n();a&&(a="else{"+a+"}");return h(["if(",b,"){",f(),"}",a])}})},compile:function(){var a=['"use strict";',r,"return {"];Object.keys(y).forEach(function(b){a.push('"',b,'":',y[b].toString(),",")});a.push("}");var b=h(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,g.concat(b)).apply(null,n)}}}},{"./extend":20}],20:[function(g,n,r){n.exports=function(e,h){for(var g=Object.keys(h),b=0;b<g.length;++b)e[g[b]]=h[g[b]];return e}},{}],21:[function(g,n,r){n.exports=
function(e,h,g){for(var b=0,a=0;a<h.length;++a)for(var c=h[a],n=0;n<g;++n)e[b++]=c[n]}},{}],22:[function(g,n,r){var e=g("./is-typed-array");n.exports=function(h){return!!h&&"object"===typeof h&&Array.isArray(h.shape)&&Array.isArray(h.stride)&&"number"===typeof h.offset&&h.shape.length===h.stride.length&&(Array.isArray(h.data)||e(h.data))}},{"./is-typed-array":23}],23:[function(g,n,r){var e=g("../constants/arraytypes.json");n.exports=function(h){return Object.prototype.toString.call(h)in e}},{"../constants/arraytypes.json":3}],
24:[function(g,n,r){n.exports=function(e,h){if("undefined"!==typeof document){var g;g=(g=/\.(\w+)(\?.*)?$/.exec(e))&&g[1]?g[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(g))return g=document.createElement("video"),g.autoplay=!0,g.loop=!0,h&&(g.crossOrigin=h),g.src=e,g;if(0<=["dds"].indexOf(g))return g=new XMLHttpRequest,g.responseType="arraybuffer",g.open("GET",e,!0),g.send(),g;g=new Image;h&&(g.crossOrigin=h);g.src=e;return g}return null}},
{}],25:[function(g,n,r){n.exports=function(e,h){for(var g=Array(e),b=0;b<e;++b)g[b]=h(b);return g}},{}],26:[function(g,n,r){n.exports=function(g){function n(a){for(var b=Z,c=J,e=0;e<B;++e){var f=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*O;da.pixels.push({target:a,miplevel:e,width:b,height:c,data:new Uint8Array(g,I,f)});I+=f;b>>=1;c>>=1}}var r=new Int32Array(g),W=r[A],Z=r[fa],J=r[E],aa=F,H=0,O=0,K=4;switch(r[ga]){case q:O=8;W&t?(K=3,H=l):H=b;break;case v:O=16;H=a;break;case f:O=16;H=c;break;case w:O=8,
H=z}var B=1;r[Y]&G&&(B=Math.max(1,r[P]));var I=r[m]+4,da={width:Z,height:J,channels:K,format:H,type:aa,compressed:!0,cube:!1,pixels:[]};if(r[Q]&y)for(da.cube=!0,r=0;6>r;++r)n(h+r);else n(e);return da};var e=3553,h=34069,l=33776,b=33777,a=33778,c=33779,z=36196,F=5121,G=131072,y=512,t=64,q=827611204,v=861165636,f=894720068,w=826496069,m=1,A=2,E=3,fa=4,P=7,Y=20,ga=21,Q=28},{}],27:[function(g,n,r){function e(a){var b,e;b=(65535<a)<<4;a>>>=b;e=(255<a)<<3;a>>>=e;b|=e;e=(15<a)<<2;a>>>=e;b|=e;e=(3<a)<<1;
return b|e|a>>>e>>1}function h(a){a:{for(var c=16;268435456>=c;c*=16)if(a<=c){a=c;break a}a=0}c=b[e(a)>>2];return 0<c.length?c.pop():new ArrayBuffer(a)}function l(a){b[e(a.byteLength)>>2].push(a)}var b=g("./loop")(8,function(){return[]});n.exports={alloc:h,free:l,allocType:function(a,b){switch(a){case 5120:return new Int8Array(h(b),0,b);case 5121:return new Uint8Array(h(b),0,b);case 5122:return new Int16Array(h(2*b),0,b);case 5123:return new Uint16Array(h(2*b),0,b);case 5124:return new Int32Array(h(4*
b),0,b);case 5125:return new Uint32Array(h(4*b),0,b);case 5126:return new Float32Array(h(4*b),0,b);default:return null}},freeType:function(a){l(a.buffer)}}},{"./loop":25}],28:[function(g,n,r){n.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],29:[function(g,n,r){n.exports=function(e){for(var h=
new Float32Array(e),h=new Uint32Array(h.buffer),g=new Uint16Array(e.length),b=0;b<e.length;++b)if(isNaN(e[b]))g[b]=65535;else if(Infinity===e[b])g[b]=31744;else if(-Infinity===e[b])g[b]=64512;else{var a=h[b],c=a>>>31<<15,n=(a<<1>>>24)-127,a=a>>13&1023;g[b]=-24>n?c:-14>n?c+(a+1024>>-14-n):15<n?c+31744:c+(n+15<<10)+a}return g}},{}],30:[function(g,n,r){n.exports=function(e,h,g,b,a,c,n){for(var r=0,G=0;G<g;++G)for(var y=0;y<b;++y)e[r++]=h[a*G+c*y+n]}},{}],31:[function(g,n,r){n.exports=function(e){return Object.keys(e).map(function(h){return e[h]})}},
{}],32:[function(g,n,r){function e(b,a){function c(){var a=window.innerWidth,c=window.innerHeight;b!==document.body&&(c=b.getBoundingClientRect(),a=c.right-c.left,c=c.top-c.bottom);e.width=n*a;e.height=n*c;l(e.style,{width:a+"px",height:c+"px"})}var e=document.createElement("canvas"),g=h(e,a);l(e.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(e);b===document.body&&(e.style.position="absolute",l(b.style,{margin:0,padding:0}));var n=+g.options.pixelRatio;window.addEventListener("resize",
c,!1);var r=g.options.onDestroy;g.options=l(l({},g.options),{onDestroy:function(){window.removeEventListener("resize",c);b.removeChild(e);r&&r()}});c();return g}function h(b,a){function c(a){try{return b.getContext(a,e)}catch(c){return null}}var e=a.glOptions||{};return{gl:c("webgl")||c("experimental-webgl")||c("webgl-experimental"),options:l({pixelRatio:window.devicePixelRatio},a)}}var l=g("./util/extend");n.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],
options:b[1]||{}};var a=document.body,c=b[1]||{};if("string"===typeof b[0])a=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)a=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],options:l({pixelRatio:1},c)};c=b[0]}return a.nodeName&&"CANVAS"===a.nodeName.toUpperCase()?h(a,c):e(a,c)}},{"./util/extend":20}],33:[function(g,n,r){var e=g("./lib/util/extend"),h=g("./lib/dynamic"),l=g("./lib/util/raf"),b=g("./lib/util/clock"),a=g("./lib/strings"),
c=g("./lib/webgl"),z=g("./lib/extension"),F=g("./lib/limits"),G=g("./lib/buffer"),y=g("./lib/elements"),t=g("./lib/texture"),q=g("./lib/renderbuffer"),v=g("./lib/framebuffer"),f=g("./lib/attribute"),w=g("./lib/shader"),m=g("./lib/read"),A=g("./lib/core");n.exports=function(){function g(){M=l.next(g);H.count+=1;var a=T.viewport,c=T.scissor_box;a[0]=a[1]=c[0]=c[1]=0;H.viewportWidth=H.frameBufferWidth=H.drawingBufferWidth=a[2]=c[2]=u.drawingBufferWidth;H.viewportHeight=H.frameBufferWidth=H.drawingBufferHeight=
a[3]=c[3]=u.drawingBufferHeight;a=b();H.deltaTime=(a-Z)/1E3;H.time=(a-W)/1E3;Z=a;D.procs.refresh();I.poll();for(a=0;a<N.length;++a)(0,N[a])(H,null,0)}function n(a){}function r(a){}function Y(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];h.isDynamic(e)?d[b]=h.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}var f=b(a.context||{}),g=b(a.uniforms||{}),l=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=
c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var f=D.compile(a,l,g,f),m=f.draw,n=f.batch,q=f.scope,r=[];return function(a,b){var d;if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<
a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)}}function ga(){D.procs.poll()}var Q=c(Array.prototype.slice.call(arguments)),u=Q.gl,la=Q.options,Q=a(),R=z(u).extensions,W=b(),Z=W,J=u.drawingBufferWidth,aa=u.drawingBufferHeight,H={count:0,deltaTime:0,time:0,viewportWidth:J,viewportHeight:aa,framebufferWidth:J,framebufferHeight:aa,
drawingBufferWidth:J,drawingBufferHeight:aa,pixelRatio:la.pixelRatio},J=F(u,R),O=G(u),K=y(u,R,O),aa=f(u,R,J,O,Q),B=w(u,Q),I=t(u,R,J,ga,H),da=q(u,R,J),S=v(u,R,J,I,da),L=m(u,ga,H),D=A(u,Q,R,J,O,K,I,S,{},aa,B,{elements:null,primitive:4,count:-1,offset:0,instances:-1},H),T=D.next,V=u.canvas,N=[],M=0;V&&(V.addEventListener("webglcontextlost",n,!1),V.addEventListener("webglcontextrestored",r,!1));D.procs.refresh();return e(Y,{clear:function(a){var b=0;ga();var c=a.color;c&&(u.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(u.clearDepth(+a.depth),b|=256);"stencil"in a&&(u.clearStencil(a.stencil|0),b|=1024);u.clear(b)},prop:h.define.bind(null,1),context:h.define.bind(null,2),"this":h.define.bind(null,3),draw:Y({}),elements:function(a){return K.create(a)},buffer:function(a){return O.create(a,34962)},texture:function(a){return I.create(a,3553)},cube:function(a){return 6===arguments.length?I.create(Array.prototype.slice.call(arguments),34067):I.create(a,34067)},renderbuffer:function(a){return da.create(a)},
framebuffer:function(a){return S.create(a)},framebufferCube:function(a){},attributes:u.getContextAttributes(),frame:function(a){N.push(a);!M&&0<N.length&&g();return{cancel:function(){var b=N.find(function(b){return b===a});0>b||(N.splice(b,1),0>=N.length&&M&&(l.cancel(g),M=0))}}},limits:J,read:L,destroy:function(){M&&(l.cancel(g),M=0);V&&(V.removeEventListener("webglcontextlost",n),V.removeEventListener("webglcontextrestored",r));B.clear();S.clear();da.clear();I.clear();O.clear();if(la.onDestroy)la.onDestroy()},
_gl:u,_refresh:function(){D.procs.refresh()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/strings":16,"./lib/texture":17,"./lib/util/clock":18,"./lib/util/extend":20,"./lib/util/raf":28,"./lib/webgl":32}]},{},[33])(33)});
