(function(na){if("object"===typeof exports&&"undefined"!==typeof module)module.a=na();else if("function"===typeof define&&define.sb)define([],na);else{var e;"undefined"!==typeof window?e=window:"undefined"!==typeof global?e=global:"undefined"!==typeof self?e=self:e=this;e.ac=na()}})(function(){return function e(k,c,q){function a(f,g){if(!c[f]){if(!k[f]){var m="function"==typeof require&&require;if(!g&&m)return m(f,!0);if(b)return b(f,!0);m=Error("Cannot find module '"+f+"'");throw m.code="MODULE_NOT_FOUND",
m;}m=c[f]={a:{}};k[f][0].call(m.a,function(b){var c=k[f][1][b];return a(c?c:b)},m,m.a,e,k,c,q)}return c[f].a}for(var b="function"==typeof require&&require,m=0;m<q.length;m++)a(q[m]);return a}({1:[function(e,k){function c(){this.s=!1;this.J=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.C=!1;this.type=5126;this.A=this.j=this.offset=0}var q=e("./constants/dtypes.json");Object.assign(c.prototype,{Ra:function(a,b){return this.s?a.s&&this.buffer===a.buffer&&this.size===b&&this.C===a.C&&this.type===
a.type&&this.offset===a.offset&&this.j===a.j&&this.A===a.A:!a.s&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.J===a.J},set:function(a,b){(this.s=a.s)?(this.buffer=a.buffer,this.size=b,this.C=a.C,this.type=a.type,this.offset=a.offset,this.j=a.j,this.A=a.A):(this.x=a.x,this.y=a.y,this.z=a.z,this.J=a.J)}});k.a=function(a,b,m){function f(){for(var b=Array(16),a=0;16>a;++a)b[a]=new c;this.ib=b;this.top=0}function g(b){for(var a=b.ib,f=b.top;a.length-1<=f;)a.push(new c);return a[++b.top]}var e=b.N,D=
{};b=a.getParameter(a.MAX_VERTEX_ATTRIBS);for(var k=Array(b),n=0;n<b;++n)k[n]=new c;Object.assign(f.prototype,{Ia:function(b,a,c,f){var n=g(this);n.s=!1;n.x=b;n.y=a;n.z=c;n.J=f},hb:function(b,a,c,f,n,m,e){var q=g(this);q.s=!0;q.buffer=b;q.size=a;q.offset=c;q.j=f;q.A=n;q.C=m;q.type=e},Yb:function(b){if("number"===typeof b)this.Ia(b,0,0,0);else if(Array.isArray(b))this.Ia(b[0],b[1],b[2],b[3]);else{var a=m.ea(b),c=0,f=0,n=0,g=0,e=!1,D=5126;a?D=a.B:(a=m.ea(b.buffer),c=b.size||0,f=b.j||0,n=b.offset||0,
g=b.A||0,e=b.C||!1,D=a.B,"type"in b&&(D=q[b.type]));this.hb(a,c,n,f,g,e,D)}},pop:function(){--this.top}});return{sa:k,attributes:D,bind:function(b,c,f,n){n=f.size||n;if(!c.Ra(f,n)){if(f.s){c.s||a.enableVertexAttribArray(b);c.buffer!==f.buffer&&f.buffer.bind();a.vertexAttribPointer(b,n,f.type,f.C,f.j,f.offset);var g=e.Aa;g&&g.vertexAttribDivisorANGLE(b,f.A)}else c.s&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,f.x,f.y,f.z,f.J);c.set(f,n)}},c:function(b){b in D||(D[b]=new f)}}}},{"./constants/dtypes.json":8}],
2:[function(e,k){var c=e("./check"),q=e("./is-typed-array"),a=e("./constants/arraytypes.json"),b={"static":35044,dynamic:35048,stream:35040};k.a=function(m){function f(b,a){this.id=g++;this.buffer=b;this.type=a;this.usage=35044;this.byteLength=0;this.Ca=1;this.data=null;this.B=5121}var g=0,e={};Object.assign(f.prototype,{bind:function(){m.bindBuffer(this.type,this.buffer)},update:function(f){if(Array.isArray(f)||q(f))f={data:f};else if("number"===typeof f)f={length:f|0};else if(null===f||void 0===
f)f={};c.type(f,"object","buffer arguments must be an object, a number or an array");"usage"in f&&(c.b(f.usage,b,"buffer usage"),this.usage=b[f.usage]);var g=f.Ca|0||1;if("data"in f){var n=f.data;if(null===n)this.byteLength=f.length|0,this.B=5121;else{if(Array.isArray(n)){if(0<n.length&&Array.isArray(n[0])){g=n[0].length;f=n;for(var n=g,e=new Float32Array(f.length*n),p=0,O=0;O<f.length;++O)for(var k=f[O],L=0;L<n;++L)e[p++]=k[L];n=e}else n=new Float32Array(n);this.B=5126}else c.Fa(n,"invalid data type buffer data"),
this.B=a[Object.prototype.toString.call(n)];this.Ca=g;this.byteLength=n.byteLength}this.data=n}else"length"in f&&(c.T(f.length,"buffer length must be a nonnegative integer"),this.data=null,this.byteLength=f.length|0,this.B=5121);this.bind();m.bufferData(this.type,this.data||this.byteLength,this.usage)},refresh:function(){m.isBuffer(this.buffer)||(this.buffer=m.createBuffer());this.update({})},l:function(){c(this.buffer,"buffer must not be deleted already");m.deleteBuffer(this.buffer);this.buffer=
null;delete e[this.id]}});return{create:function(b,a){function c(b){p.update(b||{});return c}b=b||{};var g=m.createBuffer(),p=new f(g,a);p.update(b);e[p.id]=p;c.X="buffer";c.qa=p;c.l=function(){p.l()};return c},clear:function(){Object.keys(e).forEach(function(b){e[b].l()})},refresh:function(){Object.keys(e).forEach(function(b){e[b].refresh()})},ea:function(b){return b&&b.qa instanceof f?b.qa:null}}}},{"./check":3,"./constants/arraytypes.json":7,"./is-typed-array":16}],3:[function(e,k){function c(b){b=
Error("(regl) "+b);console.error(b);throw b;}function q(b,a){b||c(a)}var a=e("./is-typed-array");k.a=Object.assign(q,{i:c,b:function(b,a,f){q(b in a,"unknown parameter ("+b+")"+(f?": "+f:"")+". possible values: "+Object.keys(a).join())},type:function(b,a,f){q(typeof b===a,"invalid parameter type"+(f?": "+f:"")+". expected "+a+", got "+typeof b)},Fa:function(b,c){q(a(b),"invalid parameter type"+(c?": "+c:"")+". must be a typed array")},T:function(b,a){q(0<=b&&(b|0)===b,"invalid parameter type, ("+
b+")"+(a?": "+a:"")+". must be a nonnegative integer")},Ha:function(b,a,f){q(0<=a.indexOf(b),"invalid value"+(f?": "+f:"")+". must be one of: "+a)}})},{"./is-typed-array":16}],4:[function(e,k){k.a="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],5:[function(e,k){k.a=function(){function c(){var b=[],a=[];return Object.assign(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{c:function(){var c="v"+e++;a.push(c);
0<arguments.length&&(b.push(c,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return c},toString:function(){return[0<a.length?"var "+a+";":"",b.join("")].join("")}})}var e=0,a=[],b=[],m={};return{link:function(f){var c="g"+e++;a.push(c);b.push(f);return c},block:c,V:function(b){var a=[],k=c(),D=k.toString;return m[b]=Object.assign(k,{M:function(){var b="a"+e++;a.push(b);return b},toString:function(){return["function(",a.join(),"){",D(),"}"].join("")}})},compile:function(){var c=
['"use strict";return {'];Object.keys(m).forEach(function(b){c.push('"',b,'":',m[b].toString(),",")});c.push("}");return Function.apply(null,a.concat([c.join("")])).apply(null,b)}}}},{}],6:[function(e,k){function c(b){switch(b){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function q(a,c,f,g){var e,m=",";switch(c){case 5126:e="1f";break;case 35664:e="2fv";break;case 35665:e="3fv";break;case 35666:e="4fv";
break;case 35670:case 5124:e="1i";break;case 35671:case 35667:e="2iv";break;case 35672:case 35668:e="3iv";break;case 35673:case 35669:e="4iv";break;case 35674:e="Matrix2fv";m=",false,";break;case 35675:e="Matrix3fv";m=",false,";break;case 35676:e="Matrix4fv";m=",false,";break;default:b.i("unsupported uniform type")}return a+".uniform"+e+"("+f+m+g+");"}function a(b){return b+"["+b+".length-1]"}var b=e("./check"),m=e("./codegen"),f=e("./constants/primitives.json"),g=e("./constants/dtypes.json"),L={0:0,
1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},D={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},C={0:0,
zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};k.a=function(n,e,p,k,z,F,T,N,P,W,Q,M){function U(g,p,e,E,T){function G(b){var a=b.id,u=U[a];if(u)return u;u=b.Ea?l.c(x(b.data),"(",F,",",X,",",la,")"):l.c(F,".",b.data);return U[a]=u}function W(b,a){return b.find(function(b){return b.name===a})}function r(b){return A&&!(b in p||b in T)}var t=m(),x=t.link,l=t.V("batch"),u=t.block(),v=l.c,h=l.M,d=x(n),ma=x(g.la),ia=x(P.bind),la=x(M),
S=x(Q.count),B=x(Q.offset),ca=x(Q.O),aa=x(Q.h),z=x(k.elements),S=v(a(S)),B=v(a(B)),aa=v(a(aa)),z=v(a(z)),da,ja,y=w.Aa;y&&(da=v(a(ca)),ja=x(y));var A="elements"in p,ca=h(),h=h(),F=v(),X=v(),U={};l(d,".useProgram(",ma,");");g.m.forEach(function(b){if(!(b.name in e)){var a=x(b.location),c=x(N.m[b.name]),c=c+"["+c+".length-1]";35678===b.info.type||35680===b.info.type?(b=v(c+"._texture"),l(q(d,5124,a,b+".bind()")),u(b,".unbind();")):l(q(d,b.info.type,a,c))}});g.attributes.forEach(function(b){if(!(E.name in
E)){var a=x(P.attributes[b.name]);l(ia,"(",b.location,",",x(P.sa[b.location]),",",a,".records[",a,".top]",",",c(b.info.type),");")}});A||l("if(",z,"){",d,".bindBuffer(",34963,",",z,".buffer._buffer.buffer);","}else{",d,".bindBuffer(",34963,",null);","}");l("for(",X,"=0;",X,"<",ca,";++",X,"){",F,"=",h,"[",X,"];");Object.keys(p).forEach(function(a){function u(b){l("if(",c,"){",d,".enable(",b,");}else{",d,".disable(",b,");}")}var c=G(p[a]);switch(a){case "cull.enable":u(2884);break;case "blend.enable":u(3042);
break;case "dither":u(3024);break;case "stencil.enable":u(2960);break;case "depth.enable":u(2929);break;case "scissor.enable":u(3089);break;case "polygonOffset.enable":u(32823);break;case "sample.alpha":u(32926);break;case "sample.enable":u(32928);break;case "depth.mask":l(d,".depthMask(",c,");");break;case "depth.func":a=x(D);l(d,".depthFunc(",a,"[",c,"]);");break;case "depth.range":l(d,".depthRange(",c,"[0],",c,"[1]);");break;case "blend.color":l(d,".blendColor(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");
break;case "blend.equation":a=x(I);l("if(typeof ",c,'==="string"){',d,".blendEquation(",a,"[",c,"]);","}else{",d,".blendEquationSeparate(",a,"[",c,".rgb],",a,"[",c,".alpha]);","}");break;case "blend.func":a=x(L);l(d,".blendFuncSeparate(",a,'["srcRGB" in ',c,"?",c,".srcRGB:",c,".src],",a,'["dstRGB" in ',c,"?",c,".dstRGB:",c,".dst],",a,'["srcAlpha" in ',c,"?",c,".srcAlpha:",c,".src],",a,'["dstAlpha" in ',c,"?",c,".dstAlpha:",c,".dst]);");break;case "stencil.mask":l(d,".stencilMask(",c,");");break;case "stencil.func":a=
x(D);l(d,".stencilFunc(",a,"[",c,'.cmp||"always"],',c,".ref|0,",'"mask" in ',c,"?",c,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":var fa=x(C);l(d,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",fa,"[",c,'.fail||"keep"],',fa,"[",c,'.zfail||"keep"],',fa,"[",c,'.pass||"keep"]);');break;case "polygonOffset.offset":l(d,".polygonOffset(",c,".factor||0,",c,".units||0);");break;case "cull.face":l(d,".cullFace(",c,'==="front"?',1028,":",1029,");");break;case "lineWidth":l(d,".lineWidth(",
c,");");break;case "frontFace":l(d,".frontFace(",c,'==="cw"?',2304,":",2305,");");break;case "colorMask":l(d,".colorMask(",c,"[0],",c,"[1],",c,"[2],",c,"[3]);");break;case "sample.coverage":l(d,".sampleCoverage(",c,".value,",c,".invert);");break;case "scissor.box":a=l.c(c+".x||0");fa=l.c(c+".y||0");l(d,".scissor(",a,",",fa,",",'"w" in ',c,"?",c,".w:",d,".drawingBufferWidth-",a,",",'"h" in ',c,"?",c,".h:",d,".drawingBufferHeight-",fa,");");break;case "viewport":a=l.c(c+".x||0");fa=l.c(c+".y||0");l(d,
".viewport(",a,",",fa,",",'"w" in ',c,"?",c,".w:",d,".drawingBufferWidth-",a,",",'"h" in ',c,"?",c,".h:",d,".drawingBufferHeight-",fa,");");break;case "primitives":case "offset":case "count":case "elements":break;default:b.i("unsupported option for batch",a)}});var J=g.m,K=[];Object.keys(e).forEach(function(b){var a=W(J,b);if(a){var c=a.info.type,u=x(a.location);b=G(e[b]);35678===a.info.type||35680===a.info.type?(a=v(b+"._texture"),K.push(a),l(q(d,5124,u,a+".bind()"))):l(q(d,c,u,b))}});K.forEach(function(b){l(b,
".unbind();")});var R=g.attributes;Object.keys(E).forEach(function(b){var a=W(R,b);a&&l(ia,"(",a.location,",",x(b.sa[a.location]),",",G(E[b]),",",c(a.info.type),");")});p.count?l(S,"=",G(p.count),";"):r("count")||l("if(",S,"){");p.offset&&l(B,"=",G(p.offset),";");p.h&&(g=x(f),l(aa,"=",g,"[",G(p.h),"];"));A&&(g=G(p.elements),l(z,"=",g,"?",g,"._elements:null;"));r("offset")&&l(B,"=0;");l("if(",z,"){");r("count")&&l(S,"=",z,".vertCount;","if(",S,">0){");r("primitive")&&l(aa,"=",z,".primType;");A&&l(d,
".bindBuffer(",34963,",",z,".buffer._buffer.buffer);");y&&(p.O&&l(da,"=",G(p.O),";"),l("if(",da,">0){",ja,".drawElementsInstancedANGLE(",aa,",",S,",",z,".type,",B,",",da,");}else{"));l(d,".drawElements(",aa,",",S,",",z,".type,",B,");");y&&l("}");r("count")&&l("}");l("}else{");r("count")||(r("primitive")&&l(aa,"=",4,";"),y&&l("if(",da,">0){",ja,".drawArraysInstancedANGLE(",aa,",",B,",",S,",",da,");}else{"),l(d,".drawArrays(",aa,",",B,",",S,");}"),y&&l("}"));l("}}",u);return t.compile().Ma}var w=e.N,
R=T.Oa,I={add:32774,subtract:32778,"reverse subtract":32779};w.Ab&&(I.min=32775,I.max=32776);var V=0;return{S:function(b){var f=m(),g=f.link,p=f.V("draw"),e=p.c,E=g(n),C=g(b.la),r=g(P.bind),t=g(Q.count),x=g(Q.offset),l=g(Q.O),u=g(Q.h),v=g(k.elements),h=[];p(E,".useProgram(",C,");");b.attributes.forEach(function(b){var a=g(P.attributes[b.name]);p(r,"(",b.location,",",g(P.sa[b.location]),",",a,".records[",a,".top]",",",c(b.info.type),");")});b.m.forEach(function(b){var a=g(b.location),c=g(N.m[b.name]),
c=c+"["+c+".length-1]";35678===b.info.type||35680===b.info.type?(b=e(c+"._texture"),h.push(b),p(q(E,5124,a,b+".bind()"))):p(q(E,b.info.type,a,c))});h.forEach(function(b){p(b,".unbind();")});b=e(a(u));t=e(a(t));x=e(a(x));v=e(a(v));p("if(",t,"){");(C=w.Aa)?(l=e(a(l)),C=g(C),p("if(",v,"){",v,".bind();","if(",l,">0){",C,".drawElementsInstancedANGLE(",b,",",t,",",v,".type,",x,",",l,");}else{",E,".drawElements(",b,",",t,",",v,".type,",x,");}","}else if(",l,">0){",C,".drawArraysInstancedANGLE(",b,",",x,
",",t,",",l,");}else{",E,".drawArrays(",b,",",x,",",t,");}}")):p("if(",v,"){",E,".drawElements(",b,",",t,",",v,".type,",x,");}","}else{",E,".drawArrays(",b,",",x,",",t,");}");return f.compile().S},Na:function(c,e,n,q,E,z,w){function r(b){var a=ja[b];return a?a:a=ja[b]=u(R[b])}function t(b,a){var c=r(b);y(c,".push(",a,");");A(c,".pop();")}function x(b){var a=b.id,c=qa[a];if(c)return c;c=b.Ea?J.c(u(b.data),"(",ka,",0,",ra,")"):J.c(ka,".",b.data);return qa[a]=c}var l=m(),u=l.link,v=l.block,h=l.V,d=V++,
ma=u(T.F),ia=u(W.Ua),la=u(W.ob),S=u(W.gb),B={count:u(Q.count),offset:u(Q.offset),O:u(Q.O),h:u(Q.h)},ca=u(k.elements),aa=u(f),F=u(D),da=u(C),ja={},y=v(),A=v(),pa=!1;Object.keys(c).forEach(function(a){var d=c[a];switch(a){case "frag":pa=!0;y(ia,".push(",u(d),");");A(ia,".pop();");break;case "vert":pa=!0;y(la,".push(",u(d),");");A(la,".pop();");break;case "count":case "offset":case "instances":b.T(d,a);y(B[a],".push(",d,");");A(B[a],".pop();");break;case "primitive":b.b(d,f,"not a valid drawing primitive");
y(B.h,".push(",f[d],");");A(B.h,".pop();");break;case "elements":var h=k.Wa(d),d=!("primitive"in c);a=!("count"in c);h?(h=u(h),y(ca,".push(",h,");"),d&&y(B.h,".push(",h,".primType);"),a&&y(B.count,".push(",h,".vertCount);")):(y(ca,".push(null);"),d&&y(B.h,".push(",4,");"),a&&y(B.count,".push(0);"));d&&A(B.h,".pop();");a&&A(B.count,".pop();");"offset"in c||(y(B.offset,".push(0);"),A(B.offset,".pop();"));A(ca,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":b.type(d,
"boolean",a);t(a,d);break;case "depth.func":b.b(d,D,a);t(a,D[d]);break;case "depth.range":b(Array.isArray(d)&&2===d.length&&d[0]<=d[1],"depth range is 2d array");a=r(a);y(a,".push(",d[0],",",d[1],");");A(a,".pop();");break;case "blend.func":a=r(a);b.type(d,"object","blend func must be an object");var h="srcRGB"in d?d.ec:d.src,g="srcAlpha"in d?d.dc:d.src,v="dstRGB"in d?d.zb:d.Qa,d="dstAlpha"in d?d.yb:d.Qa;b.b(h,L);b.b(g,L);b.b(v,L);b.b(d,L);y(a,".push(",L[h],",",L[v],",",L[g],",",L[d],");");A(a,".pop();");
break;case "blend.equation":a=r(a);"string"===typeof d?(b.b(d,I,"invalid blend equation"),y(a,".push(",I[d],",",I[d],");")):"object"===typeof d?(b.b(d.kb,I,"invalid blend equation rgb"),b.b(d.alpha,I,"invalid blend equation alpha"),y(a,".push(",I[d.kb],",",I[d.alpha],");")):b.i("invalid blend equation");A(a,".pop();");break;case "blend.color":b(Array.isArray(d)&&4===d.length,"blend color is a 4d array");a=r(a);y(a,".push(",d[0],",",d[1],",",d[2],",",d[3],");");A(a,".pop();");break;case "stencil.mask":b.type(d,
"number","stencil mask must be an integer");a=r(a);y(a,".push(",d,");");A(a,".pop();");break;case "stencil.func":b.type(d,"object","stencil func must be an object");h=d.tb||"keep";g=d.$b||0;d="mask"in d?d.Qb:-1;b.b(h,D,"invalid stencil func cmp");b.type(g,"number","stencil func ref");b.type(d,"number","stencil func mask");a=r(a);y(a,".push(",D[h],",",g,",",d,");");A(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":b.type(d,"object",a);h=d.Eb||"keep";g=d.vc||"keep";d=d.Vb||"keep";b.b(h,
C,a);b.b(g,C,a);b.b(d,C,a);a=r(a);y(a,".push(",C[h],",",C[g],",",C[d],");");A(a,".pop();");break;case "polygonOffset.offset":b.type(d,"object",a);h=d.Db||0;d=d.units||0;b.type(h,"number","offset.factor");b.type(d,"number","offset.units");a=r(a);y(a,".push(",h,",",d,");");A(a,".pop();");break;case "cull.face":h=0;"front"===d?h=1028:"back"===d&&(h=1029);b(!!h,"cull.face");d=r(a);y(d,".push(",h,");");A(d,".pop();");break;case "lineWidth":b(0<d&&"number"===typeof d,a);t(a,d);break;case "frontFace":h=
0;"cw"===d?h=2304:"ccw"===d&&(h=2305);b(!!h,"frontFace");d=r(a);y(d,".push(",h,");");A(d,".pop();");break;case "colorMask":b(Array.isArray(d)&&4===d.length,"color mask must be length 4 array");a=r(a);y(a,".push(",d.map(function(b){return!!b}).join(),");");A(a,".pop();");break;case "sample.coverage":b.type(d,"object",a);h="value"in d?d.value:1;d=!!d.Nb;b("number"===typeof h&&0<=h&&1>=h,"sample value");a=r(a);y(a,".push(",h,",",d,");");A(a,".pop();");break;case "viewport":case "scissor.box":b("object"===
typeof d&&d,a+" is an object");var h=d.x||0,g=d.y||0,p=v=-1;b("number"===typeof h&&0<=h,a+".x must be a positive int");b("number"===typeof g&&0<=g,a+".y must be a positive int");"w"in d&&(v=d.J,b("number"===typeof v&&0<=v,a+".w must be a positive int"));"h"in d&&(p=d.Mb,b("number"===typeof p&&0<=p,a+".h must be a positive int"));d=r(a);y(d,".push(",h,",",g,",",v,",",p,");");A(d,".pop();");break;default:b.i("unsupported parameter "+a)}});if(pa){if(c.Ta&&c.nb)y(S,".push(",u(W.create(c.nb,c.Ta)),");");
else{var v=y.c(ia,"[",ia,".length-1]"),X=y.c(la,"[",la,".length-1]"),oa=u(W.create);y(S,".push(",oa,"(",X,",",v,"));")}A(S,".pop();")}Object.keys(e).forEach(function(b){N.c(b);var a=u(N.m[b]),d;b=e[b];"function"===typeof b&&b.X?d=u(b):Array.isArray(b)?d=u(b.slice()):d=+b;y(a,".push(",d,");");A(a,".pop();")});Object.keys(n).forEach(function(a){P.c(a);var d=u(P.attributes[a]),c=n[a];if("number"===typeof c)y(d,".pushVec(",+c,",0,0,0);");else if(b(!!c,"invalid attribute: "+a),Array.isArray(c))y(d,".pushVec(",
[c[0]||0,c[1]||0,c[2]||0,c[3]||0],");");else{var h=p.ea(c),f=0,v=0,e=0,m=0,q=!1,l=5126;h?l=h.B:(b.type(c,"object",'invalid attribute "'+a+'"'),h=p.ea(c.buffer),f=c.size||0,v=c.j||0,e=c.offset||0,m=c.A||0,q=c.C||!1,b(!!h,"invalid attribute "+a+".buffer"),l=h.B,"type"in c&&(b.b(c.type,g,"attribute type"),l=g[c.type]));b(!!h,"invalid attribute "+a+".buffer");b.T(v,a+".stride");b.T(e,a+".offset");b.T(m,a+".divisor");b.type(q,"boolean",a+".normalized");b.Ha(f,[0,1,2,3,4],a+".size");y(d,".pushPtr(",[u(h),
f,e,v,m,q,l].join(),");")}A(d,".pop();")});var J=l.block(),K=l.block(),ra,ka;w&&(ra=u(M),ka=y.c());var qa={};Object.keys(q).forEach(function(a){var d=x(q[a]);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=r(a);J(a,".push(",d,");");K(a,".pop();");break;case "count":case "offset":case "instances":a=B[a];J(a,".push(",
d,");");K(a,".pop();");break;case "primitive":a=B.h;J(a,".push(",aa,"[",d,"]);");K(a,".pop();");break;case "depth.func":a=r(a);J(a,".push(",F,"[",d,"]);");K(a,".pop();");break;case "blend.func":a=r(a);var h=u(L);J(a,".push(",h,'["srcRGB" in ',d,"?",d,".srcRGB:",d,".src],",h,'["dstRGB" in ',d,"?",d,".dstRGB:",d,".dst],",h,'["srcAlpha" in ',d,"?",d,".srcAlpha:",d,".src],",h,'["dstAlpha" in ',d,"?",d,".dstAlpha:",d,".dst]);");K(a,".pop();");break;case "blend.equation":a=r(a);h=u(I);J("if(typeof ",d,
'==="string"){',a,".push(",h,"[",d,"],",h,"[",d,"]);","}else{",a,".push(",h,"[",d,".rgb],",h,"[",d,".alpha]);","}");K(a,".pop();");break;case "blend.color":a=r(a);J(a,".push(",d,"[0],",d,"[1],",d,"[2],",d,"[3]);");K(a,".pop();");break;case "stencil.mask":a=r(a);J(a,".push(",d,");");K(a,".pop();");break;case "stencil.func":a=r(a);J(a,".push(",F,"[",d,".cmp],",d,".ref|0,",'"mask" in ',d,"?",d,".mask:-1);");K(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=r(a);J(a,".push(",da,"[",
d,'.fail||"keep"],',da,"[",d,'.zfail||"keep"],',da,"[",d,'.pass||"keep"]);');K(a,".pop();");break;case "polygonOffset.offset":a=r(a);J(a,".push(",d,".factor||0,",d,".units||0);");K(a,".pop();");break;case "cull.face":a=r(a);J(a,".push(",d,'==="front"?',1028,":",1029,");");K(a,".pop();");break;case "frontFace":a=r(a);J(a,".push(",d,'==="cw"?',2304,":",2305,");");K(a,".pop();");break;case "colorMask":a=r(a);J(a,".push(",d,"[0],",d,"[1],",d,"[2],",d,"[3]);");K(a,".pop();");break;case "sample.coverage":a=
r(a);J(a,".push(",d,".value,",d,".invert);");K(a,".pop();");break;case "scissor.box":case "viewport":a=r(a);J(a,".push(",d,".x||0,",d,".y||0,",'"w" in ',d,"?",d,".w:-1,",'"h" in ',d,"?",d,".h:-1);");K(a,".pop();");break;case "elements":a=!("primitive"in q)&&!("primitive"in c);var h=!("count"in q)&&!("count"in c),f=!("offset"in q)&&!("offset"in c),g=J.c();J("if(",d,"){",g,"=",d,"._elements;",ca,".push(",g,");",a?B.h+".push("+g+".primType);":"",h?B.count+".push("+g+".vertCount);":"",f?B.offset+".push("+
g+".offset);":"","}else{",ca,".push(null);","}");K(ca,".pop();","if(",d,"){",a?B.h+".pop();":"",h?B.count+".pop();":"",f?B.offset+".pop();":"","}");break;default:b.i("unsupported dynamic option: "+a)}});Object.keys(E).forEach(function(a){N.c(a);var b=u(N.m[a]);a=x(E[a]);J(b,".push(",a,");");K(b,".pop();")});Object.keys(z).forEach(function(a){P.c(a);var b=u(P.attributes[a]);a=x(z[a]);J(b,".pushDyn(",a,");");K(b,".pop();")});v=h("scope");X=v.M();oa=v.M();v(y);w&&v(ka,"=",X,";",J);v(oa,"();",w?K:"",
A);v=h("draw");v(y);w&&v(ka,"=",v.M(),";",J);X=a(S);v(ma,"();","if(",X,")",X,".draw(",w?ka:"",");",w?K:"",A);var ha=h("batch");ha(y);w=ha.c(a(S));h=u(function(a,b,u){var h=a.ra[d];h||(h=a.ra[d]=U(a,q,E,z,c));return h(b,u)});ha("if(",w,"){",ma,"();",h,"(",w,",",ha.M(),",",ha.M(),");");Object.keys(q).forEach(function(a){(a=ja[a])&&ha(a,".setDirty();")});ha("}",A);return l.compile()}}}},{"./check":3,"./codegen":5,"./constants/dtypes.json":8,"./constants/primitives.json":9}],7:[function(e,k){k.a={"[object Int8Array]":5120,
"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],8:[function(e,k){k.a={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],9:[function(e,k){k.a={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],10:[function(e,
k){function c(a,c){function f(){var c=window.innerWidth,f=window.innerHeight;a!==document.body&&(f=a.getBoundingClientRect(),c=f.right-f.left,f=f.top-f.bottom);g.width=k*c;g.height=k*f;Object.assign(g.style,{width:c+"px",height:f+"px"})}var g=document.createElement("canvas"),e=q(g,c);Object.assign(g.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(g);a===document.body&&(g.style.position="absolute",Object.assign(a.style,{margin:0,padding:0}));var k=+e.options.ja;window.addEventListener("resize",
f,!1);var C=e.options.wa;e.options=Object.assign({},e.options,{wa:function(){window.removeEventListener("resize",f);a.removeChild(g);C&&C()}});f();return e}function q(b,c){function f(a){try{return b.getContext(a,g)}catch(c){return null}}var g=c.Kb||{},e=f("webgl")||f("experimental-webgl")||f("webgl-experimental");a(e,"webgl not supported");return{ua:e,options:Object.assign({ja:window.devicePixelRatio},c)}}var a=e("./check");k.a=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{ua:a[0],
options:a[1]||{}};var e=document.body,f=a[1]||{};if("string"===typeof a[0])e=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)e=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{ua:a[0],options:Object.assign({ja:1},f)};f=a[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?q(e,f):c(e,f)}},{"./check":3}],11:[function(e,k){k.a=function(){return{h:[4],count:[0],offset:[0],O:[0]}}},{}],12:[function(e,k){function c(b,c){this.id=a++;
this.Ea=b;this.data=c}function q(a){switch(typeof a){case "boolean":case "number":case "string":return new c(!1,a);case "function":return new c(!0,a);default:return q}}var a=0;k.a={Pa:q,Ya:function(a){return"function"===typeof a&&!a.X||a instanceof c},mb:function(a,e){return a instanceof c?a:"function"===typeof a&&a!==q?new c(!0,a):new c(!1,e)}}},{}],13:[function(e,k){var c=e("./check"),q=e("./is-typed-array"),a=e("./constants/primitives.json");k.a=function(b,e,f){function g(){this.buffer=null;this.U=
4;this.type=this.oa=0}function k(b,f){var g={type:"elements"},e=D.Rb;b.U=4;b.oa=0;b.type=0;var m=null;if(!f)return g;"number"===typeof f?g.length=f:(c.type(f,"object","argument to element buffer must be object"),m=f.data||f);if(Array.isArray(m))if(0===f.length)m=null;else if(Array.isArray(m[0])){var z=m[0].length;1===z&&(b.U=0);2===z&&(b.U=1);3===z&&(b.U=4);for(var F=0,z=0;z<m.length;++z)F+=m[z].length;for(var F=e?new Uint32Array(F):new Uint16Array(F),T=0,z=0;z<m.length;++z)for(var N=m[z],P=0;P<N.length;++P)F[T++]=
N[P];m=F}else e?m=new Uint32Array(m):m=new Uint16Array(m);q(m)?(m instanceof Uint8Array||m instanceof Uint8ClampedArray?b.type=5121:m instanceof Uint16Array?b.type=5123:m instanceof Uint32Array?(c(e,"32-bit element buffers not supported"),b.type=5125):c.i("invalid typed array for element buffer"),b.oa=m.length,g.data=m):c(!m,"invalid element buffer data type");"object"===typeof f&&("primitive"in f&&(e=f.h,c.Ub(e,a),b.U=a[e]),"usage"in f&&(g.usage=f.usage),"count"in f&&(b.oa=f.oa|0));return g}var D=
e.N;Object.assign(g.prototype,{bind:function(){b.bindBuffer(34963,this.buffer.qa.buffer)},l:function(){this.buffer&&(this.buffer.l(),this.buffer=null)}});return{create:function(a){function b(a){c.buffer(k(c,a));return b}var c=new g;c.buffer=f.create(k(c,a),34963);b.X="elements";b.za=c;b.l=function(){c.l()};return b},elements:[null],Wa:function(a){return a&&a.za instanceof g?a.za:null}}}},{"./check":3,"./constants/primitives.json":9,"./is-typed-array":16}],14:[function(e,k){k.a=function(c){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{a[b]=
c.getExtension(b)}catch(e){}})}var a={};e();return{N:a,refresh:e}}},{}],15:[function(e,k){k.a=function(){return{create:function(){},clear:function(){},refresh:function(){},Ib:function(){return null}}}},{}],16:[function(e,k){var c=e("./constants/arraytypes.json");k.a=function(e){return Object.prototype.toString.call(e)in c}},{"./constants/arraytypes.json":7}],17:[function(e,k){k.a=function(c,e){var a=e.N,b=1;a.Sa&&(b=c.getParameter(34047));return{ub:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),
c.getParameter(3413)],xb:c.getParameter(3414),ic:c.getParameter(3415),jc:c.getParameter(3408),N:Object.keys(a).filter(function(b){return!!a[b]}),Za:b,Wb:c.getParameter(33901),lineWidth:c.getParameter(33902),viewport:c.getParameter(3386),vb:c.getParameter(35661),wb:c.getParameter(34076),bc:c.getParameter(34024),lb:c.getParameter(34930),lc:c.getParameter(3379),attributes:c.getParameter(34921),pc:c.getParameter(36347),oc:c.getParameter(35660),nc:c.getParameter(36348),Hb:c.getParameter(36349),Lb:c.getParameter(35724),
cc:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],18:[function(e,k){k.a=function(c,e){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(c))&&a[1]?a[1].toLowerCase():void 0;0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a)?(a=document.createElement("video"),a.autoplay=!0,a.loop=!0,e&&(a.crossOrigin=e),a.src=c):0<=["dds"].indexOf(a)?(a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",c,
!0),a.send()):(a=new Image,e&&(a.crossOrigin=e),a.src=c);return a}return null}},{}],19:[function(e,k){var c=e("./check");k.a=function(e){function k(a){for(var b=ga,c=G,f=0;f<l;++f){var g=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*t;v.D.push({target:a,o:f,width:b,height:c,data:new Uint8Array(e,u,g)});u+=g;b>>=1;c>>=1}}var H=new Int32Array(e);c(H[0]===q,"invalid magic number for dds header");var ea=H[Q];c(ea&O,"unsupported dds format");var ga=H[U],G=H[M],Y=C,r=0,t=0,x=4;switch(H[I]){case F:t=8;ea&z?(x=3,
r=m):r=f;break;case T:t=16;r=g;break;case N:t=16;r=L;break;case P:t=8;r=D;break;default:c.i("unsupported dds texture format")}var l=1;H[R]&n&&(l=Math.max(1,H[w]));var u=H[W]+4,v={width:ga,height:G,f:x,format:r,type:Y,w:!0,ca:!1,D:[]},H=H[V];if(H&E)for(c((H&p)===p,"missing cubemap faces"),v.ca=!0,H=0;6>H;++H)k(b+H);else k(a);return v};var q=542327876,a=3553,b=34069,m=33776,f=33777,g=33778,L=33779,D=36196,C=5121,n=131072,E=512,p=64512,O=4,z=64,F=827611204,T=861165636,N=894720068,P=826496069,W=1,Q=2,
M=3,U=4,w=7,R=20,I=21,V=28},{"./check":3}],20:[function(e,k){"function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?k.a={next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:k.a={next:function(c){setTimeout(c,30)},cancel:clearTimeout}},{}],21:[function(e,k){var c=e("./check"),q=e("./is-typed-array");k.a=function(a,b){return function(e){var f=e||{};q(e)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|
0}:"object"!==typeof e&&(f={});b.F();var g=b.viewport,k=f.x||0,D=f.y||0,C=f.width||g.width,g=f.height||g.height,n=C*g*4,f=f.data||new Uint8Array(n);c.Fa(f);c(f.byteLength>=n,"data buffer too small");a.pixelStorei(3333,4);a.readPixels(k,D,C,g,6408,5121,f);return f}}},{"./check":3,"./is-typed-array":16}],22:[function(e,k){function c(a,b,c){this.name=a;this.location=b;this.info=c}var q=e("./check");k.a=function(a,b,e,f,g){function k(b,c){var f=O[b],e=f[c];e||(e=a.createShader(b),a.shaderSource(e,c),
a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)||q.i("Error compiling shader:\n"+a.getShaderInfoLog(e)),f[c]=e);return e}function D(){Object.keys(O).forEach(function(b){Object.keys(O[b]).forEach(function(c){a.deleteShader(O[b][c])})});O[35632]={};O[35633]={}}function C(a,b){this.Va=a;this.pb=b;this.la=null;this.m=[];this.attributes=[];this.S=function(){};this.ra={}}function n(){F.forEach(function(a){a.l()});F.length=0;z={}}function E(){F.forEach(function(a){a.link()})}function p(){D();
n()}var O={},z={},F=[];Object.assign(C.prototype,{link:function(){var b,p;b=k(a.FRAGMENT_SHADER,this.Va);p=k(a.VERTEX_SHADER,this.pb);var n=this.la=a.createProgram();a.attachShader(n,b);a.attachShader(n,p);a.linkProgram(n);a.getProgramParameter(n,a.LINK_STATUS)||q.i("Error linking program:\n"+a.getProgramInfoLog(n));var E=a.getProgramParameter(n,a.ACTIVE_UNIFORMS),z=this.m=[];for(b=0;b<E;++b)if(p=a.getActiveUniform(n,b))if(1<p.size)for(var O=0;O<p.size;++O){var C=p.name.replace("[0]","["+O+"]");z.push(new c(C,
a.getUniformLocation(n,C),p));f.c(C)}else z.push(new c(p.name,a.getUniformLocation(n,p.name),p)),f.c(p.name);E=a.getProgramParameter(n,a.ACTIVE_ATTRIBUTES);z=this.attributes=[];for(b=0;b<E;++b)if(p=a.getActiveAttrib(n,b))z.push(new c(p.name,a.getAttribLocation(n,p.name),p)),e.c(p.name);this.S=g(this);this.ra={}},l:function(){a.deleteProgram(this.la)}});p();return{create:function(a,b){var c=z[b];c||(c=z[b]={});var f=c[a];f||(f=new C(b,a),f.link(),c[a]=f,F.push(f));return f},clear:p,refresh:function(){O[35632]=
{};O[35633]={};E()},gb:[null],Ua:["void main(){gl_FragColor=vec4(0,0,0,0);}"],ob:["void main(){gl_Position=vec4(0,0,0,0);}"]}}},{"./check":3}],23:[function(e,k){k.a=function(c,e){var a=c.length,b=c.slice(),m=!0;return{push:function(){for(var c=0;c<a;++c)b.push(arguments[c]);m=!0},pop:function(){b.length-=a;m=!0},F:function(){var c=b.length-a;if(m){switch(a){case 1:e(b[c]);break;case 2:e(b[c],b[c+1]);break;case 3:e(b[c],b[c+1],b[c+2]);break;case 4:e(b[c],b[c+1],b[c+2],b[c+3]);break;case 5:e(b[c],b[c+
1],b[c+2],b[c+3],b[c+4]);break;case 6:e(b[c],b[c+1],b[c+2],b[c+3],b[c+4],b[c+5]);break;default:e.apply(null,b.slice(c,b.length))}m=!1}},Ja:function(){m=!0}}}},{}],24:[function(e,k){var c=e("./stack"),q=e("./codegen");k.a=function(a){function b(b,e){var f=c([!!e],function(c){c?a.enable(b):a.disable(b)});f.Fb=b;return f}var e={width:a.drawingBufferWidth,height:a.drawingBufferHeight},f={dither:b(3024),"blend.enable":b(3042),"blend.color":c([0,0,0,0],function(b,c,e,f){a.blendColor(b,c,e,f)}),"blend.equation":c([32774,
32774],function(b,c){a.blendEquationSeparate(b,c)}),"blend.func":c([1,0,1,0],function(b,c,e,f){a.blendFuncSeparate(b,c,e,f)}),"depth.enable":b(2929,!0),"depth.func":c([513],function(b){a.depthFunc(b)}),"depth.range":c([0,1],function(b,c){a.depthRange(b,c)}),"depth.mask":c([!0],function(b){a.depthMask(b)}),"cull.enable":b(2884),"cull.face":c([1029],function(b){a.cullFace(b)}),frontFace:c([2305],function(b){a.frontFace(b)}),colorMask:c([!0,!0,!0,!0],function(b,c,e,f){a.colorMask(b,c,e,f)}),lineWidth:c([1],
function(b){a.lineWidth(b)}),"polygonOffset.enable":b(32823),"polygonOffset.offset":c([0,0],function(b,c){a.polygonOffset(b,c)}),"sample.alpha":b(32926),"sample.enable":b(32928),"sample.coverage":c([1,!1],function(b,c){a.sampleCoverage(b,c)}),"stencil.enable":b(2960),"stencil.mask":c([-1],function(b){a.stencilMask(b)}),"stencil.func":c([519,0,-1],function(b,c,e){a.stencilFunc(b,c,e)}),"stencil.opFront":c([7680,7680,7680],function(b,c,e){a.stencilOpSeparate(1028,b,c,e)}),"stencil.opBack":c([7680,7680,
7680],function(b,c,e){a.stencilOpSeparate(1029,b,c,e)}),"scissor.enable":b(3089),"scissor.box":c([0,0,-1,-1],function(b,c,e,f){var g=e;0>e&&(g=a.drawingBufferWidth-b);e=f;0>f&&(e=a.drawingBufferHeight-c);a.scissor(b,c,g,e)}),viewport:c([0,0,-1,-1],function(b,c,f,g){var k=f;0>f&&(k=a.drawingBufferWidth-b);f=g;0>g&&(f=a.drawingBufferHeight-c);a.viewport(b,c,k,f);e.width=k;e.height=f})},g=q(),k=g.V("poll"),D=g.V("refresh");Object.keys(f).forEach(function(a){a=g.link(f[a]);k(a,".poll();");D(a,".setDirty();")});
var C=g.compile();return{Oa:f,viewport:e,F:C.F,refresh:C.refresh,ab:function(){f.viewport.Ja();f["scissor.box"].Ja()}}}},{"./codegen":5,"./stack":23}],25:[function(e,k){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function q(a){return"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.j)&&"number"===typeof a.offset&&a.shape.length===a.j.length&&(Array.isArray(a.data)||L(a.data))}function a(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;
for(var c=a[0].length,e=1;e<b;++e)if(!Array.isArray(a[e])||a[e].length!==c)return!1;return!0}function b(a){return Object.prototype.toString.call(a)}function m(a){return"[object HTMLCanvasElement]"===b(a)}function f(a){return"[object CanvasRenderingContext2D]"===b(a)}var g=e("./check"),L=e("./is-typed-array"),D=e("./load-texture"),C=e("./to-half-float"),n=e("./parse-dds"),E=[9984,9986,9985,9987];k.a=function(e,k,z,F,T){function N(a){this.target=a;this.ka=this.da=!1;this.Ka=1;this.aa=37444;this.type=
this.g=this.format=this.f=this.height=this.width=0;this.w=!1;this.y=this.x=this.offset=this.H=this.na=this.W=this.o=0;this.ba=!1;this.crossOrigin=this.pa=this.canvas=this.video=this.u=this.data=null;this.R=this.fa=!1}function P(a){this.target=a;this.type=this.g=this.format=this.height=this.width=0;this.L=this.K=33071;this.P=0;this.va=9728;this.Y=1;this.G=!1;this.Ga=4352}function W(a,b){var c,d,e=0,f=0,k=0,l=0,m=0,q=0,n=!1,p=!1,r=!1,w=0,y=[0,0,0,0,0,0],A=0,t=!1;for(c=0;c<b.length;++c){d=b[c];var l=
l||d.width<<d.o,m=m||d.height<<d.o,e=e||d.type,f=f||d.format,k=k||d.g,q=q||d.f,p=p||d.fa,r=r||d.R,n=n||d.w,x=d.o;d=d.target;t=t||0<x;3553===d?w|=1<<x:(d=d-34069,y[d]|=1<<x,A|=1<<d)}a.fa=p;a.R=r;a.width=l;a.height=m;a.format=f;a.g=k;a.type=e;p=t?(l<<1)-1:1;if(3553===a.target)g(0===A,"pixmap type must not contain cubemap faces"),g(w===p,"missing mip map data");else for(g(63===A,"missing cubemap faces"),c=0;6>c;++c)g(y[c]===p,"missing mip map data");c=0<=E.indexOf(a.P);a.G=!t&&(a.G||c);t=t||a.G;a.P?
g(t===c,"min filter inconsistent with mipmap data"):a.P=t?9987:9728;t&&g(l===m&&!(l&l-1)&&!!l,"must be a square power of 2 to support mipmaps");a.G&&g(!n,"mipmap generation not supported for compressed textures");a.K=a.K||33071;a.L=a.L||33071;33071===a.K&&33071===a.L||g(!(l&l-1)&&!!l&&!(m&m-1)&&!!m&&!A,"incompatible size for wrap mode, image must be a power of 2");(5126===e&&!M.Sb||36193===e&&!M.Tb)&&g(9728===this.va&&9728===this.P,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=
b[c],n=d.o,d.width&&g(d.width<<n===l,"inconsistent width"),d.height&&g(d.height<<n===m,"inconsistent width"),d.f?g(d.f===q,"inconsistent channels"):d.f=q,d.format?g(d.format===f,"inconsistent format"):d.format=f,d.g?g(d.g===k,"inconsistent internalformat"):d.g=k,d.type?g(d.type===e,"inconsistent type"):d.type=e,d.ba&&g(5121===d.type&&6408===d.g,"incompatible format/type for copyTexImage2D")}function Q(a,b){this.id=Y++;this.target=a;this.I=b;this.v=this.xa=-1;this.Z=0;this.$=null;this.ha=new P(a);
this.D=[]}var M=k.N,U={"don't care":4352,"dont care":4352,nice:4354,fast:4353},w={repeat:10497,clamp:33071,mirror:33648},R={nearest:9728,linear:9729},I=Object.assign({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},R),V={none:0,browser:37444},ba={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Z={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},H={};M.Bb&&
(Z.fc=35904,Z.gc=35906);M.bb&&(ba.Gb=5126);M.cb&&(ba["half float"]=36193);M.qb&&(Object.assign(Z,{depth:6402,"depth stencil":34041}),Object.assign(ba,{uint16:5123,uint32:5125,"depth stencil":34042}));M.tc&&Object.assign(H,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});M.qc&&Object.assign(H,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});M.sc&&Object.assign(H,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});M.rc&&(H["rgb etc1"]=36196);var ea=Array.prototype.slice.call(e.getParameter(34467));Object.keys(H).forEach(function(a){var b=H[a];0<=ea.indexOf(b)&&(Z[a]=b)});k=Object.keys(Z);z.kc=k;var ga=k.reduce(function(a,b){var c=Z[b];a[c]=6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?c:32855===c||0<=b.indexOf("rgba")?6408:6407;return a},{});Object.assign(N.prototype,{ia:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(g.type(a.ka,"boolean","invalid premultiplyAlpha"),
this.ka=a.ka);"flipY"in a&&(g.type(a.da,"boolean","invalid texture flip"),this.da=a.da);"alignment"in a&&(g.Ha(a.La,[1,2,4,8],"invalid texture unpack alignment"),this.Ka=a.La);"colorSpace"in a&&(g.b(a.aa,V,"invalid colorSpace"),this.aa=V[a.aa]);if("format"in a){var b=a.format;g.b(b,Z,"invalid texture format");this.g=Z[b];b in ba&&(this.type=ba[b]);b in H&&(this.w=!0)}"type"in a&&(b=a.type,g.b(b,ba,"invalid texture type"),this.type=ba[b]);var b=this.width,c=this.height,d=this.f;"shape"in a?(g(Array.isArray(a.shape)&&
2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.Zb),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.f));this.width=b|0;this.height=c|0;this.f=d|0;"stride"in a?(b=a.j,g(Array.isArray(b)&&2<=b.length,"invalid stride vector"),this.W=b[0],this.na=b[1],3===b.length?this.H=b[2]:this.H=1,this.ga=!0):(this.H=1,this.W=this.H*d,this.na=this.W*b);"offset"in a&&(this.offset=a.offset|0,this.ga=!0);"crossOrigin"in
a&&(this.crossOrigin=a.crossOrigin)}},parse:function(e,v){this.o=v;this.width=this.width>>v;this.height=this.height>>v;var h=e;switch(typeof e){case "string":break;case "object":if(!e)return;this.ia(e);var d=e.data;if("string"===typeof d||d&&(L(d)||c(d)||q(d)||m(d)||f(d)||"[object HTMLImageElement]"===b(d)||"[object HTMLVideoElement]"===b(d)||a(d)))h=e.data;break;case "undefined":return;default:g.i("invalid pixel data type")}"string"===typeof h&&(h=D(h,this.crossOrigin));var d=null,k=!1;this.w&&g(h instanceof
Uint8Array||"[object XMLHttpRequest]"===b(h),"compressed texture data must be stored in a uint8array");if(null!==h)if(L(h))this.data=h;else if(c(h))d=h,k=!0;else if(q(h)){Array.isArray(h.data)?(d=h.data,k=!0):this.data=h.data;var l=h.shape;this.width=l[0];this.height=l[1];3===l.length?this.f=l[2]:this.f=1;l=h.j;this.W=h.j[0];this.na=h.j[1];3===l.length?this.H=h.j[2]:this.H=1;this.offset=h.offset;this.ga=!0}else if(m(h)||f(h))m(h)?this.canvas=h:this.canvas=h.canvas,this.width=this.canvas.width,this.height=
this.canvas.height,this.ma();else if("[object HTMLImageElement]"===b(h))this.u=h,h.complete?(this.width=h.naturalWidth,this.height=h.naturalHeight):(this.width=this.width||h.naturalWidth,this.height=this.height||h.naturalHeight,this.R=!0),this.ma();else if("[object HTMLVideoElement]"===b(h))this.video=h,1<h.readyState?(this.width=h.width,this.height=h.height):(this.width=this.width||h.width,this.height=this.height||h.height,this.R=!0),this.fa=!0,this.ma();else if("[object XMLHttpRequest]"===b(h))this.pa=
h,this.R=!0;else if(a(h)){var k=h.length,l=h[0].length,n=1,p,B,r,t;if(Array.isArray(h[0][0]))for(n=h[0][0].length,g(0<=n&&4>=n,"invalid number of channels for image data"),d=Array(k*l*n),p=t=0;p<k;++p)for(B=0;B<l;++B)for(r=0;r<n;++r)d[t++]=h[p][B][r];else for(d=Array(k*l),p=t=0;p<k;++p)for(B=0;B<l;++B)d[t++]=h[p][B];this.width=k;this.height=l;this.f=n;k=!0}else e.ba&&(this.ba=!0,this.x=this.x|0,this.y=this.y|0,console.log(T),this.width=(this.width||T.width)|0,this.height=(this.height||T.height)|0,
this.ma());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.g||(this.g=[6409,6410,6407,6408][(this.f=this.f||4)-1],g(this.g,"invalid number of channels"));l=this.g;if(6402===l||34041===l)g(M.qb,"depth/stencil texture not supported"),6402===l&&g(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===l&&g(34042===this.type,"depth stencil texture format must match type"),
g(!this.data&&!d&&!this.u&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");h=this.format=ga[l];if(!this.f)switch(h){case 6409:case 6406:case 6402:this.f=1;break;case 34041:case 6410:this.f=2;break;case 6407:this.f=3;break;default:this.f=4}h=this.type;5126===h?g(M.bb,"float texture not supported"):36193===h?g(M.cb,"half float texture not supported"):h||(h=6402===l?5125:5121);this.type=h;if(k)switch(h){case 5121:this.data=new Uint8Array(d);break;case 5123:this.data=new Uint16Array(d);
break;case 5125:this.data=new Uint32Array(d);break;case 5126:this.data=new Float32Array(d);break;case 36193:this.data=C(d);break;case 33635:case 32820:case 32819:case 34042:g.i("unsupported format for automatic conversion");break;default:g.i("unsupported type conversion")}if(this.data){if(this.ga){d=this.data;k=this.width;l=this.height;n=this.f;p=this.W;B=this.na;r=this.H;t=this.offset;for(var w=new d.constructor(k*l*n),x=0,z=0;z<l;++z)for(var y=0;y<k;++y)for(var A=0;A<n;++A)w[x++]=d[B*z+p*y+r*A+
t];this.data=w}switch(h){case 5121:g(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:g(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:g(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:g(this.data instanceof Float32Array,"incompatible pixel type");break;default:g.i("bad or missing pixel type")}}this.ga=!1},ma:function(){this.format=
this.g=6408;this.type=5121;this.f=4;this.w=!1},upload:function(a){e.pixelStorei(37440,this.da);e.pixelStorei(37441,this.ka);e.pixelStorei(37443,this.aa);e.pixelStorei(3317,this.Ka);var b=this.target,c=this.o,d=this.u,f=this.canvas,g=this.video,l=this.data,k=this.g,m=this.format,n=this.type,q=this.width||Math.max(1,a.width>>c);a=this.height||Math.max(1,a.height>>c);g&&2<g.readyState?e.texImage2D(b,c,m,m,n,g):d&&d.complete?e.texImage2D(b,c,m,m,n,d):f?e.texImage2D(b,c,m,m,n,f):this.w?e.compressedTexImage2D(b,
c,k,q,a,0,l):this.ba?(F(),e.copyTexImage2D(b,c,m,this.x,this.y,q,a,0)):l?e.texImage2D(b,c,m,q,a,0,m,n,l):e.texImage2D(b,c,m,q||1,a||1,0,m,n,null)}});Object.assign(P.prototype,{clear:function(){P.call(this,this.target)},parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;g.b(b,I);this.P=I[b]}"mag"in a&&(b=a.Pb,g.b(b,R),this.va=R[b]);var b=this.K,c=this.L;if("wrap"in a){var d=a.uc;"string"===typeof d?(g.b(d,w),b=c=w[d]):Array.isArray(d)&&(g.b(d[0],w),g.b(d[1],w),b=w[d[0]],c=w[d[1]])}else"wrapS"in
a&&(b=a.K,g.b(b,w),b=w[b]),"wrapT"in a&&(c=a.L,g.b(c,w),c=w[c]);this.K=b;this.L=c;"anisotropic"in a&&(b=a.Y,g("number"===typeof b&&1<=b&&b<=z.Za,"aniso samples must be between 1 and "),this.Y=a.Y);if("mipmap"in a)switch(a=a.$a,typeof a){case "string":g.b(a,U,"invalid mipmap hint");this.Ga=U[a];this.G=!0;break;case "boolean":this.G=!!a;break;case "object":break;default:g.i("invalid mipmap type")}}},upload:function(){var a=this.target;e.texParameteri(a,10241,this.P);e.texParameteri(a,10240,this.va);
e.texParameteri(a,10242,this.K);e.texParameteri(a,10243,this.L);M.Sa&&e.texParameteri(a,34046,this.Y);this.G&&(e.hint(33170,this.Ga),e.generateMipmap(a))}});var G=0,Y=0,r={},t=[],x=z.lb,l=Array(x).map(function(){return null});Object.assign(Q.prototype,{bind:function(){this.Z+=1;var a=this.v;if(0>a){for(var b=0;b<x;++b){var c=l[b];if(!c||0>=c.Z){c&&(c.v=-1);l[b]=this;a=b;break}}a>=x&&g.i("insufficient number of texture units");this.v=a;e.activeTexture(33984+a);e.bindTexture(this.target,this.I);G=a}return a},
mc:function(){--this.Z},refresh:function(){var a=this.target,b=this.v;0<=b?(e.activeTexture(33984+b),G=b):e.bindTexture(a,this.I);for(var a=this.D,c=this.ha,d=0;d<a.length;++d)a[d].upload(c);c.upload();0>b&&((b=l[G])?e.bindTexture(b.target,b.I):(this.v=G,l[G]=this))},update:function(a){function b(c,d){var f=d.$a,g;if(Array.isArray(f))for(var h=0;h<f.length;++h)g=new N(c),g.ia(a),g.ia(d),g.parse(f[h],h),e.push(g);else g=new N(c),g.ia(a),g.parse(d,0),e.push(g)}var c;this.Ba();var d=this.ha,e=this.D;
d.clear();e.length=0;d.parse(a);if(3553===this.target)b(3553,a);else{var f=a.Cb||a;if(Array.isArray(f))for(g(6===f.length,"invalid number of faces in cube map"),c=0;6>c;++c)b(34069+c,f[c]);else if("string"!==typeof f)for(c=0;6>c;++c)b(34069+c,{})}W(d,e);d.R&&this.Xa();d.fa&&(this.xa=t.length,t.push(this));this.refresh()},Xa:function(){function a(b,c,f){var h=n(f);g(h.format in ga,"unsupported dds texture format");h.ca?g(34067===e.target):g(3553===e.target);c&&g(1===h.D.length,"number of mip levels inconsistent");
h.D.forEach(function(a){var e=new N(h.ca?a.target:b);e.f=h.f;e.w=h.w;e.type=h.type;e.g=h.format;e.format=ga[h.format];e.width=a.width;e.height=a.height;e.o=a.o||c;e.data=a.data;d.push(e)})}function b(){for(var f=0;f<d.length;++f){var g=d[f],l=g.u,k=g.video,m=g.pa;l&&l.complete?(g.width=l.naturalWidth,g.height=l.naturalHeight):k&&2<k.readyState?(g.width=k.width,g.height=k.height):m&&4===m.readyState&&(d[f]=d[d.length-1],d.pop(),m.removeEventListener("readystatechange",b),a(g.target,g.o,m.response))}W(c,
d);e.refresh()}var c=this.ha,d=this.D,e=this;d.forEach(function(a){a.u&&!a.u.complete?a.u.addEventListener("load",b):a.video&&1>a.readyState?a.video.addEventListener("progress",b):a.pa&&a.pa.addEventListener("readystatechange",b)});this.$=function(){d.forEach(function(a){a.u?a.u.removeEventListener("load",b):a.video&&a.video.removeEventListener("progress",b)})}},Ba:function(){this.$&&(this.$(),this.$=null);var a=this.xa;0<=a&&((t[a]=t[t.length-1]).id=a,t.pop(),this.xa=-1)},l:function(){g(this.I,"must not double free texture");
0<=this.v&&(e.activeTexture(33984+this.v),G=this.v,e.bindTexture(this.target,null),l[this.v]=null);this.Ba();e.deleteTexture(this.I);this.D=this.ha=this.I=null;delete r[this.id]}});return{create:function(a,b){function c(a,e,f,g,h,l){var k=a||{};34067===b&&6===arguments.length&&(k=[a,e,f,g,h,l]);d.update(k)}var d=new Q(b,e.createTexture());r[d.id]=d;c(a);Object.assign(c,{X:"texture",rb:d,l:function(){d.l()}});return c},refresh:function(){Object.keys(r).forEach(function(a){r[a].refresh()});for(var a=
0;a<x;++a)l[a]=null;G=0;e.activeTexture(33984)},clear:function(){for(var a=0;a<x;++a)e.activeTexture(33984+a),e.bindTexture(3553,null),l[a]=null;e.activeTexture(33984);G=0;Object.keys(r).forEach(function(a){r[a].l()})},F:function(){for(var a=0;a<t.length;++a)t[a].refresh()},Jb:function(){return null}}}},{"./check":3,"./is-typed-array":16,"./load-texture":18,"./parse-dds":19,"./to-half-float":26}],26:[function(e,k){k.a=function(c){for(var e=new Float32Array(c),e=new Uint32Array(e.buffer),a=new Uint16Array(c.length),
b=0;b<c.length;++b)if(isNaN(c[b]))a[b]=65535;else if(Infinity===c[b])a[b]=31744;else if(-Infinity===c[b])a[b]=64512;else{var k=e[b],f=k>>>31<<15,g=(k<<1>>>24)-127,k=k>>13&1023;a[b]=-24>g?f:-14>g?f+(k+1024>>-14-g):15<g?f+31744:f+(g+15<<10)+k}return a}},{}],27:[function(e,k){k.a=function(){var c={};return{m:c,c:function(e){e in c||(c[e]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])}}}},{}],28:[function(e,k){var c=e("./lib/check"),q=e("./lib/context"),a=e("./lib/extension"),b=e("./lib/limits"),m=e("./lib/buffer"),
f=e("./lib/elements"),g=e("./lib/texture"),L=e("./lib/fbo"),D=e("./lib/uniform"),C=e("./lib/attribute"),n=e("./lib/shader"),E=e("./lib/draw"),p=e("./lib/state"),O=e("./lib/compile"),z=e("./lib/read"),F=e("./lib/dynamic"),T=e("./lib/raf"),N=e("./lib/clock");k.a=function(){function e(){h=T.next(e);t.count+=1;if(t.width!==w.drawingBufferWidth||t.height!==w.drawingBufferHeight)t.width=w.drawingBufferWidth,t.height=w.drawingBufferHeight,G.ab();var a=N();t.Da=a-t.t;t.t=a;Y.F();for(var b=0;b<v.length;++b)(0,v[b])(t.count,
t.t,t.Da);t.jb=N()-a}function k(){h&&(T.cancel(e),h=0)}function Q(a){k();a.preventDefault();R.eb&&R.eb()}function M(){I.refresh();V.refresh();Y.refresh();r.refresh();ea.refresh();G.refresh();R.fb&&R.fb();e()}var U=q(Array.prototype.slice.call(arguments)),w=U.ua,R=U.options,I=a(w),U=b(w,I),V=m(w),ba=f(w,I,V),Z=D(),H=C(w,I,V),ea=n(w,I,H,Z,function(a){return l.S(a)}),ga=E(w,I,V),G=p(w,ea),Y=g(w,I,U,function(){G.F()},G.viewport),r=L(w,I,Y),t={count:0,start:N(),Da:0,t:N(),jb:0,width:w.drawingBufferWidth,
height:w.drawingBufferHeight,ja:R.ja},x=z(w,G),l=O(w,I,V,ba,Y,r,G,Z,H,ea,ga,t),u=w.canvas,v=[],h=0;u&&(u.addEventListener("webglcontextlost",Q,!1),u.addEventListener("webglcontextrestored",M,!1));return Object.assign(function(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var f=a[b];F.Ya(f)?(e=!0,d[b]=F.mb(f,b)):c[b]=f});return{ta:d,ya:c}}c(!!a,"invalid args to regl({...})");c.type(a,"object","invalid args to regl({...})");var e=!1,f=b(a.m||{}),g=b(a.attributes||{});a=b(function(a){function b(a){if(a in
c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Object.assign({},a);delete c.m;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var f=l.Na(a.ya,f.ya,g.ya,a.ta,f.ta,g.ta,e),h=f.S,k=f.Ma,m=f.scope,n=[];return function(a,b){var c;if("number"===typeof a){for(c=a|0;n.length<c;)n.push(null);c=k(a|0,n)}else c=Array.isArray(a)?k(a.length,a):"function"===typeof a?m(null,a):"function"===typeof b?
m(a,b):h(a);return c}},{clear:function(a){var b=0;G.F();var e=a.color;e&&(w.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),b|=16384);"depth"in a&&(w.clearDepth(+a.depth),b|=256);"stencil"in a&&(w.clearStencil(a.stencil|0),b|=1024);c(!!b,"called regl.clear with no buffer specified");w.clear(b)},Xb:F.Pa,elements:function(a){return ba.create(a)},buffer:function(a){return V.create(a,34962)},I:function(a){return Y.create(a,3553)},ca:function(a){return 6===arguments.length?Y.create(Array.prototype.slice.call(arguments),
34067):Y.create(a,34067)},frame:function(a){v.push(a);!h&&0<v.length&&e();return{cancel:function(){var b=v.find(function(b){return b===a});0>b||(v.splice(b,1),0>=v.length&&k())}}},hc:t,Ob:U,read:x,l:function(){k();u&&(u.removeEventListener("webglcontextlost",Q),u.removeEventListener("webglcontextrestored",M));ea.clear();r.clear();Y.clear();V.clear();R.wa&&R.wa()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/check":3,"./lib/clock":4,"./lib/compile":6,"./lib/context":10,"./lib/draw":11,"./lib/dynamic":12,
"./lib/elements":13,"./lib/extension":14,"./lib/fbo":15,"./lib/limits":17,"./lib/raf":20,"./lib/read":21,"./lib/shader":22,"./lib/state":24,"./lib/texture":25,"./lib/uniform":27}]},{},[28])(28)});
