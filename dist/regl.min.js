(function(ta){if("object"===typeof exports&&"undefined"!==typeof module)module.a=ta();else if("function"===typeof define&&define.Pb)define([],ta);else{var c;"undefined"!==typeof window?c=window:"undefined"!==typeof global?c=global:"undefined"!==typeof self?c=self:c=this;c.Gc=ta()}})(function(){return function c(g,b,q){function a(h,e){if(!b[h]){if(!g[h]){var E="function"==typeof require&&require;if(!e&&E)return E(h,!0);if(d)return d(h,!0);E=Error("Cannot find module '"+h+"'");throw E.code="MODULE_NOT_FOUND",
E;}E=b[h]={a:{}};g[h][0].call(E.a,function(b){var d=g[h][1][b];return a(d?d:b)},E,E.a,c,g,b,q)}return b[h].a}for(var d="function"==typeof require&&require,e=0;e<q.length;e++)a(q[e]);return a}({1:[function(c,g){function b(){this.v=!1;this.O=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.I=!1;this.type=5126;this.H=this.m=this.offset=0}var q=c("./constants/dtypes.json");Object.assign(b.prototype,{jb:function(a,b){return this.v?a.v&&this.buffer===a.buffer&&this.size===b&&this.I===a.I&&this.type===
a.type&&this.offset===a.offset&&this.m===a.m&&this.H===a.H:!a.v&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.O===a.O},set:function(a,b){(this.v=a.v)?(this.buffer=a.buffer,this.size=b,this.I=a.I,this.type=a.type,this.offset=a.offset,this.m=a.m,this.H=a.H):(this.x=a.x,this.y=a.y,this.z=a.z,this.O=a.O)}});g.a=function(a,d,e,h){function k(){for(var a=Array(16),d=0;16>d;++d)a[d]=new b;this.Gb=a;this.top=0}function c(a){for(var d=a.Gb,h=a.top;d.length-1<=h;)d.push(new b);return d[++a.top]}var g={};e=
e.vb;for(var z=Array(e),y=0;y<e;++y)z[y]=new b;Object.assign(k.prototype,{Ya:function(a,b,d,h){var e=c(this);e.v=!1;e.x=a;e.y=b;e.z=d;e.O=h},Fb:function(a,b,d,h,e,k,q){var g=c(this);g.v=!0;g.buffer=a;g.size=b;g.offset=d;g.m=h;g.H=e;g.I=k;g.type=q},Ec:function(a){if("number"===typeof a)this.Ya(a,0,0,0);else if(Array.isArray(a))this.Ya(a[0],a[1],a[2],a[3]);else{var b=h.na(a),d=0,e=0,k=0,c=0,g=!1,E=5126;b?E=b.K:(b=h.na(a.buffer),d=a.size||0,e=a.m||0,k=a.offset||0,c=a.H||0,g=a.I||!1,E=b.K,"type"in a&&
(E=q[a.type]));this.Fb(b,d,k,e,c,g,E)}},pop:function(){--this.top}});return{Ca:z,attributes:g,bind:function(b,h,e,k){k=e.size||k;if(!h.jb(e,k)){if(e.v){h.v||a.enableVertexAttribArray(b);h.buffer!==e.buffer&&e.buffer.bind();a.vertexAttribPointer(b,k,e.type,e.I,e.m,e.offset);var q=d.Na;q&&q.vertexAttribDivisorANGLE(b,e.H)}else h.v&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,e.x,e.y,e.z,e.O);h.set(e,k)}},g:function(a){a in g||(g[a]=new k)}}}},{"./constants/dtypes.json":8}],2:[function(c,g){function b(a,
b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var q=c("./check"),a=c("./is-typed-array"),d=c("./is-ndarray"),e=c("./constants/arraytypes.json"),h=c("./constants/dtypes.json"),k=c("./values"),E={"static":35044,dynamic:35048,stream:35040};g.a=function(c){function g(a,
b){this.id=m++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.la=1;this.data=null;this.K=5121}function y(a){c.isBuffer(a.buffer)||(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function x(a){var b=a.buffer;q(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete l[a.id]}var m=0,l={};g.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(k,m,K){function aa(k){var l=k||
{};if(Array.isArray(l)||a(l)||d(l))l={data:l};else if("number"===typeof l)l={length:l|0};else if(null===l||void 0===l)l={};q.type(l,"object","buffer arguments must be an object, a number or an array");"usage"in l?(q.b(l.usage,E,"invalid buffer usage"),U.usage=E[l.usage]):U.usage=35044;k=0;"type"in l&&(q.b(l.type,h,"invalid buffer type"),k=h[l.type]);var x=l.la|0||1,c=0,m=null;if("data"in l)if(m=l.data,null===m)c=l.length|0;else{if(d(m)){var x=m.shape,c=m.m,l=m.offset,g=0,F=0,K=0,u=0;1===x.length?
(g=x[0],F=1,K=c[0],u=0):2===x.length?(g=x[0],F=x[1],K=c[0],u=c[1]):q.h("invalid shape");k=k||e[Object.prototype.toString.call(m)]|0||5126;for(var x=F,c=b(k,g*F),m=m.data,Q=0,B=0;B<g;++B)for(var z=0;z<F;++z)c[Q++]=m[K*B+u*z+l];m=c}else if(Array.isArray(m))if(0<m.length&&Array.isArray(m[0])){x=m[0].length;k=k||5126;l=b(k,m.length*x);c=m;m=x;for(g=u=0;g<c.length;++g)for(K=c[g],F=0;F<m;++F)l[u++]=K[F];m=l}else k=k||5126,m=b(k,m);else q.Sa(m,"invalid data type buffer data"),k=k||e[Object.prototype.toString.call(m)]|
0;c=m.byteLength}else"length"in l&&(c=l.length|0,q.ba(c,"buffer length must be a nonnegative integer"));U.data=m;U.K=k||5121;U.byteLength=c;U.la=x;y(U);return aa}var D=c.createBuffer(),U=new g(D,m);l[U.id]=U;K||aa(k);aa.C="buffer";aa.Aa=U;aa.G=function(){x(U)};return aa},clear:function(){k(l).forEach(x)},refresh:function(){k(l).forEach(y)},na:function(a){return a&&a.Aa instanceof g?a.Aa:null}}}},{"./check":3,"./constants/arraytypes.json":7,"./constants/dtypes.json":8,"./is-ndarray":16,"./is-typed-array":17,
"./values":30}],3:[function(c,g){function b(a){a=Error("(regl) "+a);console.error(a);throw a;}var q=c("./is-typed-array");g.a=Object.assign(function(a,d){a||b(d)},{h:b,b:function(a,d,e){a in d||b("unknown parameter ("+a+")"+(e?": "+e:"")+". possible values: "+Object.keys(d).join())},type:function(a,d,e){typeof a!==d&&b("invalid parameter type"+(e?": "+e:"")+". expected "+d+", got "+typeof a)},Sa:function(a,d){q(a)||b("invalid parameter type"+(d?": "+d:"")+". must be a typed array")},ba:function(a,
d){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+(d?": "+d:"")+". must be a nonnegative integer")},qa:function(a,d,e){0>d.indexOf(a)&&b("invalid value"+(e?": "+e:"")+". must be one of: "+d)}})},{"./is-typed-array":17}],4:[function(c,g){g.a="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],5:[function(c,g){g.a=function(){function b(){var a=[],b=[];return Object.assign(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},
{g:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),a.push(";"));return d},toString:function(){return[0<b.length?"var "+b+";":"",a.join("")].join("")}})}var c=0,a=[],d=[],e={};return{link:function(b){var e="g"+c++;a.push(e);d.push(b);return e},block:b,ca:function(a){var d=[],g=b(),B=g.toString;return e[a]=Object.assign(g,{T:function(){var a="a"+c++;d.push(a);return a},toString:function(){return["function(",d.join(),"){",B(),
"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(e).forEach(function(a){b.push('"',a,'":',e[a].toString(),",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,d)}}}},{}],6:[function(c,g){function b(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function q(a,b,d,h){var k,c=",";switch(b){case 5126:k="1f";break;case 35664:k="2fv";break;
case 35665:k="3fv";break;case 35666:k="4fv";break;case 35670:case 5124:k="1i";break;case 35671:case 35667:k="2iv";break;case 35672:case 35668:k="3iv";break;case 35673:case 35669:k="4iv";break;case 35674:k="Matrix2fv";c=",false,";break;case 35675:k="Matrix3fv";c=",false,";break;case 35676:k="Matrix4fv";c=",false,";break;default:e.h("unsupported uniform type")}return a+".uniform"+k+"("+d+c+h+");"}function a(a){return a+"["+a+".length-1]"}function d(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var e=
c("./check"),h=c("./codegen"),k=c("./constants/primitives.json"),E=c("./constants/dtypes.json"),B={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},z={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,
"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};g.a=function(c,m,l,g,u,K,aa,D,U,ea,R,ba,ja,ma){function X(l,g,F,K,E){function D(a){var f=ra[a];return f?f:f=ra[a]=r(G[a])}function S(a){var f=a.id,w=W[f];if(w)return w;w=a.Ra?n.g(r(a.data),"(",R,",",O,",",H,")"):n.g(R,".",a.data);return W[f]=w}function t(a,f){return a.find(function(a){return a.name===
f})}function J(a){return oa&&!(a in g||a in E)}var L=h(),r=L.link,n=L.ca("batch"),C=L.block(),T=n.g,Z=n.T,f=r(c),I=r(l.va),p=r(ea.bind),H=r(ja),ia=r(aa),A=r(ba.count),P=r(ba.offset),ga=r(ba.W),Y=r(ba.o),ra={},N=r(u.elements),A=T(a(A)),P=T(a(P)),Y=T(a(Y)),N=T(a(N)),v,M,pa=m.Na;pa&&(v=T(a(ga)),M=r(pa));var oa="elements"in g,ga=Z(),Z=Z(),R=T(),O=T(),W={};n(f,".useProgram(",I,");");l.s.forEach(function(a){if(!(a.name in F)){var na=r(a.location),w=r(U.s[a.name]),w=w+"["+w+".length-1]";35678===a.info.type||
35680===a.info.type?(a=T(w+"._texture"),n(q(f,5124,na,a+".bind()")),C(a,".unbind();")):n(q(f,a.info.type,na,w))}});l.attributes.forEach(function(a){if(!(K.name in K)){var f=r(ea.attributes[a.name]);n(p,"(",a.location,",",r(ea.Ca[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")}});oa||n("if(",N,"){",f,".bindBuffer(",34963,",",N,".buffer.buffer);","}else{",f,".bindBuffer(",34963,",null);","}");n("for(",O,"=0;",O,"<",ga,";++",O,"){",R,"=",Z,"[",O,"];");Object.keys(g).sort(d).forEach(function(a){function na(a){n("if(",
w,"){",f,".enable(",a,");}else{",f,".disable(",a,");}")}var w=S(g[a]);switch(a){case "framebuffer":a=D("viewport");var b=D("scissor.box");n("if(",ia,".push(",w,"&&",w,"._framebuffer)){",ia,".poll();",a,".setDirty();",b,".setDirty();","}");break;case "cull.enable":na(2884);break;case "blend.enable":na(3042);break;case "dither":na(3024);break;case "stencil.enable":na(2960);break;case "depth.enable":na(2929);break;case "scissor.enable":na(3089);break;case "polygonOffset.enable":na(32823);break;case "sample.alpha":na(32926);
break;case "sample.enable":na(32928);break;case "depth.mask":n(f,".depthMask(",w,");");break;case "depth.func":a=r(z);n(f,".depthFunc(",a,"[",w,"]);");break;case "depth.range":n(f,".depthRange(",w,"[0],",w,"[1]);");break;case "blend.color":n(f,".blendColor(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "blend.equation":a=r(V);n("if(typeof ",w,'==="string"){',f,".blendEquation(",a,"[",w,"]);","}else{",f,".blendEquationSeparate(",a,"[",w,".rgb],",a,"[",w,".alpha]);","}");break;case "blend.func":a=
r(B);n(f,".blendFuncSeparate(",a,'["srcRGB" in ',w,"?",w,".srcRGB:",w,".src],",a,'["dstRGB" in ',w,"?",w,".dstRGB:",w,".dst],",a,'["srcAlpha" in ',w,"?",w,".srcAlpha:",w,".src],",a,'["dstAlpha" in ',w,"?",w,".dstAlpha:",w,".dst]);");break;case "stencil.mask":n(f,".stencilMask(",w,");");break;case "stencil.func":a=r(z);n(f,".stencilFunc(",a,"[",w,'.cmp||"always"],',w,".ref|0,",'"mask" in ',w,"?",w,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=r(y);n(f,".stencilOpSeparate(","stencil.opFront"===
a?1028:1029,",",b,"[",w,'.fail||"keep"],',b,"[",w,'.zfail||"keep"],',b,"[",w,'.pass||"keep"]);');break;case "polygonOffset.offset":n(f,".polygonOffset(",w,".factor||0,",w,".units||0);");break;case "cull.face":n(f,".cullFace(",w,'==="front"?',1028,":",1029,");");break;case "lineWidth":n(f,".lineWidth(",w,");");break;case "frontFace":n(f,".frontFace(",w,'==="cw"?',2304,":",2305,");");break;case "colorMask":n(f,".colorMask(",w,"[0],",w,"[1],",w,"[2],",w,"[3]);");break;case "sample.coverage":n(f,".sampleCoverage(",
w,".value,",w,".invert);");break;case "scissor.box":case "viewport":a=D(a);n(a,".push(",w,".x||0,",w,".y||0,",w,".w||-1,",w,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;default:e.h("unsupported option for batch",a)}});("viewport"in g||"framebuffer"in g)&&n(D("viewport"),".poll();");("scissor.box"in g||"framebuffer"in g)&&n(D("scissor.box"),".poll();");"framebuffer"in g&&n(ia,".pop();");var X=l.s,da=[];Object.keys(F).forEach(function(a){var b=t(X,a);if(b){var w=
b.info.type,p=r(b.location);a=S(F[a]);35678===b.info.type||35680===b.info.type?(b=T(a+"._texture"),da.push(b),n(q(f,5124,p,b+".bind()"))):n(q(f,w,p,a))}});da.forEach(function(a){n(a,".unbind();")});var ma=l.attributes;Object.keys(K).forEach(function(a){var f=t(ma,a);f&&n(p,"(",f.location,",",r(a.Ca[f.location]),",",S(K[a]),",",b(f.info.type),");")});g.count?n(A,"=",S(g.count),";"):J("count")||n("if(",A,"){");g.offset&&n(P,"=",S(g.offset),";");g.o&&(l=r(k),n(Y,"=",l,"[",S(g.o),"];"));oa&&(l=S(g.elements),
n(N,"=",l,"?",l,"._elements:null;"));J("offset")&&n(P,"=0;");n("if(",N,"){");J("count")&&n(A,"=",N,".vertCount;","if(",A,">0){");J("primitive")&&n(Y,"=",N,".primType;");oa&&n(f,".bindBuffer(",34963,",",N,".buffer.buffer);");pa&&(g.W&&n(v,"=",S(g.W),";"),n("if(",v,">0){",M,".drawElementsInstancedANGLE(",Y,",",A,",",N,".type,",P,",",v,");}else{"));n(f,".drawElements(",Y,",",A,",",N,".type,",P,");");pa&&n("}");J("count")&&n("}");n("}else{");J("count")||(J("primitive")&&n(Y,"=",4,";"),pa&&n("if(",v,">0){",
M,".drawArraysInstancedANGLE(",Y,",",P,",",A,",",v,");}else{"),n(f,".drawArrays(",Y,",",P,",",A,");}"),pa&&n("}"));n("}}",C);return L.compile().eb}var G=D.gb,V={add:32774,subtract:32778,"reverse subtract":32779};m.cc&&(V.min=32775,V.max=32776);var da=0;return{U:function(d){var e=h(),l=e.link,k=e.ca("draw"),g=k.g,F=l(c),K=l(d.va),E=l(ea.bind),J=l(ba.count),L=l(ba.offset),r=l(ba.W),n=l(ba.o),C=l(u.elements),T=[];k(F,".useProgram(",K,");");d.attributes.forEach(function(a){var f=l(ea.attributes[a.name]);
k(E,"(",a.location,",",l(ea.Ca[a.location]),",",f,".records[",f,".top]",",",b(a.info.type),");")});d.s.forEach(function(a){var f=l(a.location),b=l(U.s[a.name]),b=b+"["+b+".length-1]";35678===a.info.type||35680===a.info.type?(a=g(b+"._texture"),T.push(a),k(q(F,5124,f,a+".bind()"))):k(q(F,a.info.type,f,b))});T.forEach(function(a){k(a,".unbind();")});d=g(a(n));J=g(a(J));L=g(a(L));C=g(a(C));k("if(",J,"){");(K=m.Na)?(r=g(a(r)),K=l(K),k("if(",C,"){",C,".bind();","if(",r,">0){",K,".drawElementsInstancedANGLE(",
d,",",J,",",C,".type,",L,",",r,");}else{",F,".drawElements(",d,",",J,",",C,".type,",L,");}","}else if(",r,">0){",K,".drawArraysInstancedANGLE(",d,",",L,",",J,",",r,");}else{",F,".drawArrays(",d,",",L,",",J,");}}")):k("if(",C,"){",F,".drawElements(",d,",",J,",",C,".type,",L,");}","}else{",F,".drawArrays(",d,",",L,",",J,");}");return e.compile().U},fb:function(b,c,m,x,q,K,D){function t(a){var b=N[a];return b?b:b=N[a]=n(G[a])}function J(a,b){var f=t(a);v(f,".push(",b,");");M(f,".pop();")}function L(a){var b=
a.id,f=wa[b];if(f)return f;f=a.Ra?O.g(n(a.data),"(",sa,",0,",va,")"):O.g(sa,".",a.data);return wa[b]=f}var r=h(),n=r.link,C=r.block,T=r.ca,Z=da++,f=n(ma),I=n(R.ob),p=n(R.Lb),H=n(R.Eb),ia=n(aa),A={count:n(ba.count),offset:n(ba.offset),W:n(ba.W),o:n(ba.o)},P=n(u.elements),ga=n(k),Y=n(z),ra=n(y),N={},v=C(),M=C(),pa=!1;Object.keys(b).sort(d).forEach(function(a){var f=b[a];switch(a){case "frag":pa=!0;v(I,".push(",n(f),");");M(I,".pop();");break;case "vert":pa=!0;v(p,".push(",n(f),");");M(p,".pop();");
break;case "framebuffer":a=aa.rb(f);e(null===f||a,"invalid framebuffer object");a=t("viewport");var d=t("scissor.box");v("if(",ia,".push(",n(f&&f.Ma),")){",a,".setDirty();",d,".setDirty();","}");M("if(",ia,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "count":case "offset":case "instances":e.ba(f,a);v(A[a],".push(",f,");");M(A[a],".pop();");break;case "primitive":e.b(f,k,"not a valid drawing primitive");v(A.o,".push(",k[f],");");M(A.o,".pop();");break;case "elements":d=u.qb(f);f=!("primitive"in
b);a=!("count"in b);d?(d=n(d),v(P,".push(",d,");"),f&&v(A.o,".push(",d,".primType);"),a&&v(A.count,".push(",d,".vertCount);")):(v(P,".push(null);"),f&&v(A.o,".push(",4,");"),a&&v(A.count,".push(0);"));f&&M(A.o,".pop();");a&&M(A.count,".pop();");"offset"in b||(v(A.offset,".push(0);"),M(A.offset,".pop();"));M(P,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":e.type(f,
"boolean",a);J(a,f);break;case "depth.func":e.b(f,z,a);J(a,z[f]);break;case "depth.range":e(Array.isArray(f)&&2===f.length&&f[0]<=f[1],"depth range is 2d array");a=t(a);v(a,".push(",f[0],",",f[1],");");M(a,".pop();");break;case "blend.func":a=t(a);e.type(f,"object","blend func must be an object");var d="srcRGB"in f?f.Jc:f.src,H="srcAlpha"in f?f.Ic:f.src,h="dstRGB"in f?f.bc:f.ib,f="dstAlpha"in f?f.ac:f.ib;e.b(d,B);e.b(H,B);e.b(h,B);e.b(f,B);v(a,".push(",B[d],",",B[h],",",B[H],",",B[f],");");M(a,".pop();");
break;case "blend.equation":a=t(a);"string"===typeof f?(e.b(f,V,"invalid blend equation"),v(a,".push(",V[f],",",V[f],");")):"object"===typeof f?(e.b(f.Ib,V,"invalid blend equation rgb"),e.b(f.alpha,V,"invalid blend equation alpha"),v(a,".push(",V[f.Ib],",",V[f.alpha],");")):e.h("invalid blend equation");M(a,".pop();");break;case "blend.color":e(Array.isArray(f)&&4===f.length,"blend color is a 4d array");a=t(a);v(a,".push(",f[0],",",f[1],",",f[2],",",f[3],");");M(a,".pop();");break;case "stencil.mask":e.type(f,
"number","stencil mask must be an integer");a=t(a);v(a,".push(",f,");");M(a,".pop();");break;case "stencil.func":e.type(f,"object","stencil func must be an object");d=f.Rb||"keep";H=f.Fc||0;f="mask"in f?f.pc:-1;e.b(d,z,"invalid stencil func cmp");e.type(H,"number","stencil func ref");e.type(f,"number","stencil func mask");a=t(a);v(a,".push(",z[d],",",H,",",f,");");M(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":e.type(f,"object",a);d=f.fc||"keep";H=f.Xc||"keep";f=f.Bc||"keep";e.b(d,
y,a);e.b(H,y,a);e.b(f,y,a);a=t(a);v(a,".push(",y[d],",",y[H],",",y[f],");");M(a,".pop();");break;case "polygonOffset.offset":e.type(f,"object",a);d=f.ec||0;f=f.units||0;e.type(d,"number","offset.factor");e.type(f,"number","offset.units");a=t(a);v(a,".push(",d,",",f,");");M(a,".pop();");break;case "cull.face":d=0;"front"===f?d=1028:"back"===f&&(d=1029);e(!!d,"cull.face");f=t(a);v(f,".push(",d,");");M(f,".pop();");break;case "lineWidth":d=l.tb;e("number"===typeof f&&f>=d[0]&&f<=d[1],"invalid line width, must positive number between "+
d[0]+" and "+d[1]);J(a,f);break;case "frontFace":d=0;"cw"===f?d=2304:"ccw"===f&&(d=2305);e(!!d,"frontFace");f=t(a);v(f,".push(",d,");");M(f,".pop();");break;case "colorMask":e(Array.isArray(f)&&4===f.length,"color mask must be length 4 array");a=t(a);v(a,".push(",f.map(function(a){return!!a}).join(),");");M(a,".pop();");break;case "sample.coverage":e.type(f,"object",a);d="value"in f?f.value:1;f=!!f.mc;e("number"===typeof d&&0<=d&&1>=d,"sample value");a=t(a);v(a,".push(",d,",",f,");");M(a,".pop();");
break;case "viewport":case "scissor.box":e("object"===typeof f&&f,a+" is an object");var d=f.x||0,H=f.y||0,c=h=-1;e("number"===typeof d&&0<=d,a+".x must be a positive int");e("number"===typeof H&&0<=H,a+".y must be a positive int");"w"in f&&(h=f.O,e("number"===typeof h&&0<=h,a+".w must be a positive int"));"h"in f&&(c=f.lc,e("number"===typeof c&&0<=c,a+".h must be a positive int"));f=t(a);v(f,".push(",d,",",H,",",h,",",c,");");M(f,".pop();");break;default:e.h("unsupported parameter "+a)}});if(pa){if(b.nb&&
b.Kb)v(H,".push(",n(R.create(b.Kb,b.nb)),");");else{var C=v.g(I,"[",I,".length-1]"),oa=v.g(p,"[",p,".length-1]"),ua=n(R.create);v(H,".push(",ua,"(",oa,",",C,"));")}M(H,".pop();")}Object.keys(c).forEach(function(a){U.g(a);var f=n(U.s[a]),b;a=c[a];"function"===typeof a&&a.C?b=n(a):Array.isArray(a)?b=n(a.slice()):b=+a;v(f,".push(",b,");");M(f,".pop();")});Object.keys(m).forEach(function(a){ea.g(a);var f=n(ea.attributes[a]),b=m[a];if("number"===typeof b)v(f,".pushVec(",+b,",0,0,0);");else if(e(!!b,"invalid attribute: "+
a),Array.isArray(b))v(f,".pushVec(",[b[0]||0,b[1]||0,b[2]||0,b[3]||0],");");else{var d=g.na(b),p=0,l=0,H=0,h=0,k=!1,c=5126;d?c=d.K:(e.type(b,"object",'invalid attribute "'+a+'"'),d=g.na(b.buffer),p=b.size||0,l=b.m||0,H=b.offset||0,h=b.H||0,k=b.I||!1,e(!!d,"invalid attribute "+a+".buffer"),c=d.K,"type"in b&&(e.b(b.type,E,"attribute type"),c=E[b.type]));e(!!d,"invalid attribute "+a+".buffer");e.ba(l,a+".stride");e.ba(H,a+".offset");e.ba(h,a+".divisor");e.type(k,"boolean",a+".normalized");e.qa(p,[0,
1,2,3,4],a+".size");v(f,".pushPtr(",[n(d),p,H,l,h,k,c].join(),");")}M(f,".pop();")});var O=r.block(),W=r.block(),va,sa;D&&(va=n(ja),sa=v.g());var wa={};Object.keys(x).sort(d).forEach(function(a){var f=L(x[a]);switch(a){case "framebuffer":a=t("viewport");var d=t("scissor.box");O("if(",ia,".push(",f,"&&",f,"._framebuffer)){",a,".setDirty();",d,".setDirty();","}");W("if(",ia,".pop()){",a,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
t(a);O(a,".push(",f,");");W(a,".pop();");break;case "count":case "offset":case "instances":a=A[a];O(a,".push(",f,");");W(a,".pop();");break;case "primitive":a=A.o;O(a,".push(",ga,"[",f,"]);");W(a,".pop();");break;case "depth.func":a=t(a);O(a,".push(",Y,"[",f,"]);");W(a,".pop();");break;case "blend.func":a=t(a);d=n(B);O(a,".push(",d,'["srcRGB" in ',f,"?",f,".srcRGB:",f,".src],",d,'["dstRGB" in ',f,"?",f,".dstRGB:",f,".dst],",d,'["srcAlpha" in ',f,"?",f,".srcAlpha:",f,".src],",d,'["dstAlpha" in ',f,
"?",f,".dstAlpha:",f,".dst]);");W(a,".pop();");break;case "blend.equation":a=t(a);d=n(V);O("if(typeof ",f,'==="string"){',a,".push(",d,"[",f,"],",d,"[",f,"]);","}else{",a,".push(",d,"[",f,".rgb],",d,"[",f,".alpha]);","}");W(a,".pop();");break;case "blend.color":a=t(a);O(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");W(a,".pop();");break;case "stencil.mask":a=t(a);O(a,".push(",f,");");W(a,".pop();");break;case "stencil.func":a=t(a);O(a,".push(",Y,"[",f,".cmp],",f,".ref|0,",'"mask" in ',f,"?",f,".mask:-1);");
W(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=t(a);O(a,".push(",ra,"[",f,'.fail||"keep"],',ra,"[",f,'.zfail||"keep"],',ra,"[",f,'.pass||"keep"]);');W(a,".pop();");break;case "polygonOffset.offset":a=t(a);O(a,".push(",f,".factor||0,",f,".units||0);");W(a,".pop();");break;case "cull.face":a=t(a);O(a,".push(",f,'==="front"?',1028,":",1029,");");W(a,".pop();");break;case "frontFace":a=t(a);O(a,".push(",f,'==="cw"?',2304,":",2305,");");W(a,".pop();");break;case "colorMask":a=t(a);
O(a,".push(",f,"[0],",f,"[1],",f,"[2],",f,"[3]);");W(a,".pop();");break;case "sample.coverage":a=t(a);O(a,".push(",f,".value,",f,".invert);");W(a,".pop();");break;case "scissor.box":case "viewport":a=t(a);O(a,".push(",f,".x||0,",f,".y||0,",'"w" in ',f,"?",f,".w:-1,",'"h" in ',f,"?",f,".h:-1);");W(a,".pop();");break;case "elements":a=!("primitive"in x)&&!("primitive"in b);var d=!("count"in x)&&!("count"in b),p=!("offset"in x)&&!("offset"in b),l=O.g();O("if(",f,"){",l,"=",f,"._elements;",P,".push(",
l,");",a?A.o+".push("+l+".primType);":"",d?A.count+".push("+l+".vertCount);":"",p?A.offset+".push("+l+".offset);":"","}else{",P,".push(null);","}");W(P,".pop();","if(",f,"){",a?A.o+".pop();":"",d?A.count+".pop();":"",p?A.offset+".pop();":"","}");break;default:e.h("unsupported dynamic option: "+a)}});Object.keys(q).forEach(function(a){U.g(a);var f=n(U.s[a]);a=L(q[a]);O(f,".push(",a,");");W(f,".pop();")});Object.keys(K).forEach(function(a){ea.g(a);var f=n(ea.attributes[a]);a=L(K[a]);O(f,".pushDyn(",
a,");");W(f,".pop();")});C=T("scope");oa=C.T();ua=C.T();C(v);D&&C(sa,"=",oa,";",O);C(ua,"();",D?W:"",M);C=T("draw");C(v);D&&C(sa,"=",C.T(),";",O);oa=a(H);C(f,"();","if(",oa,")",oa,".draw(",D?sa:"",");",D?W:"",M);var qa=T("batch");qa(v);D=qa.g(a(H));T=n(function(a,f,d){var p=a.Ba[Z];p||(p=a.Ba[Z]=X(a,x,q,K,b));return p(f,d)});qa("if(",D,"){",f,"();",T,"(",D,",",qa.T(),",",qa.T(),");");Object.keys(x).forEach(function(a){(a=N[a])&&qa(a,".setDirty();")});qa("}",M);return r.compile()}}}},{"./check":3,
"./codegen":5,"./constants/dtypes.json":8,"./constants/primitives.json":9}],7:[function(c,g){g.a={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],8:[function(c,g){g.a={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],9:[function(c,
g){g.a={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],10:[function(c,g){function b(a,b){function h(){var b=window.innerWidth,e=window.innerHeight;a!==document.body&&(e=a.getBoundingClientRect(),b=e.right-e.left,e=e.top-e.bottom);k.width=g*b;k.height=g*e;Object.assign(k.style,{width:b+"px",height:e+"px"})}var k=document.createElement("canvas"),c=q(k,b);Object.assign(k.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(k);a===document.body&&
(k.style.position="absolute",Object.assign(a.style,{margin:0,padding:0}));var g=+c.options.sa;window.addEventListener("resize",h,!1);var z=c.options.Ha;c.options=Object.assign({},c.options,{Ha:function(){window.removeEventListener("resize",h);a.removeChild(k);z&&z()}});h();return c}function q(b,e){function h(a){try{return b.getContext(a,k)}catch(e){return null}}var k=e.jc||{},c=h("webgl")||h("experimental-webgl")||h("webgl-experimental");a(c,"webgl not supported");return{Fa:c,options:Object.assign({sa:window.devicePixelRatio},
e)}}var a=c("./check");g.a=function(a){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{Fa:a[0],options:a[1]||{}};var e=document.body,h=a[1]||{};if("string"===typeof a[0])e=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)e=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{Fa:a[0],options:Object.assign({sa:1},h)};h=a[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?q(e,h):b(e,h)}},{"./check":3}],11:[function(c,
g){g.a=function(){return{o:[4],count:[0],offset:[0],W:[0]}}},{}],12:[function(c,g){function b(b,e){this.id=a++;this.Ra=b;this.data=e}function q(a){switch(typeof a){case "boolean":case "number":case "string":return new b(!1,a);case "function":return new b(!0,a);default:return q}}var a=0;g.a={hb:q,sb:function(a){return"function"===typeof a&&!a.C||a instanceof b},Jb:function(a,e){return a instanceof b?a:"function"===typeof a&&a!==q?new b(!0,a):new b(!1,e)}}},{}],13:[function(c,g){var b=c("./check"),
q=c("./is-typed-array"),a=c("./is-ndarray"),d=c("./constants/primitives.json");g.a=function(e,h,c){function g(){this.buffer=null;this.Db=4;this.type=this.bb=0}g.prototype.bind=function(){this.buffer.bind()};return{create:function(e){function z(e){var l=h.yc;if(e)if("number"===typeof e)x(e);else{var c=null,k="static",g=0;Array.isArray(e)||q(e)||a(e)?c=e:(b.type(e,"object","invalid arguments for elements"),"data"in e&&(c=e.data),"usage"in e&&(k=e.usage),"length"in e&&(g=e.length));Array.isArray(c)||
a(c)&&"array"===c.K||"type"in e?x({type:e.type||(l?"uint32":"uint16"),usage:k,data:c,length:g}):x({usage:k,data:c,length:g});if(Array.isArray(c)||q(c))x.la=3}else x();c=y.buffer.byteLength;k=0;switch(y.buffer.K){case 5121:case 5120:k=5121;break;case 5123:case 5122:k=5123;c>>=1;break;case 5125:case 5124:b(l,"32 bit element buffers not supported");k=5125;c>>=2;break;default:b.h("invalid element buffer type")}l=4;g=y.buffer.la;1===g&&(l=0);2===g&&(l=1);3===g&&(l=4);"object"===typeof e&&("primitive"in
e&&(l=e.o,b.b(l,d),l=d[l]),"count"in e&&(c=e.bb|0));y.Db=l;y.bb=c;y.type=k;return z}var y=new g,x=c.create(null,34963,!0);y.buffer=x.Aa;z(e);Object.assign(z,{C:"elements",La:y,G:function(){b(null!==y.buffer,"must not double destroy elements");x.G();y.buffer=null}});return z},elements:[null],qb:function(a){return a&&a.La instanceof g?a.La:null}}}},{"./check":3,"./constants/primitives.json":9,"./is-ndarray":16,"./is-typed-array":17}],14:[function(c,g){g.a=function(b){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(d){try{a[d]=
b.getExtension(d)}catch(e){}})}var a={};c();return{Qa:a,refresh:c}}},{}],15:[function(c,g){var b=c("./check"),q=c("./values"),a=[1029];g.a=function(d,e,c,k,g){function B(a,b,d,e){this.target=a;this.level=b;this.c=d;this.i=e}function z(a){a&&(a.c&&a.c.w.aa(),a.i&&a.i.D.aa())}function y(a,d,e){a.c?b.qa(a.c.w.B.l,d,"unsupported texture format for attachment"):b.qa(a.i.D.format,e,"unsupported renderbuffer format for attachment")}function x(a,d){var e=d.width,l=d.height;if(a.c){var c=a.c.w,k=Math.max(1,
c.B.width>>a.level),h=Math.max(1,c.B.height>>a.level),e=e||k,l=l||h;b(k===e&&h===l,"inconsistent width/height for supplied texture");b(0>c.ta,"polling fbo textures not supported");c.j+=1}else c=a.i.D,e=e||c.width,l=l||c.height,b(c.width===e&&c.height===l,"inconsistent width/height for renderbuffer"),b(0<=ka.indexOf(c.format),"renderbuffer format not compatible with color channels"),c.j+=1;d.width=e;d.height=l}function m(a,b){b?b.c?d.framebufferTexture2D(36160,a,b.target,b.c.w.c,b.level):d.framebufferRenderbuffer(36160,
a,36161,b.i.D.i):d.framebufferTexture2D(36160,a,3553,null,0)}function l(a){var d=3553,e=0,c=null,l=null,k=a;"object"===typeof a&&(k=a.data,"level"in a&&(e=a.level|0),"target"in a&&(d=a.target|0));b.type(k,"function","invalid attachment data");k=a.C;"texture"===k?(c=a,34067===c.w.target?b(34069<=d&&34075>d,"invalid cube map target"):b(3553===d)):"renderbuffer"===k?(l=a,d=36161,e=0):b.h("invalid regl object for attachment");return new B(d,e,c,l)}function F(a){return a&&(a.c||a.i)}function u(){this.id=
la++;ca[this.id]=this;this.V=null;this.height=this.width=0;this.$=[];this.ka=this.xa=this.ja=null;this.Ia=this.Xa=!1}function K(a){d.isFramebuffer(a.V)||(a.V=d.createFramebuffer());t=!0;d.bindFramebuffer(36160,a.V);for(var l=a.$,k=0;k<l.length;++k)m(36064+k,l[k]);for(k=l.length;k<c.wb;++k)m(36064+k,null);m(36096,a.ja);m(36128,a.xa);m(33306,a.ka);e.za&&e.za.drawBuffersWEBGL(ha[l.length]);a=d.checkFramebufferStatus(36160);36053!==a&&b.h("framebuffer configuration not supported, status = "+U[a])}function aa(a){a=
a.V;b(a,"must not double destroy framebuffer");d.isFramebuffer(a)&&d.deleteFramebuffer(a)}function D(){return S[S.length-1]}var U={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ea={rgba:6408},R={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.Pa&&(R.srgba=35907);e.kb&&(R.rgba16f=34842,R.rgb16f=34843);e.Nb&&(R.rgba32f=34836);var ba=[33189],ja=[36168],ma=[34041],X=[],G=[],V=[];e.Ka&&(X.push(6402),V.push(34041));var da=
Object.assign({},ea,R),Q=q(ea),ka=q(R),R=5121,fa={uint8:5121};e.Wa&&(R=fa["half float"]=36193);e.Va&&(R=fa.mb=5126);fa.Qb=R;var ha=function(){for(var a=Array(c.Ta),b=0;b<=c.Ta;++b)for(var d=a[b]=Array(b),e=0;e<b;++e)d[e]=36064+e;return a}(),la=0,ca={},S=[null],t=!0;return{top:D,$b:function(){return t},push:function(a){a=a||null;t=t||a!==D();S.push(a);return t},pop:function(){var a=D();S.pop();return t=t||a!==D()},rb:function(a){return"function"===typeof a&&"framebuffer"===a.C&&(a=a.Ma,a instanceof
u)?a:null},M:function(){if(t){var b=S[S.length-1],l=e.za;b?(d.bindFramebuffer(36160,b.V),l&&l.drawBuffersWEBGL(ha[b.$.length])):(d.bindFramebuffer(36160,null),l&&l.drawBuffersWEBGL(a));t=!1}},create:function(a){function c(a){var q,m=a||{};q=e.za;var u=0,f=0;"shape"in m?(a=m.shape,b(Array.isArray(a)&&2<=a.length,"invalid shape for framebuffer"),u=a[0],f=a[1]):("radius"in m&&(u=f=m.Za),"width"in m&&(u=m.width),"height"in m&&(f=m.height));var I=null;a=!1;if("colorBuffers"in m||"colorBuffer"in m){I=m.Ub||
m.Tb;Array.isArray(I)||(I=[I]);h.width=u;h.height=f;1<I.length&&b(q,"multiple render targets not supported");b(0<=I.length,"must specify at least one color attachment");I=I.map(l);for(q=0;q<I.length;++q)u=I[q],y(u,Q,ka),x(u,h);u=h.width;f=h.height}else{var p=!0,H="rgba",ia="uint8",A=1;a=!0;h.width=u||d.drawingBufferWidth;h.height=f||d.drawingBufferHeight;"format"in m&&(H=m.format,b.b(H,da,"invalid color format"),p=H in ea);"type"in m&&(b(p,"colorType can not be set for renderbuffer targets"),ia=m.type,
b.b(ia,fa,"invalid color type"));"colorCount"in m&&(A=m.Vb|0,b(0<=A,"color count must be positive"));if(h.Xa)for(I=h.$;I.length>A;)z(I.pop());else I=[];for(q=0;q<I.length;++q){var P;a:{P=I[q];var ga=p,Y=H,D=u,N=f;if(P.c){var v=P.c;if(ga){v({format:Y,type:ia,width:D,height:N});v.w.j+=1;P=!0;break a}}else if(v=P.i,!ga){v({format:Y,width:D,height:N});v.D.j+=1;P=!0;break a}z(P);P=!1}P||(I[q--]=I[I.length-1],I.pop())}for(;I.length<A;)p?I.push(new B(3553,0,k.create({format:H,type:ia,width:u,height:f},3553),
null)):I.push(new B(36161,0,null,g.create({format:H,width:u,height:f})))}b(0<I.length,"must specify at least one color buffer");h.width=u;h.height=f;H=p=q=null;ia=!1;A=0;"depthBuffer"in m&&(q=l(m.Xb),y(q,X,ba),A+=1);"stencilBuffer"in m&&(p=l(m.Oc),y(p,G,ja),A+=1);"depthStencilBuffer"in m&&(H=l(m.Yb),y(H,V,ma),A+=1);if(q||p||H)b(1===A,"can specify only one of depth, stencil or depthStencil attachment"),x(q||p||H,h);else if(A=!0,ga=P=!1,"depth"in m&&(A=!!m.depth),"stencil"in m&&(P=!!m.stencil),"depthTexture"in
m&&(ga=!!m.Zb),m=h.ja||h.xa||h.ka,Y=null,A||P)ia=!0,ga?(b(e.Ka,"depth texture extension not supported"),b(A,"stencil only textures not supported"),ga=P?"depth stencil":"depth",h.Ia&&m.c?(m.c({format:ga,width:u,height:f}),m.c.w.j+=1,Y=m):Y=new B(3553,0,k.create({format:ga,width:u,height:f},3553),null)):(ga=A?P?"depth stencil":"depth":"stencil",h.Ia&&m.i?(m.i({format:ga,width:u,height:f}),m.i.D.j+=1,Y=m):Y=new B(36161,0,null,g.create({format:ga,width:u,height:f}))),A?P?H=Y:q=Y:p=Y;u=h;u.$.forEach(z);
z(u.ja);z(u.xa);z(u.ka);h.$=I;h.ja=q;h.xa=p;h.ka=H;h.Xa=a;h.Ia=ia;c.color=I.map(F);c.depth=F(q);c.stencil=F(p);c.Ob=F(H);K(h);c.width=h.width;c.height=h.height;return c}var h=new u;c(a);Object.assign(c,{C:"framebuffer",Ma:h,G:function(){aa(h)}});return c},clear:function(){q(ca).forEach(aa)},refresh:function(){q(ca).forEach(K)}}}},{"./check":3,"./values":30}],16:[function(c,g){var b=c("./is-typed-array");g.a=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.m)&&"number"===
typeof c.offset&&c.shape.length===c.m.length&&(Array.isArray(c.data)||b(c.data))}},{"./is-typed-array":17}],17:[function(c,g){var b=c("./constants/arraytypes.json");g.a=function(c){return Object.prototype.toString.call(c)in b}},{"./constants/arraytypes.json":7}],18:[function(c,g){g.a=function(b,c){var a=1;c.lb&&(a=b.getParameter(34047));var d=1,e=1;c.za&&(d=b.getParameter(34852),e=b.getParameter(36063));return{Sb:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],
Wb:b.getParameter(3414),Nc:b.getParameter(3415),Pc:b.getParameter(3408),Qa:Object.keys(c).filter(function(a){return!!c[a]}),ub:a,Ta:d,wb:e,Cc:b.getParameter(33901),tb:b.getParameter(33902),xc:b.getParameter(3386),qc:b.getParameter(35661),rc:b.getParameter(34076),xb:b.getParameter(34024),yb:b.getParameter(34930),tc:b.getParameter(3379),vb:b.getParameter(34921),wc:b.getParameter(36347),vc:b.getParameter(35660),uc:b.getParameter(36348),sc:b.getParameter(36349),kc:b.getParameter(35724),Hc:b.getParameter(7937),
vendor:b.getParameter(7936),version:b.getParameter(7938)}}},{}],19:[function(c,g){g.a=function(b,c){if("undefined"!==typeof document){var a;a=(a=/\.(\w+)(\?.*)?$/.exec(b))&&a[1]?a[1].toLowerCase():void 0;0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(a)?(a=document.createElement("video"),a.autoplay=!0,a.loop=!0,c&&(a.crossOrigin=c),a.src=b):0<=["dds"].indexOf(a)?(a=new XMLHttpRequest,a.responseType="arraybuffer",a.open("GET",b,!0),a.send()):(a=new Image,
c&&(a.crossOrigin=c),a.src=b);return a}return null}},{}],20:[function(c,g){var b=c("./check");g.a=function(c){function g(a){for(var b=fa,d=ha,e=0;e<J;++e){var f=Math.max(1,b+3>>2)*Math.max(1,d+3>>2)*S;r.J.push({target:a,u:e,width:b,height:d,data:new Uint8Array(c,L,f)});L+=f;b>>=1;d>>=1}}var Q=new Int32Array(c);b(Q[0]===q,"invalid magic number for dds header");var ka=Q[ea];b(ka&l,"unsupported dds format");var fa=Q[ba],ha=Q[R],la=z,ca=0,S=0,t=4;switch(Q[X]){case u:S=8;ka&F?(t=3,ca=e):ca=h;break;case K:S=
16;ca=k;break;case aa:S=16;ca=E;break;case D:S=8;ca=B;break;default:b.h("unsupported dds texture format")}var J=1;Q[ma]&y&&(J=Math.max(1,Q[ja]));var L=Q[U]+4,r={width:fa,height:ha,f:t,format:ca,type:la,F:!0,ia:!1,J:[]},Q=Q[G];if(Q&x)for(b((Q&m)===m,"missing cubemap faces"),r.ia=!0,Q=0;6>Q;++Q)g(d+Q);else g(a);return r};var q=542327876,a=3553,d=34069,e=33776,h=33777,k=33778,E=33779,B=36196,z=5121,y=131072,x=512,m=64512,l=4,F=64,u=827611204,K=861165636,aa=894720068,D=826496069,U=1,ea=2,R=3,ba=4,ja=
7,ma=20,X=21,G=28},{"./check":3}],21:[function(c,g){"function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?g.a={next:function(b){return requestAnimationFrame(b)},cancel:function(b){return cancelAnimationFrame(b)}}:g.a={next:function(b){setTimeout(b,30)},cancel:clearTimeout}},{}],22:[function(c,g){var b=c("./check"),q=c("./is-typed-array");g.a=function(a,d,c){return function(h){var k=h||{};q(h)?k={data:k}:2===arguments.length?k={width:arguments[0]|0,height:arguments[1]|
0}:"object"!==typeof h&&(k={});d();var g=k.x||0,B=k.y||0,z=k.width||c.width,y=k.height||c.height,x=z*y*4,k=k.data||new Uint8Array(x);b.Sa(k);b(k.byteLength>=x,"data buffer too small");a.pixelStorei(3333,4);a.readPixels(g,B,z,y,6408,5121,k);return k}}},{"./check":3,"./is-typed-array":17}],23:[function(c,g){var b=c("./check"),q=c("./values");g.a=function(a,d,c){function h(){this.id=z++;this.j=1;this.i=null;this.format=32854;this.height=this.width=0}function k(b){a.isRenderbuffer(b.i)||(b.i=a.createRenderbuffer());
a.bindRenderbuffer(36161,b.i);a.renderbufferStorage(36161,b.format,b.width,b.height)}function g(d){var c=d.i;b(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.isRenderbuffer(c)&&a.deleteRenderbuffer(c);d.i=null;d.j=0;delete y[d.id]}var B={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};d.Pa&&(B.srgba=35907);d.kb&&(B.rgba16f=34842,B.rgb16f=34843);d.Nb&&(B.rgba32f=34836);var z=0,y={};h.prototype.aa=function(){0===--this.j&&g(this)};
return{create:function(a){function d(a){a=a||{};var h=0,g=0;"shape"in a?(g=a.shape,b(Array.isArray(g)&&2<=g.length,"invalid renderbuffer shape"),h=g[0]|0,g=g[1]|0):("radius"in a&&(h=g=a.Za|0),"width"in a&&(h=a.width|0),"height"in a&&(g=a.height|0));var q=c.xb;b(0<=h&&0<=g&&h<=q&&g<=q,"invalid renderbuffer size");d.width=l.width=Math.max(h,1);d.height=l.height=Math.max(g,1);l.format=32854;"format"in a&&(a=a.format,b.b(a,B,"invalid render buffer format"),l.format=B[a]);k(l);return d}var l=new h;y[l.id]=
l;d(a);Object.assign(d,{C:"renderbuffer",D:l,G:function(){l.aa()}});return d},refresh:function(){q(y).forEach(k)},clear:function(){q(y).forEach(g)}}}},{"./check":3,"./values":30}],24:[function(c,g){function b(a,b,c){this.name=a;this.location=b;this.info=c}var q=c("./check");g.a=function(a,d,c,h){function k(b,d){var c=m[b],e=c[d];e||(e=a.createShader(b),a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)||q.h("Error compiling shader:\n"+a.getShaderInfoLog(e)),c[d]=e);return e}
function g(){Object.keys(m).forEach(function(b){Object.keys(m[b]).forEach(function(d){a.deleteShader(m[b][d])})});m[35632]={};m[35633]={}}function B(a,b){this.pb=a;this.Mb=b;this.va=null;this.s=[];this.attributes=[];this.U=function(){};this.Ba={}}function z(){F.forEach(function(a){a.G()});F.length=0;l={}}function y(){F.forEach(function(a){a.link()})}function x(){g();z()}var m={},l={},F=[];Object.assign(B.prototype,{link:function(){var l,g;l=k(a.FRAGMENT_SHADER,this.pb);g=k(a.VERTEX_SHADER,this.Mb);
var m=this.va=a.createProgram();a.attachShader(m,l);a.attachShader(m,g);a.linkProgram(m);a.getProgramParameter(m,a.LINK_STATUS)||q.h("Error linking program:\n"+a.getProgramInfoLog(m));var x=a.getProgramParameter(m,a.ACTIVE_UNIFORMS),F=this.s=[];for(l=0;l<x;++l)if(g=a.getActiveUniform(m,l))if(1<g.size)for(var y=0;y<g.size;++y){var E=g.name.replace("[0]","["+y+"]");F.push(new b(E,a.getUniformLocation(m,E),g));c.g(E)}else F.push(new b(g.name,a.getUniformLocation(m,g.name),g)),c.g(g.name);x=a.getProgramParameter(m,
a.ACTIVE_ATTRIBUTES);F=this.attributes=[];for(l=0;l<x;++l)if(g=a.getActiveAttrib(m,l))F.push(new b(g.name,a.getAttribLocation(m,g.name),g)),d.g(g.name);this.U=h(this);this.Ba={}},G:function(){a.deleteProgram(this.va)}});x();return{create:function(a,b){var d=l[b];d||(d=l[b]={});var c=d[a];c||(c=new B(b,a),c.link(),d[a]=c,F.push(c));return c},clear:x,refresh:function(){m[35632]={};m[35633]={};y()},Eb:[null],ob:["void main(){gl_FragColor=vec4(0,0,0,0);}"],Lb:["void main(){gl_Position=vec4(0,0,0,0);}"]}}},
{"./check":3}],25:[function(c,g){g.a=function(b,c){var a=b.length,d=b.slice(),e=b.slice(),h=!0;return{push:function(){h=!1;for(var b=0;b<a;++b){var c=arguments[b];h=h||c!==e[b];d.push(c)}},pop:function(){h=!1;for(var b=0;b<a;++b)h=h||d[d.length-a+b]!==e[b];d.length-=a},M:function(){var b=d.length-a;if(h){switch(a){case 1:c(d[b]);break;case 2:c(d[b],d[b+1]);break;case 3:c(d[b],d[b+1],d[b+2]);break;case 4:c(d[b],d[b+1],d[b+2],d[b+3]);break;case 5:c(d[b],d[b+1],d[b+2],d[b+3],d[b+4]);break;case 6:c(d[b],
d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]);break;default:c.apply(null,d.slice(b,d.length))}for(var g=0;g<a;++g)e[g]=d[b+g];h=!1}},$a:function(){h=!0}}}},{}],26:[function(c,g){var b=c("./stack"),q=c("./codegen");g.a=function(a,c,e){function h(c,d){var e=b([!!d],function(b){b?a.enable(c):a.disable(c)});e.gc=c;return e}var g={dither:h(3024),"blend.enable":h(3042),"blend.color":b([0,0,0,0],function(b,c,d,e){a.blendColor(b,c,d,e)}),"blend.equation":b([32774,32774],function(b,c){a.blendEquationSeparate(b,c)}),
"blend.func":b([1,0,1,0],function(b,c,d,e){a.blendFuncSeparate(b,c,d,e)}),"depth.enable":h(2929,!0),"depth.func":b([513],function(b){a.depthFunc(b)}),"depth.range":b([0,1],function(b,c){a.depthRange(b,c)}),"depth.mask":b([!0],function(b){a.depthMask(b)}),"cull.enable":h(2884),"cull.face":b([1029],function(b){a.cullFace(b)}),frontFace:b([2305],function(b){a.frontFace(b)}),colorMask:b([!0,!0,!0,!0],function(b,c,d,e){a.colorMask(b,c,d,e)}),lineWidth:b([1],function(b){a.lineWidth(b)}),"polygonOffset.enable":h(32823),
"polygonOffset.offset":b([0,0],function(b,c){a.polygonOffset(b,c)}),"sample.alpha":h(32926),"sample.enable":h(32928),"sample.coverage":b([1,!1],function(b,c){a.sampleCoverage(b,c)}),"stencil.enable":h(2960),"stencil.mask":b([-1],function(b){a.stencilMask(b)}),"stencil.func":b([519,0,-1],function(b,c,d){a.stencilFunc(b,c,d)}),"stencil.opFront":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1028,b,c,d)}),"stencil.opBack":b([7680,7680,7680],function(b,c,d){a.stencilOpSeparate(1029,b,c,d)}),"scissor.enable":h(3089),
"scissor.box":b([0,0,-1,-1],function(b,e,l,h){var g=l,k=c.top();0>l&&(g=k?k.width-b:a.drawingBufferWidth-b);l=h;0>h&&(l=k?k.height-e:a.drawingBufferHeight-e);a.scissor(b,e,g,l)}),viewport:b([0,0,-1,-1],function(b,h,l,g){var k=l,q=c.top();0>l&&(k=q?q.width-b:a.drawingBufferWidth-b);l=g;0>g&&(l=q?q.height-h:a.drawingBufferHeight-h);a.viewport(b,h,k,l);e.width=k;e.height=l})},E=q(),B=E.ca("poll"),z=E.ca("refresh");Object.keys(g).forEach(function(a){a=E.link(g[a]);B(a,".poll();");z(a,".setDirty();")});
var y=E.compile();return{gb:g,viewport:e,M:y.M,refresh:y.refresh,Ab:function(){g.viewport.$a();g["scissor.box"].$a()}}}},{"./codegen":5,"./stack":25}],27:[function(c,g){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function q(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function a(a){return Object.prototype.toString.call(a)}function d(b){return"[object HTMLCanvasElement]"===
a(b)}function e(b){return"[object CanvasRenderingContext2D]"===a(b)}var h=c("./check"),k=c("./values"),E=c("./is-typed-array"),B=c("./is-ndarray"),z=c("./load-texture"),y=c("./to-half-float"),x=c("./parse-dds"),m=[9984,9986,9985,9987];g.a=function(c,g,u,K,aa){function D(a){this.target=a;this.ua=this.ma=!1;this.ab=1;this.ga=37444;this.type=this.l=this.format=this.f=this.height=this.width=0;this.F=!1;this.y=this.x=this.offset=this.N=this.ya=this.da=this.u=0;this.ha=!1;this.crossOrigin=this.S=this.canvas=
this.video=this.A=this.data=null;this.Y=this.oa=!1}function U(a){this.target=a;this.type=this.l=this.format=this.height=this.width=0;this.R=this.P=33071;this.X=0;this.Ga=9728;this.ea=1;this.L=!1;this.Ua=4352}function ea(a,b){var c,d,e=0,l=0,k=0,n=0,q=0,y=0,N=!1,v=!1,t=!1,r=0,x=[0,0,0,0,0,0],z=0,u=!1;for(c=0;c<b.length;++c){d=b[c];var n=n||d.width<<d.u,q=q||d.height<<d.u,e=e||d.type,l=l||d.format,k=k||d.l,y=y||d.f,v=v||d.oa,t=t||d.Y,N=N||d.F,B=d.u;d=d.target;u=u||0<B;3553===d?r|=1<<B:(d=d-34069,x[d]|=
1<<B,z|=1<<d)}a.oa=v;a.Y=t;a.width=n;a.height=q;a.format=l;a.l=k;a.type=e;v=u?(n<<1)-1:1;if(3553===a.target)h(0===z,"pixmap type must not contain cubemap faces"),h(r===v,"missing mip map data");else for(h(63===z,"missing cubemap faces"),c=0;6>c;++c)h(x[c]===v,"missing mip map data");c=0<=m.indexOf(a.X);a.L=!u&&(a.L||c);u=u||a.L;a.X?h(u===c,"min filter inconsistent with mipmap data"):a.X=u?9987:9728;u&&h(n===q&&!(n&n-1)&&!!n,"must be a square power of 2 to support mipmaps");a.L&&h(!N,"mipmap generation not supported for compressed textures");
a.P=a.P||33071;a.R=a.R||33071;33071===a.P&&33071===a.R||h(!(n&n-1)&&!!n&&!(q&q-1)&&!!q&&!z,"incompatible size for wrap mode, image must be a power of 2");(5126===e&&!g.zc||36193===e&&!g.Ac)&&h(9728===this.Ga&&9728===this.X,"unsupported filter mode for float texture");for(c=0;c<b.length;++c)d=b[c],N=d.u,d.width&&h(d.width<<N===n,"inconsistent width"),d.height&&h(d.height<<N===q,"inconsistent width"),d.f?h(d.f===y,"inconsistent channels"):d.f=y,d.format?h(d.format===l,"inconsistent format"):d.format=
l,d.l?h(d.l===k,"inconsistent internalformat"):d.l=k,d.type?h(d.type===e,"inconsistent type"):d.type=e,d.ha&&h(5121===d.type&&6408===d.l,"incompatible format/type for copyTexImage2D")}function R(a){this.id=r++;this.j=1;this.target=a;this.c=null;this.Z=this.ta=-1;this.fa=0;this.Da=null;this.B=new U(a);this.J=[]}function ba(a,b){function c(a,f){var d=f.zb,e;if(Array.isArray(d))for(var h=0;h<d.length;++h)e=new D(a),e.ra(b),e.ra(f),e.parse(d[h],h),g.push(e);else e=new D(a),e.ra(b),e.parse(f,0),g.push(e)}
var d;X(a);var e=a.B;U.call(e,a.target);var g=a.J;g.length=0;e.parse(b);if(3553===a.target)c(3553,b);else{var l=b.dc||b;if(Array.isArray(l))for(h(6===l.length,"invalid number of faces in cube map"),d=0;6>d;++d)c(34069+d,l[d]);else if("string"!==typeof l)for(d=0;6>d;++d)c(34069+d,{})}ea(e,g);e.Y&&ma(a);e.oa&&(a.ta=C.length,C.push(a));ja(a)}function ja(a){c.isTexture(a.c)||(a.c=c.createTexture());var b=a.target,d=a.Z;0<=d?(c.activeTexture(33984+d),L=d):c.bindTexture(b,a.c);for(var b=a.J,e=a.B,g=0;g<
b.length;++g)b[g].upload(e);e.upload();0>d&&((d=Z[L])?c.bindTexture(d.target,d.c):(a.Z=L,Z[L]=a))}function ma(a){function b(c,d,g){var p=x(g);h(p.format in J,"unsupported dds texture format");p.ia?(h(34067===a.target),h.h("cube map DDS not yet implemented")):h(3553===a.target);d&&h(1===p.J.length,"number of mip levels inconsistent");p.J.forEach(function(a){var b=new D(p.ia?a.target:c);b.f=p.f;b.F=p.F;b.type=p.type;b.l=p.format;b.format=J[p.format];b.width=a.width;b.height=a.height;b.u=a.u||d;b.data=
a.data;e.push(b)})}function c(){for(var g=0;g<e.length;++g){var h=e[g],p=h.A,l=h.video,k=h.S;p&&p.complete?(h.width=p.naturalWidth,h.height=p.naturalHeight):l&&2<l.readyState?(h.width=l.width,h.height=l.height):k&&4===k.readyState&&(e[g]=e[e.length-1],e.pop(),k.removeEventListener("readystatechange",ja),b(h.target,h.u,k.response))}ea(d,e);ja(a)}var d=a.B,e=a.J;e.forEach(function(a){a.A&&!a.A.complete?a.A.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.S&&
a.S.addEventListener("readystatechange",c)});a.Da=function(){e.forEach(function(a){a.A?a.A.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",c):a.S&&(a.S.removeEventListener("readystatechange",c),a.S.abort())})}}function X(a){var b=a.Da;b&&(b(),a.Da=null);b=a.ta;0<=b&&((C[b]=C[C.length-1]).id=b,C.pop(),a.ta=-1)}function G(a){var b=a.c;h(b,"must not double destroy texture");var d=a.Z,e=a.target;0<=d&&(c.activeTexture(33984+d),L=d,c.bindTexture(e,null),Z[d]=null);X(a);c.isTexture(b)&&
c.deleteTexture(b);a.c=null;a.B=null;a.J=null;a.j=0;delete n[a.id]}var V={"don't care":4352,"dont care":4352,nice:4354,fast:4353},da={repeat:10497,clamp:33071,mirror:33648},Q={nearest:9728,linear:9729},ka=Object.assign({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},Q),fa={none:0,browser:37444},ha={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},la={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,
rgba4:32854,"rgb5 a1":32855,rgb565:36194},ca={};g.Pa&&(la.Kc=35904,la.Lc=35906);g.Va&&(ha.mb=5126);g.Wa&&(ha["half float"]=36193);g.Ka&&(Object.assign(la,{depth:6402,"depth stencil":34041}),Object.assign(ha,{uint16:5123,uint32:5125,"depth stencil":34042}));g.Vc&&Object.assign(ca,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.Sc&&Object.assign(ca,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.Uc&&Object.assign(ca,
{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.Tc&&(ca["rgb etc1"]=36196);var S=Array.prototype.slice.call(c.getParameter(34467));Object.keys(ca).forEach(function(a){var b=ca[a];0<=S.indexOf(b)&&(la[a]=b)});var t=Object.keys(la);u.Qc=t;var J=t.reduce(function(a,b){var c=la[b];a[c]=6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?c:32855===c||0<=b.indexOf("rgba")?6408:6407;return a},{});Object.assign(D.prototype,{ra:function(a){if("object"===
typeof a&&a){"premultiplyAlpha"in a&&(h.type(a.ua,"boolean","invalid premultiplyAlpha"),this.ua=a.ua);"flipY"in a&&(h.type(a.ma,"boolean","invalid texture flip"),this.ma=a.ma);"alignment"in a&&(h.qa(a.cb,[1,2,4,8],"invalid texture unpack alignment"),this.ab=a.cb);"colorSpace"in a&&(h.b(a.ga,fa,"invalid colorSpace"),this.ga=fa[a.ga]);if("format"in a){var b=a.format;h.b(b,la,"invalid texture format");this.l=la[b];b in ha&&(this.type=ha[b]);b in ca&&(this.F=!0)}"type"in a&&(b=a.type,h.b(b,ha,"invalid texture type"),
this.type=ha[b]);var b=this.width,c=this.height,d=this.f;"shape"in a?(h(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.Za),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.f));this.width=b|0;this.height=c|0;this.f=d|0;"stride"in a?(b=a.m,h(Array.isArray(b)&&2<=b.length,"invalid stride vector"),this.da=b[0],this.ya=b[1],3===b.length?this.N=b[2]:this.N=1,this.pa=!0):(this.N=
1,this.da=this.N*d,this.ya=this.da*b);"offset"in a&&(this.offset=a.offset|0,this.pa=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,l){this.u=l;this.width=this.width>>l;this.height=this.height>>l;var p=c;switch(typeof c){case "string":break;case "object":if(!c)return;this.ra(c);var k=c.data;if("string"===typeof k||k&&(E(k)||b(k)||B(k)||d(k)||e(k)||"[object HTMLImageElement]"===a(k)||"[object HTMLVideoElement]"===a(k)||q(k)))p=c.data;break;case "undefined":return;default:h.h("invalid pixel data type")}"string"===
typeof p&&(p=z(p,this.crossOrigin));var k=null,n=!1;this.F&&h(p instanceof Uint8Array||"[object XMLHttpRequest]"===a(p),"compressed texture data must be stored in a uint8array");if(null!==p)if(E(p))this.data=p;else if(b(p))k=p,n=!0;else if(B(p)){Array.isArray(p.data)?(k=p.data,n=!0):this.data=p.data;var m=p.shape;this.width=m[0];this.height=m[1];3===m.length?this.f=m[2]:this.f=1;m=p.m;this.da=p.m[0];this.ya=p.m[1];3===m.length?this.N=p.m[2]:this.N=1;this.offset=p.offset;this.pa=!0}else if(d(p)||e(p))d(p)?
this.canvas=p:this.canvas=p.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.wa();else if("[object HTMLImageElement]"===a(p))this.A=p,p.complete?(this.width=p.naturalWidth,this.height=p.naturalHeight):(this.width=this.width||p.naturalWidth,this.height=this.height||p.naturalHeight,this.Y=!0),this.wa();else if("[object HTMLVideoElement]"===a(p))this.video=p,1<p.readyState?(this.width=p.width,this.height=p.height):(this.width=this.width||p.width,this.height=this.height||p.height,
this.Y=!0),this.oa=!0,this.wa();else if("[object XMLHttpRequest]"===a(p))this.S=p,this.Y=!0;else if(q(p)){var n=p.length,m=p[0].length,t=1,r,u,x,N;if(Array.isArray(p[0][0]))for(t=p[0][0].length,h(0<=t&&4>=t,"invalid number of channels for image data"),k=Array(n*m*t),r=N=0;r<n;++r)for(u=0;u<m;++u)for(x=0;x<t;++x)k[N++]=p[r][u][x];else for(k=Array(n*m),r=N=0;r<n;++r)for(u=0;u<m;++u)k[N++]=p[r][u];this.width=n;this.height=m;this.f=t;n=!0}else c.ha&&(this.ha=!0,this.x=this.x|0,this.y=this.y|0,this.width=
(this.width||aa.width)|0,this.height=(this.height||aa.height)|0,this.wa());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.l||(this.l=[6409,6410,6407,6408][(this.f=this.f||4)-1],h(this.l,"invalid number of channels"));m=this.l;if(6402===m||34041===m)h(g.Ka,"depth/stencil texture not supported"),6402===m&&h(5123===this.type||5125,"depth texture type must be uint16 or uint32"),
34041===m&&h(34042===this.type,"depth stencil texture format must match type"),h(!this.data&&!k&&!this.A&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");p=this.format=J[m];if(!this.f)switch(p){case 6409:case 6406:case 6402:this.f=1;break;case 34041:case 6410:this.f=2;break;case 6407:this.f=3;break;default:this.f=4}p=this.type;5126===p?h(g.Va,"float texture not supported"):36193===p?h(g.Wa,"half float texture not supported"):p||(p=6402===m?5125:5121);this.type=p;if(n)switch(p){case 5121:this.data=
new Uint8Array(k);break;case 5123:this.data=new Uint16Array(k);break;case 5125:this.data=new Uint32Array(k);break;case 5126:this.data=new Float32Array(k);break;case 36193:this.data=y(k);break;case 33635:case 32820:case 32819:case 34042:h.h("unsupported format for automatic conversion");break;default:h.h("unsupported type conversion")}if(this.data){if(this.pa){k=this.data;n=this.width;m=this.height;t=this.f;r=this.da;u=this.ya;x=this.N;N=this.offset;for(var v=new k.constructor(n*m*t),M=0,C=0;C<m;++C)for(var D=
0;D<n;++D)for(var G=0;G<t;++G)v[M++]=k[u*C+r*D+x*G+N];this.data=v}switch(p){case 5121:h(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:h(this.data instanceof Uint16Array,"incompatible pixel type");break;case 5125:h(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:h(this.data instanceof Float32Array,"incompatible pixel type");break;default:h.h("bad or missing pixel type")}}this.pa=
!1},wa:function(){this.format=this.l=6408;this.type=5121;this.f=4;this.F=!1},upload:function(a){c.pixelStorei(37440,this.ma);c.pixelStorei(37441,this.ua);c.pixelStorei(37443,this.ga);c.pixelStorei(3317,this.ab);var b=this.target,d=this.u,e=this.A,g=this.canvas,h=this.video,k=this.data,n=this.l,m=this.format,q=this.type,r=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);h&&2<h.readyState?c.texImage2D(b,d,m,m,q,h):e&&e.complete?c.texImage2D(b,d,m,m,q,e):g?c.texImage2D(b,d,m,
m,q,g):this.F?c.compressedTexImage2D(b,d,n,r,a,0,k):this.ha?(K(),c.copyTexImage2D(b,d,m,this.x,this.y,r,a,0)):k?c.texImage2D(b,d,m,r,a,0,m,q,k):c.texImage2D(b,d,m,r||1,a||1,0,m,q,null)}});Object.assign(U.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var b=a.min;h.b(b,ka);this.X=ka[b]}"mag"in a&&(b=a.oc,h.b(b,Q),this.Ga=Q[b]);var b=this.P,c=this.R;if("wrap"in a){var d=a.Wc;"string"===typeof d?(h.b(d,da),b=c=da[d]):Array.isArray(d)&&(h.b(d[0],da),h.b(d[1],da),b=da[d[0]],c=da[d[1]])}else"wrapS"in
a&&(b=a.P,h.b(b,da),b=da[b]),"wrapT"in a&&(c=a.R,h.b(c,da),c=da[c]);this.P=b;this.R=c;"anisotropic"in a&&(b=a.ea,h("number"===typeof b&&1<=b&&b<=u.ub,"aniso samples must be between 1 and "),this.ea=a.ea);if("mipmap"in a)switch(a=a.zb,typeof a){case "string":h.b(a,V,"invalid mipmap hint");this.Ua=V[a];this.L=!0;break;case "boolean":this.L=!!a;break;case "object":break;default:h.h("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.X);c.texParameteri(a,10240,this.Ga);
c.texParameteri(a,10242,this.P);c.texParameteri(a,10243,this.R);g.lb&&c.texParameteri(a,34046,this.ea);this.L&&(c.hint(33170,this.Ua),c.generateMipmap(a))}});var L=0,r=0,n={},C=[],T=u.yb,Z=Array(T).map(function(){return null});Object.assign(R.prototype,{bind:function(){this.fa+=1;var a=this.Z;if(0>a){for(var b=0;b<T;++b){var d=Z[b];if(d){if(0<d.fa)continue;d.Z=-1}Z[b]=this;a=b;break}a>=T&&h.h("insufficient number of texture units");this.Z=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.c);
L=a}return a},Rc:function(){--this.fa},aa:function(){0===--this.j&&G(this)}});return{create:function(a,b){function c(a,e,f,g,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,f,g,h,k]);ba(d,l);c.width=d.B.width;c.height=d.B.height;return c}var d=new R(b);n[d.id]=d;c(a);Object.assign(c,{C:"texture",w:d,G:function(){d.aa()}});return c},refresh:function(){k(n).forEach(ja);for(var a=0;a<T;++a)Z[a]=null;L=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<T;++a)c.activeTexture(33984+a),c.bindTexture(3553,
null),Z[a]=null;c.activeTexture(33984);L=0;k(n).forEach(G)},M:function(){C.forEach(ja)},ic:function(){return null}}}},{"./check":3,"./is-ndarray":16,"./is-typed-array":17,"./load-texture":19,"./parse-dds":20,"./to-half-float":28,"./values":30}],28:[function(c,g){g.a=function(b){for(var c=new Float32Array(b),c=new Uint32Array(c.buffer),a=new Uint16Array(b.length),d=0;d<b.length;++d)if(isNaN(b[d]))a[d]=65535;else if(Infinity===b[d])a[d]=31744;else if(-Infinity===b[d])a[d]=64512;else{var e=c[d],g=e>>>
31<<15,k=(e<<1>>>24)-127,e=e>>13&1023;a[d]=-24>k?g:-14>k?g+(e+1024>>-14-k):15<k?g+31744:g+(k+15<<10)+e}return a}},{}],29:[function(c,g){g.a=function(){var b={};return{s:b,g:function(c){c in b||(b[c]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])}}}},{}],30:[function(c,g){g.a=function(b){return Object.keys(b).map(function(c){return b[c]})}},{}],31:[function(c,g){var b=c("./lib/check"),q=c("./lib/context"),a=c("./lib/extension"),d=c("./lib/limits"),e=c("./lib/buffer"),h=c("./lib/elements"),k=c("./lib/texture"),
E=c("./lib/renderbuffer"),B=c("./lib/framebuffer"),z=c("./lib/uniform"),y=c("./lib/attribute"),x=c("./lib/shader"),m=c("./lib/draw"),l=c("./lib/state"),F=c("./lib/compile"),u=c("./lib/read"),K=c("./lib/dynamic"),aa=c("./lib/raf"),D=c("./lib/clock");g.a=function(){function c(){I=aa.next(c);n.count+=1;if(n.width!==G.drawingBufferWidth||n.height!==G.drawingBufferHeight)n.width=G.drawingBufferWidth,n.height=G.drawingBufferHeight,C.Ab();var a=D();n.Oa=a-n.t;n.t=a;J.M();for(var b=0;b<f.length;++b)(0,f[b])(n.count,
n.t,n.Oa);n.Hb=D()-a}function g(){I&&(aa.cancel(c),I=0)}function R(a){g();a.preventDefault();V.Bb&&V.Bb()}function ba(){da.refresh();fa.refresh();J.refresh();L.refresh();r.refresh();S.refresh();C.refresh();V.Cb&&V.Cb();c()}function ja(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];K.sb(f)?(d=!0,e[c]=K.Jb(f,c)):b[c]=f});return{Ea:e,Ja:b}}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var d=!1,e=c(a.s||{}),f=c(a.attributes||{});a=
c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Object.assign({},a);delete c.s;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=T.fb(a.Ja,e.Ja,f.Ja,a.Ea,e.Ea,f.Ea,d),g=e.U,h=e.eb,k=e.scope,l=[];return function(a,b){var c;if("number"===typeof a){for(c=a|0;l.length<c;)l.push(null);c=h(a|0,l)}else c=Array.isArray(a)?h(a.length,a):"function"===typeof a?
k(null,a):"function"===typeof b?k(a,b):g(a);return c}}function ma(){r.M();C.M()}var X=q(Array.prototype.slice.call(arguments)),G=X.Fa,V=X.options,da=a(G),X=da.Qa,Q={width:G.drawingBufferWidth,height:G.drawingBufferHeight},ka=d(G,X),fa=e(G),ha=h(G,X,fa),la=z(),ca=y(G,X,ka,fa),S=x(G,ca,la,function(a){return T.U(a)}),t=m(G,X,fa),J=k(G,X,ka,ma,Q),L=E(G,X,ka),r=B(G,X,ka,J,L),n={count:0,start:D(),Oa:0,t:D(),Hb:0,width:G.drawingBufferWidth,height:G.drawingBufferHeight,sa:V.sa},C=l(G,r,Q),Q=u(G,ma,Q),T=F(G,
X,ka,fa,ha,J,r,C,la,ca,S,t,n,ma),Z=G.canvas,f=[],I=0;Z&&(Z.addEventListener("webglcontextlost",R,!1),Z.addEventListener("webglcontextrestored",ba,!1));return Object.assign(ja,{clear:function(a){var c=0;ma();var d=a.color;d&&(G.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in a&&(G.clearDepth(+a.depth),c|=256);"stencil"in a&&(G.clearStencil(a.stencil|0),c|=1024);b(!!c,"called regl.clear with no buffer specified");G.clear(c)},Dc:K.hb,U:ja({}),elements:function(a){return ha.create(a)},
buffer:function(a){return fa.create(a,34962)},c:function(a){return J.create(a,3553)},ia:function(a){return 6===arguments.length?J.create(Array.prototype.slice.call(arguments),34067):J.create(a,34067)},i:function(a){return L.create(a)},V:function(a){return r.create(a)},hc:function(){b.h("framebuffer cube not yet implemented")},frame:function(a){f.push(a);!I&&0<f.length&&c();return{cancel:function(){var b=f.find(function(b){return b===a});0>b||(f.splice(b,1),0>=f.length&&g())}}},Mc:n,nc:ka,read:Q,G:function(){g();
Z&&(Z.removeEventListener("webglcontextlost",R),Z.removeEventListener("webglcontextrestored",ba));S.clear();r.clear();L.clear();J.clear();fa.clear();V.Ha&&V.Ha()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/check":3,"./lib/clock":4,"./lib/compile":6,"./lib/context":10,"./lib/draw":11,"./lib/dynamic":12,"./lib/elements":13,"./lib/extension":14,"./lib/framebuffer":15,"./lib/limits":18,"./lib/raf":21,"./lib/read":22,"./lib/renderbuffer":23,"./lib/shader":24,"./lib/state":26,"./lib/texture":27,"./lib/uniform":29}]},
{},[31])(31)});
