(function(ua){if("object"===typeof exports&&"undefined"!==typeof module)module.a=ua();else if("function"===typeof define&&define.Sb)define([],ua);else{var c;"undefined"!==typeof window?c=window:"undefined"!==typeof global?c=global:"undefined"!==typeof self?c=self:c=this;c.Kc=ua()}})(function(){return function c(f,a,p){function d(b,e){if(!a[b]){if(!f[b]){var u="function"==typeof require&&require;if(!e&&u)return u(b,!0);if(h)return h(b,!0);u=Error("Cannot find module '"+b+"'");throw u.code="MODULE_NOT_FOUND",
u;}u=a[b]={a:{}};f[b][0].call(u.a,function(a){var e=f[b][1][a];return d(e?e:a)},u,u.a,c,f,a,p)}return a[b].a}for(var h="function"==typeof require&&require,e=0;e<p.length;e++)d(p[e]);return d}({1:[function(c,f){function a(){this.u=!1;this.M=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.G=!1;this.type=5126;this.F=this.m=this.offset=0}var p=c("./constants/dtypes.json"),d=c("./extend");d(a.prototype,{jb:function(a,e){return this.u?a.u&&this.buffer===a.buffer&&this.size===e&&this.G===a.G&&this.type===
a.type&&this.offset===a.offset&&this.m===a.m&&this.F===a.F:!a.u&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.M===a.M},set:function(a,e){(this.u=a.u)?(this.buffer=a.buffer,this.size=e,this.G=a.G,this.type=a.type,this.offset=a.offset,this.m=a.m,this.F=a.F):(this.x=a.x,this.y=a.y,this.z=a.z,this.M=a.M)}});f.a=function(h,e,b,c,u){function C(){for(var e=Array(16),b=0;16>b;++b)e[b]=new a;this.Hb=e;this.top=0}function f(e){for(var b=e.Hb,h=e.top;b.length-1<=h;)b.push(new a);return b[++e.top]}var x={};
b=b.wb;for(var r=Array(b),m=0;m<b;++m)r[m]=new a;d(C.prototype,{Ya:function(a,e,b,h){var d=f(this);d.u=!1;d.x=a;d.y=e;d.z=b;d.M=h},Gb:function(a,e,b,h,d,r,p){var c=f(this);c.u=!0;c.buffer=a;c.size=e;c.offset=b;c.m=h;c.F=d;c.G=r;c.type=p},Ic:function(a){if("number"===typeof a)this.Ya(a,0,0,0);else if(Array.isArray(a))this.Ya(a[0],a[1],a[2],a[3]);else{var e=c.na(a),b=0,h=0,d=0,r=0,m=!1,u=5126;e?u=e.I:(e=c.na(a.buffer),b=a.size||0,h=a.m||0,d=a.offset||0,r=a.F||0,m=a.G||!1,u=e.I,"type"in a&&(u=p[a.type]));
this.Gb(e,b,d,h,r,m,u)}},pop:function(){--this.top}});return{Ca:r,bind:function(a,b,d,r){r=d.size||r;if(!b.jb(d,r)){if(d.u){b.u||h.enableVertexAttribArray(a);b.buffer!==d.buffer&&d.buffer.bind();h.vertexAttribPointer(a,r,d.type,d.G,d.m,d.offset);var c=e.Na;c&&c.vertexAttribDivisorANGLE(a,d.F)}else b.u&&h.disableVertexAttribArray(a),h.vertexAttrib4f(a,d.x,d.y,d.z,d.M);b.set(d,r)}},f:function(a){a=u.id(a);var b=x[a];b||(b=x[a]=new C);return b}}}},{"./constants/dtypes.json":8,"./extend":14}],2:[function(c,
f){function a(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var p=c("./check"),d=c("./is-typed-array"),h=c("./is-ndarray"),e=c("./constants/arraytypes.json"),b=c("./constants/dtypes.json"),l=c("./values"),u={"static":35044,dynamic:35048,stream:35040};f.a=function(c){function f(a,
b){this.id=m++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.la=1;this.data=null;this.I=5121}function x(a){c.isBuffer(a.buffer)||(a.buffer=c.createBuffer());a.bind();c.bufferData(a.type,a.data||a.byteLength,a.usage)}function r(a){var b=a.buffer;p(b,"buffer must not be deleted already");c.isBuffer(b)&&c.deleteBuffer(b);a.buffer=null;delete w[a.id]}var m=0,w={};f.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)};return{create:function(q,m,l){function S(c){var r=c||{};
if(Array.isArray(r)||d(r)||h(r))r={data:r};else if("number"===typeof r)r={length:r|0};else if(null===r||void 0===r)r={};p.type(r,"object","buffer arguments must be an object, a number or an array");"usage"in r?(p.b(r.usage,u,"invalid buffer usage"),G.usage=u[r.usage]):G.usage=35044;c=0;"type"in r&&(p.b(r.type,b,"invalid buffer type"),c=b[r.type]);var q=r.la|0||1,m=0,l=null;if("data"in r)if(l=r.data,null===l)m=r.length|0;else{if(h(l)){var q=l.shape,m=l.m,r=l.offset,O=0,f=0,w=0,K=0;1===q.length?(O=
q[0],f=1,w=m[0],K=0):2===q.length?(O=q[0],f=q[1],w=m[0],K=m[1]):p.h("invalid shape");c=c||e[Object.prototype.toString.call(l)]|0||5126;for(var q=f,m=a(c,O*f),l=l.data,C=0,ma=0;ma<O;++ma)for(var Z=0;Z<f;++Z)m[C++]=l[w*ma+K*Z+r];l=m}else if(Array.isArray(l))if(0<l.length&&Array.isArray(l[0])){q=l[0].length;c=c||5126;r=a(c,l.length*q);m=l;l=q;for(O=K=0;O<m.length;++O)for(w=m[O],f=0;f<l;++f)r[K++]=w[f];l=r}else c=c||5126,l=a(c,l);else p.Sa(l,"invalid data type buffer data"),c=c||e[Object.prototype.toString.call(l)]|
0;m=l.byteLength}else"length"in r&&(m=r.length|0,p.ba(m,"buffer length must be a nonnegative integer"));G.data=l;G.I=c||5121;G.byteLength=m;G.la=q;x(G);return S}var ea=c.createBuffer(),G=new f(ea,m);w[G.id]=G;l||S(q);S.B="buffer";S.Aa=G;S.aa=function(){r(G)};return S},clear:function(){l(w).forEach(r)},refresh:function(){l(w).forEach(x)},na:function(a){return a&&a.Aa instanceof f?a.Aa:null}}}},{"./check":3,"./constants/arraytypes.json":7,"./constants/dtypes.json":8,"./is-ndarray":17,"./is-typed-array":18,
"./values":32}],3:[function(c,f){function a(a){a=Error("(regl) "+a);console.error(a);throw a;}function p(e,b){e||a(b)}var d=c("./is-typed-array"),h=c("./extend");f.a=h(p,{h:a,b:function(e,b,d){e in b||a("unknown parameter ("+e+")"+(d?": "+d:"")+". possible values: "+Object.keys(b).join())},type:function(e,b,d){typeof e!==b&&a("invalid parameter type"+(d?": "+d:"")+". expected "+b+", got "+typeof e)},Sa:function(e,b){d(e)||a("invalid parameter type"+(b?": "+b:"")+". must be a typed array")},ba:function(e,
b){0<=e&&(e|0)===e||a("invalid parameter type, ("+e+")"+(b?": "+b:"")+". must be a nonnegative integer")},qa:function(e,b,d){0>b.indexOf(e)&&a("invalid value"+(d?": "+d:"")+". must be one of: "+b)},Kb:function(a,b){a.getShaderParameter(b,a.COMPILE_STATUS)||p.h("Error compiling shader:\n"+a.getShaderInfoLog(b))},ub:function(a,b){a.getProgramParameter(b,a.LINK_STATUS)||p.h("Error linking program:\n"+a.getProgramInfoLog(b))}})},{"./extend":14,"./is-typed-array":18}],4:[function(c,f){f.a="undefined"!==
typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],5:[function(c,f){var a=c("./extend");f.a=function(){function c(){var b=[],e=[];return a(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{f:function(){var a="v"+d++;e.push(a);0<arguments.length&&(b.push(a,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return a},toString:function(){return[0<e.length?"var "+e+";":"",b.join("")].join("")}})}var d=0,h=[],
e=[],b={};return{link:function(a){var b="g"+d++;h.push(b);e.push(a);return b},block:c,ca:function(e){var h=[],f=c(),J=f.toString;return b[e]=a(f,{R:function(){var a="a"+d++;h.push(a);return a},toString:function(){return["function(",h.join(),"){",J(),"}"].join("")}})},compile:function(){var a=['"use strict";return {'];Object.keys(b).forEach(function(e){a.push('"',e,'":',b[e].toString(),",")});a.push("}");return Function.apply(null,h.concat([a.join("")])).apply(null,e)}}}},{"./extend":14}],6:[function(c,
f){function a(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function p(a,b,d,h){var c,p=",";switch(b){case 5126:c="1f";break;case 35664:c="2fv";break;case 35665:c="3fv";break;case 35666:c="4fv";break;case 35670:case 5124:c="1i";break;case 35671:case 35667:c="2iv";break;case 35672:case 35668:c="3iv";break;case 35673:case 35669:c="4iv";break;case 35674:c="Matrix2fv";p=",false,";break;case 35675:c=
"Matrix3fv";p=",false,";break;case 35676:c="Matrix4fv";p=",false,";break;default:e.h("unsupported uniform type")}return a+".uniform"+c+"("+d+p+h+");"}function d(a){return a+"["+a+".length-1]"}function h(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var e=c("./check"),b=c("./codegen"),l=c("./constants/primitives.json"),u=c("./constants/dtypes.json"),C={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,
"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},J={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},x={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};f.a=function(c,m,f,q,O,K,S,ea,G,fa,ga,V,
Y,ka,na){function ha(q,m,u,O,S){function B(a){var L=ra[a];return L?L:L=ra[a]=y(la[a])}function W(a){var L=a.id,k=U[L];if(k)return k;k=a.Ra?n.f(y(a.data),"(",qa,",",H,",",P,")"):n.f(qa,".",a.data);return U[L]=k}function v(a,L){return a.find(function(a){return a.name===L})}function M(a){return oa&&!(a in m||a in S)}var Q=b(),y=Q.link,n=Q.ca("batch"),D=Q.block(),F=n.f,ba=n.R,g=y(c),I=y(q.va),t=y(ga.bind),P=y(ka),ja=y(ea),A=y(Y.count),R=y(Y.offset),ta=y(Y.U),X=y(Y.o),ra={},da=y(K.elements),A=F(d(A)),
R=F(d(R)),X=F(d(X)),da=F(d(da)),z,N,G=f.Na;G&&(z=F(d(ta)),N=y(G));var oa="elements"in m,ta=ba(),ba=ba(),qa=F(),H=F(),U={};n(g,".useProgram(",I,");");q.X.forEach(function(a){if(!(a.name in u)){var L=y(a.location),k=y(fa.f(a.name)),k=k+"["+k+".length-1]";a=a.info.type;35678===a||35680===a?(a=F(k+"._texture"),n(p(g,5124,L,a+".bind()")),D(a,".unbind();")):n(p(g,a,L,k))}});q.attributes.forEach(function(g){if(!(O.name in O)){var L=y(ga.f(g.name));n(t,"(",g.location,",",y(ga.Ca[g.location]),",",L,".records[",
L,".top]",",",a(g.info.type),");")}});oa||n("if(",da,"){",g,".bindBuffer(",34963,",",da,".buffer.buffer);","}else{",g,".bindBuffer(",34963,",null);","}");n("for(",H,"=0;",H,"<",ta,";++",H,"){",qa,"=",ba,"[",H,"];");Object.keys(m).sort(h).forEach(function(a){function L(a){n("if(",k,"){",g,".enable(",a,");}else{",g,".disable(",a,");}")}var k=W(m[a]);switch(a){case "framebuffer":a=B("viewport");var b=B("scissor.box");n("if(",ja,".push(",k,"&&",k,"._framebuffer)){",ja,".poll();",a,".setDirty();",b,".setDirty();",
"}");break;case "cull.enable":L(2884);break;case "blend.enable":L(3042);break;case "dither":L(3024);break;case "stencil.enable":L(2960);break;case "depth.enable":L(2929);break;case "scissor.enable":L(3089);break;case "polygonOffset.enable":L(32823);break;case "sample.alpha":L(32926);break;case "sample.enable":L(32928);break;case "depth.mask":n(g,".depthMask(",k,");");break;case "depth.func":a=y(J);n(g,".depthFunc(",a,"[",k,"]);");break;case "depth.range":n(g,".depthRange(",k,"[0],",k,"[1]);");break;
case "blend.color":n(g,".blendColor(",k,"[0],",k,"[1],",k,"[2],",k,"[3]);");break;case "blend.equation":a=y(E);n("if(typeof ",k,'==="string"){',g,".blendEquation(",a,"[",k,"]);","}else{",g,".blendEquationSeparate(",a,"[",k,".rgb],",a,"[",k,".alpha]);","}");break;case "blend.func":a=y(C);n(g,".blendFuncSeparate(",a,'["srcRGB" in ',k,"?",k,".srcRGB:",k,".src],",a,'["dstRGB" in ',k,"?",k,".dstRGB:",k,".dst],",a,'["srcAlpha" in ',k,"?",k,".srcAlpha:",k,".src],",a,'["dstAlpha" in ',k,"?",k,".dstAlpha:",
k,".dst]);");break;case "stencil.mask":n(g,".stencilMask(",k,");");break;case "stencil.func":a=y(J);n(g,".stencilFunc(",a,"[",k,'.cmp||"always"],',k,".ref|0,",'"mask" in ',k,"?",k,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=y(x);n(g,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",b,"[",k,'.fail||"keep"],',b,"[",k,'.zfail||"keep"],',b,"[",k,'.pass||"keep"]);');break;case "polygonOffset.offset":n(g,".polygonOffset(",k,".factor||0,",k,".units||0);");break;case "cull.face":n(g,
".cullFace(",k,'==="front"?',1028,":",1029,");");break;case "lineWidth":n(g,".lineWidth(",k,");");break;case "frontFace":n(g,".frontFace(",k,'==="cw"?',2304,":",2305,");");break;case "colorMask":n(g,".colorMask(",k,"[0],",k,"[1],",k,"[2],",k,"[3]);");break;case "sample.coverage":n(g,".sampleCoverage(",k,".value,",k,".invert);");break;case "scissor.box":case "viewport":a=B(a);n(a,".push(",k,".x||0,",k,".y||0,",k,".w||-1,",k,".h||-1);");break;case "primitives":case "offset":case "count":case "elements":break;
default:e.h("unsupported option for batch",a)}});("viewport"in m||"framebuffer"in m)&&n(B("viewport"),".poll();");("scissor.box"in m||"framebuffer"in m)&&n(B("scissor.box"),".poll();");"framebuffer"in m&&n(ja,".pop();");var V=q.X,ha=[];Object.keys(u).forEach(function(a){var L=v(V,a);if(L){var k=L.info.type,b=y(L.location);a=W(u[a]);35678===L.info.type||35680===L.info.type?(L=F(a+"._texture"),ha.push(L),n(p(g,5124,b,L+".bind()"))):n(p(g,k,b,a))}});ha.forEach(function(a){n(a,".unbind();")});var na=
q.attributes;Object.keys(O).forEach(function(g){var b=v(na,g);b&&n(t,"(",b.location,",",y(g.Ca[b.location]),",",W(O[g]),",",a(b.info.type),");")});m.count?n(A,"=",W(m.count),";"):M("count")||n("if(",A,"){");m.offset&&n(R,"=",W(m.offset),";");m.o&&(q=y(l),n(X,"=",q,"[",W(m.o),"];"));oa&&(q=W(m.elements),n(da,"=",q,"?",q,"._elements:null;"));M("offset")&&n(R,"=0;");n("if(",da,"){");M("count")&&n(A,"=",da,".vertCount;","if(",A,">0){");M("primitive")&&n(X,"=",da,".primType;");oa&&n(g,".bindBuffer(",34963,
",",da,".buffer.buffer);");G&&(m.U&&n(z,"=",W(m.U),";"),n("if(",z,">0){",N,".drawElementsInstancedANGLE(",X,",",A,",",da,".type,",R,",",z,");}else{"));n(g,".drawElements(",X,",",A,",",da,".type,",R,");");G&&n("}");M("count")&&n("}");n("}else{");M("count")||(M("primitive")&&n(X,"=",4,";"),G&&n("if(",z,">0){",N,".drawArraysInstancedANGLE(",X,",",R,",",A,",",z,");}else{"),n(g,".drawArrays(",X,",",R,",",A,");}"),G&&n("}"));n("}}",D);return Q.compile().eb}var la=G.gb,E={add:32774,subtract:32778,"reverse subtract":32779};
f.gc&&(E.min=32775,E.max=32776);var B=0;return{S:function(e){var h=b(),m=h.link,q=h.ca("draw"),l=q.f,u=m(c),O=m(e.va),C=m(ga.bind),M=m(Y.count),Q=m(Y.offset),y=m(Y.U),n=m(Y.o),D=m(K.elements),F=[];q(u,".useProgram(",O,");");e.attributes.forEach(function(b){var g=m(ga.f(b.name));q(C,"(",b.location,",",m(ga.Ca[b.location]),",",g,".records[",g,".top]",",",a(b.info.type),");")});e.X.forEach(function(a){var b=m(a.location),e=m(fa.f(a.name)),e=e+"["+e+".length-1]";a=a.info.type;35678===a||35680===a?(a=
l(e+"._texture"),F.push(a),q(p(u,5124,b,a+".bind()"))):q(p(u,a,b,e))});F.forEach(function(a){q(a,".unbind();")});e=l(d(n));M=l(d(M));Q=l(d(Q));D=l(d(D));q("if(",M,"){");(O=f.Na)?(y=l(d(y)),O=m(O),q("if(",D,"){",D,".bind();","if(",y,">0){",O,".drawElementsInstancedANGLE(",e,",",M,",",D,".type,",Q,",",y,");}else{",u,".drawElements(",e,",",M,",",D,".type,",Q,");}","}else if(",y,">0){",O,".drawArraysInstancedANGLE(",e,",",Q,",",M,",",y,");}else{",u,".drawArrays(",e,",",Q,",",M,");}}")):q("if(",D,"){",
u,".drawElements(",e,",",M,",",D,".type,",Q,");}","}else{",u,".drawArrays(",e,",",Q,",",M,");}");return h.compile().S},fb:function(a,c,r,p,f,w,S){function v(a){var k=da[a];return k?k:k=da[a]=n(la[a])}function M(a,k){var b=v(a);z(b,".push(",k,");");N(b,".pop();")}function Q(a){var k=a.id,b=wa[k];if(b)return b;b=a.Ra?H.f(n(a.data),"(",sa,",0,",va,")"):H.f(sa,".",a.data);return wa[k]=b}var y=b(),n=y.link,D=y.block,F=y.ca,ba=B++,g=n(na);n(m);var I=n(V.pb),t=n(V.Pb),P=n(V.Fb),ja=n(ea),A={count:n(Y.count),
offset:n(Y.offset),U:n(Y.U),o:n(Y.o)},R=n(K.elements),ta=n(l),X=n(J),ra=n(x),da={},z=D(),N=D(),G=!1;Object.keys(a).sort(h).forEach(function(b){var k=a[b];switch(b){case "frag":G=!0;z(I,".push(",n(m.id(k)),");");N(I,".pop();");break;case "vert":G=!0;z(t,".push(",n(m.id(k)),");");N(t,".pop();");break;case "framebuffer":b=ea.rb(k);e(null===k||b,"invalid framebuffer object");b=v("viewport");var g=v("scissor.box");z("if(",ja,".push(",n(k&&k.Ma),")){",b,".setDirty();",g,".setDirty();","}");N("if(",ja,".pop()){",
b,".setDirty();",g,".setDirty();","}");break;case "count":case "offset":case "instances":e.ba(k,b);z(A[b],".push(",k,");");N(A[b],".pop();");break;case "primitive":e.b(k,l,"not a valid drawing primitive");z(A.o,".push(",l[k],");");N(A.o,".pop();");break;case "elements":g=K.qb(k);k=!("primitive"in a);b=!("count"in a);g?(g=n(g),z(R,".push(",g,");"),k&&z(A.o,".push(",g,".primType);"),b&&z(A.count,".push(",g,".vertCount);")):(z(R,".push(null);"),k&&z(A.o,".push(",4,");"),b&&z(A.count,".push(0);"));k&&
N(A.o,".pop();");b&&N(A.count,".pop();");"offset"in a||(z(A.offset,".push(0);"),N(A.offset,".pop();"));N(R,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":e.type(k,"boolean",b);M(b,k);break;case "depth.func":e.b(k,J,b);M(b,J[k]);break;case "depth.range":e(Array.isArray(k)&&2===k.length&&k[0]<=k[1],"depth range is 2d array");b=
v(b);z(b,".push(",k[0],",",k[1],");");N(b,".pop();");break;case "blend.func":b=v(b);e.type(k,"object","blend func must be an object");var g="srcRGB"in k?k.Nc:k.src,d="srcAlpha"in k?k.Mc:k.src,h="dstRGB"in k?k.fc:k.ib,k="dstAlpha"in k?k.ec:k.ib;e.b(g,C);e.b(d,C);e.b(h,C);e.b(k,C);z(b,".push(",C[g],",",C[h],",",C[d],",",C[k],");");N(b,".pop();");break;case "blend.equation":b=v(b);"string"===typeof k?(e.b(k,E,"invalid blend equation"),z(b,".push(",E[k],",",E[k],");")):"object"===typeof k?(e.b(k.Jb,E,
"invalid blend equation rgb"),e.b(k.alpha,E,"invalid blend equation alpha"),z(b,".push(",E[k.Jb],",",E[k.alpha],");")):e.h("invalid blend equation");N(b,".pop();");break;case "blend.color":e(Array.isArray(k)&&4===k.length,"blend color is a 4d array");b=v(b);z(b,".push(",k[0],",",k[1],",",k[2],",",k[3],");");N(b,".pop();");break;case "stencil.mask":e.type(k,"number","stencil mask must be an integer");b=v(b);z(b,".push(",k,");");N(b,".pop();");break;case "stencil.func":e.type(k,"object","stencil func must be an object");
g=k.Vb||"keep";d=k.Jc||0;k="mask"in k?k.tc:-1;e.b(g,J,"invalid stencil func cmp");e.type(d,"number","stencil func ref");e.type(k,"number","stencil func mask");b=v(b);z(b,".push(",J[g],",",d,",",k,");");N(b,".pop();");break;case "stencil.opFront":case "stencil.opBack":e.type(k,"object",b);g=k.jc||"keep";d=k.ad||"keep";k=k.Fc||"keep";e.b(g,x,b);e.b(d,x,b);e.b(k,x,b);b=v(b);z(b,".push(",x[g],",",x[d],",",x[k],");");N(b,".pop();");break;case "polygonOffset.offset":e.type(k,"object",b);g=k.ic||0;k=k.units||
0;e.type(g,"number","offset.factor");e.type(k,"number","offset.units");b=v(b);z(b,".push(",g,",",k,");");N(b,".pop();");break;case "cull.face":g=0;"front"===k?g=1028:"back"===k&&(g=1029);e(!!g,"cull.face");k=v(b);z(k,".push(",g,");");N(k,".pop();");break;case "lineWidth":g=q.tb;e("number"===typeof k&&k>=g[0]&&k<=g[1],"invalid line width, must positive number between "+g[0]+" and "+g[1]);M(b,k);break;case "frontFace":g=0;"cw"===k?g=2304:"ccw"===k&&(g=2305);e(!!g,"frontFace");k=v(b);z(k,".push(",g,
");");N(k,".pop();");break;case "colorMask":e(Array.isArray(k)&&4===k.length,"color mask must be length 4 array");b=v(b);z(b,".push(",k.map(function(a){return!!a}).join(),");");N(b,".pop();");break;case "sample.coverage":e.type(k,"object",b);g="value"in k?k.value:1;k=!!k.qc;e("number"===typeof g&&0<=g&&1>=g,"sample value");b=v(b);z(b,".push(",g,",",k,");");N(b,".pop();");break;case "viewport":case "scissor.box":e("object"===typeof k&&k,b+" is an object");var g=k.x||0,d=k.y||0,c=h=-1;e("number"===
typeof g&&0<=g,b+".x must be a positive int");e("number"===typeof d&&0<=d,b+".y must be a positive int");"w"in k&&(h=k.M,e("number"===typeof h&&0<=h,b+".w must be a positive int"));"h"in k&&(c=k.pc,e("number"===typeof c&&0<=c,b+".h must be a positive int"));k=v(b);z(k,".push(",g,",",d,",",h,",",c,");");N(k,".pop();");break;default:e.h("unsupported parameter "+b)}});if(G){if(a.nb&&a.Nb)D=a.nb,z(P,".push(",n(V.create(m.id(a.Nb),m.id(D))),");");else{var D=z.f(I,"[",I,".length-1]"),oa=z.f(t,"[",t,".length-1]"),
qa=n(V.create);z(P,".push(",qa,"(",oa,",",D,"));")}N(P,".pop();")}Object.keys(c).forEach(function(a){var b=n(fa.f(a)),g;a=c[a];"function"===typeof a&&a.B?g=n(a):Array.isArray(a)?g=n(a.slice()):g=+a;z(b,".push(",g,");");N(b,".pop();")});Object.keys(r).forEach(function(a){var b=n(ga.f(a)),g=r[a];if("number"===typeof g)z(b,".pushVec(",+g,",0,0,0);");else if(e(!!g,"invalid attribute: "+a),Array.isArray(g))z(b,".pushVec(",[g[0]||0,g[1]||0,g[2]||0,g[3]||0],");");else{var d=O.na(g),h=0,t=0,c=0,m=0,q=!1,
P=5126;d?P=d.I:(e.type(g,"object",'invalid attribute "'+a+'"'),d=O.na(g.buffer),h=g.size||0,t=g.m||0,c=g.offset||0,m=g.F||0,q=g.G||!1,e(!!d,"invalid attribute "+a+".buffer"),P=d.I,"type"in g&&(e.b(g.type,u,"attribute type"),P=u[g.type]));e(!!d,"invalid attribute "+a+".buffer");e.ba(t,a+".stride");e.ba(c,a+".offset");e.ba(m,a+".divisor");e.type(q,"boolean",a+".normalized");e.qa(h,[0,1,2,3,4],a+".size");z(b,".pushPtr(",[n(d),h,c,t,m,q,P].join(),");")}N(b,".pop();")});var H=y.block(),U=y.block(),va,
sa;S&&(va=n(ka),sa=z.f());var wa={};Object.keys(p).sort(h).forEach(function(b){var g=Q(p[b]);switch(b){case "framebuffer":b=v("viewport");var d=v("scissor.box");H("if(",ja,".push(",g,"&&",g,"._framebuffer)){",b,".setDirty();",d,".setDirty();","}");U("if(",ja,".pop()){",b,".setDirty();",d,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":b=
v(b);H(b,".push(",g,");");U(b,".pop();");break;case "count":case "offset":case "instances":b=A[b];H(b,".push(",g,");");U(b,".pop();");break;case "primitive":b=A.o;H(b,".push(",ta,"[",g,"]);");U(b,".pop();");break;case "depth.func":b=v(b);H(b,".push(",X,"[",g,"]);");U(b,".pop();");break;case "blend.func":b=v(b);d=n(C);H(b,".push(",d,'["srcRGB" in ',g,"?",g,".srcRGB:",g,".src],",d,'["dstRGB" in ',g,"?",g,".dstRGB:",g,".dst],",d,'["srcAlpha" in ',g,"?",g,".srcAlpha:",g,".src],",d,'["dstAlpha" in ',g,
"?",g,".dstAlpha:",g,".dst]);");U(b,".pop();");break;case "blend.equation":b=v(b);d=n(E);H("if(typeof ",g,'==="string"){',b,".push(",d,"[",g,"],",d,"[",g,"]);","}else{",b,".push(",d,"[",g,".rgb],",d,"[",g,".alpha]);","}");U(b,".pop();");break;case "blend.color":b=v(b);H(b,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");U(b,".pop();");break;case "stencil.mask":b=v(b);H(b,".push(",g,");");U(b,".pop();");break;case "stencil.func":b=v(b);H(b,".push(",X,"[",g,".cmp],",g,".ref|0,",'"mask" in ',g,"?",g,".mask:-1);");
U(b,".pop();");break;case "stencil.opFront":case "stencil.opBack":b=v(b);H(b,".push(",ra,"[",g,'.fail||"keep"],',ra,"[",g,'.zfail||"keep"],',ra,"[",g,'.pass||"keep"]);');U(b,".pop();");break;case "polygonOffset.offset":b=v(b);H(b,".push(",g,".factor||0,",g,".units||0);");U(b,".pop();");break;case "cull.face":b=v(b);H(b,".push(",g,'==="front"?',1028,":",1029,");");U(b,".pop();");break;case "frontFace":b=v(b);H(b,".push(",g,'==="cw"?',2304,":",2305,");");U(b,".pop();");break;case "colorMask":b=v(b);
H(b,".push(",g,"[0],",g,"[1],",g,"[2],",g,"[3]);");U(b,".pop();");break;case "sample.coverage":b=v(b);H(b,".push(",g,".value,",g,".invert);");U(b,".pop();");break;case "scissor.box":case "viewport":b=v(b);H(b,".push(",g,".x||0,",g,".y||0,",'"w" in ',g,"?",g,".w:-1,",'"h" in ',g,"?",g,".h:-1);");U(b,".pop();");break;case "elements":b=!("primitive"in p)&&!("primitive"in a);var d=!("count"in p)&&!("count"in a),h=!("offset"in p)&&!("offset"in a),t=H.f();H("if(",g,"){",t,"=",g,"._elements;",R,".push(",
t,");",b?A.o+".push("+t+".primType);":"",d?A.count+".push("+t+".vertCount);":"",h?A.offset+".push("+t+".offset);":"","}else{",R,".push(null);","}");U(R,".pop();","if(",g,"){",b?A.o+".pop();":"",d?A.count+".pop();":"",h?A.offset+".pop();":"","}");break;default:e.h("unsupported dynamic option: "+b)}});Object.keys(f).forEach(function(a){var b=n(fa.f(a));a=Q(f[a]);H(b,".push(",a,");");U(b,".pop();")});Object.keys(w).forEach(function(a){var b=n(ga.f(a));a=Q(w[a]);H(b,".pushDyn(",a,");");U(b,".pop();")});
D=F("scope");oa=D.R();qa=D.R();D(z);S&&D(sa,"=",oa,";",H);D(qa,"();",S?U:"",N);D=F("draw");D(z);S&&D(sa,"=",D.R(),";",H);oa=d(P);D(g,"();","if(",oa,")",oa,".draw(",S?sa:"",");",S?U:"",N);var pa=F("batch");pa(z);S=pa.f(d(P));F=n(function(b,g,d){var e=b.Ba[ba];e||(e=b.Ba[ba]=ha(b,p,f,w,a));return e(g,d)});pa("if(",S,"){",g,"();",F,"(",S,",",pa.R(),",",pa.R(),");");Object.keys(p).forEach(function(a){(a=da[a])&&pa(a,".setDirty();")});pa("}",N);return y.compile()}}}},{"./check":3,"./codegen":5,"./constants/dtypes.json":8,
"./constants/primitives.json":9}],7:[function(c,f){f.a={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],8:[function(c,f){f.a={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],9:[function(c,f){f.a={points:0,lines:1,"line loop":2,
"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],10:[function(c,f){function a(a,b){function d(){var b=window.innerWidth,m=window.innerHeight;a!==document.body&&(m=a.getBoundingClientRect(),b=m.right-m.left,m=m.top-m.bottom);c.width=J*b;c.height=J*m;h(c.style,{width:b+"px",height:m+"px"})}var c=document.createElement("canvas"),f=p(c,b);h(c.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(c);a===document.body&&(c.style.position="absolute",h(a.style,{margin:0,padding:0}));
var J=+f.options.sa;window.addEventListener("resize",d,!1);var x=f.options.Ha;f.options=h(h({},f.options),{Ha:function(){window.removeEventListener("resize",d);a.removeChild(c);x&&x()}});d();return f}function p(a,b){function c(b){try{return a.getContext(b,p)}catch(d){return null}}var p=b.nc||{},f=c("webgl")||c("experimental-webgl")||c("webgl-experimental");d(f,"webgl not supported");return{Fa:f,options:h({sa:window.devicePixelRatio},b)}}var d=c("./check"),h=c("./extend");f.a=function(d){if("undefined"===
typeof document||"undefined"===typeof HTMLElement)return{Fa:d[0],options:d[1]||{}};var b=document.body,c=d[1]||{};if("string"===typeof d[0])b=document.querySelector(d[0])||document.body;else if("object"===typeof d[0])if(d[0]instanceof HTMLElement)b=d[0];else{if(d[0]instanceof WebGLRenderingContext)return{Fa:d[0],options:h({sa:1},c)};c=d[0]}return b.nodeName&&"CANVAS"===b.nodeName.toUpperCase()?p(b,c):a(b,c)}},{"./check":3,"./extend":14}],11:[function(c,f){f.a=function(){return{o:[4],count:[0],offset:[0],
U:[0]}}},{}],12:[function(c,f){function a(a,c){this.id=d++;this.Ra=a;this.data=c}function p(d){switch(typeof d){case "boolean":case "number":case "string":return new a(!1,d);case "function":return new a(!0,d);default:return p}}var d=0;f.a={hb:p,sb:function(d){return"function"===typeof d&&!d.B||d instanceof a},Mb:function(d,c){return d instanceof a?d:"function"===typeof d&&d!==p?new a(!0,d):new a(!1,c)}}},{}],13:[function(c,f){var a=c("./check"),p=c("./is-typed-array"),d=c("./is-ndarray"),h=c("./constants/primitives.json");
f.a=function(c,b,f){function u(){this.buffer=null;this.Eb=4;this.type=this.bb=0}u.prototype.bind=function(){this.buffer.bind()};return{create:function(c){function e(c){var f=b.Cc;if(c)if("number"===typeof c)r(c);else{var q=null,l="static",u=0;Array.isArray(c)||p(c)||d(c)?q=c:(a.type(c,"object","invalid arguments for elements"),"data"in c&&(q=c.data),"usage"in c&&(l=c.usage),"length"in c&&(u=c.length));Array.isArray(q)||d(q)&&"array"===q.I||"type"in c?r({type:c.type||(f?"uint32":"uint16"),usage:l,
data:q,length:u}):r({usage:l,data:q,length:u});if(Array.isArray(q)||p(q))r.la=3}else r();q=x.buffer.byteLength;l=0;switch(x.buffer.I){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;q>>=1;break;case 5125:case 5124:a(f,"32 bit element buffers not supported");l=5125;q>>=2;break;default:a.h("invalid element buffer type")}f=4;u=x.buffer.la;1===u&&(f=0);2===u&&(f=1);3===u&&(f=4);"object"===typeof c&&("primitive"in c&&(f=c.o,a.b(f,h),f=h[f]),"count"in c&&(q=c.bb|0));x.Eb=f;x.bb=q;x.type=l;return e}
var x=new u,r=f.create(null,34963,!0);x.buffer=r.Aa;e(c);e.B="elements";e.La=x;e.aa=function(){a(null!==x.buffer,"must not double destroy elements");r.aa();x.buffer=null};return e},elements:[null],qb:function(a){return a&&a.La instanceof u?a.La:null}}}},{"./check":3,"./constants/primitives.json":9,"./is-ndarray":17,"./is-typed-array":18}],14:[function(c,f){f.a=function(a,c){for(var d=Object.keys(c),h=0;h<d.length;++h)a[d[h]]=c[d[h]];return a}},{}],15:[function(c,f){f.a=function(a){function c(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(c){try{d[c]=
a.getExtension(c)}catch(e){}})}var d={};c();return{Qa:d,refresh:c}}},{}],16:[function(c,f){var a=c("./check"),p=c("./values"),d=c("./extend"),h=[1029];f.a=function(c,b,f,u,C){function J(a,b,d,c){this.target=a;this.level=b;this.c=d;this.i=c}function x(a){a&&(a.c&&a.c.v.$(),a.i&&a.i.C.$())}function r(b,d,c){b.c?a.qa(b.c.v.A.l,d,"unsupported texture format for attachment"):a.qa(b.i.C.format,c,"unsupported renderbuffer format for attachment")}function m(b,d){var c=d.width,e=d.height;if(b.c){var h=b.c.v,
q=Math.max(1,h.A.width>>b.level),r=Math.max(1,h.A.height>>b.level),c=c||q,e=e||r;a(q===c&&r===e,"inconsistent width/height for supplied texture");a(0>h.ta,"polling fbo textures not supported");h.j+=1}else h=b.i.C,c=c||h.width,e=e||h.height,a(h.width===c&&h.height===e,"inconsistent width/height for renderbuffer"),a(0<=Z.indexOf(h.format),"renderbuffer format not compatible with color channels"),h.j+=1;d.width=c;d.height=e}function w(a,b){b?b.c?c.framebufferTexture2D(36160,a,b.target,b.c.v.c,b.level):
c.framebufferRenderbuffer(36160,a,36161,b.i.C.i):c.framebufferTexture2D(36160,a,3553,null,0)}function q(b){var d=3553,c=0,e=null,h=null,q=b;"object"===typeof b&&(q=b.data,"level"in b&&(c=b.level|0),"target"in b&&(d=b.target|0));a.type(q,"function","invalid attachment data");q=b.B;"texture"===q?(e=b,34067===e.v.target?a(34069<=d&&34075>d,"invalid cube map target"):a(3553===d)):"renderbuffer"===q?(h=b,d=36161,c=0):a.h("invalid regl object for attachment");return new J(d,c,e,h)}function O(b){return b&&
(b.c||b.i)}function K(){this.id=T++;aa[this.id]=this;this.T=null;this.height=this.width=0;this.Z=[];this.ka=this.xa=this.ja=null;this.Ia=this.Xa=!1}function S(d){c.isFramebuffer(d.T)||(d.T=c.createFramebuffer());v=!0;c.bindFramebuffer(36160,d.T);for(var h=d.Z,q=0;q<h.length;++q)w(36064+q,h[q]);for(q=h.length;q<f.xb;++q)w(36064+q,null);w(36096,d.ja);w(36128,d.xa);w(33306,d.ka);b.za&&b.za.drawBuffersWEBGL(ca[h.length]);d=c.checkFramebufferStatus(36160);36053!==d&&a.h("framebuffer configuration not supported, status = "+
fa[d])}function ea(b){b=b.T;a(b,"must not double destroy framebuffer");c.isFramebuffer(b)&&c.deleteFramebuffer(b)}function G(){return W[W.length-1]}var fa={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},ga={rgba:6408},V={rgba4:32854,rgb565:36194,"rgb5 a1":32855};b.Pa&&(V.srgba=35907);b.kb&&(V.rgba16f=34842,V.rgb16f=34843);b.Qb&&(V.rgba32f=34836);var Y=[33189],ka=[36168],na=[34041],ha=[],la=[],E=[];b.Ka&&(ha.push(6402),
E.push(34041));var B=d(d({},ga),V),ma=p(ga),Z=p(V),V=5121,ia={uint8:5121};b.Wa&&(V=ia["half float"]=36193);b.Va&&(V=ia.mb=5126);ia.Ub=V;var ca=function(){for(var b=Array(f.Ta),a=0;a<=f.Ta;++a)for(var d=b[a]=Array(a),c=0;c<a;++c)d[c]=36064+c;return b}(),T=0,aa={},W=[null],v=!0;return{top:G,dc:function(){return v},push:function(b){b=b||null;v=v||b!==G();W.push(b);return v},pop:function(){var b=G();W.pop();return v=v||b!==G()},rb:function(b){return"function"===typeof b&&"framebuffer"===b.B&&(b=b.Ma,
b instanceof K)?b:null},K:function(){if(v){var a=W[W.length-1],d=b.za;a?(c.bindFramebuffer(36160,a.T),d&&d.drawBuffersWEBGL(ca[a.Z.length])):(c.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(h));v=!1}},create:function(d){function h(d){var p,l=d||{};p=b.za;var w=0,g=0;"shape"in l?(d=l.shape,a(Array.isArray(d)&&2<=d.length,"invalid shape for framebuffer"),w=d[0],g=d[1]):("radius"in l&&(w=g=l.Za),"width"in l&&(w=l.width),"height"in l&&(g=l.height));var I=null;d=!1;if("colorBuffers"in l||"colorBuffer"in
l){I=l.Yb||l.Xb;Array.isArray(I)||(I=[I]);f.width=w;f.height=g;1<I.length&&a(p,"multiple render targets not supported");a(0<=I.length,"must specify at least one color attachment");I=I.map(q);for(p=0;p<I.length;++p)w=I[p],r(w,ma,Z),m(w,f);w=f.width;g=f.height}else{var t=!0,P="rgba",ja="uint8",A=1;d=!0;f.width=w||c.drawingBufferWidth;f.height=g||c.drawingBufferHeight;"format"in l&&(P=l.format,a.b(P,B,"invalid color format"),t=P in ga);"type"in l&&(a(t,"colorType can not be set for renderbuffer targets"),
ja=l.type,a.b(ja,ia,"invalid color type"));"colorCount"in l&&(A=l.Zb|0,a(0<=A,"color count must be positive"));if(f.Xa)for(I=f.Z;I.length>A;)x(I.pop());else I=[];for(p=0;p<I.length;++p){var R;a:{R=I[p];var K=t,X=P,v=w,da=g;if(R.c){var z=R.c;if(K){z({format:X,type:ja,width:v,height:da});z.v.j+=1;R=!0;break a}}else if(z=R.i,!K){z({format:X,width:v,height:da});z.C.j+=1;R=!0;break a}x(R);R=!1}R||(I[p--]=I[I.length-1],I.pop())}for(;I.length<A;)t?I.push(new J(3553,0,u.create({format:P,type:ja,width:w,height:g},
3553),null)):I.push(new J(36161,0,null,C.create({format:P,width:w,height:g})))}a(0<I.length,"must specify at least one color buffer");f.width=w;f.height=g;P=t=p=null;ja=!1;A=0;"depthBuffer"in l&&(p=q(l.ac),r(p,ha,Y),A+=1);"stencilBuffer"in l&&(t=q(l.Sc),r(t,la,ka),A+=1);"depthStencilBuffer"in l&&(P=q(l.bc),r(P,E,na),A+=1);if(p||t||P)a(1===A,"can specify only one of depth, stencil or depthStencil attachment"),m(p||t||P,f);else if(A=!0,K=R=!1,"depth"in l&&(A=!!l.depth),"stencil"in l&&(R=!!l.stencil),
"depthTexture"in l&&(K=!!l.cc),l=f.ja||f.xa||f.ka,X=null,A||R)ja=!0,K?(a(b.Ka,"depth texture extension not supported"),a(A,"stencil only textures not supported"),K=R?"depth stencil":"depth",f.Ia&&l.c?(l.c({format:K,width:w,height:g}),l.c.v.j+=1,X=l):X=new J(3553,0,u.create({format:K,width:w,height:g},3553),null)):(K=A?R?"depth stencil":"depth":"stencil",f.Ia&&l.i?(l.i({format:K,width:w,height:g}),l.i.C.j+=1,X=l):X=new J(36161,0,null,C.create({format:K,width:w,height:g}))),A?R?P=X:p=X:t=X;w=f;w.Z.forEach(x);
x(w.ja);x(w.xa);x(w.ka);f.Z=I;f.ja=p;f.xa=t;f.ka=P;f.Xa=d;f.Ia=ja;h.color=I.map(O);h.depth=O(p);h.stencil=O(t);h.Tb=O(P);S(f);h.width=f.width;h.height=f.height;return h}var f=new K;h(d);h.B="framebuffer";h.Ma=f;h.Rb=function(){ea(f)};return h},clear:function(){p(aa).forEach(ea)},refresh:function(){p(aa).forEach(S)}}}},{"./check":3,"./extend":14,"./values":32}],17:[function(c,f){var a=c("./is-typed-array");f.a=function(c){return"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.m)&&"number"===
typeof c.offset&&c.shape.length===c.m.length&&(Array.isArray(c.data)||a(c.data))}},{"./is-typed-array":18}],18:[function(c,f){var a=c("./constants/arraytypes.json");f.a=function(c){return Object.prototype.toString.call(c)in a}},{"./constants/arraytypes.json":7}],19:[function(c,f){f.a=function(a,c){var d=1;c.lb&&(d=a.getParameter(34047));var h=1,e=1;c.za&&(h=a.getParameter(34852),e=a.getParameter(36063));return{Wb:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],
$b:a.getParameter(3414),Rc:a.getParameter(3415),Tc:a.getParameter(3408),Qa:Object.keys(c).filter(function(b){return!!c[b]}),vb:d,Ta:h,xb:e,Gc:a.getParameter(33901),tb:a.getParameter(33902),Bc:a.getParameter(3386),uc:a.getParameter(35661),vc:a.getParameter(34076),yb:a.getParameter(34024),zb:a.getParameter(34930),xc:a.getParameter(3379),wb:a.getParameter(34921),Ac:a.getParameter(36347),zc:a.getParameter(35660),yc:a.getParameter(36348),wc:a.getParameter(36349),oc:a.getParameter(35724),Lc:a.getParameter(7937),
vendor:a.getParameter(7936),version:a.getParameter(7938)}}},{}],20:[function(c,f){f.a=function(a,c){if("undefined"!==typeof document){var d;d=(d=/\.(\w+)(\?.*)?$/.exec(a))&&d[1]?d[1].toLowerCase():void 0;0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(d)?(d=document.createElement("video"),d.autoplay=!0,d.loop=!0,c&&(d.crossOrigin=c),d.src=a):0<=["dds"].indexOf(d)?(d=new XMLHttpRequest,d.responseType="arraybuffer",d.open("GET",a,!0),d.send()):(d=new Image,
c&&(d.crossOrigin=c),d.src=a);return d}return null}},{}],21:[function(c,f){var a=c("./check");f.a=function(c){function f(b){for(var a=Z,d=ia,h=0;h<v;++h){var e=Math.max(1,a+3>>2)*Math.max(1,d+3>>2)*aa;Q.H.push({target:b,s:h,width:a,height:d,data:new Uint8Array(c,M,e)});M+=e;a>>=1;d>>=1}}var B=new Int32Array(c);a(B[0]===p,"invalid magic number for dds header");var ma=B[fa];a(ma&w,"unsupported dds format");var Z=B[V],ia=B[ga],ca=J,T=0,aa=0,W=4;switch(B[na]){case O:aa=8;ma&q?(W=3,T=e):T=b;break;case K:aa=
16;T=l;break;case S:aa=16;T=u;break;case ea:aa=8;T=C;break;default:a.h("unsupported dds texture format")}var v=1;B[ka]&x&&(v=Math.max(1,B[Y]));var M=B[G]+4,Q={width:Z,height:ia,g:W,format:T,type:ca,D:!0,ia:!1,H:[]},B=B[ha];if(B&r)for(a((B&m)===m,"missing cubemap faces"),Q.ia=!0,B=0;6>B;++B)f(h+B);else f(d);return Q};var p=542327876,d=3553,h=34069,e=33776,b=33777,l=33778,u=33779,C=36196,J=5121,x=131072,r=512,m=64512,w=4,q=64,O=827611204,K=861165636,S=894720068,ea=826496069,G=1,fa=2,ga=3,V=4,Y=7,ka=
20,na=21,ha=28},{"./check":3}],22:[function(c,f){"function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?f.a={next:function(a){return requestAnimationFrame(a)},cancel:function(a){return cancelAnimationFrame(a)}}:f.a={next:function(a){setTimeout(a,30)},cancel:clearTimeout}},{}],23:[function(c,f){var a=c("./check"),p=c("./is-typed-array");f.a=function(d,c,e){return function(b){var f=b||{};p(b)?f={data:f}:2===arguments.length?f={width:arguments[0]|0,height:arguments[1]|0}:
"object"!==typeof b&&(f={});c();var u=f.x||0,C=f.y||0,J=f.width||e.width,x=f.height||e.height,r=J*x*4,f=f.data||new Uint8Array(r);a.Sa(f);a(f.byteLength>=r,"data buffer too small");d.pixelStorei(3333,4);d.readPixels(u,C,J,x,6408,5121,f);return f}}},{"./check":3,"./is-typed-array":18}],24:[function(c,f){var a=c("./check"),p=c("./values");f.a=function(d,c,e){function b(){this.id=J++;this.j=1;this.i=null;this.format=32854;this.height=this.width=0}function f(b){d.isRenderbuffer(b.i)||(b.i=d.createRenderbuffer());
d.bindRenderbuffer(36161,b.i);d.renderbufferStorage(36161,b.format,b.width,b.height)}function u(b){var c=b.i;a(c,"must not double destroy renderbuffer");d.bindRenderbuffer(36161,null);d.isRenderbuffer(c)&&d.deleteRenderbuffer(c);b.i=null;b.j=0;delete x[b.id]}var C={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.Pa&&(C.srgba=35907);c.kb&&(C.rgba16f=34842,C.rgb16f=34843);c.Qb&&(C.rgba32f=34836);var J=0,x={};b.prototype.$=function(){0===--this.j&&u(this)};
return{create:function(d){function c(b){b=b||{};var d=0,r=0;"shape"in b?(r=b.shape,a(Array.isArray(r)&&2<=r.length,"invalid renderbuffer shape"),d=r[0]|0,r=r[1]|0):("radius"in b&&(d=r=b.Za|0),"width"in b&&(d=b.width|0),"height"in b&&(r=b.height|0));var p=e.yb;a(0<=d&&0<=r&&d<=p&&r<=p,"invalid renderbuffer size");c.width=h.width=Math.max(d,1);c.height=h.height=Math.max(r,1);h.format=32854;"format"in b&&(b=b.format,a.b(b,C,"invalid render buffer format"),h.format=C[b]);f(h);return c}var h=new b;x[h.id]=
h;c(d);c.B="renderbuffer";c.C=h;c.aa=function(){h.$()};return c},refresh:function(){p(x).forEach(f)},clear:function(){p(x).forEach(u)}}}},{"./check":3,"./values":32}],25:[function(c,f){function a(a,d,b){this.name=a;this.location=d;this.info=b}var p=c("./check"),d=c("./values");f.a=function(c,e,b,f,u){function C(b,a){var d=35632===b?r:m,e=d[a];if(!e){var f=u.Lb(a),e=c.createShader(b);c.shaderSource(e,f);c.compileShader(e);p.Kb(c,e,f,b);d[a]=e}return e}function J(b,a){this.ob=b;this.Ob=a;this.va=null;
this.X=[];this.attributes=[];this.S=function(){};this.Ba={}}function x(d){var q,r;q=C(35632,d.ob);r=C(35633,d.Ob);var m=d.va=c.createProgram();c.attachShader(m,q);c.attachShader(m,r);c.linkProgram(m);p.ub(c,m);var u=c.getProgramParameter(m,35718),w=d.X=[];for(q=0;q<u;++q)if(r=c.getActiveUniform(m,q))if(1<r.size)for(var x=0;x<r.size;++x){var J=r.name.replace("[0]","["+x+"]");b.f(J);w.push(new a(J,c.getUniformLocation(m,J),r))}else b.f(r.name),w.push(new a(r.name,c.getUniformLocation(m,r.name),r));
u=c.getProgramParameter(m,35721);w=d.attributes=[];for(q=0;q<u;++q)if(r=c.getActiveAttrib(m,q))e.f(r.name),w.push(new a(r.name,c.getAttribLocation(m,r.name),r));d.S=f(d);d.Ba={}}var r={},m={},w={},q=[];return{create:function(b,a){var c=w[a];c||(c=w[a]={});var d=c[b];d||(d=new J(a,b),x(d),c[b]=d,q.push(d));return d},clear:function(){var b=c.deleteShader.bind(c);d(r).forEach(b);r={};d(m).forEach(b);m={};q.forEach(function(b){c.deleteProgram(b.va)});q.length=0;w={}},refresh:function(){r={};m={};q.forEach(x)},
Fb:[null],pb:[u.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],Pb:[u.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./check":3,"./values":32}],26:[function(c,f){f.a=function(a,c){var d=a.length,h=a.slice(),e=a.slice(),b=!1,f=!0;return{push:function(){b=!1;for(var a=0;a<d;++a){var c=arguments[a];b=b||c!==e[a];h.push(c)}},pop:function(){b=!1;h.length-=d;for(var a=0;a<d;++a)b=b||h[h.length-d+a]!==e[a]},K:function(){var a=h.length-d;if(b||f){switch(d){case 1:c(h[a]);break;case 2:c(h[a],h[a+1]);
break;case 3:c(h[a],h[a+1],h[a+2]);break;case 4:c(h[a],h[a+1],h[a+2],h[a+3]);break;case 5:c(h[a],h[a+1],h[a+2],h[a+3],h[a+4]);break;case 6:c(h[a],h[a+1],h[a+2],h[a+3],h[a+4],h[a+5]);break;default:c.apply(null,h.slice(a,h.length))}for(var C=0;C<d;++C)e[C]=h[a+C];f=b=!1}},$a:function(){f=!0}}}},{}],27:[function(c,f){var a=c("./stack"),p=c("./codegen");f.a=function(c,f,e){function b(b,e){var f=a([!!e],function(a){a?c.enable(b):c.disable(b)});f.kc=b;return f}var l={dither:b(3024),"blend.enable":b(3042),
"blend.color":a([0,0,0,0],function(b,a,e,f){c.blendColor(b,a,e,f)}),"blend.equation":a([32774,32774],function(b,a){c.blendEquationSeparate(b,a)}),"blend.func":a([1,0,1,0],function(b,a,e,f){c.blendFuncSeparate(b,a,e,f)}),"depth.enable":b(2929,!0),"depth.func":a([513],function(b){c.depthFunc(b)}),"depth.range":a([0,1],function(b,a){c.depthRange(b,a)}),"depth.mask":a([!0],function(b){c.depthMask(b)}),"cull.enable":b(2884),"cull.face":a([1029],function(b){c.cullFace(b)}),frontFace:a([2305],function(b){c.frontFace(b)}),
colorMask:a([!0,!0,!0,!0],function(b,a,e,f){c.colorMask(b,a,e,f)}),lineWidth:a([1],function(b){c.lineWidth(b)}),"polygonOffset.enable":b(32823),"polygonOffset.offset":a([0,0],function(b,a){c.polygonOffset(b,a)}),"sample.alpha":b(32926),"sample.enable":b(32928),"sample.coverage":a([1,!1],function(b,a){c.sampleCoverage(b,a)}),"stencil.enable":b(2960),"stencil.mask":a([-1],function(b){c.stencilMask(b)}),"stencil.func":a([519,0,-1],function(b,a,e){c.stencilFunc(b,a,e)}),"stencil.opFront":a([7680,7680,
7680],function(b,a,e){c.stencilOpSeparate(1028,b,a,e)}),"stencil.opBack":a([7680,7680,7680],function(b,a,e){c.stencilOpSeparate(1029,b,a,e)}),"scissor.enable":b(3089),"scissor.box":a([0,0,-1,-1],function(b,a,e,q){var l=e,p=f.top();0>e&&(l=p?p.width-b:c.drawingBufferWidth-b);e=q;0>q&&(e=p?p.height-a:c.drawingBufferHeight-a);c.scissor(b,a,l,e)}),viewport:a([0,0,-1,-1],function(b,a,l,q){var p=l,u=f.top();0>l&&(p=u?u.width-b:c.drawingBufferWidth-b);l=q;0>q&&(l=u?u.height-a:c.drawingBufferHeight-a);c.viewport(b,
a,p,l);e.width=p;e.height=l})},u=p(),C=u.ca("poll"),J=u.ca("refresh");Object.keys(l).forEach(function(b){b=u.link(l[b]);C(b,".poll();");J(b,".setDirty();")});var x=u.compile();return{gb:l,viewport:e,K:x.K,refresh:x.refresh,Bb:function(){l.viewport.$a();l["scissor.box"].$a()}}}},{"./codegen":5,"./stack":26}],28:[function(c,f){f.a=function(){var a={},c=[""];return{id:function(d){var f=a[d];if(f)return f;f=a[d]=c.length;c.push(d);return f},Lb:function(a){return c[a]}}}},{}],29:[function(c,f){function a(b){return Array.isArray(b)&&
(0===b.length||"number"===typeof b[0])}function p(b){if(!Array.isArray(b))return!1;var a=b.length;if(0===a||!Array.isArray(b[0]))return!1;for(var c=b[0].length,d=1;d<a;++d)if(!Array.isArray(b[d])||b[d].length!==c)return!1;return!0}function d(b){return Object.prototype.toString.call(b)}function h(b){return"[object HTMLCanvasElement]"===d(b)}function e(b){return"[object CanvasRenderingContext2D]"===d(b)}var b=c("./check"),l=c("./extend"),u=c("./values"),C=c("./is-typed-array"),J=c("./is-ndarray"),x=
c("./load-texture"),r=c("./to-half-float"),m=c("./parse-dds"),w=[9984,9986,9985,9987];f.a=function(c,f,K,S,ea){function G(b){this.target=b;this.ua=this.ma=!1;this.ab=1;this.type=this.l=this.format=this.g=this.height=this.width=this.ga=0;this.D=!1;this.y=this.x=this.offset=this.L=this.ya=this.da=this.s=0;this.ha=!1;this.crossOrigin=this.P=this.canvas=this.video=this.w=this.data=null;this.W=this.oa=!1}function fa(b){this.target=b;this.type=this.l=this.format=this.height=this.width=0;this.O=this.N=33071;
this.V=0;this.Ga=9728;this.ea=1;this.J=!1;this.Ua=4352}function ga(a,c){var d,e,h=0,A=0,l=0,p=0,r=0,q=0,m=!1,n=!1,u=!1,x=0,v=[0,0,0,0,0,0],y=0,H=!1;for(d=0;d<c.length;++d){e=c[d];var p=p||e.width<<e.s,r=r||e.height<<e.s,h=h||e.type,A=A||e.format,l=l||e.l,q=q||e.g,n=n||e.oa,u=u||e.W,m=m||e.D,C=e.s;e=e.target;H=H||0<C;3553===e?x|=1<<C:(e=e-34069,v[e]|=1<<C,y|=1<<e)}a.oa=n;a.W=u;a.width=p;a.height=r;a.format=A;a.l=l;a.type=h;n=H?(p<<1)-1:1;if(3553===a.target)b(0===y,"pixmap type must not contain cubemap faces"),
b(x===n,"missing mip map data");else for(b(63===y,"missing cubemap faces"),d=0;6>d;++d)b(v[d]===n,"missing mip map data");d=0<=w.indexOf(a.V);a.J=!H&&(a.J||d);H=H||a.J;a.V?b(H===d,"min filter inconsistent with mipmap data"):a.V=H?9987:9728;H&&b(p===r&&!(p&p-1)&&!!p,"must be a square power of 2 to support mipmaps");a.J&&b(!m,"mipmap generation not supported for compressed textures");a.N=a.N||33071;a.O=a.O||33071;33071===a.N&&33071===a.O||b(!(p&p-1)&&!!p&&!(r&r-1)&&!!r&&!y,"incompatible size for wrap mode, image must be a power of 2");
(5126===h&&!f.Dc||36193===h&&!f.Ec)&&b(9728===this.Ga&&9728===this.V,"unsupported filter mode for float texture");for(d=0;d<c.length;++d)e=c[d],m=e.s,e.width&&b(e.width<<m===p,"inconsistent width"),e.height&&b(e.height<<m===r,"inconsistent width"),e.g?b(e.g===q,"inconsistent channels"):e.g=q,e.format?b(e.format===A,"inconsistent format"):e.format=A,e.l?b(e.l===l,"inconsistent internalformat"):e.l=l,e.type?b(e.type===h,"inconsistent type"):e.type=h,e.ha&&b(5121===e.type&&6408===e.l,"incompatible format/type for copyTexImage2D")}
function V(b){this.id=y++;this.j=1;this.target=b;this.c=null;this.Y=this.ta=-1;this.fa=0;this.Da=null;this.A=new fa(b);this.H=[]}function Y(a,c){function d(b,a){var g=a.Ab,e;if(Array.isArray(g))for(var f=0;f<g.length;++f)e=new G(b),e.ra(c),e.ra(a),e.parse(g[f],f),h.push(e);else e=new G(b),e.ra(c),e.parse(a,0),h.push(e)}var e;ha(a);var f=a.A;fa.call(f,a.target);var h=a.H;h.length=0;f.parse(c);if(3553===a.target)d(3553,c);else{var l=c.hc||c;if(Array.isArray(l))for(b(6===l.length,"invalid number of faces in cube map"),
e=0;6>e;++e)d(34069+e,l[e]);else if("string"!==typeof l)for(e=0;6>e;++e)d(34069+e,{})}ga(f,h);f.W&&na(a);f.oa&&(a.ta=D.length,D.push(a));ka(a)}function ka(b){c.isTexture(b.c)||(b.c=c.createTexture());var a=b.target,d=b.Y;0<=d?(c.activeTexture(33984+d),Q=d):c.bindTexture(a,b.c);for(var a=b.H,e=b.A,f=0;f<a.length;++f)a[f].upload(e);e.upload();0>d&&((d=ba[Q])?c.bindTexture(d.target,d.c):(b.Y=Q,ba[Q]=b))}function na(a){function c(d,e,h){var t=m(h);b(t.format in M,"unsupported dds texture format");t.ia?
(b(34067===a.target),b.h("cube map DDS not yet implemented")):b(3553===a.target);e&&b(1===t.H.length,"number of mip levels inconsistent");t.H.forEach(function(b){var a=new G(t.ia?b.target:d);a.g=t.g;a.D=t.D;a.type=t.type;a.l=t.format;a.format=M[t.format];a.width=b.width;a.height=b.height;a.s=b.s||e;a.data=b.data;f.push(a)})}function d(){for(var b=0;b<f.length;++b){var h=f[b],t=h.w,l=h.video,p=h.P;t&&t.complete?(h.width=t.naturalWidth,h.height=t.naturalHeight):l&&2<l.readyState?(h.width=l.width,h.height=
l.height):p&&4===p.readyState&&(f[b]=f[f.length-1],f.pop(),p.removeEventListener("readystatechange",ka),c(h.target,h.s,p.response))}ga(e,f);ka(a)}var e=a.A,f=a.H;f.forEach(function(b){b.w&&!b.w.complete?b.w.addEventListener("load",d):b.video&&1>b.readyState?b.video.addEventListener("progress",d):b.P&&b.P.addEventListener("readystatechange",d)});a.Da=function(){f.forEach(function(b){b.w?b.w.removeEventListener("load",d):b.video?b.video.removeEventListener("progress",d):b.P&&(b.P.removeEventListener("readystatechange",
d),b.P.abort())})}}function ha(b){var a=b.Da;a&&(a(),b.Da=null);a=b.ta;0<=a&&((D[a]=D[D.length-1]).id=a,D.pop(),b.ta=-1)}function la(a){var d=a.c;b(d,"must not double destroy texture");var e=a.Y,f=a.target;0<=e&&(c.activeTexture(33984+e),Q=e,c.bindTexture(f,null),ba[e]=null);ha(a);c.isTexture(d)&&c.deleteTexture(d);a.c=null;a.A=null;a.H=null;a.j=0;delete n[a.id]}var E={"don't care":4352,"dont care":4352,nice:4354,fast:4353},B={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,linear:9729},Z=
l({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),ia={none:0,browser:37444},ca={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},T={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},aa={};f.Pa&&(T.Oc=35904,T.Pc=35906);f.Va&&(ca.mb=5126);f.Wa&&(ca["half float"]=36193);f.Ka&&(l(T,{depth:6402,"depth stencil":34041}),l(ca,{uint16:5123,uint32:5125,"depth stencil":34042}));
f.Zc&&l(aa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.Wc&&l(aa,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.Yc&&l(aa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});f.Xc&&(aa["rgb etc1"]=36196);var W=Array.prototype.slice.call(c.getParameter(34467));Object.keys(aa).forEach(function(b){var a=aa[b];0<=W.indexOf(a)&&(T[b]=a)});var v=Object.keys(T);
K.Uc=v;var M=v.reduce(function(b,a){var c=T[a];b[c]=6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?c:32855===c||0<=a.indexOf("rgba")?6408:6407;return b},{});l(G.prototype,{ra:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(b.type(a.ua,"boolean","invalid premultiplyAlpha"),this.ua=a.ua);"flipY"in a&&(b.type(a.ma,"boolean","invalid texture flip"),this.ma=a.ma);"alignment"in a&&(b.qa(a.cb,[1,2,4,8],"invalid texture unpack alignment"),this.ab=a.cb);"colorSpace"in a&&(b.b(a.ga,
ia,"invalid colorSpace"),this.ga=ia[a.ga]);if("format"in a){var c=a.format;b.b(c,T,"invalid texture format");this.l=T[c];c in ca&&(this.type=ca[c]);c in aa&&(this.D=!0)}"type"in a&&(c=a.type,b.b(c,ca,"invalid texture type"),this.type=ca[c]);var c=this.width,d=this.height,e=this.g;"shape"in a?(b(Array.isArray(a.shape)&&2<=a.shape.length,"shape must be an array"),c=a.shape[0],d=a.shape[1],3===a.shape.length&&(e=a.shape[2])):("radius"in a&&(c=d=a.Za),"width"in a&&(c=a.width),"height"in a&&(d=a.height),
"channels"in a&&(e=a.g));this.width=c|0;this.height=d|0;this.g=e|0;"stride"in a?(c=a.m,b(Array.isArray(c)&&2<=c.length,"invalid stride vector"),this.da=c[0],this.ya=c[1],3===c.length?this.L=c[2]:this.L=1,this.pa=!0):(this.L=1,this.da=this.L*e,this.ya=this.da*c);"offset"in a&&(this.offset=a.offset|0,this.pa=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(c,l){this.s=l;this.width=this.width>>l;this.height=this.height>>l;var t=c;switch(typeof c){case "string":break;case "object":if(!c)return;
this.ra(c);var m=c.data;if("string"===typeof m||m&&(C(m)||a(m)||J(m)||h(m)||e(m)||"[object HTMLImageElement]"===d(m)||"[object HTMLVideoElement]"===d(m)||p(m)))t=c.data;break;case "undefined":return;default:b.h("invalid pixel data type")}"string"===typeof t&&(t=x(t,this.crossOrigin));var m=null,q=!1;this.D&&b(t instanceof Uint8Array||"[object XMLHttpRequest]"===d(t),"compressed texture data must be stored in a uint8array");if(null!==t)if(C(t))this.data=t;else if(a(t))m=t,q=!0;else if(J(t)){Array.isArray(t.data)?
(m=t.data,q=!0):this.data=t.data;var n=t.shape;this.width=n[0];this.height=n[1];3===n.length?this.g=n[2]:this.g=1;n=t.m;this.da=t.m[0];this.ya=t.m[1];3===n.length?this.L=t.m[2]:this.L=1;this.offset=t.offset;this.pa=!0}else if(h(t)||e(t))h(t)?this.canvas=t:this.canvas=t.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.wa();else if("[object HTMLImageElement]"===d(t))this.w=t,t.complete?(this.width=t.naturalWidth,this.height=t.naturalHeight):(this.width=this.width||t.naturalWidth,
this.height=this.height||t.naturalHeight,this.W=!0),this.wa();else if("[object HTMLVideoElement]"===d(t))this.video=t,1<t.readyState?(this.width=t.width,this.height=t.height):(this.width=this.width||t.width,this.height=this.height||t.height,this.W=!0),this.oa=!0,this.wa();else if("[object XMLHttpRequest]"===d(t))this.P=t,this.W=!0;else if(p(t)){var q=t.length,n=t[0].length,u=1,v,w,y,B;if(Array.isArray(t[0][0]))for(u=t[0][0].length,b(0<=u&&4>=u,"invalid number of channels for image data"),m=Array(q*
n*u),w=B=0;w<n;++w)for(v=0;v<q;++v)for(y=0;y<u;++y)m[B++]=t[v][w][y];else for(m=Array(q*n),w=B=0;w<n;++w)for(v=0;v<q;++v)m[B++]=t[v][w];this.width=q;this.height=n;this.g=u;q=!0}else c.ha&&(this.ha=!0,this.x=this.x|0,this.y=this.y|0,this.width=(this.width||ea.width)|0,this.height=(this.height||ea.height)|0,this.wa());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=
5126));this.l||(this.l=[6409,6410,6407,6408][(this.g=this.g||4)-1],b(this.l,"invalid number of channels"));n=this.l;if(6402===n||34041===n)b(f.Ka,"depth/stencil texture not supported"),6402===n&&b(5123===this.type||5125,"depth texture type must be uint16 or uint32"),34041===n&&b(34042===this.type,"depth stencil texture format must match type"),b(!this.data&&!m&&!this.w&&!this.video&&!this.canvas,"depth/stencil textures are for rendering only");t=this.format=M[n];if(!this.g)switch(t){case 6409:case 6406:case 6402:this.g=
1;break;case 34041:case 6410:this.g=2;break;case 6407:this.g=3;break;default:this.g=4}t=this.type;5126===t?b(f.Va,"float texture not supported"):36193===t?b(f.Wa,"half float texture not supported"):t||(t=6402===n?5125:5121);this.type=t;if(q)switch(t){case 5121:this.data=new Uint8Array(m);break;case 5123:this.data=new Uint16Array(m);break;case 5125:this.data=new Uint32Array(m);break;case 5126:this.data=new Float32Array(m);break;case 36193:this.data=r(m);break;case 33635:case 32820:case 32819:case 34042:b.h("unsupported format for automatic conversion");
break;default:b.h("unsupported type conversion")}if(this.data){if(this.pa){m=this.data;q=this.width;n=this.height;u=this.g;v=this.da;w=this.ya;y=this.L;B=this.offset;for(var z=new m.constructor(q*n*u),E=0,D=0;D<n;++D)for(var F=0;F<q;++F)for(var G=0;G<u;++G)z[E++]=m[w*D+v*F+y*G+B];this.data=z}switch(t){case 5121:b(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case 33635:case 32820:case 32819:case 5123:case 36193:b(this.data instanceof Uint16Array,
"incompatible pixel type");break;case 5125:b(this.data instanceof Uint32Array,"incompatible pixel type");break;case 5126:b(this.data instanceof Float32Array,"incompatible pixel type");break;default:b.h("bad or missing pixel type")}}this.pa=!1},wa:function(){this.format=this.l=6408;this.type=5121;this.g=4;this.D=!1},upload:function(a){c.pixelStorei(37440,this.ma);c.pixelStorei(37441,this.ua);c.pixelStorei(37443,this.ga);c.pixelStorei(3317,this.ab);var b=this.target,d=this.s,e=this.w,f=this.canvas,
h=this.video,l=this.data,m=this.l,p=this.format,n=this.type,r=this.width||Math.max(1,a.width>>d);a=this.height||Math.max(1,a.height>>d);h&&2<h.readyState?c.texImage2D(b,d,p,p,n,h):e&&e.complete?c.texImage2D(b,d,p,p,n,e):f?c.texImage2D(b,d,p,p,n,f):this.D?c.compressedTexImage2D(b,d,m,r,a,0,l):this.ha?(S(),c.copyTexImage2D(b,d,p,this.x,this.y,r,a,0)):l?c.texImage2D(b,d,p,r,a,0,p,n,l):c.texImage2D(b,d,p,r||1,a||1,0,p,n,null)}});l(fa.prototype,{parse:function(a){if("object"===typeof a&&a){if("min"in a){var c=
a.min;b.b(c,Z);this.V=Z[c]}"mag"in a&&(c=a.sc,b.b(c,ma),this.Ga=ma[c]);var c=this.N,d=this.O;if("wrap"in a){var e=a.$c;"string"===typeof e?(b.b(e,B),c=d=B[e]):Array.isArray(e)&&(b.b(e[0],B),b.b(e[1],B),c=B[e[0]],d=B[e[1]])}else"wrapS"in a&&(c=a.N,b.b(c,B),c=B[c]),"wrapT"in a&&(d=a.O,b.b(d,B),d=B[d]);this.N=c;this.O=d;"anisotropic"in a&&(c=a.ea,b("number"===typeof c&&1<=c&&c<=K.vb,"aniso samples must be between 1 and "),this.ea=a.ea);if("mipmap"in a)switch(a=a.Ab,typeof a){case "string":b.b(a,E,"invalid mipmap hint");
this.Ua=E[a];this.J=!0;break;case "boolean":this.J=!!a;break;case "object":break;default:b.h("invalid mipmap type")}}},upload:function(){var a=this.target;c.texParameteri(a,10241,this.V);c.texParameteri(a,10240,this.Ga);c.texParameteri(a,10242,this.N);c.texParameteri(a,10243,this.O);f.lb&&c.texParameteri(a,34046,this.ea);this.J&&(c.hint(33170,this.Ua),c.generateMipmap(a))}});var Q=0,y=0,n={},D=[],F=K.zb,ba=Array(F).map(function(){return null});l(V.prototype,{bind:function(){this.fa+=1;var a=this.Y;
if(0>a){for(var d=0;d<F;++d){var e=ba[d];if(e){if(0<e.fa)continue;e.Y=-1}ba[d]=this;a=d;break}a>=F&&b.h("insufficient number of texture units");this.Y=a;c.activeTexture(33984+a);c.bindTexture(this.target,this.c);Q=a}return a},Vc:function(){--this.fa},$:function(){0===--this.j&&la(this)}});return{create:function(a,b){function c(a,e,f,h,g,l){var p=a||{};34067===b&&6===arguments.length&&(p=[a,e,f,h,g,l]);Y(d,p);c.width=d.A.width;c.height=d.A.height;return c}var d=new V(b);n[d.id]=d;c(a);c.B="texture";
c.v=d;c.aa=function(){d.$()};return c},refresh:function(){u(n).forEach(ka);for(var a=0;a<F;++a)ba[a]=null;Q=0;c.activeTexture(33984)},clear:function(){for(var a=0;a<F;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),ba[a]=null;c.activeTexture(33984);Q=0;u(n).forEach(la)},K:function(){D.forEach(ka)},mc:function(){return null}}}},{"./check":3,"./extend":14,"./is-ndarray":17,"./is-typed-array":18,"./load-texture":20,"./parse-dds":21,"./to-half-float":30,"./values":32}],30:[function(c,f){f.a=function(a){for(var c=
new Float32Array(a),c=new Uint32Array(c.buffer),d=new Uint16Array(a.length),f=0;f<a.length;++f)if(isNaN(a[f]))d[f]=65535;else if(Infinity===a[f])d[f]=31744;else if(-Infinity===a[f])d[f]=64512;else{var e=c[f],b=e>>>31<<15,l=(e<<1>>>24)-127,e=e>>13&1023;d[f]=-24>l?b:-14>l?b+(e+1024>>-14-l):15<l?b+31744:b+(l+15<<10)+e}return d}},{}],31:[function(c,f){f.a=function(a){var c={};return{f:function(d){d=a.id(d);var f=c[d];f||(f=c[d]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return f}}}},{}],32:[function(c,f){f.a=
function(a){return Object.keys(a).map(function(c){return a[c]})}},{}],33:[function(c,f){var a=c("./lib/check"),p=c("./lib/extend"),d=c("./lib/context"),h=c("./lib/strings"),e=c("./lib/extension"),b=c("./lib/limits"),l=c("./lib/buffer"),u=c("./lib/elements"),C=c("./lib/texture"),J=c("./lib/renderbuffer"),x=c("./lib/framebuffer"),r=c("./lib/uniform"),m=c("./lib/attribute"),w=c("./lib/shader"),q=c("./lib/draw"),O=c("./lib/state"),K=c("./lib/compile"),S=c("./lib/read"),ea=c("./lib/dynamic"),G=c("./lib/raf"),
fa=c("./lib/clock");f.a=function(){function c(){P=G.next(c);F.count+=1;if(F.width!==E.drawingBufferWidth||F.height!==E.drawingBufferHeight)F.width=E.drawingBufferWidth,F.height=E.drawingBufferHeight,ba.Bb();var a=fa();F.Oa=a-F.t;F.t=a;y.K();for(var b=0;b<t.length;++b)(0,t[b])(F.count,F.t,F.Oa);F.Ib=fa()-a}function f(){P&&(G.cancel(c),P=0)}function Y(a){f();a.preventDefault();B.Cb&&B.Cb()}function ka(){ma.refresh();T.refresh();y.refresh();n.refresh();D.refresh();M.refresh();ba.refresh();B.Db&&B.Db();
c()}function na(b){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];ea.sb(f)?(d=!0,e[c]=ea.Mb(f,c)):b[c]=f});return{Ea:e,Ja:b}}a(!!b,"invalid args to regl({...})");a.type(b,"object","invalid args to regl({...})");var d=!1,e=c(b.X||{}),f=c(b.attributes||{});b=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=p({},a);delete c.X;delete c.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");
b("scissor");b("sample");return c}(b));var e=g.fb(b.Ja,e.Ja,f.Ja,b.Ea,e.Ea,f.Ea,d),h=e.S,l=e.eb,m=e.scope,n=[];return function(a,b){var c;if("number"===typeof a){for(c=a|0;n.length<c;)n.push(null);c=l(a|0,n)}else c=Array.isArray(a)?l(a.length,a):"function"===typeof a?m(null,a):"function"===typeof b?m(a,b):h(a);return c}}function ha(){D.K();ba.K()}var la=d(Array.prototype.slice.call(arguments)),E=la.Fa,B=la.options,la=h(),ma=e(E),Z=ma.Qa,ia={width:E.drawingBufferWidth,height:E.drawingBufferHeight},
ca=b(E,Z),T=l(E),aa=u(E,Z,T),W=r(la),v=m(E,Z,ca,T,la),M=w(E,v,W,function(a){return g.S(a)},la),Q=q(E,Z,T),y=C(E,Z,ca,ha,ia),n=J(E,Z,ca),D=x(E,Z,ca,y,n),F={count:0,start:fa(),Oa:0,t:fa(),Ib:0,width:E.drawingBufferWidth,height:E.drawingBufferHeight,sa:B.sa},ba=O(E,D,ia),ia=S(E,ha,ia),g=K(E,la,Z,ca,T,aa,y,D,ba,W,v,M,Q,F,ha),I=E.canvas,t=[],P=0;I&&(I.addEventListener("webglcontextlost",Y,!1),I.addEventListener("webglcontextrestored",ka,!1));return p(na,{clear:function(b){var c=0;ha();var d=b.color;d&&
(E.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(E.clearDepth(+b.depth),c|=256);"stencil"in b&&(E.clearStencil(b.stencil|0),c|=1024);a(!!c,"called regl.clear with no buffer specified");E.clear(c)},Hc:ea.hb,S:na({}),elements:function(a){return aa.create(a)},buffer:function(a){return T.create(a,34962)},c:function(a){return y.create(a,3553)},ia:function(a){return 6===arguments.length?y.create(Array.prototype.slice.call(arguments),34067):y.create(a,34067)},i:function(a){return n.create(a)},
T:function(a){return D.create(a)},lc:function(){a.h("framebuffer cube not yet implemented")},frame:function(a){t.push(a);!P&&0<t.length&&c();return{cancel:function(){var b=t.find(function(b){return b===a});0>b||(t.splice(b,1),0>=t.length&&f())}}},Qc:F,rc:ca,read:ia,aa:function(){f();I&&(I.removeEventListener("webglcontextlost",Y),I.removeEventListener("webglcontextrestored",ka));M.clear();D.clear();n.clear();y.clear();T.clear();B.Ha&&B.Ha()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/check":3,
"./lib/clock":4,"./lib/compile":6,"./lib/context":10,"./lib/draw":11,"./lib/dynamic":12,"./lib/elements":13,"./lib/extend":14,"./lib/extension":15,"./lib/framebuffer":16,"./lib/limits":19,"./lib/raf":22,"./lib/read":23,"./lib/renderbuffer":24,"./lib/shader":25,"./lib/state":27,"./lib/strings":28,"./lib/texture":29,"./lib/uniform":31}]},{},[33])(33)});
