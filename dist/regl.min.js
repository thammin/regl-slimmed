(function(va){"object"===typeof exports&&"undefined"!==typeof module?module.exports=va():"function"===typeof define&&define.amd?define([],va):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).initREGL=va()})(function(){return function d(g,m,c){function p(a,e){if(!m[a]){if(!g[a]){var B="function"==typeof require&&require;if(!e&&B)return B(a,!0);if(b)return b(a,!0);B=Error("Cannot find module '"+a+"'");throw B.code="MODULE_NOT_FOUND",B;}B=m[a]=
{exports:{}};g[a][0].call(B.exports,function(b){var c=g[a][1][b];return p(c?c:b)},B,B.exports,d,g,m,c)}return m[a].exports}for(var b="function"==typeof require&&require,a=0;a<c.length;a++)p(c[a]);return p}({1:[function(d,g,m){function c(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}var p=d("./constants/dtypes.json"),b=d("./extend");b(c.prototype,{equals:function(a,b){return this.pointer?a.pointer&&
this.buffer===a.buffer&&this.size===b&&this.normalized===a.normalized&&this.type===a.type&&this.offset===a.offset&&this.stride===a.stride&&this.divisor===a.divisor:!a.pointer&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},set:function(a,b){(this.pointer=a.pointer)?(this.buffer=a.buffer,this.size=b,this.normalized=a.normalized,this.type=a.type,this.offset=a.offset,this.stride=a.stride,this.divisor=a.divisor):(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w)}});g.exports=function(a,d,e,B,l){function g(){for(var a=
Array(16),b=0;16>b;++b)a[b]=new c;this.records=a;this.top=0}function y(a){for(var b=a.records,h=a.top;b.length-1<=h;)b.push(new c);return b[++a.top]}var E={};e=e.maxAttributes;for(var h=Array(e),w=0;w<e;++w)h[w]=new c;b(g.prototype,{pushVec:function(a,b,c,h){var l=y(this);l.pointer=!1;l.x=a;l.y=b;l.z=c;l.w=h},pushPtr:function(a,b,c,h,l,p,e){var d=y(this);d.pointer=!0;d.buffer=a;d.size=b;d.offset=c;d.stride=h;d.divisor=l;d.normalized=p;d.type=e},pushDyn:function(a){if("number"===typeof a)this.pushVec(a,
0,0,0);else if(Array.isArray(a))this.pushVec(a[0],a[1],a[2],a[3]);else{var b=B.getBuffer(a),c=0,h=0,l=0,e=0,d=!1,w=5126;b?w=b.dtype:(b=B.getBuffer(a.buffer),c=a.size||0,h=a.stride||0,l=a.offset||0,e=a.divisor||0,d=a.normalized||!1,w=b.dtype,"type"in a&&(w=p[a.type]));this.pushPtr(b,c,l,h,e,d,w)}},pop:function(){--this.top}});return{bindings:h,bind:function(b,c,h,l){l=h.size||l;if(!c.equals(h,l)){if(h.pointer){c.pointer||a.enableVertexAttribArray(b);c.buffer!==h.buffer&&h.buffer.bind();a.vertexAttribPointer(b,
l,h.type,h.normalized,h.stride,h.offset);var p=d.angle_instanced_arrays;p&&p.vertexAttribDivisorANGLE(b,h.divisor)}else c.pointer&&a.disableVertexAttribArray(b),a.vertexAttrib4f(b,h.x,h.y,h.z,h.w);c.set(h,l)}},def:function(a){a=l.id(a);var b=E[a];b||(b=E[a]=new g);return b}}}},{"./constants/dtypes.json":7,"./extend":13}],2:[function(d,g,m){function c(a,b){switch(a){case 5121:return new Uint8Array(b);case 5123:return new Uint16Array(b);case 5125:return new Uint32Array(b);case 5120:return new Int8Array(b);
case 5122:return new Int16Array(b);case 5124:return new Int32Array(b);case 5126:return new Float32Array(b);default:return null}}var p=d("./is-typed-array"),b=d("./is-ndarray"),a=d("./constants/arraytypes.json"),H=d("./constants/dtypes.json"),e=d("./values"),B={"static":35044,dynamic:35048,stream:35040};g.exports=function(l){function d(a,b){this.id=h++;this.buffer=a;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function g(a){l.isBuffer(a.buffer)||(a.buffer=
l.createBuffer());a.bind();l.bufferData(a.type,a.data||a.byteLength,a.usage)}function E(a){var b=a.buffer;l.isBuffer(b)&&l.deleteBuffer(b);a.buffer=null;delete w[a.id]}var h=0,w={};d.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)};return{create:function(h,e,da){function u(h){var f=h||{};if(Array.isArray(f)||p(f)||b(f))f={data:f};else if("number"===typeof f)f={length:f|0};else if(null===f||void 0===f)f={};m.usage="usage"in f?B[f.usage]:35044;h=0;"type"in f&&(h=H[f.type]);var l=f.dimension|
0||1,d=0,e=null;if("data"in f)if(e=f.data,null===e)d=f.length|0;else{if(b(e)){var l=e.shape,d=e.stride,f=e.offset,D=0,w=0,da=0,q=0;1===l.length?(D=l[0],w=1,da=d[0],q=0):2===l.length&&(D=l[0],w=l[1],da=d[0],q=d[1]);h=h||a[Object.prototype.toString.call(e)]|0||5126;for(var l=w,d=c(h,D*w),e=e.data,G=0,ma=0;ma<D;++ma)for(var S=0;S<w;++S)d[G++]=e[da*ma+q*S+f];e=d}else if(Array.isArray(e))if(0<e.length&&Array.isArray(e[0])){l=e[0].length;h=h||5126;f=c(h,e.length*l);d=e;e=l;for(D=q=0;D<d.length;++D)for(da=
d[D],w=0;w<e;++w)f[q++]=da[w];e=f}else h=h||5126,e=c(h,e);else h=h||a[Object.prototype.toString.call(e)]|0;d=e.byteLength}else"length"in f&&(d=f.length|0);m.data=e;m.dtype=h||5121;m.byteLength=d;m.dimension=l;g(m);return u}var Q=l.createBuffer(),m=new d(Q,e);w[m.id]=m;da||u(h);u._reglType="buffer";u._buffer=m;u.destroy=function(){E(m)};return u},clear:function(){e(w).forEach(E)},refresh:function(){e(w).forEach(g)},getBuffer:function(a){return a&&a._buffer instanceof d?a._buffer:null}}}},{"./constants/arraytypes.json":6,
"./constants/dtypes.json":7,"./is-ndarray":16,"./is-typed-array":17,"./values":31}],3:[function(d,g,m){g.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],4:[function(d,g,m){var c=d("./extend");g.exports=function(){function d(){var a=[],l=[];return c(function(){a.push.apply(a,Array.prototype.slice.call(arguments))},{def:function(){var c="v"+b++;l.push(c);0<arguments.length&&(a.push(c,"="),a.push.apply(a,Array.prototype.slice.call(arguments)),
a.push(";"));return c},toString:function(){return[0<l.length?"var "+l+";":"",a.join("")].join("")}})}var b=0,a=[],H=[],e={};return{link:function(c){var l="g"+b++;a.push(l);H.push(c);return l},block:d,proc:function(a){var l=[],H=d(),g=H.toString;return e[a]=c(H,{arg:function(){var a="a"+b++;l.push(a);return a},toString:function(){return["function(",l.join(),"){",g(),"}"].join("")}})},compile:function(){var b=['"use strict";return {'];Object.keys(e).forEach(function(a){b.push('"',a,'":',e[a].toString(),
",")});b.push("}");return Function.apply(null,a.concat([b.join("")])).apply(null,H)}}}},{"./extend":13}],5:[function(d,g,m){function c(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function p(a,b,c,f){var l,e=",";switch(b){case 5126:l="1f";break;case 35664:l="2fv";break;case 35665:l="3fv";break;case 35666:l="4fv";break;case 35670:case 5124:l="1i";break;case 35671:case 35667:l="2iv";break;
case 35672:case 35668:l="3iv";break;case 35673:case 35669:l="4iv";break;case 35674:l="Matrix2fv";e=",false,";break;case 35675:l="Matrix3fv";e=",false,";break;case 35676:l="Matrix4fv",e=",false,"}return a+".uniform"+l+"("+c+e+f+");"}function b(a){return a+"["+a+".length-1]"}function a(a,b){return"framebuffer"===a||a<b?-1:a>b?1:0}var H=d("./codegen"),e=d("./constants/primitives.json"),B=d("./constants/dtypes.json"),l={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,
"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},P={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,
invert:5386};g.exports=function(d,h,w,f,D,g,u,m,R,L,V,ea,W,ha,ia){function O(h,f,D,T,G){function B(a){var C=qa[a];return C?C:C=qa[a]=r(M[a])}function K(a){var C=a.id,v=N[C];if(v)return v;v=a.func?k.def(r(a.data),"(",R,",",I,",",ka,")"):k.def(R,".",a.data);return N[C]=v}function u(a,C){return a.find(function(a){return a.name===C})}function ga(a){return O&&!(a in f||a in G)}var X=H(),r=X.link,k=X.proc("batch"),t=X.block(),x=k.def,aa=k.arg,n=r(d),U=r(h.program),Z=r(V.bind),ka=r(ha),oa=r(m),J=r(W.count),
ba=r(W.offset),ta=r(W.instances),la=r(W.primitive),qa={},ca=r(g.elements),J=x(b(J)),ba=x(b(ba)),la=x(b(la)),ca=x(b(ca)),z,F,na=w.angle_instanced_arrays;na&&(z=x(b(ta)),F=r(na));var O="elements"in f,ta=aa(),aa=aa(),R=x(),I=x(),N={};k(n,".useProgram(",U,");");h.uniforms.forEach(function(a){if(!(a.name in D)){var C=r(a.location),v=r(L.def(a.name)),v=v+"["+v+".length-1]";a=a.info.type;35678===a||35680===a?(a=x(v+"._texture"),k(p(n,5124,C,a+".bind()")),t(a,".unbind();")):k(p(n,a,C,v))}});h.attributes.forEach(function(a){if(!(T.name in
T)){var C=r(V.def(a.name));k(Z,"(",a.location,",",r(V.bindings[a.location]),",",C,".records[",C,".top]",",",c(a.info.type),");")}});O||k("if(",ca,"){",n,".bindBuffer(",34963,",",ca,".buffer.buffer);","}else{",n,".bindBuffer(",34963,",null);","}");k("for(",I,"=0;",I,"<",ta,";++",I,"){",R,"=",aa,"[",I,"];");Object.keys(f).sort(a).forEach(function(a){function C(a){k("if(",v,"){",n,".enable(",a,");}else{",n,".disable(",a,");}")}var v=K(f[a]);switch(a){case "framebuffer":a=B("viewport");var b=B("scissor.box");
k("if(",oa,".push(",v,"&&",v,"._framebuffer)){",oa,".poll();",a,".setDirty();",b,".setDirty();","}");break;case "cull.enable":C(2884);break;case "blend.enable":C(3042);break;case "dither":C(3024);break;case "stencil.enable":C(2960);break;case "depth.enable":C(2929);break;case "scissor.enable":C(3089);break;case "polygonOffset.enable":C(32823);break;case "sample.alpha":C(32926);break;case "sample.enable":C(32928);break;case "depth.mask":k(n,".depthMask(",v,");");break;case "depth.func":a=r(P);k(n,
".depthFunc(",a,"[",v,"]);");break;case "depth.range":k(n,".depthRange(",v,"[0],",v,"[1]);");break;case "blend.color":k(n,".blendColor(",v,"[0],",v,"[1],",v,"[2],",v,"[3]);");break;case "blend.equation":a=r(q);k("if(typeof ",v,'==="string"){',n,".blendEquation(",a,"[",v,"]);","}else{",n,".blendEquationSeparate(",a,"[",v,".rgb],",a,"[",v,".alpha]);","}");break;case "blend.func":a=r(l);k(n,".blendFuncSeparate(",a,'["srcRGB" in ',v,"?",v,".srcRGB:",v,".src],",a,'["dstRGB" in ',v,"?",v,".dstRGB:",v,".dst],",
a,'["srcAlpha" in ',v,"?",v,".srcAlpha:",v,".src],",a,'["dstAlpha" in ',v,"?",v,".dstAlpha:",v,".dst]);");break;case "stencil.mask":k(n,".stencilMask(",v,");");break;case "stencil.func":a=r(P);k(n,".stencilFunc(",a,"[",v,'.cmp||"always"],',v,".ref|0,",'"mask" in ',v,"?",v,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":b=r(y);k(n,".stencilOpSeparate(","stencil.opFront"===a?1028:1029,",",b,"[",v,'.fail||"keep"],',b,"[",v,'.zfail||"keep"],',b,"[",v,'.pass||"keep"]);');break;case "polygonOffset.offset":k(n,
".polygonOffset(",v,".factor||0,",v,".units||0);");break;case "cull.face":k(n,".cullFace(",v,'==="front"?',1028,":",1029,");");break;case "lineWidth":k(n,".lineWidth(",v,");");break;case "frontFace":k(n,".frontFace(",v,'==="cw"?',2304,":",2305,");");break;case "colorMask":k(n,".colorMask(",v,"[0],",v,"[1],",v,"[2],",v,"[3]);");break;case "sample.coverage":k(n,".sampleCoverage(",v,".value,",v,".invert);");break;case "scissor.box":case "viewport":a=B(a),k(a,".push(",v,".x||0,",v,".y||0,",v,".w||-1,",
v,".h||-1);")}});("viewport"in f||"framebuffer"in f)&&k(B("viewport"),".poll();");("scissor.box"in f||"framebuffer"in f)&&k(B("scissor.box"),".poll();");"framebuffer"in f&&k(oa,".pop();");var ea=h.uniforms,ia=[];Object.keys(D).forEach(function(a){var C=u(ea,a);if(C){var v=C.info.type,b=r(C.location);a=K(D[a]);35678===C.info.type||35680===C.info.type?(C=x(a+"._texture"),ia.push(C),k(p(n,5124,b,C+".bind()"))):k(p(n,v,b,a))}});ia.forEach(function(a){k(a,".unbind();")});var ua=h.attributes;Object.keys(T).forEach(function(a){var C=
u(ua,a);C&&k(Z,"(",C.location,",",r(a.bindings[C.location]),",",K(T[a]),",",c(C.info.type),");")});f.count?k(J,"=",K(f.count),";"):ga("count")||k("if(",J,"){");f.offset&&k(ba,"=",K(f.offset),";");f.primitive&&(h=r(e),k(la,"=",h,"[",K(f.primitive),"];"));O&&(h=K(f.elements),k(ca,"=",h,"?",h,"._elements:null;"));ga("offset")&&k(ba,"=0;");k("if(",ca,"){");ga("count")&&k(J,"=",ca,".vertCount;","if(",J,">0){");ga("primitive")&&k(la,"=",ca,".primType;");O&&k(n,".bindBuffer(",34963,",",ca,".buffer.buffer);");
na&&(f.instances&&k(z,"=",K(f.instances),";"),k("if(",z,">0){",F,".drawElementsInstancedANGLE(",la,",",J,",",ca,".type,",ba,",",z,");}else{"));k(n,".drawElements(",la,",",J,",",ca,".type,",ba,");");na&&k("}");ga("count")&&k("}");k("}else{");ga("count")||(ga("primitive")&&k(la,"=",4,";"),na&&k("if(",z,">0){",F,".drawArraysInstancedANGLE(",la,",",ba,",",J,",",z,");}else{"),k(n,".drawArrays(",la,",",ba,",",J,");}"),na&&k("}"));k("}}",t);return X.compile().batch}var M=R.contextState,q={add:32774,subtract:32778,
"reverse subtract":32779};w.ext_blend_minmax&&(q.min=32775,q.max=32776);var G=0;return{draw:function(a){var h=H(),f=h.link,l=h.proc("draw"),e=l.def,q=f(d),D=f(a.program),B=f(V.bind),G=f(W.count),u=f(W.offset),r=f(W.instances),k=f(W.primitive),t=f(g.elements),m=[];l(q,".useProgram(",D,");");a.attributes.forEach(function(a){var b=f(V.def(a.name));l(B,"(",a.location,",",f(V.bindings[a.location]),",",b,".records[",b,".top]",",",c(a.info.type),");")});a.uniforms.forEach(function(a){var b=f(a.location),
h=f(L.def(a.name)),h=h+"["+h+".length-1]";a=a.info.type;35678===a||35680===a?(a=e(h+"._texture"),m.push(a),l(p(q,5124,b,a+".bind()"))):l(p(q,a,b,h))});m.forEach(function(a){l(a,".unbind();")});a=e(b(k));G=e(b(G));u=e(b(u));t=e(b(t));l("if(",G,"){");(D=w.angle_instanced_arrays)?(r=e(b(r)),D=f(D),l("if(",t,"){",t,".bind();","if(",r,">0){",D,".drawElementsInstancedANGLE(",a,",",G,",",t,".type,",u,",",r,");}else{",q,".drawElements(",a,",",G,",",t,".type,",u,");}","}else if(",r,">0){",D,".drawArraysInstancedANGLE(",
a,",",u,",",G,",",r,");}else{",q,".drawArrays(",a,",",u,",",G,");}}")):l("if(",t,"){",q,".drawElements(",a,",",G,",",t,".type,",u,");}","}else{",q,".drawArrays(",a,",",u,",",G,");}");return h.compile().draw},command:function(f,c,d,p,w,u,K){function A(a){var b=ca[a];return b?b:b=ca[a]=k(M[a])}function E(a,b){var n=A(a);z(n,".push(",b,");");F(n,".pop();")}function X(a){var b=a.id,n=ua[b];if(n)return n;n=a.func?I.def(k(a.data),"(",sa,",0,",xa,")"):I.def(sa,".",a.data);return ua[b]=n}var r=H(),k=r.link,
t=r.block,x=r.proc,R=G++,n=k(ia);k(h);var U=k(ea.fragShaders),Z=k(ea.vertShaders),ka=k(ea.programs),oa=k(m),J={count:k(W.count),offset:k(W.offset),instances:k(W.instances),primitive:k(W.primitive)},ba=k(g.elements),ta=k(e),la=k(P),qa=k(y),ca={},z=t(),F=t(),na=!1;Object.keys(f).sort(a).forEach(function(a){var b=f[a];switch(a){case "frag":na=!0;z(U,".push(",k(h.id(b)),");");F(U,".pop();");break;case "vert":na=!0;z(Z,".push(",k(h.id(b)),");");F(Z,".pop();");break;case "framebuffer":m.getFramebuffer(b);
a=A("viewport");var n=A("scissor.box");z("if(",oa,".push(",k(b&&b._framebuffer),")){",a,".setDirty();",n,".setDirty();","}");F("if(",oa,".pop()){",a,".setDirty();",n,".setDirty();","}");break;case "count":case "offset":case "instances":z(J[a],".push(",b,");");F(J[a],".pop();");break;case "primitive":z(J.primitive,".push(",e[b],");");F(J.primitive,".pop();");break;case "elements":n=g.getElements(b);b=!("primitive"in f);a=!("count"in f);n?(n=k(n),z(ba,".push(",n,");"),b&&z(J.primitive,".push(",n,".primType);"),
a&&z(J.count,".push(",n,".vertCount);")):(z(ba,".push(null);"),b&&z(J.primitive,".push(",4,");"),a&&z(J.count,".push(0);"));b&&F(J.primitive,".pop();");a&&F(J.count,".pop();");"offset"in f||(z(J.offset,".push(0);"),F(J.offset,".pop();"));F(ba,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":E(a,b);break;case "depth.func":E(a,P[b]);
break;case "depth.range":a=A(a);z(a,".push(",b[0],",",b[1],");");F(a,".pop();");break;case "blend.func":a=A(a);z(a,".push(",l["srcRGB"in b?b.srcRGB:b.src],",",l["dstRGB"in b?b.dstRGB:b.dst],",",l["srcAlpha"in b?b.srcAlpha:b.src],",",l["dstAlpha"in b?b.dstAlpha:b.dst],");");F(a,".pop();");break;case "blend.equation":a=A(a);"string"===typeof b?z(a,".push(",q[b],",",q[b],");"):"object"===typeof b&&z(a,".push(",q[b.rgb],",",q[b.alpha],");");F(a,".pop();");break;case "blend.color":a=A(a);z(a,".push(",
b[0],",",b[1],",",b[2],",",b[3],");");F(a,".pop();");break;case "stencil.mask":a=A(a);z(a,".push(",b,");");F(a,".pop();");break;case "stencil.func":var n=b.cmp||"keep",c=b.ref||0,b="mask"in b?b.mask:-1;a=A(a);z(a,".push(",P[n],",",c,",",b,");");F(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":n=b.fail||"keep";c=b.zfail||"keep";b=b.pass||"keep";a=A(a);z(a,".push(",y[n],",",y[c],",",y[b],");");F(a,".pop();");break;case "polygonOffset.offset":n=b.factor||0;b=b.units||0;a=A(a);z(a,".push(",
n,",",b,");");F(a,".pop();");break;case "cull.face":n=0;"front"===b?n=1028:"back"===b&&(n=1029);b=A(a);z(b,".push(",n,");");F(b,".pop();");break;case "lineWidth":E(a,b);break;case "frontFace":n=0;"cw"===b?n=2304:"ccw"===b&&(n=2305);b=A(a);z(b,".push(",n,");");F(b,".pop();");break;case "colorMask":a=A(a);z(a,".push(",b.map(function(a){return!!a}).join(),");");F(a,".pop();");break;case "sample.coverage":n="value"in b?b.value:1;b=!!b.invert;a=A(a);z(a,".push(",n,",",b,");");F(a,".pop();");break;case "viewport":case "scissor.box":var n=
b.x||0,c=b.y||0,d=-1,p=-1;"w"in b&&(d=b.w);"h"in b&&(p=b.h);b=A(a);z(b,".push(",n,",",c,",",d,",",p,");");F(b,".pop();")}});if(na){if(f.frag&&f.vert)t=f.frag,z(ka,".push(",k(ea.create(h.id(f.vert),h.id(t))),");");else{var t=z.def(U,"[",U,".length-1]"),ra=z.def(Z,"[",Z,".length-1]"),wa=k(ea.create);z(ka,".push(",wa,"(",ra,",",t,"));")}F(ka,".pop();")}Object.keys(c).forEach(function(a){var b=k(L.def(a));a=c[a];a="function"===typeof a&&a._reglType?k(a):Array.isArray(a)?k(a.slice()):+a;z(b,".push(",a,
");");F(b,".pop();")});Object.keys(d).forEach(function(a){var b=k(V.def(a));a=d[a];if("number"===typeof a)z(b,".pushVec(",+a,",0,0,0);");else if(Array.isArray(a))z(b,".pushVec(",[a[0]||0,a[1]||0,a[2]||0,a[3]||0],");");else{var n=D.getBuffer(a),f=0,h=0,c=0,l=0,Z=!1,e=5126;n?e=n.dtype:(n=D.getBuffer(a.buffer),f=a.size||0,h=a.stride||0,c=a.offset||0,l=a.divisor||0,Z=a.normalized||!1,e=n.dtype,"type"in a&&(e=B[a.type]));z(b,".pushPtr(",[k(n),f,c,h,l,Z,e].join(),");")}F(b,".pop();")});var I=r.block(),
N=r.block(),xa,sa;K&&(xa=k(ha),sa=z.def());var ua={};Object.keys(p).sort(a).forEach(function(a){var b=X(p[a]);switch(a){case "framebuffer":a=A("viewport");var n=A("scissor.box");I("if(",oa,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",n,".setDirty();","}");N("if(",oa,".pop()){",a,".setDirty();",n,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
A(a);I(a,".push(",b,");");N(a,".pop();");break;case "count":case "offset":case "instances":a=J[a];I(a,".push(",b,");");N(a,".pop();");break;case "primitive":a=J.primitive;I(a,".push(",ta,"[",b,"]);");N(a,".pop();");break;case "depth.func":a=A(a);I(a,".push(",la,"[",b,"]);");N(a,".pop();");break;case "blend.func":a=A(a);n=k(l);I(a,".push(",n,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",n,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",n,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",n,'["dstAlpha" in ',
b,"?",b,".dstAlpha:",b,".dst]);");N(a,".pop();");break;case "blend.equation":a=A(a);n=k(q);I("if(typeof ",b,'==="string"){',a,".push(",n,"[",b,"],",n,"[",b,"]);","}else{",a,".push(",n,"[",b,".rgb],",n,"[",b,".alpha]);","}");N(a,".pop();");break;case "blend.color":a=A(a);I(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");N(a,".pop();");break;case "stencil.mask":a=A(a);I(a,".push(",b,");");N(a,".pop();");break;case "stencil.func":a=A(a);I(a,".push(",la,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",
b,".mask:-1);");N(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=A(a);I(a,".push(",qa,"[",b,'.fail||"keep"],',qa,"[",b,'.zfail||"keep"],',qa,"[",b,'.pass||"keep"]);');N(a,".pop();");break;case "polygonOffset.offset":a=A(a);I(a,".push(",b,".factor||0,",b,".units||0);");N(a,".pop();");break;case "cull.face":a=A(a);I(a,".push(",b,'==="front"?',1028,":",1029,");");N(a,".pop();");break;case "frontFace":a=A(a);I(a,".push(",b,'==="cw"?',2304,":",2305,");");N(a,".pop();");break;case "colorMask":a=
A(a);I(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");N(a,".pop();");break;case "sample.coverage":a=A(a);I(a,".push(",b,".value,",b,".invert);");N(a,".pop();");break;case "scissor.box":case "viewport":a=A(a);I(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");N(a,".pop();");break;case "elements":a=!("primitive"in p)&&!("primitive"in f);var n=!("count"in p)&&!("count"in f),h=!("offset"in p)&&!("offset"in f),c=I.def();I("if(",b,"){",c,"=",b,"._elements;",ba,
".push(",c,");",a?J.primitive+".push("+c+".primType);":"",n?J.count+".push("+c+".vertCount);":"",h?J.offset+".push("+c+".offset);":"","}else{",ba,".push(null);","}");N(ba,".pop();","if(",b,"){",a?J.primitive+".pop();":"",n?J.count+".pop();":"",h?J.offset+".pop();":"","}")}});Object.keys(w).forEach(function(a){var b=k(L.def(a));a=X(w[a]);I(b,".push(",a,");");N(b,".pop();")});Object.keys(u).forEach(function(a){var b=k(V.def(a));a=X(u[a]);I(b,".pushDyn(",a,");");N(b,".pop();")});t=x("scope");ra=t.arg();
wa=t.arg();t(z);K&&t(sa,"=",ra,";",I);t(wa,"();",K?N:"",F);t=x("draw");t(z);K&&t(sa,"=",t.arg(),";",I);ra=b(ka);t(n,"();","if(",ra,")",ra,".draw(",K?sa:"",");",K?N:"",F);var pa=x("batch");pa(z);K=pa.def(b(ka));x=k(function(a,b,n){var h=a.batchCache[R];h||(h=a.batchCache[R]=O(a,p,w,u,f));return h(b,n)});pa("if(",K,"){",n,"();",x,"(",K,",",pa.arg(),",",pa.arg(),");");Object.keys(p).forEach(function(a){(a=ca[a])&&pa(a,".setDirty();")});pa("}",F);return r.compile()}}}},{"./codegen":4,"./constants/dtypes.json":7,
"./constants/primitives.json":8}],6:[function(d,g,m){g.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],7:[function(d,g,m){g.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],8:[function(d,g,m){g.exports={points:0,
lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],9:[function(d,g,m){function c(a,c){function e(){var c=window.innerWidth,h=window.innerHeight;a!==document.body&&(h=a.getBoundingClientRect(),c=h.right-h.left,h=h.top-h.bottom);d.width=g*c;d.height=g*h;b(d.style,{width:c+"px",height:h+"px"})}var d=document.createElement("canvas"),l=p(d,c);b(d.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(d);a===document.body&&(d.style.position="absolute",b(a.style,
{margin:0,padding:0}));var g=+l.options.pixelRatio;window.addEventListener("resize",e,!1);var m=l.options.onDestroy;l.options=b(b({},l.options),{onDestroy:function(){window.removeEventListener("resize",e);a.removeChild(d);m&&m()}});e();return l}function p(a,c){function e(b){try{return a.getContext(b,d)}catch(c){return null}}var d=c.glOptions||{};return{gl:e("webgl")||e("experimental-webgl")||e("webgl-experimental"),options:b({pixelRatio:window.devicePixelRatio},c)}}var b=d("./extend");g.exports=function(a){if("undefined"===
typeof document||"undefined"===typeof HTMLElement)return{gl:a[0],options:a[1]||{}};var d=document.body,e=a[1]||{};if("string"===typeof a[0])d=document.querySelector(a[0])||document.body;else if("object"===typeof a[0])if(a[0]instanceof HTMLElement)d=a[0];else{if(a[0]instanceof WebGLRenderingContext)return{gl:a[0],options:b({pixelRatio:1},e)};e=a[0]}return d.nodeName&&"CANVAS"===d.nodeName.toUpperCase()?p(d,e):c(d,e)}},{"./extend":13}],10:[function(d,g,m){g.exports=function(c){return{primitive:[4],
count:[0],offset:[0],instances:[0]}}},{}],11:[function(d,g,m){function c(a,c){this.id=b++;this.func=a;this.data=c}function p(a,b){switch(typeof a){case "boolean":case "number":case "string":return new c(!1,a);case "function":return new c(!0,a);default:return p}}var b=0;g.exports={define:p,isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof c},unbox:function(a,b){return a instanceof c?a:"function"===typeof a&&a!==p?new c(!0,a):new c(!1,b)}}},{}],12:[function(d,g,m){var c=
d("./is-typed-array"),p=d("./is-ndarray"),b=d("./constants/primitives.json");g.exports=function(a,d,e){function g(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}g.prototype.bind=function(){this.buffer.bind()};return{create:function(a){function m(a){var l=d.oes_element_index_uint;if(a)if("number"===typeof a)E(a);else{var f=null,e="static",g=0;Array.isArray(a)||c(a)||p(a)?f=a:("data"in a&&(f=a.data),"usage"in a&&(e=a.usage),"length"in a&&(g=a.length));Array.isArray(f)||p(f)&&"array"===
f.dtype||"type"in a?E({type:a.type||(l?"uint32":"uint16"),usage:e,data:f,length:g}):E({usage:e,data:f,length:g});if(Array.isArray(f)||c(f))E.dimension=3}else E();l=y.buffer.byteLength;f=0;switch(y.buffer.dtype){case 5121:case 5120:f=5121;break;case 5123:case 5122:f=5123;l>>=1;break;case 5125:case 5124:f=5125,l>>=2}e=4;g=y.buffer.dimension;1===g&&(e=0);2===g&&(e=1);3===g&&(e=4);"object"===typeof a&&("primitive"in a&&(e=b[a.primitive]),"count"in a&&(l=a.vertCount|0));y.primType=e;y.vertCount=l;y.type=
f;return m}var y=new g,E=e.create(null,34963,!0);y.buffer=E._buffer;m(a);m._reglType="elements";m._elements=y;m.destroy=function(){E.destroy();y.buffer=null};return m},elements:[null],getElements:function(a){return a&&a._elements instanceof g?a._elements:null}}}},{"./constants/primitives.json":8,"./is-ndarray":16,"./is-typed-array":17}],13:[function(d,g,m){g.exports=function(c,d){for(var b=Object.keys(d),a=0;a<b.length;++a)c[b[a]]=d[b[a]];return c}},{}],14:[function(d,g,m){g.exports=function(c){function d(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(a){try{b[a]=
c.getExtension(a)}catch(d){}})}var b={};d();return{extensions:b,refresh:d}}},{}],15:[function(d,g,m){var c=d("./values"),p=d("./extend"),b=[1029];g.exports=function(a,d,e,g,l){function m(a,b,f,c){this.target=a;this.level=b;this.texture=f;this.renderbuffer=c}function y(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function E(a,b){var f=b.width,c=b.height;if(a.texture)var h=a.texture._texture,d=Math.max(1,h.params.width>>a.level),l=Math.max(1,h.params.height>>
a.level),f=f||d,c=c||l;else h=a.renderbuffer._renderbuffer,f=f||h.width,c=c||h.height;h.refCount+=1;b.width=f;b.height=c}function h(b,f){f?f.texture?a.framebufferTexture2D(36160,b,f.target,f.texture._texture.texture,f.level):a.framebufferRenderbuffer(36160,b,36161,f.renderbuffer._renderbuffer.renderbuffer):a.framebufferTexture2D(36160,b,3553,null,0)}function w(a){var b=3553,f=0,c=null,h=null;"object"===typeof a&&("level"in a&&(f=a.level|0),"target"in a&&(b=a.target|0));var d=a._reglType;"texture"===
d?c=a:"renderbuffer"===d&&(h=a,b=36161,f=0);return new m(b,f,c,h)}function f(a){return a&&(a.texture||a.renderbuffer)}function D(){this.id=ha++;ia[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function da(b){a.isFramebuffer(b.framebuffer)||(b.framebuffer=a.createFramebuffer());M=!0;a.bindFramebuffer(36160,b.framebuffer);for(var f=b.colorAttachments,
c=0;c<f.length;++c)h(36064+c,f[c]);for(c=f.length;c<e.maxColorAttachments;++c)h(36064+c,null);h(36096,b.depthAttachment);h(36128,b.stencilAttachment);h(33306,b.depthStencilAttachment);d.webgl_draw_buffers&&d.webgl_draw_buffers.drawBuffersWEBGL(W[f.length]);a.checkFramebufferStatus(36160)}function u(b){b=b.framebuffer;a.isFramebuffer(b)&&a.deleteFramebuffer(b)}function Q(){return O[O.length-1]}var R={rgba:6408},L={rgba4:32854,rgb565:36194,"rgb5 a1":32855};d.ext_srgb&&(L.srgba=35907);d.ext_color_buffer_half_float&&
(L.rgba16f=34842,L.rgb16f=34843);d.webgl_color_buffer_float&&(L.rgba32f=34836);var V=[],ea=[];d.webgl_depth_texture&&(V.push(6402),ea.push(34041));p(p({},R),L);c(R);c(L);L=5121;V={uint8:5121};d.oes_texture_half_float&&(L=V["half float"]=36193);d.oes_texture_float&&(L=V["float"]=5126);V.best=L;var W=function(){for(var a=Array(e.maxDrawbuffers),b=0;b<=e.maxDrawbuffers;++b)for(var f=a[b]=Array(b),c=0;c<b;++c)f[c]=36064+c;return a}(),ha=0,ia={},O=[null],M=!0;return{top:Q,dirty:function(){return M},push:function(a){a=
a||null;M=M||a!==Q();O.push(a);return M},pop:function(){var a=Q();O.pop();return M=M||a!==Q()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof D)?a:null},poll:function(){if(M){var f=O[O.length-1],c=d.webgl_draw_buffers;f?(a.bindFramebuffer(36160,f.framebuffer),c&&c.drawBuffersWEBGL(W[f.colorAttachments.length])):(a.bindFramebuffer(36160,null),c&&c.drawBuffersWEBGL(b));M=!1}},create:function(b){function c(b){var d,e=b||{},p=b=0;if("shape"in
e){var D=e.shape;b=D[0];p=D[1]}else"radius"in e&&(b=p=e.radius),"width"in e&&(b=e.width),"height"in e&&(p=e.height);var u=null,D=!1;if("colorBuffers"in e||"colorBuffer"in e){u=e.colorBuffers||e.colorBuffer;Array.isArray(u)||(u=[u]);h.width=b;h.height=p;u=u.map(w);for(d=0;d<u.length;++d)E(u[d],h);b=h.width;p=h.height}else{var q=!0,H="rgba",Q="uint8",r=1,D=!0;h.width=b||a.drawingBufferWidth;h.height=p||a.drawingBufferHeight;"format"in e&&(H=e.format,q=H in R);"type"in e&&(Q=e.type);"colorCount"in e&&
(r=e.colorCount|0);if(h.ownsColor)for(u=h.colorAttachments;u.length>r;)y(u.pop());else u=[];for(d=0;d<u.length;++d){var k;a:{k=u[d];var t=q,x=H,O=b,n=p;if(k.texture){var U=k.texture;if(t){U({format:x,type:Q,width:O,height:n});U._texture.refCount+=1;k=!0;break a}}else if(U=k.renderbuffer,!t){U({format:x,width:O,height:n});U._renderbuffer.refCount+=1;k=!0;break a}y(k);k=!1}k||(u[d--]=u[u.length-1],u.pop())}for(;u.length<r;)q?u.push(new m(3553,0,g.create({format:H,type:Q,width:b,height:p},3553),null)):
u.push(new m(36161,0,null,l.create({format:H,width:b,height:p})))}h.width=b;h.height=p;H=q=d=null;Q=!1;"depthBuffer"in e&&(d=w(e.depthBuffer));"stencilBuffer"in e&&(q=w(e.stencilBuffer));"depthStencilBuffer"in e&&(H=w(e.depthStencilBuffer));if(d||q||H)E(d||q||H,h);else if(r=!0,t=k=!1,"depth"in e&&(r=!!e.depth),"stencil"in e&&(k=!!e.stencil),"depthTexture"in e&&(t=!!e.depthTexture),e=h.depthAttachment||h.stencilAttachment||h.depthStencilAttachment,x=null,r||k)Q=!0,t?(t=k?"depth stencil":"depth",h.ownsDepthStencil&&
e.texture?(e.texture({format:t,width:b,height:p}),e.texture._texture.refCount+=1,x=e):x=new m(3553,0,g.create({format:t,width:b,height:p},3553),null)):(t=r?k?"depth stencil":"depth":"stencil",h.ownsDepthStencil&&e.renderbuffer?(e.renderbuffer({format:t,width:b,height:p}),e.renderbuffer._renderbuffer.refCount+=1,x=e):x=new m(36161,0,null,l.create({format:t,width:b,height:p}))),r?k?H=x:d=x:q=x;b=h;b.colorAttachments.forEach(y);y(b.depthAttachment);y(b.stencilAttachment);y(b.depthStencilAttachment);
h.colorAttachments=u;h.depthAttachment=d;h.stencilAttachment=q;h.depthStencilAttachment=H;h.ownsColor=D;h.ownsDepthStencil=Q;c.color=u.map(f);c.depth=f(d);c.stencil=f(q);c.depthStencil=f(H);da(h);c.width=h.width;c.height=h.height;return c}var h=new D;c(b);c._reglType="framebuffer";c._framebuffer=h;c._destroy=function(){u(h)};return c},clear:function(){c(ia).forEach(u)},refresh:function(){c(ia).forEach(da)}}}},{"./extend":13,"./values":31}],16:[function(d,g,m){var c=d("./is-typed-array");g.exports=
function(d){return"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||c(d.data))}},{"./is-typed-array":17}],17:[function(d,g,m){var c=d("./constants/arraytypes.json");g.exports=function(d){return Object.prototype.toString.call(d)in c}},{"./constants/arraytypes.json":6}],18:[function(d,g,m){g.exports=function(c,d){var b=1;d.ext_texture_filter_anisotropic&&(b=c.getParameter(34047));var a=1,g=1;d.webgl_draw_buffers&&
(a=c.getParameter(34852),g=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(d).filter(function(a){return!!d[a]}),maxAnisotropic:b,maxDrawbuffers:a,maxColorAttachments:g,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),
maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],19:[function(d,g,m){g.exports=
function(c,d){if("undefined"!==typeof document){var b;b=(b=/\.(\w+)(\?.*)?$/.exec(c))&&b[1]?b[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(b))return b=document.createElement("video"),b.autoplay=!0,b.loop=!0,d&&(b.crossOrigin=d),b.src=c,b;if(0<=["dds"].indexOf(b))return b=new XMLHttpRequest,b.responseType="arraybuffer",b.open("GET",c,!0),b.send(),b;b=new Image;d&&(b.crossOrigin=d);b.src=c;return b}return null}},{}],20:[function(d,
g,m){g.exports=function(d){function g(a){for(var b=q,c=G,f=0;f<Y;++f){var h=Math.max(1,b+3>>2)*Math.max(1,c+3>>2)*ja;K.pixels.push({target:a,miplevel:f,width:b,height:c,data:new Uint8Array(d,fa,h)});fa+=h;b>>=1;c>>=1}}var m=new Int32Array(d),M=m[u],q=m[R],G=m[Q],ma=l,S=0,ja=0,T=4;switch(m[ea]){case h:ja=8;M&E?(T=3,S=b):S=a;break;case w:ja=16;S=H;break;case f:ja=16;S=e;break;case D:ja=8,S=B}var Y=1;m[V]&P&&(Y=Math.max(1,m[L]));var fa=m[da]+4,K={width:q,height:G,channels:T,format:S,type:ma,compressed:!0,
cube:!1,pixels:[]};if(m[W]&y)for(K.cube=!0,m=0;6>m;++m)g(p+m);else g(c);return K};var c=3553,p=34069,b=33776,a=33777,H=33778,e=33779,B=36196,l=5121,P=131072,y=512,E=64,h=827611204,w=861165636,f=894720068,D=826496069,da=1,u=2,Q=3,R=4,L=7,V=20,ea=21,W=28},{}],21:[function(d,g,m){g.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){setTimeout(c,
30)},cancel:clearTimeout}},{}],22:[function(d,g,m){var c=d("./is-typed-array");g.exports=function(d,b,a){return function(g){var e=g||{};c(g)?e={data:e}:2===arguments.length?e={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof g&&(e={});b();var m=e.x||0,l=e.y||0,P=e.width||a.width,y=e.height||a.height,e=e.data||new Uint8Array(P*y*4);d.pixelStorei(3333,4);d.readPixels(m,l,P,y,6408,5121,e);return e}}},{"./is-typed-array":17}],23:[function(d,g,m){var c=d("./values");g.exports=function(d,b,
a){function g(){this.id=P++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function e(a){d.isRenderbuffer(a.renderbuffer)||(a.renderbuffer=d.createRenderbuffer());d.bindRenderbuffer(36161,a.renderbuffer);d.renderbufferStorage(36161,a.format,a.width,a.height)}function m(a){var b=a.renderbuffer;d.bindRenderbuffer(36161,null);d.isRenderbuffer(b)&&d.deleteRenderbuffer(b);a.renderbuffer=null;a.refCount=0;delete y[a.id]}var l={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(l.srgba=35907);b.ext_color_buffer_half_float&&(l.rgba16f=34842,l.rgb16f=34843);b.webgl_color_buffer_float&&(l.rgba32f=34836);var P=0,y={};g.prototype.decRef=function(){0===--this.refCount&&m(this)};return{create:function(a){function b(a){a=a||{};var d=0,g=0;"shape"in a?(g=a.shape,d=g[0]|0,g=g[1]|0):("radius"in a&&(d=g=a.radius|0),"width"in a&&(d=a.width|0),"height"in a&&(g=a.height|0));b.width=c.width=Math.max(d,1);b.height=c.height=Math.max(g,
1);c.format=32854;"format"in a&&(c.format=l[a.format]);e(c);return b}var c=new g;y[c.id]=c;b(a);b._reglType="renderbuffer";b._renderbuffer=c;b.destroy=function(){c.decRef()};return b},refresh:function(){c(y).forEach(e)},clear:function(){c(y).forEach(m)}}}},{"./values":31}],24:[function(d,g,m){function c(b,a,c){this.name=b;this.location=a;this.info=c}var p=d("./values");g.exports=function(b,a,d,e,g){function l(a,c){var d=35632===a?E:h,f=d[c];if(!f){var e=g.str(c),f=b.createShader(a);b.shaderSource(f,
e);b.compileShader(f);d[c]=f}return f}function m(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function y(f){var h,g;h=l(35632,f.fragId);g=l(35633,f.vertId);var p=f.program=b.createProgram();b.attachShader(p,h);b.attachShader(p,g);b.linkProgram(p);var m=b.getProgramParameter(p,35718),w=f.uniforms=[];for(h=0;h<m;++h)if(g=b.getActiveUniform(p,h))if(1<g.size)for(var B=0;B<g.size;++B){var y=g.name.replace("[0]","["+B+"]");
d.def(y);w.push(new c(y,b.getUniformLocation(p,y),g))}else d.def(g.name),w.push(new c(g.name,b.getUniformLocation(p,g.name),g));m=b.getProgramParameter(p,35721);w=f.attributes=[];for(h=0;h<m;++h)if(g=b.getActiveAttrib(p,h))a.def(g.name),w.push(new c(g.name,b.getAttribLocation(p,g.name),g));f.draw=e(f);f.batchCache={}}var E={},h={},w={},f=[];return{create:function(a,b){var c=w[b];c||(c=w[b]={});var d=c[a];d||(d=new m(b,a),y(d),c[a]=d,f.push(d));return d},clear:function(){var a=b.deleteShader.bind(b);
p(E).forEach(a);E={};p(h).forEach(a);h={};f.forEach(function(a){b.deleteProgram(a.program)});f.length=0;w={}},refresh:function(){E={};h={};f.forEach(y)},programs:[null],fragShaders:[g.id("void main(){gl_FragColor=vec4(0,0,0,0);}")],vertShaders:[g.id("void main(){gl_Position=vec4(0,0,0,0);}")]}}},{"./values":31}],25:[function(d,g,m){g.exports=function(c,d){var b=c.length,a=c.slice(),g=c.slice(),e=!1,m=!0;return{push:function(){e=!1;for(var c=0;c<b;++c){var d=arguments[c];e=e||d!==g[c];a.push(d)}},
pop:function(){e=!1;a.length-=b;for(var c=0;c<b;++c)e=e||a[a.length-b+c]!==g[c]},poll:function(){var c=a.length-b;if(e||m){switch(b){case 1:d(a[c]);break;case 2:d(a[c],a[c+1]);break;case 3:d(a[c],a[c+1],a[c+2]);break;case 4:d(a[c],a[c+1],a[c+2],a[c+3]);break;case 5:d(a[c],a[c+1],a[c+2],a[c+3],a[c+4]);break;case 6:d(a[c],a[c+1],a[c+2],a[c+3],a[c+4],a[c+5]);break;default:d.apply(null,a.slice(c,a.length))}for(var P=0;P<b;++P)g[P]=a[c+P];m=e=!1}},setDirty:function(){m=!0}}}},{}],26:[function(d,g,m){var c=
d("./stack"),p=d("./codegen");g.exports=function(b,a,d){function e(a,d){var f=c([!!d],function(c){c?b.enable(a):b.disable(a)});f.flag=a;return f}var g={dither:e(3024),"blend.enable":e(3042),"blend.color":c([0,0,0,0],function(a,c,d,e){b.blendColor(a,c,d,e)}),"blend.equation":c([32774,32774],function(a,c){b.blendEquationSeparate(a,c)}),"blend.func":c([1,0,1,0],function(a,c,d,e){b.blendFuncSeparate(a,c,d,e)}),"depth.enable":e(2929,!0),"depth.func":c([513],function(a){b.depthFunc(a)}),"depth.range":c([0,
1],function(a,c){b.depthRange(a,c)}),"depth.mask":c([!0],function(a){b.depthMask(a)}),"cull.enable":e(2884),"cull.face":c([1029],function(a){b.cullFace(a)}),frontFace:c([2305],function(a){b.frontFace(a)}),colorMask:c([!0,!0,!0,!0],function(a,c,d,e){b.colorMask(a,c,d,e)}),lineWidth:c([1],function(a){b.lineWidth(a)}),"polygonOffset.enable":e(32823),"polygonOffset.offset":c([0,0],function(a,c){b.polygonOffset(a,c)}),"sample.alpha":e(32926),"sample.enable":e(32928),"sample.coverage":c([1,!1],function(a,
c){b.sampleCoverage(a,c)}),"stencil.enable":e(2960),"stencil.mask":c([-1],function(a){b.stencilMask(a)}),"stencil.func":c([519,0,-1],function(a,c,d){b.stencilFunc(a,c,d)}),"stencil.opFront":c([7680,7680,7680],function(a,c,d){b.stencilOpSeparate(1028,a,c,d)}),"stencil.opBack":c([7680,7680,7680],function(a,c,d){b.stencilOpSeparate(1029,a,c,d)}),"scissor.enable":e(3089),"scissor.box":c([0,0,-1,-1],function(c,d,f,e){var g=f,l=a.top();0>f&&(g=l?l.width-c:b.drawingBufferWidth-c);f=e;0>e&&(f=l?l.height-
d:b.drawingBufferHeight-d);b.scissor(c,d,g,f)}),viewport:c([0,0,-1,-1],function(c,e,f,g){var l=f,m=a.top();0>f&&(l=m?m.width-c:b.drawingBufferWidth-c);f=g;0>g&&(f=m?m.height-e:b.drawingBufferHeight-e);b.viewport(c,e,l,f);d.width=l;d.height=f})},l=p(),m=l.proc("poll"),y=l.proc("refresh");Object.keys(g).forEach(function(a){a=l.link(g[a]);m(a,".poll();");y(a,".setDirty();")});var E=l.compile();return{contextState:g,viewport:d,poll:E.poll,refresh:E.refresh,notifyViewportChanged:function(){g.viewport.setDirty();
g["scissor.box"].setDirty()}}}},{"./codegen":4,"./stack":25}],27:[function(d,g,m){g.exports=function(){var c={},d=[""];return{id:function(b){var a=c[b];if(a)return a;a=c[b]=d.length;d.push(b);return a},str:function(b){return d[b]}}}},{}],28:[function(d,g,m){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function p(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==
c)return!1;return!0}function b(a){return Object.prototype.toString.call(a)}function a(a){return"[object HTMLCanvasElement]"===b(a)}function H(a){return"[object CanvasRenderingContext2D]"===b(a)}var e=d("./extend"),B=d("./values"),l=d("./is-typed-array"),P=d("./is-ndarray"),y=d("./load-texture"),E=d("./to-half-float"),h=d("./parse-dds"),w=[9984,9986,9985,9987];g.exports=function(d,g,m,u,Q){function R(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=
this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function L(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function V(a,b){var c,d,e=0,f=0,g=0,h=0,l=0,k=0,m=!1,p=!1,q=!1;for(c=0;c<b.length;++c)d=b[c],h=h||d.width<<d.miplevel,l=l||d.height<<d.miplevel,e=e||d.type,f=f||d.format,g=g||d.internalformat,k=k||d.channels,m=m||d.needsPoll,p=p||d.needsListeners,d=d.miplevel,q=q||0<d;a.needsPoll=m;a.needsListeners=p;a.width=h;a.height=l;a.format=f;a.internalformat=g;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=w.indexOf(a.minFilter);a.genMipmaps=!q&&(a.genMipmaps||c);q=q||a.genMipmaps;a.minFilter||(a.minFilter=
q?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=k),d.format||(d.format=f),d.internalformat||(d.internalformat=g),d.type||(d.type=e)}function ea(a){this.id=r++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new L(a);this.pixels=[]}function W(a,b){function c(a,d){var n=d.mipmap,e;if(Array.isArray(n))for(var g=0;g<n.length;++g)e=new R(a),e.parseFlags(b),e.parseFlags(d),
e.parse(n[g],g),f.push(e);else e=new R(a),e.parseFlags(b),e.parse(d,0),f.push(e)}var d;O(a);var e=a.params;L.call(e,a.target);var f=a.pixels;f.length=0;e.parse(b);if(3553===a.target)c(3553,b);else{var g=b.faces||b;if(Array.isArray(g))for(d=0;6>d;++d)c(34069+d,g[d]);else if("string"!==typeof g)for(d=0;6>d;++d)c(34069+d,{})}V(e,f);e.needsListeners&&ia(a);e.needsPoll&&(a.pollId=t.length,t.push(a));ha(a)}function ha(a){d.isTexture(a.texture)||(a.texture=d.createTexture());var b=a.target,c=a.unit;0<=c?
(d.activeTexture(33984+c),X=c):d.bindTexture(b,a.texture);for(var b=a.pixels,e=a.params,g=0;g<b.length;++g)b[g].upload(e);e.upload();0>c&&((c=aa[X])?d.bindTexture(c.target,c.texture):(a.unit=X,aa[X]=a))}function ia(a){function b(a,d,c){var n=h(c);n.pixels.forEach(function(b){var c=new R(n.cube?b.target:a);c.channels=n.channels;c.compressed=n.compressed;c.type=n.type;c.internalformat=n.format;c.format=ga[n.format];c.width=b.width;c.height=b.height;c.miplevel=b.miplevel||d;c.data=b.data;e.push(c)})}
function d(){for(var g=0;g<e.length;++g){var f=e[g],h=f.image,l=f.video,k=f.xhr;h&&h.complete?(f.width=h.naturalWidth,f.height=h.naturalHeight):l&&2<l.readyState?(f.width=l.width,f.height=l.height):k&&4===k.readyState&&(e[g]=e[e.length-1],e.pop(),k.removeEventListener("readystatechange",ha),b(f.target,f.miplevel,k.response))}V(c,e);ha(a)}var c=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",d):a.video&&1>a.readyState?a.video.addEventListener("progress",
d):a.xhr&&a.xhr.addEventListener("readystatechange",d)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",d):a.video?a.video.removeEventListener("progress",d):a.xhr&&(a.xhr.removeEventListener("readystatechange",d),a.xhr.abort())})}}function O(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((t[b]=t[t.length-1]).id=b,t.pop(),a.pollId=-1)}function M(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(d.activeTexture(33984+c),X=c,d.bindTexture(e,
null),aa[c]=null);O(a);d.isTexture(b)&&d.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete k[a.id]}var q={"don't care":4352,"dont care":4352,nice:4354,fast:4353},G={repeat:10497,clamp:33071,mirror:33648},ma={nearest:9728,linear:9729},S=e({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ma),ja={none:0,browser:37444},T={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,
"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},fa={};g.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);g.oes_texture_float&&(T["float"]=5126);g.oes_texture_half_float&&(T["half float"]=36193);g.webgl_depth_texture&&(e(Y,{depth:6402,"depth stencil":34041}),e(T,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&e(fa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&
e(fa,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&e(fa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(fa["rgb etc1"]=36196);var K=Array.prototype.slice.call(d.getParameter(34467));Object.keys(fa).forEach(function(a){var b=fa[a];0<=K.indexOf(b)&&(Y[a]=b)});var A=Object.keys(Y);m.textureFormats=A;var ga=A.reduce(function(a,b){var c=Y[b];
6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});e(R.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=ja[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=Y[b];b in T&&(this.type=T[b]);b in fa&&(this.compressed=
!0)}"type"in a&&(this.type=T[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*
b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(d,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=d;switch(typeof d){case "object":if(!d)return;this.parseFlags(d);var g=d.data;if("string"===typeof g||g&&(l(g)||c(g)||P(g)||a(g)||H(g)||"[object HTMLImageElement]"===b(g)||"[object HTMLVideoElement]"===b(g)||p(g)))f=d.data;break;case "undefined":return}"string"===typeof f&&(f=y(f,this.crossOrigin));var g=null,
h=!1;if(null!==f)if(l(f))this.data=f;else if(c(f))g=f,h=!0;else if(P(f)){Array.isArray(f.data)?(g=f.data,h=!0):this.data=f.data;var k=f.shape;this.width=k[0];this.height=k[1];this.channels=3===k.length?k[2]:1;k=f.stride;this.strideX=f.stride[0];this.strideY=f.stride[1];this.strideC=3===k.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(a(f)||H(f))a(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===
b(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if("[object HTMLVideoElement]"===b(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===b(f))this.xhr=
f,this.needsListeners=!0;else if(p(f)){var h=f.length,k=f[0].length,m=1,q,r,u,t;if(Array.isArray(f[0][0]))for(m=f[0][0].length,g=Array(h*k*m),r=t=0;r<k;++r)for(q=0;q<h;++q)for(u=0;u<m;++u)g[t++]=f[q][r][u];else for(g=Array(h*k),r=t=0;r<k;++r)for(q=0;q<h;++q)g[t++]=f[q][r];this.width=h;this.height=k;this.channels=m;h=!0}else d.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||Q.width)|0,this.height=(this.height||Q.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?
this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;k=this.format=ga[f];if(!this.channels)switch(k){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}k=this.type;5126!==k&&36193!==
k&&(k||(k=6402===f?5125:5121));this.type=k;if(h)switch(k){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=new Float32Array(g);break;case 36193:this.data=E(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;h=this.height;k=this.channels;m=this.strideX;q=this.strideY;r=this.strideC;u=this.offset;t=new g.constructor(f*h*k);for(var w=0,x=0;x<h;++x)for(var B=0;B<f;++B)for(var A=0;A<k;++A)t[w++]=
g[q*x+m*B+r*A+u];this.data=t}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(a){d.pixelStorei(37440,this.flipY);d.pixelStorei(37441,this.premultiplyAlpha);d.pixelStorei(37443,this.colorSpace);d.pixelStorei(3317,this.unpackAlignment);var b=this.target,c=this.miplevel,e=this.image,g=this.canvas,h=this.video,k=this.data,l=this.internalformat,m=this.format,p=this.type,q=this.width||Math.max(1,a.width>>
c);a=this.height||Math.max(1,a.height>>c);h&&2<h.readyState?d.texImage2D(b,c,m,m,p,h):e&&e.complete?d.texImage2D(b,c,m,m,p,e):g?d.texImage2D(b,c,m,m,p,g):this.compressed?d.compressedTexImage2D(b,c,l,q,a,0,k):this.copy?(u(),d.copyTexImage2D(b,c,m,this.x,this.y,q,a,0)):k?d.texImage2D(b,c,m,q,a,0,m,p,k):d.texImage2D(b,c,m,q||1,a||1,0,m,p,null)}});e(L.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=S[a.min]);"mag"in a&&(this.magFilter=ma[a.mag]);var b=this.wrapS,c=this.wrapT;
if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=G[d]:Array.isArray(d)&&(b=G[d[0]],c=G[d[1]])}else"wrapS"in a&&(b=G[a.wrapS]),"wrapT"in a&&(c=G[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=q[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var a=this.target;d.texParameteri(a,10241,this.minFilter);d.texParameteri(a,10240,this.magFilter);d.texParameteri(a,
10242,this.wrapS);d.texParameteri(a,10243,this.wrapT);g.ext_texture_filter_anisotropic&&d.texParameteri(a,34046,this.anisotropic);this.genMipmaps&&(d.hint(33170,this.mipmapHint),d.generateMipmap(a))}});var X=0,r=0,k={},t=[],x=m.maxTextureUnits,aa=Array(x).map(function(){return null});e(ea.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<x;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}this.unit=a;d.activeTexture(33984+a);d.bindTexture(this.target,
this.texture);X=a}return a},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&M(this)}});return{create:function(a,b){function c(a,e,f,g,h,k){var l=a||{};34067===b&&6===arguments.length&&(l=[a,e,f,g,h,k]);W(d,l);c.width=d.params.width;c.height=d.params.height;return c}var d=new ea(b);k[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){B(k).forEach(ha);for(var a=0;a<x;++a)aa[a]=null;X=0;d.activeTexture(33984)},clear:function(){for(var a=
0;a<x;++a)d.activeTexture(33984+a),d.bindTexture(3553,null),aa[a]=null;d.activeTexture(33984);X=0;B(k).forEach(M)},poll:function(){t.forEach(ha)},getTexture:function(a){return null}}}},{"./extend":13,"./is-ndarray":16,"./is-typed-array":17,"./load-texture":19,"./parse-dds":20,"./to-half-float":29,"./values":31}],29:[function(d,g,m){g.exports=function(c){for(var d=new Float32Array(c),d=new Uint32Array(d.buffer),b=new Uint16Array(c.length),a=0;a<c.length;++a)if(isNaN(c[a]))b[a]=65535;else if(Infinity===
c[a])b[a]=31744;else if(-Infinity===c[a])b[a]=64512;else{var g=d[a],e=g>>>31<<15,m=(g<<1>>>24)-127,g=g>>13&1023;b[a]=-24>m?e:-14>m?e+(g+1024>>-14-m):15<m?e+31744:e+(m+15<<10)+g}return b}},{}],30:[function(d,g,m){g.exports=function(c){var d={};return{def:function(b){b=c.id(b);var a=d[b];a||(a=d[b]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);return a}}}},{}],31:[function(d,g,m){g.exports=function(c){return Object.keys(c).map(function(d){return c[d]})}},{}],32:[function(d,g,m){var c=d("./lib/extend"),p=d("./lib/context"),
b=d("./lib/strings"),a=d("./lib/extension"),H=d("./lib/limits"),e=d("./lib/buffer"),B=d("./lib/elements"),l=d("./lib/texture"),P=d("./lib/renderbuffer"),y=d("./lib/framebuffer"),E=d("./lib/uniform"),h=d("./lib/attribute"),w=d("./lib/shader"),f=d("./lib/draw"),D=d("./lib/state"),da=d("./lib/compile"),u=d("./lib/read"),Q=d("./lib/dynamic"),R=d("./lib/raf"),L=d("./lib/clock");g.exports=function(){function d(){ka=R.next(d);x.count+=1;if(x.width!==q.drawingBufferWidth||x.height!==q.drawingBufferHeight)x.width=
q.drawingBufferWidth,x.height=q.drawingBufferHeight,aa.notifyViewportChanged();var a=L();x.dt=a-x.t;x.t=a;r.poll();for(var b=0;b<Z.length;++b)(0,Z[b])(x.count,x.t,x.dt);x.renderTime=L()-a}function g(){ka&&(R.cancel(d),ka=0)}function m(a){g();a.preventDefault();if(G.onContextLost)G.onContextLost()}function ha(a){q.getError();ma.refresh();Y.refresh();r.refresh();k.refresh();t.refresh();ga.refresh();aa.refresh();if(G.onContextRestored)G.onContextRestored();d()}function ia(a){function b(a){var c={},e=
{};Object.keys(a).forEach(function(b){var f=a[b];Q.isDynamic(f)?(d=!0,e[b]=Q.unbox(f,b)):c[b]=f});return{dynamic:e,"static":c}}var d=!1,e=b(a.uniforms||{}),f=b(a.attributes||{});a=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=c({},a);delete d.uniforms;delete d.attributes;b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));var e=n.command(a["static"],e["static"],f["static"],
a.dynamic,e.dynamic,f.dynamic,d),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return h(a|0,l)}return Array.isArray(a)?h(a.length,a):"function"===typeof a?k(null,a):"function"===typeof b?k(a,b):g(a)}}function O(){t.poll();aa.poll()}var M=p(Array.prototype.slice.call(arguments)),q=M.gl,G=M.options,M=b(),ma=a(q),S=ma.extensions,ja={width:q.drawingBufferWidth,height:q.drawingBufferHeight},T=H(q,S),Y=e(q),fa=B(q,S,Y),K=E(M),A=h(q,
S,T,Y,M),ga=w(q,A,K,function(a){return n.draw(a)},M),X=f(q,S,Y),r=l(q,S,T,O,ja),k=P(q,S,T),t=y(q,S,T,r,k),x={count:0,start:L(),dt:0,t:L(),renderTime:0,width:q.drawingBufferWidth,height:q.drawingBufferHeight,pixelRatio:G.pixelRatio},aa=D(q,t,ja),ja=u(q,O,ja),n=da(q,M,S,T,Y,fa,r,t,aa,K,A,ga,X,x,O),U=q.canvas,Z=[],ka=0;U&&(U.addEventListener("webglcontextlost",m,!1),U.addEventListener("webglcontextrestored",ha,!1));return c(ia,{clear:function(a){var b=0;O();var c=a.color;c&&(q.clearColor(+c[0]||0,+c[1]||
0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(q.clearDepth(+a.depth),b|=256);"stencil"in a&&(q.clearStencil(a.stencil|0),b|=1024);q.clear(b)},prop:Q.define,draw:ia({}),elements:function(a){return fa.create(a)},buffer:function(a){return Y.create(a,34962)},texture:function(a){return r.create(a,3553)},cube:function(a){return 6===arguments.length?r.create(Array.prototype.slice.call(arguments),34067):r.create(a,34067)},renderbuffer:function(a){return k.create(a)},framebuffer:function(a){return t.create(a)},
framebufferCube:function(a){},frame:function(a){Z.push(a);!ka&&0<Z.length&&d();return{cancel:function(){var b=Z.find(function(b){return b===a});0>b||(Z.splice(b,1),0>=Z.length&&g())}}},stats:x,limits:T,read:ja,destroy:function(){g();U&&(U.removeEventListener("webglcontextlost",m),U.removeEventListener("webglcontextrestored",ha));ga.clear();t.clear();k.clear();r.clear();Y.clear();if(G.onDestroy)G.onDestroy()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/clock":3,"./lib/compile":5,"./lib/context":9,
"./lib/draw":10,"./lib/dynamic":11,"./lib/elements":12,"./lib/extend":13,"./lib/extension":14,"./lib/framebuffer":15,"./lib/limits":18,"./lib/raf":21,"./lib/read":22,"./lib/renderbuffer":23,"./lib/shader":24,"./lib/state":26,"./lib/strings":27,"./lib/texture":28,"./lib/uniform":30}]},{},[32])(32)});
