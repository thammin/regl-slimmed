(function(qa){"object"===typeof exports&&"undefined"!==typeof module?module.exports=qa():"function"===typeof define&&define.amd?define([],qa):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).initREGL=qa()})(function(){return function e(h,l,d){function p(b,g){if(!l[b]){if(!h[b]){var z="function"==typeof require&&require;if(!g&&z)return z(b,!0);if(c)return c(b,!0);z=Error("Cannot find module '"+b+"'");throw z.code="MODULE_NOT_FOUND",z;}z=l[b]=
{exports:{}};h[b][0].call(z.exports,function(c){var d=h[b][1][c];return p(d?d:c)},z,z.exports,e,h,l,d)}return l[b].exports}for(var c="function"==typeof require&&require,b=0;b<d.length;b++)p(d[b]);return p}({1:[function(e,h,l){var d=e("./constants/dtypes.json");h.exports=function(p,c,b,e,g){function z(){this.pointer=!1;this.w=this.z=this.y=this.x=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function q(b){this.records=[];this.name=b}function h(b,
a,n,d){d=n.size||d;var f;f=a.pointer?n.pointer&&a.buffer===n.buffer&&a.size===d&&a.normalized===n.normalized&&a.type===n.type&&a.offset===n.offset&&a.stride===n.stride&&a.divisor===n.divisor:!n.pointer&&a.x===n.x&&a.y===n.y&&a.z===n.z&&a.w===n.w;f||(n.pointer?(a.pointer||p.enableVertexAttribArray(b),a.buffer!==n.buffer&&n.buffer.bind(),p.vertexAttribPointer(b,d,n.type,n.normalized,n.stride,n.offset),(f=c.angle_instanced_arrays)&&f.vertexAttribDivisorANGLE(b,n.divisor)):(a.pointer&&p.disableVertexAttribArray(b),
p.vertexAttrib4f(b,n.x,n.y,n.z,n.w)),(a.pointer=n.pointer)?(a.buffer=n.buffer,a.size=d,a.normalized=n.normalized,a.type=n.type,a.offset=n.offset,a.stride=n.stride,a.divisor=n.divisor):(a.x=n.x,a.y=n.y,a.z=n.z,a.w=n.w))}var A={};b=b.maxAttributes;for(var u=Array(b),f=0;f<b;++f)u[f]=new z;return{bindings:u,bind:function(b,a,c,d){c=c.records;h(b,a,c[c.length-1],d)},bindRecord:h,def:function(b){var a=g.id(b),c=A[a];c||(c=A[a]=new q(b));return c},box:function(b){var a=[new z];return{alloc:function(b){var c;
c=0>=a.length?new z:a.pop();if("number"===typeof b)c.pointer=!1,c.x=b,c.y=0,c.z=0,c.w=0;else if(Array.isArray(b))c.pointer=!1,c.x=b[0],c.y=b[1],c.z=b[2],c.w=b[3];else{var f=e.getBuffer(b),p=0,q=0,g=0,h=0,r=!1,I=5126;f?I=f.dtype:(f=e.getBuffer(b.buffer),p=b.size||0,q=b.stride||0,g=b.offset||0,h=b.divisor||0,r=b.normalized||!1,I=f.dtype,"type"in b&&(I=d[b.type]));c.pointer=!0;c.buffer=f;c.size=p;c.offset=g;c.stride=q;c.divisor=h;c.normalized=r;c.type=I}return c},free:function(b){a.push(b)}}},state:A}}},
{"./constants/dtypes.json":5}],2:[function(e,h,l){function d(b,c){switch(b){case 5121:return new Uint8Array(c);case 5123:return new Uint16Array(c);case 5125:return new Uint32Array(c);case 5120:return new Int8Array(c);case 5122:return new Int16Array(c);case 5124:return new Int32Array(c);case 5126:return new Float32Array(c);default:return null}}var p=e("./util/is-typed-array"),c=e("./util/is-ndarray"),b=e("./constants/arraytypes.json"),L=e("./constants/dtypes.json"),g=e("./util/values"),z={"static":35044,
dynamic:35048,stream:35040};h.exports=function(q){function e(c,b){this.id=f++;this.buffer=c;this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.data=null;this.dtype=5121}function h(c){q.isBuffer(c.buffer)||(c.buffer=q.createBuffer());c.bind();q.bufferData(c.type,c.data||c.byteLength,c.usage)}function u(c){var b=c.buffer;q.isBuffer(b)&&q.deleteBuffer(b);c.buffer=null;delete r[c.id]}var f=0,r={};e.prototype.bind=function(){q.bindBuffer(this.type,this.buffer)};return{create:function(a,
f,g){function E(a){var f=a||{};if(Array.isArray(f)||p(f)||c(f))f={data:f};else if("number"===typeof f)f={length:f|0};else if(null===f||void 0===f)f={};l.usage="usage"in f?z[f.usage]:35044;a=0;"type"in f&&(a=L[f.type]);var n=f.dimension|0||1,q=0,g=null;if("data"in f)if(g=f.data,null===g)q=f.length|0;else{if(c(g)){var n=g.shape,q=g.stride,f=g.offset,e=0,r=0,u=0,m=0;1===n.length?(e=n[0],r=1,u=q[0],m=0):2===n.length&&(e=n[0],r=n[1],u=q[0],m=q[1]);a=a||b[Object.prototype.toString.call(g)]|0||5126;for(var n=
r,q=d(a,e*r),g=g.data,R=0,ga=0;ga<e;++ga)for(var N=0;N<r;++N)q[R++]=g[u*ga+m*N+f];g=q}else if(Array.isArray(g))if(0<g.length&&Array.isArray(g[0])){n=g[0].length;a=a||5126;f=d(a,g.length*n);q=g;g=n;for(e=m=0;e<q.length;++e)for(u=q[e],r=0;r<g;++r)f[m++]=u[r];g=f}else a=a||5126,g=d(a,g);else a=a||b[Object.prototype.toString.call(g)]|0;q=g.byteLength}else"length"in f&&(q=f.length|0);l.data=g;l.dtype=a||5121;l.byteLength=q;l.dimension=n;h(l);return E}var B=q.createBuffer(),l=new e(B,f);r[l.id]=l;g||E(a);
E._reglType="buffer";E._buffer=l;E.destroy=function(){u(l)};return E},clear:function(){g(r).forEach(u)},refresh:function(){g(r).forEach(h)},getBuffer:function(c){return c&&c._buffer instanceof e?c._buffer:null}}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/values":31}],3:[function(e,h,l){function d(c){switch(c){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;
default:return 1}}function p(c,b,f,d){var a,n=",";switch(b){case 5126:a="1f";break;case 35664:a="2fv";break;case 35665:a="3fv";break;case 35666:a="4fv";break;case 35670:case 5124:a="1i";break;case 35671:case 35667:a="2iv";break;case 35672:case 35668:a="3iv";break;case 35673:case 35669:a="4iv";break;case 35674:a="Matrix2fv";n=",false,";break;case 35675:a="Matrix3fv";n=",false,";break;case 35676:a="Matrix4fv",n=",false,"}return c+".uniform"+a+"("+f+n+d+");"}function c(c){return c+"["+c+".length-1]"}
function b(c,b){return"framebuffer"===c||c<b?-1:c>b?1:0}var L=e("./util/codegen"),g=e("./constants/primitives.json"),z={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},q={never:512,less:513,"<":513,equal:514,"=":514,"==":514,
"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},I={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};h.exports=function(e,h,f,r,a,n,v,E,l,Q,x,U,P,ka,X){function ja(a,m,r,h,S){function v(c){var b=J[c];return b?b:b=J[c]=t(V[c])}function u(c){var b=c.id,a=U[b];if(a)return a;a=c.func?k.def(t(c.data),"(",W,",",Z,",",ba,")"):k.def(W,".",c.data);return U[b]=a}function ha(c,
b){for(var a=0;a<c.length;++a)if(c[a].name===b)return c[a];return null}function l(c){return la&&!(c in m||c in S)}var ia=L(),t=ia.link,k=ia.proc("batch"),ca=ia.block(),D=k.def,M=k.arg,y=t(e),w=t(a.program),O=t(x.bind),G=t(x.bindRecord),ba=t(ka),pa=t(E),da=t(P.count),fa=t(P.offset),ma=t(P.instances),C=t(P.primitive),J={},F=t(n.elements),da=D(c(da)),fa=D(c(fa)),C=D(c(C)),F=D(c(F)),K,B,ea=f.angle_instanced_arrays;ea&&(K=D(c(ma)),B=t(ea));var la="elements"in m,ma=M(),M=M(),W=D(),Z=D(),U={};k(y,".useProgram(",
w,");");a.uniforms.forEach(function(c){if(!(c.name in r)){var b=t(c.location),a=t(Q.def(c.name)),a=a+"["+a+".length-1]";c=c.info.type;35678===c||35680===c?(c=D(a+"._texture"),k(p(y,5124,b,c+".bind()")),ca(c,".unbind();")):k(p(y,c,b,a))}});a.attributes.forEach(function(c){if(!(c.name in h)){var b=t(x.def(c.name));k(O,"(",c.location,",",t(x.bindings[c.location]),",",b,",",d(c.info.type),");")}});la||k("if(",F,")",y,".bindBuffer(",34963,",",F,".buffer.buffer);");k("for(",Z,"=0;",Z,"<",ma,";++",Z,"){",
W,"=",M,"[",Z,"];");Object.keys(m).sort(b).forEach(function(c){function b(c){k("if(",a,"){",y,".enable(",c,");}else{",y,".disable(",c,");}")}var a=u(m[c]);switch(c){case "framebuffer":c=v("viewport");var w=v("scissor.box");k("if(",pa,".push(",a,"&&",a,"._framebuffer)){",pa,".poll();",c,".setDirty();",w,".setDirty();","}");break;case "cull.enable":b(2884);break;case "blend.enable":b(3042);break;case "dither":b(3024);break;case "stencil.enable":b(2960);break;case "depth.enable":b(2929);break;case "scissor.enable":b(3089);
break;case "polygonOffset.enable":b(32823);break;case "sample.alpha":b(32926);break;case "sample.enable":b(32928);break;case "depth.mask":k(y,".depthMask(",a,");");break;case "depth.func":c=t(q);k(y,".depthFunc(",c,"[",a,"]);");break;case "depth.range":k(y,".depthRange(",a,"[0],",a,"[1]);");break;case "blend.color":k(y,".blendColor(",a,"[0],",a,"[1],",a,"[2],",a,"[3]);");break;case "blend.equation":c=t(H);k("if(typeof ",a,'==="string"){',y,".blendEquation(",c,"[",a,"]);","}else{",y,".blendEquationSeparate(",
c,"[",a,".rgb],",c,"[",a,".alpha]);","}");break;case "blend.func":c=t(z);k(y,".blendFuncSeparate(",c,'["srcRGB" in ',a,"?",a,".srcRGB:",a,".src],",c,'["dstRGB" in ',a,"?",a,".dstRGB:",a,".dst],",c,'["srcAlpha" in ',a,"?",a,".srcAlpha:",a,".src],",c,'["dstAlpha" in ',a,"?",a,".dstAlpha:",a,".dst]);");break;case "stencil.mask":k(y,".stencilMask(",a,");");break;case "stencil.func":c=t(q);k(y,".stencilFunc(",c,"[",a,'.cmp||"always"],',a,".ref|0,",'"mask" in ',a,"?",a,".mask:-1);");break;case "stencil.opFront":case "stencil.opBack":w=
t(I);k(y,".stencilOpSeparate(","stencil.opFront"===c?1028:1029,",",w,"[",a,'.fail||"keep"],',w,"[",a,'.zfail||"keep"],',w,"[",a,'.pass||"keep"]);');break;case "polygonOffset.offset":k(y,".polygonOffset(",a,".factor||0,",a,".units||0);");break;case "cull.face":k(y,".cullFace(",a,'==="front"?',1028,":",1029,");");break;case "lineWidth":k(y,".lineWidth(",a,");");break;case "frontFace":k(y,".frontFace(",a,'==="cw"?',2304,":",2305,");");break;case "colorMask":k(y,".colorMask(",a,"[0],",a,"[1],",a,"[2],",
a,"[3]);");break;case "sample.coverage":k(y,".sampleCoverage(",a,".value,",a,".invert);");break;case "scissor.box":case "viewport":c=v(c),k(c,".push(",a,".x||0,",a,".y||0,",a,".w||-1,",a,".h||-1);")}});("viewport"in m||"framebuffer"in m)&&k(v("viewport"),".poll();");("scissor.box"in m||"framebuffer"in m)&&k(v("scissor.box"),".poll();");"framebuffer"in m&&k(pa,".pop();");var X=a.uniforms,sa=[];Object.keys(r).forEach(function(c){var a=ha(X,c);if(a){var b=a.info.type,w=t(a.location);c=u(r[c]);35678===
a.info.type||35680===a.info.type?(a=D(c+"._texture"),sa.push(a),k(p(y,5124,w,a+".bind()"))):k(p(y,b,w,c))}});sa.forEach(function(c){k(c,".unbind();")});var ua=a.attributes;Object.keys(h).forEach(function(c){var a=ha(ua,c);if(a){var b=t(x.box(c));c=u(h[c]);c=D(b+".alloc("+c+")");k(G,"(",a.location,",",t(x.bindings[a.location]),",",c,",",d(a.info.type),");");ca(b,".free(",c,");")}});m.count&&k(da,"=",u(m.count),";");m.offset&&k(fa,"=",u(m.offset),";");m.primitive&&k(C,"=",t(g),"[",u(m.primitive),"];");
ea&&m.instances&&k(K,"=",u(m.instances),";");la&&(a=u(m.elements),k(F,"=",a,"?",a,"._elements:null;"));l("offset")&&k(fa,"=0;");k("if(",F,"){");l("count")&&k(da,"=",F,".vertCount;");k("if(",da,">0){");l("primitive")&&k(C,"=",F,".primType;");la&&k(y,".bindBuffer(",34963,",",F,".buffer.buffer);");ea&&k("if(",K,">0){",B,".drawElementsInstancedANGLE(",C,",",da,",",F,".type,",fa,",",K,");}else ");k(y,".drawElements(",C,",",da,",",F,".type,",fa,");");k("}}else if(",da,">0){");l("count")||(l("primitive")&&
k(C,"=",4,";"),ea&&k("if(",K,">0){",B,".drawArraysInstancedANGLE(",C,",",fa,",",da,",",K,");}else{"),k(y,".drawArrays(",C,",",fa,",",da,");"),ea&&k("}"));k("}}",ca);return ia.compile().batch}var V=l.contextState,H={add:32774,subtract:32778,"reverse subtract":32779};f.ext_blend_minmax&&(H.min=32775,H.max=32776);var m=0;return{draw:function(a){var b=L(),m=b.link,g=b.proc("draw"),q=g.def,z=m(e),r=m(a.program),h=m(x.bind),u=m(P.count),v=m(P.offset),t=m(P.instances),k=m(P.primitive),E=m(n.elements),I=
[];g(z,".useProgram(",r,");");a.attributes.forEach(function(c){var a=m(x.def(c.name));g(h,"(",c.location,",",m(x.bindings[c.location]),",",a,",",d(c.info.type),");")});a.uniforms.forEach(function(c){var a=m(c.location),b=m(Q.def(c.name)),b=b+"["+b+".length-1]";c=c.info.type;35678===c||35680===c?(c=q(b+"._texture"),I.push(c),g(p(z,5124,a,c+".bind()"))):g(p(z,c,a,b))});I.forEach(function(c){g(c,".unbind();")});a=q(c(k));u=q(c(u));v=q(c(v));E=q(c(E));g("if(",u,"){");(r=f.angle_instanced_arrays)?(t=q(c(t)),
r=m(r),g("if(",E,"){",E,".bind();","if(",t,">0){",r,".drawElementsInstancedANGLE(",a,",",u,",",E,".type,",v,",",t,");}else{",z,".drawElements(",a,",",u,",",E,".type,",v,");}","}else if(",t,">0){",r,".drawArraysInstancedANGLE(",a,",",v,",",u,",",t,");}else{",z,".drawArrays(",a,",",v,",",u,");}}")):g("if(",E,"){",E,".bind();",z,".drawElements(",a,",",u,",",E,".type,",v,");","}else{",z,".drawArrays(",a,",",v,",",u,");}}");return b.compile().draw},command:function(c,a,f,d,p,e,r){function v(c){var a=ma[c];
return a?a:a=ma[c]=k(V[c])}function l(c,a){var b=v(c);C(b,".push(",a,");");J(b,".pop();")}function A(c){var a=c.id,b=la[a];if(b)return b;b=c.func?F.def(k(c.data),"(",ea,",0,",ra,")"):F.def(ea,".",c.data);return la[a]=b}var t=L(),k=t.link,B=t.block,D=t.proc,M=m++,y=k(X),w=k(U),O=k(E),G={count:k(P.count),offset:k(P.offset),instances:k(P.instances),primitive:k(P.primitive)},ba=k(n.elements),pa=k(g),da=k(q),fa=k(I),ma={},C=B(),J=B();Object.keys(c).sort(b).forEach(function(a){var b=c[a];switch(a){case "frag":case "vert":b=
h.id(b);U.shader("frag"===a?35632:35633,b);C(w,".",a,".push(",b,");");J(w,".",a,".pop();");break;case "framebuffer":E.getFramebuffer(b);a=v("viewport");var f=v("scissor.box");C("if(",O,".push(",k(b&&b._framebuffer),")){",a,".setDirty();",f,".setDirty();","}");J("if(",O,".pop()){",a,".setDirty();",f,".setDirty();","}");break;case "count":case "offset":case "instances":C(G[a],".push(",b,");");J(G[a],".pop();");break;case "primitive":C(G.primitive,".push(",g[b],");");J(G.primitive,".pop();");break;case "elements":f=
n.getElements(b);b=!("primitive"in c);a=!("count"in c);f?(f=k(f),C(ba,".push(",f,");"),b&&C(G.primitive,".push(",f,".primType);"),a&&C(G.count,".push(",f,".vertCount);")):(C(ba,".push(null);"),b&&C(G.primitive,".push(",4,");"),a&&C(G.count,".push(0);"));b&&J(G.primitive,".pop();");a&&J(G.count,".pop();");"offset"in c||(C(G.offset,".push(0);"),J(G.offset,".pop();"));J(ba,".pop();");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":l(a,
b);break;case "depth.func":l(a,q[b]);break;case "depth.range":a=v(a);C(a,".push(",b[0],",",b[1],");");J(a,".pop();");break;case "blend.func":a=v(a);C(a,".push(",z["srcRGB"in b?b.srcRGB:b.src],",",z["dstRGB"in b?b.dstRGB:b.dst],",",z["srcAlpha"in b?b.srcAlpha:b.src],",",z["dstAlpha"in b?b.dstAlpha:b.dst],");");J(a,".pop();");break;case "blend.equation":a=v(a);"string"===typeof b?C(a,".push(",H[b],",",H[b],");"):"object"===typeof b&&C(a,".push(",H[b.rgb],",",H[b.alpha],");");J(a,".pop();");break;case "blend.color":a=
v(a);C(a,".push(",b[0],",",b[1],",",b[2],",",b[3],");");J(a,".pop();");break;case "stencil.mask":a=v(a);C(a,".push(",b,");");J(a,".pop();");break;case "stencil.func":var f=b.cmp||"keep",d=b.ref||0,b="mask"in b?b.mask:-1;a=v(a);C(a,".push(",q[f],",",d,",",b,");");J(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":f=b.fail||"keep";d=b.zfail||"keep";b=b.pass||"keep";a=v(a);C(a,".push(",I[f],",",I[d],",",I[b],");");J(a,".pop();");break;case "polygonOffset.offset":f=b.factor||0;b=b.units||
0;a=v(a);C(a,".push(",f,",",b,");");J(a,".pop();");break;case "cull.face":f=0;"front"===b?f=1028:"back"===b&&(f=1029);b=v(a);C(b,".push(",f,");");J(b,".pop();");break;case "lineWidth":l(a,b);break;case "frontFace":f=0;"cw"===b?f=2304:"ccw"===b&&(f=2305);b=v(a);C(b,".push(",f,");");J(b,".pop();");break;case "colorMask":a=v(a);C(a,".push(",b.map(function(a){return!!a}).join(),");");J(a,".pop();");break;case "sample.coverage":f="value"in b?b.value:1;b=!!b.invert;a=v(a);C(a,".push(",f,",",b,");");J(a,
".pop();");break;case "viewport":case "scissor.box":var f=b.x||0,d=b.y||0,m=-1,p=-1;"w"in b&&(m=b.w);"h"in b&&(p=b.h);b=v(a);C(b,".push(",f,",",d,",",m,",",p,");");J(b,".pop();")}});Object.keys(a).forEach(function(c){var b=k(Q.def(c));c=a[c];c="function"===typeof c&&c._reglType?k(c):Array.isArray(c)?k(c.slice()):+c;C(b,".push(",c,");");J(b,".pop();")});Object.keys(f).forEach(function(a){var c=f[a],b=k(x.def(a));a=k(x.box(a).alloc(c));C(b,".records.push(",a,");");J(b,".records.pop();")});var F=t.block(),
K=t.block(),ra,ea;r&&(ra=k(ka),ea=C.def());var la={};Object.keys(d).sort(b).forEach(function(a){var b=A(d[a]);switch(a){case "framebuffer":a=v("viewport");var w=v("scissor.box");F("if(",O,".push(",b,"&&",b,"._framebuffer)){",a,".setDirty();",w,".setDirty();","}");K("if(",O,".pop()){",a,".setDirty();",w,".setDirty();","}");break;case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "lineWidth":case "depth.mask":a=
v(a);F(a,".push(",b,");");K(a,".pop();");break;case "count":case "offset":case "instances":a=G[a];F(a,".push(",b,");");K(a,".pop();");break;case "primitive":a=G.primitive;F(a,".push(",pa,"[",b,"]);");K(a,".pop();");break;case "depth.func":a=v(a);F(a,".push(",da,"[",b,"]);");K(a,".pop();");break;case "blend.func":a=v(a);w=k(z);F(a,".push(",w,'["srcRGB" in ',b,"?",b,".srcRGB:",b,".src],",w,'["dstRGB" in ',b,"?",b,".dstRGB:",b,".dst],",w,'["srcAlpha" in ',b,"?",b,".srcAlpha:",b,".src],",w,'["dstAlpha" in ',
b,"?",b,".dstAlpha:",b,".dst]);");K(a,".pop();");break;case "blend.equation":a=v(a);w=k(H);F("if(typeof ",b,'==="string"){',a,".push(",w,"[",b,"],",w,"[",b,"]);","}else{",a,".push(",w,"[",b,".rgb],",w,"[",b,".alpha]);","}");K(a,".pop();");break;case "blend.color":a=v(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "stencil.mask":a=v(a);F(a,".push(",b,");");K(a,".pop();");break;case "stencil.func":a=v(a);F(a,".push(",da,"[",b,".cmp],",b,".ref|0,",'"mask" in ',b,"?",
b,".mask:-1);");K(a,".pop();");break;case "stencil.opFront":case "stencil.opBack":a=v(a);F(a,".push(",fa,"[",b,'.fail||"keep"],',fa,"[",b,'.zfail||"keep"],',fa,"[",b,'.pass||"keep"]);');K(a,".pop();");break;case "polygonOffset.offset":a=v(a);F(a,".push(",b,".factor||0,",b,".units||0);");K(a,".pop();");break;case "cull.face":a=v(a);F(a,".push(",b,'==="front"?',1028,":",1029,");");K(a,".pop();");break;case "frontFace":a=v(a);F(a,".push(",b,'==="cw"?',2304,":",2305,");");K(a,".pop();");break;case "colorMask":a=
v(a);F(a,".push(",b,"[0],",b,"[1],",b,"[2],",b,"[3]);");K(a,".pop();");break;case "sample.coverage":a=v(a);F(a,".push(",b,".value,",b,".invert);");K(a,".pop();");break;case "scissor.box":case "viewport":a=v(a);F(a,".push(",b,".x||0,",b,".y||0,",'"w" in ',b,"?",b,".w:-1,",'"h" in ',b,"?",b,".h:-1);");K(a,".pop();");break;case "elements":a=!("primitive"in d)&&!("primitive"in c);var w=!("count"in d)&&!("count"in c),f=!("offset"in d)&&!("offset"in c),m=F.def();F("if(",b,"){",m,"=",b,"._elements;",ba,
".push(",m,");",a?G.primitive+".push("+m+".primType);":"",w?G.count+".push("+m+".vertCount);":"",f?G.offset+".push("+m+".offset);":"","}else{",ba,".push(null);","}");K(ba,".pop();","if(",b,"){",a?G.primitive+".pop();":"",w?G.count+".pop();":"",f?G.offset+".pop();":"","}")}});Object.keys(p).forEach(function(a){var b=k(Q.def(a));a=A(p[a]);F(b,".push(",a,");");K(b,".pop();")});Object.keys(e).forEach(function(a){var b=k(x.def(a)),c=A(e[a]);a=k(x.box(a));F(b,".records.push(",a,".alloc(",c,"));");K(a,".free(",
b,".records.pop());")});var W=D("scope"),Z=W.arg(),ta=W.arg();W(C);r&&W(ea,"=",Z,";",F);W(ta,"();",r?K:"",J);W=B();B=W.def();c.frag&&c.vert?(Z=c.frag,W(B,"=",k(U.program(h.id(c.vert),h.id(Z))),";")):W(B,"=",w,".program","(",w,".vert[",w,".vert.length-1]",",",w,".frag[",w,".frag.length-1]",");");Z=D("draw");Z(C,W);r&&Z(ea,"=",Z.arg(),";",F);Z(y,"();","if(",B,")",B,".draw(",r?ea:"",");",r?K:"",J);var na=D("batch");na(C,W);r=k(function(a,b,w){var f=a.batchCache[M];f||(f=a.batchCache[M]=ja(a,d,p,e,c));
return f(b,w)});na("if(",B,"){",y,"();",r,"(",B,",",na.arg(),",",na.arg(),");");Object.keys(d).forEach(function(a){(a=ma[a])&&na(a,".setDirty();")});na("}",J);return t.compile()}}}},{"./constants/primitives.json":6,"./util/codegen":22}],4:[function(e,h,l){h.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121}},{}],5:[function(e,h,l){h.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126}},{}],6:[function(e,h,l){h.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,h,l){function d(b,d){function g(){var d=window.innerWidth,f=window.innerHeight;b!==document.body&&(f=b.getBoundingClientRect(),d=f.right-f.left,f=f.top-f.bottom);e.width=h*d;e.height=h*f;c(e.style,{width:d+"px",
height:f+"px"})}var e=document.createElement("canvas"),q=p(e,d);c(e.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(e);b===document.body&&(e.style.position="absolute",c(b.style,{margin:0,padding:0}));var h=+q.options.pixelRatio;window.addEventListener("resize",g,!1);var l=q.options.onDestroy;q.options=c(c({},q.options),{onDestroy:function(){window.removeEventListener("resize",g);b.removeChild(e);l&&l()}});g();return q}function p(b,d){function g(c){try{return b.getContext(c,p)}catch(d){return null}}
var p=d.glOptions||{};return{gl:g("webgl")||g("experimental-webgl")||g("webgl-experimental"),options:c({pixelRatio:window.devicePixelRatio},d)}}var c=e("./util/extend");h.exports=function(b){if("undefined"===typeof document||"undefined"===typeof HTMLElement)return{gl:b[0],options:b[1]||{}};var e=document.body,g=b[1]||{};if("string"===typeof b[0])e=document.querySelector(b[0])||document.body;else if("object"===typeof b[0])if(b[0]instanceof HTMLElement)e=b[0];else{if(b[0]instanceof WebGLRenderingContext)return{gl:b[0],
options:c({pixelRatio:1},g)};g=b[0]}return e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()?p(e,g):d(e,g)}},{"./util/extend":23}],8:[function(e,h,l){h.exports=function(d){return{primitive:[4],count:[-1],offset:[0],instances:[0]}}},{}],9:[function(e,h,l){function d(b,d){this.id=c++;this.func=b;this.data=d}function p(b,c){switch(typeof b){case "boolean":case "number":case "string":return new d(!1,b);case "function":return new d(!0,b);default:return p}}var c=0;h.exports={define:p,isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof d},unbox:function(b,c){return b instanceof d?b:"function"===typeof b&&b!==p?new d(!0,b):new d(!1,c)}}},{}],10:[function(e,h,l){var d=e("./util/is-typed-array"),p=e("./util/is-ndarray"),c=e("./constants/primitives.json");h.exports=function(b,e,g){function h(){this.buffer=null;this.primType=4;this.type=this.vertCount=0}h.prototype.bind=function(){this.buffer.bind()};return{create:function(b){function l(b){var g=e.oes_element_index_uint;if(b)if("number"===typeof b)u(b);
else{var a=null,n="static",q=0;Array.isArray(b)||d(b)||p(b)?a=b:("data"in b&&(a=b.data),"usage"in b&&(n=b.usage),"length"in b&&(q=b.length));Array.isArray(a)||p(a)&&"array"===a.dtype||"type"in b?u({type:b.type||(g?"uint32":"uint16"),usage:n,data:a,length:q}):u({usage:n,data:a,length:q});if(Array.isArray(a)||d(a))u.dimension=3}else u();g=A.buffer.byteLength;a=0;switch(A.buffer.dtype){case 5121:case 5120:a=5121;break;case 5123:case 5122:a=5123;g>>=1;break;case 5125:case 5124:a=5125,g>>=2}n=4;q=A.buffer.dimension;
1===q&&(n=0);2===q&&(n=1);3===q&&(n=4);"object"===typeof b&&("primitive"in b&&(n=c[b.primitive]),"count"in b&&(g=b.vertCount|0));A.primType=n;A.vertCount=g;A.type=a;return l}var A=new h,u=g.create(null,34963,!0);A.buffer=u._buffer;l(b);l._reglType="elements";l._elements=A;l.destroy=function(){u.destroy();A.buffer=null};return l},elements:[null],getElements:function(b){return b&&b._elements instanceof h?b._elements:null}}}},{"./constants/primitives.json":6,"./util/is-ndarray":24,"./util/is-typed-array":25}],
11:[function(e,h,l){h.exports=function(d){function e(){"oes_texture_float oes_texture_float_linear oes_texture_half_float oes_texture_half_float_linear oes_standard_derivatives oes_element_index_uint oes_fbo_render_mipmap webgl_depth_texture webgl_draw_buffers webgl_color_buffer_float ext_texture_filter_anisotropic ext_frag_depth ext_blend_minmax ext_shader_texture_lod ext_color_buffer_half_float ext_srgb angle_instanced_arrays webgl_compressed_texture_s3tc webgl_compressed_texture_atc webgl_compressed_texture_pvrtc webgl_compressed_texture_etc1".split(" ").forEach(function(b){try{c[b]=
d.getExtension(b)}catch(e){}})}var c={};e();return{extensions:c,refresh:e}}},{}],12:[function(e,h,l){var d=e("./util/values"),p=e("./util/extend"),c=[1029];h.exports=function(b,e,g,h,q){function l(a,b,c,d){this.target=a;this.level=b;this.texture=c;this.renderbuffer=d}function A(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function u(a,b){var c=b.width,d=b.height;if(a.texture)var f=a.texture._texture,g=Math.max(1,f.params.width>>a.level),e=Math.max(1,
f.params.height>>a.level),c=c||g,d=d||e;else f=a.renderbuffer._renderbuffer,c=c||f.width,d=d||f.height;f.refCount+=1;b.width=c;b.height=d}function f(a,c){c?c.texture?b.framebufferTexture2D(36160,a,c.target,c.texture._texture.texture,c.level):b.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function r(a){var b=3553,c=0,d=null,f=null;"object"===typeof a&&("level"in a&&(c=a.level|0),"target"in a&&(b=a.target|0));var g=a._reglType;
"texture"===g?d=a:"renderbuffer"===g&&(f=a,b=36161,c=0);return new l(b,c,d,f)}function a(a){return a&&(a.texture||a.renderbuffer)}function n(){this.id=X++;ja[this.id]=this;this.framebuffer=null;this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null;this.ownsDepthStencil=this.ownsColor=!1}function v(a){b.isFramebuffer(a.framebuffer)||(a.framebuffer=b.createFramebuffer());H=!0;b.bindFramebuffer(36160,a.framebuffer);for(var c=a.colorAttachments,
d=0;d<c.length;++d)f(36064+d,c[d]);for(d=c.length;d<g.maxColorAttachments;++d)f(36064+d,null);f(36096,a.depthAttachment);f(36128,a.stencilAttachment);f(33306,a.depthStencilAttachment);e.webgl_draw_buffers&&e.webgl_draw_buffers.drawBuffersWEBGL(ka[c.length]);b.checkFramebufferStatus(36160)}function E(a){a=a.framebuffer;b.isFramebuffer(a)&&b.deleteFramebuffer(a)}function B(){return V[V.length-1]}var Q={rgba:6408},x={rgba4:32854,rgb565:36194,"rgb5 a1":32855};e.ext_srgb&&(x.srgba=35907);e.ext_color_buffer_half_float&&
(x.rgba16f=34842,x.rgb16f=34843);e.webgl_color_buffer_float&&(x.rgba32f=34836);var U=[],P=[];e.webgl_depth_texture&&(U.push(6402),P.push(34041));p(p({},Q),x);d(Q);d(x);x=5121;U={uint8:5121};e.oes_texture_half_float&&(x=U["half float"]=36193);e.oes_texture_float&&(x=U["float"]=5126);U.best=x;var ka=function(){for(var a=Array(g.maxDrawbuffers),b=0;b<=g.maxDrawbuffers;++b)for(var c=a[b]=Array(b),d=0;d<b;++d)c[d]=36064+d;return a}(),X=0,ja={},V=[null],H=!0;return{top:B,dirty:function(){return H},push:function(a){a=
a||null;H=H||a!==B();V.push(a);return H},pop:function(){var a=B();V.pop();return H=H||a!==B()},getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof n)?a:null},poll:function(){if(H){var a=V[V.length-1],d=e.webgl_draw_buffers;a?(b.bindFramebuffer(36160,a.framebuffer),d&&d.drawBuffersWEBGL(ka[a.colorAttachments.length])):(b.bindFramebuffer(36160,null),d&&d.drawBuffersWEBGL(c));H=!1}},create:function(c){function d(c){var g,e=c||{},n=c=0;if("shape"in
e){var p=e.shape;c=p[0];n=p[1]}else"radius"in e&&(c=n=e.radius),"width"in e&&(c=e.width),"height"in e&&(n=e.height);var m=null,p=!1;if("colorBuffers"in e||"colorBuffer"in e){m=e.colorBuffers||e.colorBuffer;Array.isArray(m)||(m=[m]);f.width=c;f.height=n;m=m.map(r);for(g=0;g<m.length;++g)u(m[g],f);c=f.width;n=f.height}else{var E=!0,B="rgba",t="uint8",k=1,p=!0;f.width=c=c||b.drawingBufferWidth;f.height=n=n||b.drawingBufferHeight;"format"in e&&(B=e.format,E=B in Q);"type"in e&&(t=e.type);"colorCount"in
e&&(k=e.colorCount|0);if(f.ownsColor)for(m=f.colorAttachments;m.length>k;)A(m.pop());else m=[];for(g=0;g<m.length;++g){var L;a:{L=m[g];var D=E,x=B,y=c,w=n;if(L.texture){var O=L.texture;if(D){O({format:x,type:t,width:y,height:w});O._texture.refCount+=1;L=!0;break a}}else if(O=L.renderbuffer,!D){O({format:x,width:y,height:w});O._renderbuffer.refCount+=1;L=!0;break a}A(L);L=!1}L||(m[g--]=m[m.length-1],m.pop())}for(;m.length<k;)E?m.push(new l(3553,0,h.create({format:B,type:t,width:c,height:n},3553),null)):
m.push(new l(36161,0,null,q.create({format:B,width:c,height:n})))}f.width=c;f.height=n;B=E=g=null;t=!1;"depthBuffer"in e&&(g=r(e.depthBuffer));"stencilBuffer"in e&&(E=r(e.stencilBuffer));"depthStencilBuffer"in e&&(B=r(e.depthStencilBuffer));if(g||E||B)u(g||E||B,f);else if(k=!0,D=L=!1,"depth"in e&&(k=!!e.depth),"stencil"in e&&(L=!!e.stencil),"depthTexture"in e&&(D=!!e.depthTexture),e=f.depthAttachment||f.stencilAttachment||f.depthStencilAttachment,x=null,k||L)t=!0,D?(D=L?"depth stencil":"depth",f.ownsDepthStencil&&
e.texture?(e.texture({format:D,width:c,height:n}),e.texture._texture.refCount+=1,x=e):x=new l(3553,0,h.create({format:D,width:c,height:n},3553),null)):(D=k?L?"depth stencil":"depth":"stencil",f.ownsDepthStencil&&e.renderbuffer?(e.renderbuffer({format:D,width:c,height:n}),e.renderbuffer._renderbuffer.refCount+=1,x=e):x=new l(36161,0,null,q.create({format:D,width:c,height:n}))),k?L?B=x:g=x:E=x;c=f;c.colorAttachments.forEach(A);A(c.depthAttachment);A(c.stencilAttachment);A(c.depthStencilAttachment);
f.colorAttachments=m;f.depthAttachment=g;f.stencilAttachment=E;f.depthStencilAttachment=B;f.ownsColor=p;f.ownsDepthStencil=t;d.color=m.map(a);d.depth=a(g);d.stencil=a(E);d.depthStencil=a(B);v(f);d.width=f.width;d.height=f.height;return d}var f=new n;d(c);d._reglType="framebuffer";d._framebuffer=f;d._destroy=function(){E(f)};return d},clear:function(){d(ja).forEach(E)},refresh:function(){d(ja).forEach(v)}}}},{"./util/extend":23,"./util/values":31}],13:[function(e,h,l){h.exports=function(d,e){var c=
1;e.ext_texture_filter_anisotropic&&(c=d.getParameter(34047));var b=1,h=1;e.webgl_draw_buffers&&(b=d.getParameter(34852),h=d.getParameter(36063));return{colorBits:[d.getParameter(3410),d.getParameter(3411),d.getParameter(3412),d.getParameter(3413)],depthBits:d.getParameter(3414),stencilBits:d.getParameter(3415),subpixelBits:d.getParameter(3408),extensions:Object.keys(e).filter(function(b){return!!e[b]}),maxAnisotropic:c,maxDrawbuffers:b,maxColorAttachments:h,pointSizeDims:d.getParameter(33901),lineWidthDims:d.getParameter(33902),
maxViewportDims:d.getParameter(3386),maxCombinedTextureUnits:d.getParameter(35661),maxCubeMapSize:d.getParameter(34076),maxRenderbufferSize:d.getParameter(34024),maxTextureUnits:d.getParameter(34930),maxTextureSize:d.getParameter(3379),maxAttributes:d.getParameter(34921),maxVertexUniforms:d.getParameter(36347),maxVertexTextureUnits:d.getParameter(35660),maxVaryingVectors:d.getParameter(36348),maxFragmentUniforms:d.getParameter(36349),glsl:d.getParameter(35724),renderer:d.getParameter(7937),vendor:d.getParameter(7936),
version:d.getParameter(7938)}}},{}],14:[function(e,h,l){var d=e("./util/is-typed-array");h.exports=function(e,c,b){return function(h){var g=h||{};d(h)?g={data:g}:2===arguments.length?g={width:arguments[0]|0,height:arguments[1]|0}:"object"!==typeof h&&(g={});c();var z=g.x||0,q=g.y||0,l=g.width||b.width,A=g.height||b.height,g=g.data||new Uint8Array(l*A*4);e.pixelStorei(3333,4);e.readPixels(z,q,l,A,6408,5121,g);return g}}},{"./util/is-typed-array":25}],15:[function(e,h,l){var d=e("./util/values");h.exports=
function(e,c,b){function h(){this.id=l++;this.refCount=1;this.renderbuffer=null;this.format=32854;this.height=this.width=0}function g(b){e.isRenderbuffer(b.renderbuffer)||(b.renderbuffer=e.createRenderbuffer());e.bindRenderbuffer(36161,b.renderbuffer);e.renderbufferStorage(36161,b.format,b.width,b.height)}function z(b){var c=b.renderbuffer;e.bindRenderbuffer(36161,null);e.isRenderbuffer(c)&&e.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete A[b.id]}var q={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(q.srgba=35907);c.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);c.webgl_color_buffer_float&&(q.rgba32f=34836);var l=0,A={};h.prototype.decRef=function(){0===--this.refCount&&z(this)};return{create:function(b){function c(a){a=a||{};var b=0,e=0;"shape"in a?(e=a.shape,b=e[0]|0,e=e[1]|0):("radius"in a&&(b=e=a.radius|0),"width"in a&&(b=a.width|0),"height"in a&&(e=a.height|0));c.width=d.width=Math.max(b,1);c.height=d.height=Math.max(e,
1);d.format=32854;"format"in a&&(d.format=q[a.format]);g(d);return c}var d=new h;A[d.id]=d;c(b);c._reglType="renderbuffer";c._renderbuffer=d;c.destroy=function(){d.decRef()};return c},refresh:function(){d(A).forEach(g)},clear:function(){d(A).forEach(z)}}}},{"./util/values":31}],16:[function(e,h,l){function d(c,b,d,e){this.name=c;this.id=b;this.location=d;this.info=e}var p=e("./util/values");h.exports=function(c,b,e,g,h){function q(a,b){var d=35632===a?u:f,e=d[b];if(!e){var g=h.str(b),e=c.createShader(a);
c.shaderSource(e,g);c.compileShader(e);d[b]=e}return e}function l(a,b){this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];this.draw=function(){};this.batchCache={}}function A(a){var f,p;f=q(35632,a.fragId);p=q(35633,a.vertId);var r=a.program=c.createProgram();c.attachShader(r,f);c.attachShader(r,p);c.linkProgram(r);var l=c.getProgramParameter(r,35718),u=a.uniforms=[];for(f=0;f<l;++f)if(p=c.getActiveUniform(r,f))if(1<p.size)for(var A=0;A<p.size;++A){var I=p.name.replace("[0]",
"["+A+"]");e.def(I);u.push(new d(I,h.id(I),c.getUniformLocation(r,I),p))}else e.def(p.name),u.push(new d(p.name,h.id(p.name),c.getUniformLocation(r,p.name),p));l=c.getProgramParameter(r,35721);u=a.attributes=[];for(f=0;f<l;++f)if(p=c.getActiveAttrib(r,f))b.def(p.name),u.push(new d(p.name,h.id(p.name),c.getAttribLocation(r,p.name),p));a.draw=g(a);a.batchCache={}}var u={},f={},r={},a=[];return{clear:function(){var b=c.deleteShader.bind(c);p(u).forEach(b);u={};p(f).forEach(b);f={};a.forEach(function(a){c.deleteProgram(a.program)});
a.length=0;r={}},refresh:function(){u={};f={};a.forEach(A)},program:function(b,c){var d=r[c];d||(d=r[c]={});var e=d[b];e||(e=new l(c,b),A(e),d[b]=e,a.push(e));return e},shader:q,frag:[-1],vert:[-1]}}},{"./util/values":31}],17:[function(e,h,l){var d=e("./util/stack"),p=e("./util/codegen");h.exports=function(c,b,e){function g(b,e){var a=d([!!e],function(a){a?c.enable(b):c.disable(b)});a.flag=b;return a}var h={dither:g(3024),"blend.enable":g(3042),"blend.color":d([0,0,0,0],function(b,d,a,e){c.blendColor(b,
d,a,e)}),"blend.equation":d([32774,32774],function(b,d){c.blendEquationSeparate(b,d)}),"blend.func":d([1,0,1,0],function(b,d,a,e){c.blendFuncSeparate(b,d,a,e)}),"depth.enable":g(2929,!0),"depth.func":d([513],function(b){c.depthFunc(b)}),"depth.range":d([0,1],function(b,d){c.depthRange(b,d)}),"depth.mask":d([!0],function(b){c.depthMask(b)}),"cull.enable":g(2884),"cull.face":d([1029],function(b){c.cullFace(b)}),frontFace:d([2305],function(b){c.frontFace(b)}),colorMask:d([!0,!0,!0,!0],function(b,d,a,
e){c.colorMask(b,d,a,e)}),lineWidth:d([1],function(b){c.lineWidth(b)}),"polygonOffset.enable":g(32823),"polygonOffset.offset":d([0,0],function(b,d){c.polygonOffset(b,d)}),"sample.alpha":g(32926),"sample.enable":g(32928),"sample.coverage":d([1,!1],function(b,d){c.sampleCoverage(b,d)}),"stencil.enable":g(2960),"stencil.mask":d([-1],function(b){c.stencilMask(b)}),"stencil.func":d([519,0,-1],function(b,d,a){c.stencilFunc(b,d,a)}),"stencil.opFront":d([7680,7680,7680],function(b,d,a){c.stencilOpSeparate(1028,
b,d,a)}),"stencil.opBack":d([7680,7680,7680],function(b,d,a){c.stencilOpSeparate(1029,b,d,a)}),"scissor.enable":g(3089),"scissor.box":d([0,0,-1,-1],function(d,e,a,g){var q=a,p=b.top();0>a&&(q=p?p.width-d:c.drawingBufferWidth-d);a=g;0>g&&(a=p?p.height-e:c.drawingBufferHeight-e);c.scissor(d,e,q,a)}),viewport:d([0,0,-1,-1],function(d,g,a,q){var p=a,h=b.top();0>a&&(p=h?h.width-d:c.drawingBufferWidth-d);a=q;0>q&&(a=h?h.height-g:c.drawingBufferHeight-g);c.viewport(d,g,p,a);e.width=p;e.height=a})},q=p(),
l=q.proc("poll"),A=q.proc("refresh");Object.keys(h).forEach(function(b){b=q.link(h[b]);l(b,".poll();");A(b,".setDirty();")});var u=q.compile();return{contextState:h,viewport:e,poll:u.poll,refresh:u.refresh,notifyViewportChanged:function(){h.viewport.setDirty();h["scissor.box"].setDirty()}}}},{"./util/codegen":22,"./util/stack":29}],18:[function(e,h,l){h.exports=function(){var d={"":0},e=[""];return{id:function(c){var b=d[c];if(b)return b;b=d[c]=e.length;e.push(c);return b},str:function(c){return e[c]}}}},
{}],19:[function(e,h,l){function d(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function p(a){if(!Array.isArray(a))return!1;var b=a.length;if(0===b||!Array.isArray(a[0]))return!1;for(var c=a[0].length,d=1;d<b;++d)if(!Array.isArray(a[d])||a[d].length!==c)return!1;return!0}function c(a){return Object.prototype.toString.call(a)}function b(a){return"[object HTMLCanvasElement]"===c(a)}function L(a){return"[object CanvasRenderingContext2D]"===c(a)}var g=e("./util/extend"),z=e("./util/values"),
q=e("./util/is-typed-array"),I=e("./util/is-ndarray"),A=e("./util/load-texture"),u=e("./util/to-half-float"),f=e("./util/parse-dds"),r=[9984,9986,9985,9987];h.exports=function(a,e,h,l,B){function Q(a){this.target=a;this.premultiplyAlpha=this.flipY=!1;this.unpackAlignment=1;this.type=this.internalformat=this.format=this.channels=this.height=this.width=this.colorSpace=0;this.compressed=!1;this.y=this.x=this.offset=this.strideC=this.strideY=this.strideX=this.miplevel=0;this.copy=!1;this.crossOrigin=
this.xhr=this.canvas=this.video=this.image=this.data=null;this.needsListeners=this.needsPoll=!1}function x(a){this.target=a;this.type=this.internalformat=this.format=this.height=this.width=0;this.wrapT=this.wrapS=33071;this.minFilter=0;this.magFilter=9728;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function U(a,b){var c,d,e=0,g=0,f=0,q=0,p=0,h=0,k=!1,m=!1,n=!1;for(c=0;c<b.length;++c)d=b[c],q=q||d.width<<d.miplevel,p=p||d.height<<d.miplevel,e=e||d.type,g=g||d.format,f=f||d.internalformat,
h=h||d.channels,k=k||d.needsPoll,m=m||d.needsListeners,d=d.miplevel,n=n||0<d;a.needsPoll=k;a.needsListeners=m;a.width=q;a.height=p;a.format=g;a.internalformat=f;a.type=e;if(3553!==a.target)for(c=0;6>c;++c);c=0<=r.indexOf(a.minFilter);a.genMipmaps=!n&&(a.genMipmaps||c);n=n||a.genMipmaps;a.minFilter||(a.minFilter=n?9987:9728);a.wrapS=a.wrapS||33071;a.wrapT=a.wrapT||33071;for(c=0;c<b.length;++c)d=b[c],d.channels||(d.channels=h),d.format||(d.format=g),d.internalformat||(d.internalformat=f),d.type||(d.type=
e)}function P(a){this.id=k++;this.refCount=1;this.target=a;this.texture=null;this.unit=this.pollId=-1;this.bindCount=0;this.cancelPending=null;this.params=new x(a);this.pixels=[]}function ka(a,b){function c(a,d){var e=d.mipmap,w;if(Array.isArray(e))for(var f=0;f<e.length;++f)w=new Q(a),w.parseFlags(b),w.parseFlags(d),w.parse(e[f],f),g.push(w);else w=new Q(a),w.parseFlags(b),w.parse(d,0),g.push(w)}var d;V(a);var e=a.params;x.call(e,a.target);var g=a.pixels;g.length=0;e.parse(b);if(3553===a.target)c(3553,
b);else{var f=b.faces||b;if(Array.isArray(f))for(d=0;6>d;++d)c(34069+d,f[d]);else if("string"!==typeof f)for(d=0;6>d;++d)c(34069+d,{})}U(e,g);e.needsListeners&&ja(a);e.needsPoll&&(a.pollId=D.length,D.push(a));X(a)}function X(b){a.isTexture(b.texture)||(b.texture=a.createTexture());var c=b.target,d=b.unit;0<=d?(a.activeTexture(33984+d),t=d):a.bindTexture(c,b.texture);for(var c=b.pixels,e=b.params,f=0;f<c.length;++f)c[f].upload(e);e.upload();0>d&&((d=y[t])?a.bindTexture(d.target,d.texture):(b.unit=
t,y[t]=b))}function ja(a){function b(a,c,d){var g=f(d);g.pixels.forEach(function(b){var d=new Q(g.cube?b.target:a);d.channels=g.channels;d.compressed=g.compressed;d.type=g.type;d.internalformat=g.format;d.format=ia[g.format];d.width=b.width;d.height=b.height;d.miplevel=b.miplevel||c;d.data=b.data;e.push(d)})}function c(){for(var g=0;g<e.length;++g){var f=e[g],q=f.image,G=f.video,p=f.xhr;q&&q.complete?(f.width=q.naturalWidth,f.height=q.naturalHeight):G&&2<G.readyState?(f.width=G.width,f.height=G.height):
p&&4===p.readyState&&(e[g]=e[e.length-1],e.pop(),p.removeEventListener("readystatechange",X),b(f.target,f.miplevel,p.response))}U(d,e);X(a)}var d=a.params,e=a.pixels;e.forEach(function(a){a.image&&!a.image.complete?a.image.addEventListener("load",c):a.video&&1>a.readyState?a.video.addEventListener("progress",c):a.xhr&&a.xhr.addEventListener("readystatechange",c)});a.cancelPending=function(){e.forEach(function(a){a.image?a.image.removeEventListener("load",c):a.video?a.video.removeEventListener("progress",
c):a.xhr&&(a.xhr.removeEventListener("readystatechange",c),a.xhr.abort())})}}function V(a){var b=a.cancelPending;b&&(b(),a.cancelPending=null);b=a.pollId;0<=b&&((D[b]=D[D.length-1]).id=b,D.pop(),a.pollId=-1)}function H(b){var c=b.texture,d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),t=d,a.bindTexture(e,null),y[d]=null);V(b);a.isTexture(c)&&a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ca[b.id]}var m={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
R={repeat:10497,clamp:33071,mirror:33648},ga={nearest:9728,linear:9729},N=g({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ga),aa={none:0,browser:37444},S={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},T={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},Y={};e.ext_srgb&&(T.srgb=35904,T.srgba=35906);e.oes_texture_float&&(S["float"]=5126);e.oes_texture_half_float&&
(S["half float"]=36193);e.webgl_depth_texture&&(g(T,{depth:6402,"depth stencil":34041}),g(S,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&g(Y,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&g(Y,{"rgb arc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&g(Y,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(Y["rgb etc1"]=36196);var ha=Array.prototype.slice.call(a.getParameter(34467));Object.keys(Y).forEach(function(a){var b=Y[a];0<=ha.indexOf(b)&&(T[a]=b)});var oa=Object.keys(T);h.textureFormats=oa;var ia=oa.reduce(function(a,b){var c=T[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{});g(Q.prototype,{parseFlags:function(a){if("object"===typeof a&&a){"premultiplyAlpha"in
a&&(this.premultiplyAlpha=a.premultiplyAlpha);"flipY"in a&&(this.flipY=a.flipY);"alignment"in a&&(this.unpackAlignment=a.alignment);"colorSpace"in a&&(this.colorSpace=aa[a.colorSpace]);if("format"in a){var b=a.format;this.internalformat=T[b];b in S&&(this.type=S[b]);b in Y&&(this.compressed=!0)}"type"in a&&(this.type=S[a.type]);var b=this.width,c=this.height,d=this.channels;"shape"in a?(b=a.shape[0],c=a.shape[1],3===a.shape.length&&(d=a.shape[2])):("radius"in a&&(b=c=a.radius),"width"in a&&(b=a.width),
"height"in a&&(c=a.height),"channels"in a&&(d=a.channels));this.width=b|0;this.height=c|0;this.channels=d|0;"stride"in a?(b=a.stride,this.strideX=b[0],this.strideY=b[1],this.strideC=3===b.length?b[2]:1,this.needsTranspose=!0):(this.strideC=1,this.strideX=this.strideC*d,this.strideY=this.strideX*b);"offset"in a&&(this.offset=a.offset|0,this.needsTranspose=!0);"crossOrigin"in a&&(this.crossOrigin=a.crossOrigin)}},parse:function(a,e){this.miplevel=e;this.width>>=e;this.height>>=e;var f=a;switch(typeof a){case "object":if(!a)return;
this.parseFlags(a);var g=a.data;if("string"===typeof g||g&&(q(g)||d(g)||I(g)||b(g)||L(g)||"[object HTMLImageElement]"===c(g)||"[object HTMLVideoElement]"===c(g)||p(g)))f=a.data;break;case "undefined":return}"string"===typeof f&&(f=A(f,this.crossOrigin));var g=null,h=!1;if(null!==f)if(q(f))this.data=f;else if(d(f))g=f,h=!0;else if(I(f)){Array.isArray(f.data)?(g=f.data,h=!0):this.data=f.data;var k=f.shape;this.width=k[0];this.height=k[1];this.channels=3===k.length?k[2]:1;k=f.stride;this.strideX=f.stride[0];
this.strideY=f.stride[1];this.strideC=3===k.length?f.stride[2]:1;this.offset=f.offset;this.needsTranspose=!0}else if(b(f)||L(f))b(f)?this.canvas=f:this.canvas=f.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if("[object HTMLImageElement]"===c(f))this.image=f,f.complete?(this.width=f.naturalWidth,this.height=f.naturalHeight):(this.width=this.width||f.naturalWidth,this.height=this.height||f.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();
else if("[object HTMLVideoElement]"===c(f))this.video=f,1<f.readyState?(this.width=f.width,this.height=f.height):(this.width=this.width||f.width,this.height=this.height||f.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if("[object XMLHttpRequest]"===c(f))this.xhr=f,this.needsListeners=!0;else if(p(f)){var h=f[0].length,k=f.length,m=1,n,l,z,r;if(Array.isArray(f[0][0]))for(m=f[0][0].length,g=Array(h*k*m),l=r=0;l<k;++l)for(n=0;n<h;++n)for(z=0;z<m;++z)g[r++]=f[l][n][z];
else for(g=Array(h*k),l=r=0;l<k;++l)for(n=0;n<h;++n)g[r++]=f[l][n];this.width=h;this.height=k;this.channels=m;h=!0}else a.copy&&(this.copy=!0,this.x|=0,this.y|=0,this.width=(this.width||B.width)|0,this.height=(this.height||B.height)|0,this.setDefaultFormat());!this.type&&this.data&&(6402===this.format?this.data instanceof Uint16Array?this.type=5123:this.data instanceof Uint32Array&&(this.type=5125):this.data instanceof Float32Array&&(this.type=5126));this.internalformat||(this.internalformat=[6409,
6410,6407,6408][(this.channels=this.channels||4)-1]);f=this.internalformat;k=this.format=ia[f];if(!this.channels)switch(k){case 6409:case 6406:case 6402:this.channels=1;break;case 34041:case 6410:this.channels=2;break;case 6407:this.channels=3;break;default:this.channels=4}k=this.type;5126!==k&&36193!==k&&(k||(k=6402===f?5125:5121));this.type=k;if(h)switch(k){case 5121:this.data=new Uint8Array(g);break;case 5123:this.data=new Uint16Array(g);break;case 5125:this.data=new Uint32Array(g);break;case 5126:this.data=
new Float32Array(g);break;case 36193:this.data=u(g)}if(this.data&&this.needsTranspose){g=this.data;f=this.width;h=this.height;k=this.channels;m=this.strideX;n=this.strideY;l=this.strideC;z=this.offset;r=new g.constructor(f*h*k);for(var t=0,v=0;v<h;++v)for(var x=0;x<f;++x)for(var y=0;y<k;++y)r[t++]=g[n*v+m*x+l*y+z];this.data=r}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=6408;this.type=5121;this.channels=4;this.compressed=!1},upload:function(b){a.pixelStorei(37440,
this.flipY);a.pixelStorei(37441,this.premultiplyAlpha);a.pixelStorei(37443,this.colorSpace);a.pixelStorei(3317,this.unpackAlignment);var c=this.target,d=this.miplevel,e=this.image,f=this.canvas,g=this.video,h=this.data,q=this.internalformat,k=this.format,p=this.type,m=this.width||Math.max(1,b.width>>d);b=this.height||Math.max(1,b.height>>d);g&&2<g.readyState?a.texImage2D(c,d,k,k,p,g):e&&e.complete?a.texImage2D(c,d,k,k,p,e):f?a.texImage2D(c,d,k,k,p,f):this.compressed?a.compressedTexImage2D(c,d,q,m,
b,0,h):this.copy?(l(),a.copyTexImage2D(c,d,k,this.x,this.y,m,b,0)):h?a.texImage2D(c,d,k,m,b,0,k,p,h):a.texImage2D(c,d,k,m||1,b||1,0,k,p,null)}});g(x.prototype,{parse:function(a){if("object"===typeof a&&a){"min"in a&&(this.minFilter=N[a.min]);"mag"in a&&(this.magFilter=ga[a.mag]);var b=this.wrapS,c=this.wrapT;if("wrap"in a){var d=a.wrap;"string"===typeof d?b=c=R[d]:Array.isArray(d)&&(b=R[d[0]],c=R[d[1]])}else"wrapS"in a&&(b=R[a.wrapS]),"wrapT"in a&&(c=R[a.wrapT]);this.wrapS=b;this.wrapT=c;"anisotropic"in
a&&(this.anisotropic=a.anisotropic);if("mipmap"in a)switch(a=a.mipmap,typeof a){case "string":this.mipmapHint=m[a];this.genMipmaps=!0;break;case "boolean":this.genMipmaps=!!a}}},upload:function(){var b=this.target;a.texParameteri(b,10241,this.minFilter);a.texParameteri(b,10240,this.magFilter);a.texParameteri(b,10242,this.wrapS);a.texParameteri(b,10243,this.wrapT);e.ext_texture_filter_anisotropic&&a.texParameteri(b,34046,this.anisotropic);this.genMipmaps&&(a.hint(33170,this.mipmapHint),a.generateMipmap(b))}});
var t=0,k=0,ca={},D=[],M=h.maxTextureUnits,y=Array(M).map(function(){return null});g(P.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<M;++c){var d=y[c];if(d){if(0<d.bindCount)continue;d.unit=-1}y[c]=this;b=c;break}this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture);t=b}return b},unbind:function(){--this.bindCount},decRef:function(){0===--this.refCount&&H(this)}});return{create:function(a,b){function c(a,e,f,g,k,h){var q=a||{};34067===b&&
6===arguments.length&&(q=[a,e,f,g,k,h]);ka(d,q);c.width=d.params.width;c.height=d.params.height;return c}var d=new P(b);ca[d.id]=d;c(a);c._reglType="texture";c._texture=d;c.destroy=function(){d.decRef()};return c},refresh:function(){z(ca).forEach(X);for(var b=0;b<M;++b)y[b]=null;t=0;a.activeTexture(33984)},clear:function(){for(var b=0;b<M;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),y[b]=null;a.activeTexture(33984);t=0;z(ca).forEach(H)},poll:function(){D.forEach(X)},getTexture:function(a){return null}}}},
{"./util/extend":23,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/load-texture":26,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":31}],20:[function(e,h,l){h.exports=function(d){var e={};return{def:function(c){c=d.id(c);var b=e[c];b||(b=e[c]=[]);return b},uniforms:e}}},{}],21:[function(e,h,l){h.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,h,l){var d=e("./extend");h.exports=
function(){function e(){var b=[],g=[];return d(function(){b.push.apply(b,Array.prototype.slice.call(arguments))},{def:function(){var d="v"+c++;g.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,Array.prototype.slice.call(arguments)),b.push(";"));return d},toString:function(){return[0<g.length?"var "+g+";":"",b.join("")].join("")}})}var c=0,b=[],h=[],g={};return{link:function(d){var e="g"+c++;b.push(e);h.push(d);return e},block:e,proc:function(b){var h=[],l=e(),A=l.toString;return g[b]=d(l,
{arg:function(){var b="a"+c++;h.push(b);return b},toString:function(){return["function(",h.join(),"){",A(),"}"].join("")}})},compile:function(){var c=['"use strict";return {'];Object.keys(g).forEach(function(b){c.push('"',b,'":',g[b].toString(),",")});c.push("}");return Function.apply(null,b.concat([c.join("")])).apply(null,h)}}}},{"./extend":23}],23:[function(e,h,l){h.exports=function(d,e){for(var c=Object.keys(e),b=0;b<c.length;++b)d[c[b]]=e[c[b]];return d}},{}],24:[function(e,h,l){var d=e("./is-typed-array");
h.exports=function(e){return"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||d(e.data))}},{"./is-typed-array":25}],25:[function(e,h,l){var d=e("../constants/arraytypes.json");h.exports=function(e){return Object.prototype.toString.call(e)in d}},{"../constants/arraytypes.json":4}],26:[function(e,h,l){h.exports=function(d,e){if("undefined"!==typeof document){var c;c=(c=/\.(\w+)(\?.*)?$/.exec(d))&&
c[1]?c[1].toLowerCase():void 0;if(0<="avi asf gifv mov qt yuv mpg mpeg m2v mp4 m4p m4v ogg ogv vob webm wmv".split(" ").indexOf(c))return c=document.createElement("video"),c.autoplay=!0,c.loop=!0,e&&(c.crossOrigin=e),c.src=d,c;if(0<=["dds"].indexOf(c))return c=new XMLHttpRequest,c.responseType="arraybuffer",c.open("GET",d,!0),c.send(),c;c=new Image;e&&(c.crossOrigin=e);c.src=d;return c}return null}},{}],27:[function(e,h,l){h.exports=function(e){function h(a){for(var b=m,c=R,d=0;d<T;++d){var f=Math.max(1,
b+3>>2)*Math.max(1,c+3>>2)*aa;ha.pixels.push({target:a,miplevel:d,width:b,height:c,data:new Uint8Array(e,Y,f)});Y+=f;b>>=1;c>>=1}}var l=new Int32Array(e),H=l[E],m=l[Q],R=l[B],ga=q,N=0,aa=0,S=4;switch(l[P]){case f:aa=8;H&u?(S=3,N=c):N=b;break;case r:aa=16;N=L;break;case a:aa=16;N=g;break;case n:aa=8,N=z}var T=1;l[U]&I&&(T=Math.max(1,l[x]));var Y=l[v]+4,ha={width:m,height:R,channels:S,format:N,type:ga,compressed:!0,cube:!1,pixels:[]};if(l[ka]&A)for(ha.cube=!0,l=0;6>l;++l)h(p+l);else h(d);return ha};
var d=3553,p=34069,c=33776,b=33777,L=33778,g=33779,z=36196,q=5121,I=131072,A=512,u=64,f=827611204,r=861165636,a=894720068,n=826496069,v=1,E=2,B=3,Q=4,x=7,U=20,P=21,ka=28},{}],28:[function(e,h,l){h.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(d){return requestAnimationFrame(d)},cancel:function(d){return cancelAnimationFrame(d)}}:{next:function(d){setTimeout(d,30)},cancel:clearTimeout}},{}],29:[function(e,h,l){h.exports=function(d,e){var c=
d.length,b=d.slice(),h=d.slice(),g=!1,l=!0;return{push:function(){g=!1;for(var d=0;d<c;++d){var e=arguments[d];g=g||e!==h[d];b.push(e)}},pop:function(){g=!1;b.length-=c;for(var d=0;d<c;++d)g=g||b[b.length-c+d]!==h[d]},poll:function(){var d=b.length-c;if(g||l){switch(c){case 1:e(b[d]);break;case 2:e(b[d],b[d+1]);break;case 3:e(b[d],b[d+1],b[d+2]);break;case 4:e(b[d],b[d+1],b[d+2],b[d+3]);break;case 5:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4]);break;case 6:e(b[d],b[d+1],b[d+2],b[d+3],b[d+4],b[d+5]);break;
default:e.apply(null,b.slice(d,b.length))}for(var I=0;I<c;++I)h[I]=b[d+I];l=g=!1}},setDirty:function(){l=!0}}}},{}],30:[function(e,h,l){h.exports=function(d){for(var e=new Float32Array(d),e=new Uint32Array(e.buffer),c=new Uint16Array(d.length),b=0;b<d.length;++b)if(isNaN(d[b]))c[b]=65535;else if(Infinity===d[b])c[b]=31744;else if(-Infinity===d[b])c[b]=64512;else{var h=e[b],g=h>>>31<<15,l=(h<<1>>>24)-127,h=h>>13&1023;c[b]=-24>l?g:-14>l?g+(h+1024>>-14-l):15<l?g+31744:g+(l+15<<10)+h}return c}},{}],31:[function(e,
h,l){h.exports=function(d){return Object.keys(d).map(function(e){return d[e]})}},{}],32:[function(e,h,l){var d=e("./lib/util/extend"),p=e("./lib/context"),c=e("./lib/strings"),b=e("./lib/extension"),L=e("./lib/limits"),g=e("./lib/buffer"),z=e("./lib/elements"),q=e("./lib/texture"),I=e("./lib/renderbuffer"),A=e("./lib/framebuffer"),u=e("./lib/uniform"),f=e("./lib/attribute"),r=e("./lib/shader"),a=e("./lib/draw"),n=e("./lib/state"),v=e("./lib/compile"),E=e("./lib/read"),B=e("./lib/dynamic"),Q=e("./lib/util/raf"),
x=e("./lib/util/clock");h.exports=function(){function e(){ba=Q.next(e);M.count+=1;if(M.width!==m.drawingBufferWidth||M.height!==m.drawingBufferHeight)M.width=m.drawingBufferWidth,M.height=m.drawingBufferHeight,y.notifyViewportChanged();var a=x();M.dt=a-M.t;M.t=a;k.poll();for(var b=0;b<G.length;++b)(0,G[b])(M.count,M.t,M.dt);M.renderTime=x()-a}function h(){ba&&(Q.cancel(e),ba=0)}function l(a){h();a.preventDefault();if(R.onContextLost)R.onContextLost()}function X(a){m.getError();ga.refresh();T.refresh();
k.refresh();ca.refresh();D.refresh();ia.refresh();y.refresh();if(R.onContextRestored)R.onContextRestored();e()}function ja(a){function b(a){var d={},e={};Object.keys(a).forEach(function(b){var f=a[b];B.isDynamic(f)?(c=!0,e[b]=B.unbox(f,b)):d[b]=f});return{dynamic:e,"static":d}}var c=!1,e=b(a.uniforms||{}),f=b(a.attributes||{});a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;b("blend");
b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));var e=w.command(a["static"],e["static"],f["static"],a.dynamic,e.dynamic,f.dynamic,c),g=e.draw,h=e.batch,k=e.scope,l=[];return function(a,b){if("function"===typeof a)return k(null,a);if("function"===typeof b)return k(a,b);if("number"===typeof a){for(var c=a|0;l.length<c;)l.push(null);return h(a|0,l)}return Array.isArray(a)?h(a.length,a):g(a)}}function V(){D.poll();y.poll()}var H=p(Array.prototype.slice.call(arguments)),
m=H.gl,R=H.options,H=c(),ga=b(m),N=ga.extensions,aa={width:m.drawingBufferWidth,height:m.drawingBufferHeight},S=L(m,N),T=g(m),Y=z(m,N,T),ha=u(H),oa=f(m,N,S,T,H),ia=r(m,oa,ha,function(a){return w.draw(a)},H),t=a(m,N,T),k=q(m,N,S,V,aa),ca=I(m,N,S),D=A(m,N,S,k,ca),M={count:0,start:x(),dt:0,t:x(),renderTime:0,width:m.drawingBufferWidth,height:m.drawingBufferHeight,pixelRatio:R.pixelRatio},y=n(m,D,aa),aa=E(m,V,aa),w=v(m,H,N,S,T,Y,k,D,y,ha,oa,ia,t,M,V),O=m.canvas,G=[],ba=0;O&&(O.addEventListener("webglcontextlost",
l,!1),O.addEventListener("webglcontextrestored",X,!1));return d(ja,{clear:function(a){var b=0;V();var c=a.color;c&&(m.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(m.clearDepth(+a.depth),b|=256);"stencil"in a&&(m.clearStencil(a.stencil|0),b|=1024);m.clear(b)},prop:B.define,draw:ja({}),elements:function(a){return Y.create(a)},buffer:function(a){return T.create(a,34962)},texture:function(a){return k.create(a,3553)},cube:function(a){return 6===arguments.length?k.create(Array.prototype.slice.call(arguments),
34067):k.create(a,34067)},renderbuffer:function(a){return ca.create(a)},framebuffer:function(a){return D.create(a)},framebufferCube:function(a){},frame:function(a){G.push(a);!ba&&0<G.length&&e();return{cancel:function(){var b=G.find(function(b){return b===a});0>b||(G.splice(b,1),0>=G.length&&h())}}},stats:M,limits:S,read:aa,destroy:function(){h();O&&(O.removeEventListener("webglcontextlost",l),O.removeEventListener("webglcontextrestored",X));ia.clear();D.clear();ca.clear();k.clear();T.clear();if(R.onDestroy)R.onDestroy()}})}},
{"./lib/attribute":1,"./lib/buffer":2,"./lib/compile":3,"./lib/context":7,"./lib/draw":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/state":17,"./lib/strings":18,"./lib/texture":19,"./lib/uniform":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":28}]},{},[32])(32)});
